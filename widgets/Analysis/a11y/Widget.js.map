{"version":3,"sources":["../../../../widgets/Analysis/a11y/Widget.js"],"names":["define","lang","html","domAttr","domConstruct","query","on","keys","a11yclick","jimuUtils","mo","a11y_initFirstFocusNode","initFirstFocusNode","domNode","toolsSection","a11y_initLastFocusNode","itemNodes","toolsTbody","lastNode","length","initLastFocusNode","a11y_addTool","toolItemDOM","nameDiv","isValid","uniqId","getUUID","set","uniqNameId","uniqTipId","create","innerHTML","nls","toolNotAvailable","a11y_analysisTool_backBtn","backBtn","submitButton","currentAnalysisDijit","own","hitch","evt","keyCode","TAB","preventDefault","shiftKey","toolPanel","focus","_nextNode","getStyle","a11y_analysisTool_submitBtn","_submitBtn","_submitBtnLabel","getAttr","setAttr","click","toolCountInList","a11y_analysisTool_toolPanel","ESCAPE","stopPropagation","hasClass","target","a11y_updateTitleForMsgDom","jobStatus","JobInfo","titleId","toolTitle","statusId","messageStatusNode","idsArray","STATUS_SUCCEEDED","push","outputtip","messagePanel","join","a11y_addAttrsAndEventForCancelBtn","closeImg","a11y_addAttrsForOutputLink","outputLink","a11y_addAttrsForExportNode","exportNode","action","a11y_addMessagePanelEvent","buttonSection","cancelBtn","messageSection","homeBtn","a11y_switchToPrevious","ENTER","SPACE","_switchToPrevious","a11y_switchToHome","_switchToHome","a11y_switchView_toolList","a11y_switchView_others","idx","ANALYSIS_VIEW"],"mappings":"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","file":"Widget.js","sourcesContent":["///////////////////////////////////////////////////////////////////////////\r\n// Copyright Â© Esri. All Rights Reserved.\r\n//\r\n// Licensed under the Apache License Version 2.0 (the \"License\");\r\n// you may not use this file except in compliance with the License.\r\n// You may obtain a copy of the License at\r\n//\r\n//    http://www.apache.org/licenses/LICENSE-2.0\r\n//\r\n// Unless required by applicable law or agreed to in writing, software\r\n// distributed under the License is distributed on an \"AS IS\" BASIS,\r\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n// See the License for the specific language governing permissions and\r\n// limitations under the License.\r\n///////////////////////////////////////////////////////////////////////////\r\ndefine([\r\n    'dojo/_base/lang',\r\n    'dojo/_base/html',\r\n    'dojo/dom-attr',\r\n    'dojo/dom-construct',\r\n    \"dojo/query\",\r\n    'dojo/on',\r\n    'dojo/keys',\r\n    \"dijit/a11yclick\",\r\n    'jimu/utils'\r\n  ],\r\n  function (lang, html, domAttr, domConstruct, query, on, keys, a11yclick, jimuUtils) {\r\n    var mo = {};\r\n\r\n    mo.a11y_initFirstFocusNode = function () {\r\n      jimuUtils.initFirstFocusNode(this.domNode, this.toolsSection);\r\n    };\r\n\r\n    mo.a11y_initLastFocusNode = function () {\r\n      var itemNodes = query('.tools-table-item', this.toolsTbody);\r\n      var lastNode = itemNodes[itemNodes.length - 1];\r\n      if (lastNode) {\r\n        jimuUtils.initLastFocusNode(this.domNode, lastNode);\r\n      }\r\n    };\r\n\r\n    mo.a11y_addTool = function (toolItemDOM, nameDiv, isValid) {\r\n      var uniqId = jimuUtils.getUUID();\r\n      //toolItemDOM\r\n      domAttr.set(toolItemDOM, 'role', 'button');\r\n      domAttr.set(toolItemDOM, 'tabindex', '0');\r\n\r\n      //nameDiv\r\n      var uniqNameId = 'jimuUniq_name_' + uniqId;\r\n      domAttr.set(nameDiv, 'id', uniqNameId);\r\n\r\n      //isValid & tipDiv\r\n      if (isValid === true) {\r\n        domAttr.set(toolItemDOM, 'aria-labelledby', uniqNameId);\r\n      } else {\r\n        //add hidden tip\r\n        var uniqTipId = 'jimuUniq_tip_' + uniqId;\r\n        domConstruct.create(\"div\", {\r\n          'id': uniqTipId,\r\n          'class': 'icon-section screen-readers-only',\r\n          innerHTML: this.nls.toolNotAvailable\r\n        }, toolItemDOM);\r\n        domAttr.set(toolItemDOM, 'aria-disabled', 'true');\r\n        domAttr.set(toolItemDOM, 'aria-labelledby', uniqNameId + ' ' + uniqTipId);\r\n      }\r\n    };\r\n\r\n    mo.a11y_analysisTool_backBtn = function (backBtn, submitButton) {\r\n      domAttr.set(backBtn, 'role', 'button');\r\n      domAttr.set(backBtn, 'tabindex', '0');\r\n      this.currentAnalysisDijit.own(on(backBtn, 'keydown', lang.hitch(this, function (evt) {\r\n        if (evt.keyCode === keys.TAB) {\r\n          evt.preventDefault();\r\n          if (evt.shiftKey) {\r\n            this.toolPanel.focus();\r\n          } else {\r\n            var _nextNode = (html.getStyle(submitButton, 'display') !== 'none') ? submitButton : this.toolPanel;\r\n            _nextNode.focus();\r\n          }\r\n        }\r\n      })));\r\n    };\r\n\r\n    mo.a11y_analysisTool_submitBtn = function (backBtn, submitButton) {\r\n      var lastNode;\r\n      if (html.getStyle(submitButton, 'display') !== 'none') {\r\n        var _submitBtn = query('[role=\"button\"]', submitButton)[0];\r\n        var _submitBtnLabel = html.getAttr(_submitBtn, 'aria-labelledby');\r\n        html.setAttr(submitButton, 'aria-labelledby', _submitBtnLabel);\r\n        html.setAttr(submitButton, 'tabindex', '0');\r\n        html.setAttr(submitButton, 'role', 'button');\r\n        this.currentAnalysisDijit.own(on(submitButton, a11yclick, lang.hitch(this, function () {\r\n          _submitBtn.click();\r\n        })));\r\n\r\n        this.currentAnalysisDijit.own(on(submitButton, 'keydown', lang.hitch(this, function (evt) {\r\n          if (evt.keyCode === keys.TAB) {\r\n            evt.preventDefault();\r\n            if (evt.shiftKey) {\r\n              var _nextNode = backBtn ? backBtn : this.toolPanel;\r\n              _nextNode.focus();\r\n            } else {\r\n              this.toolPanel.focus();\r\n            }\r\n          }\r\n        })));\r\n        lastNode = submitButton;\r\n      } else if (backBtn) {\r\n        lastNode = backBtn;\r\n      } else { //no backBtn & sumitBtn is hidden\r\n        lastNode = this.toolPanel;\r\n      }\r\n\r\n      if (this.toolCountInList === 1) {\r\n        jimuUtils.initFirstFocusNode(this.domNode, this.toolPanel);\r\n        jimuUtils.initLastFocusNode(this.domNode, lastNode);\r\n      }\r\n    };\r\n\r\n    mo.a11y_analysisTool_toolPanel = function (backBtn, submitButton) {\r\n      this.own(on(this.toolPanel, 'keydown', lang.hitch(this, function (evt) {\r\n        if (evt.keyCode === keys.ESCAPE && backBtn) { //has back btn\r\n          evt.stopPropagation();\r\n          backBtn.focus();\r\n        } else if (html.hasClass(evt.target, 'tool-panel') && evt.keyCode === keys.TAB) {\r\n          evt.preventDefault();\r\n          var _submitBtn = (html.getStyle(submitButton, 'display') !== 'none') ? submitButton : null;\r\n          var _nextNode;\r\n          if (evt.shiftKey) {\r\n            _nextNode = _submitBtn || backBtn || this.toolPanel;\r\n          } else if (!evt.shiftKey) {\r\n            _nextNode = backBtn || _submitBtn || this.toolPanel;\r\n          }\r\n          _nextNode.focus();\r\n        }\r\n      })));\r\n    };\r\n\r\n    mo.a11y_updateTitleForMsgDom = function(jobStatus, JobInfo){\r\n      //update msg status\r\n      // this.messageStatusNode.innerHTML = jimuUtils.stripHTML(jobMsg);\r\n      //update aira-labelledby\r\n      var titleId = html.getAttr(this.toolTitle, 'id');\r\n      var statusId = html.getAttr(this.messageStatusNode, 'id');\r\n      var idsArray = [titleId, statusId];\r\n      if(jobStatus ===  JobInfo.STATUS_SUCCEEDED){//add noteTips when status's succeeded.\r\n        idsArray.push(html.getAttr(this.outputtip, 'id'));\r\n      }\r\n      html.setAttr(this.messagePanel, 'aria-labelledby', idsArray.join(' '));\r\n    };\r\n\r\n    mo.a11y_addAttrsAndEventForCancelBtn = function( closeImg){\r\n      domAttr.set(closeImg, 'role', 'button');\r\n      domAttr.set(closeImg, 'tabindex', '0');\r\n      this.own(on(closeImg, 'keydown', lang.hitch(this, function(evt){\r\n        if (!evt.shiftKey && evt.keyCode === keys.TAB) { //has back btn\r\n          evt.preventDefault();\r\n          this.messagePanel.focus();\r\n        }\r\n      })));\r\n    };\r\n\r\n    mo.a11y_addAttrsForOutputLink = function(outputLink){\r\n      domAttr.set(outputLink, 'role', 'link');\r\n    };\r\n\r\n    mo.a11y_addAttrsForExportNode = function(exportNode){\r\n      domAttr.set(exportNode, 'role', 'button');\r\n      domAttr.set(exportNode, 'aria-haspopup', 'true');\r\n      domAttr.set(exportNode, 'aria-label', this.nls.action);\r\n      domAttr.set(exportNode, 'tabindex', '0');\r\n    };\r\n\r\n    mo.a11y_addMessagePanelEvent = function(){\r\n      this.own(on(this.messagePanel, 'keydown', lang.hitch(this, function (evt) {\r\n        if (evt.keyCode === keys.ESCAPE) {\r\n          evt.stopPropagation();\r\n          if(html.getStyle(this.buttonSection, 'display') !== 'none'){//if has backBtn\r\n            this.backBtn.focus();\r\n          }\r\n        } else if (html.hasClass(evt.target, 'message-panel') && evt.keyCode === keys.TAB) {\r\n          var cancelBtn = query('.job-cancel-icon', this.messageSection)[0];\r\n          var lastNode = cancelBtn || (html.getStyle(this.buttonSection, 'display') !== 'none' ? this.homeBtn : null);\r\n          if(!lastNode){\r\n            evt.preventDefault();\r\n          }else if(evt.shiftKey){//shift+tab: focus on last node\r\n            evt.preventDefault();\r\n            lastNode.focus();\r\n          }\r\n        }\r\n      })));\r\n    };\r\n\r\n    mo.a11y_switchToPrevious = function(evt) {\r\n      if(evt.keyCode === keys.ENTER || evt.keyCode === keys.SPACE){\r\n        this._switchToPrevious();\r\n      }\r\n    };\r\n\r\n    mo.a11y_switchToHome = function(evt) {\r\n      if(evt.keyCode === keys.ENTER || evt.keyCode === keys.SPACE){\r\n        this._switchToHome();\r\n      }else if(!evt.shiftKey && evt.keyCode === keys.TAB){\r\n        evt.preventDefault();\r\n        this.messagePanel.focus();\r\n      }\r\n    };\r\n\r\n    mo.a11y_switchView_toolList = function () {\r\n      if (this.toolCountInList === 1) {\r\n        this.toolPanel.focus();\r\n      } else {\r\n        this.toolsSection.focus();\r\n      }\r\n    };\r\n\r\n    mo.a11y_switchView_others = function (idx, ANALYSIS_VIEW) {\r\n      if (idx === ANALYSIS_VIEW) {\r\n        this.toolPanel.focus();\r\n      } else {\r\n        this.messagePanel.focus();\r\n      }\r\n    };\r\n\r\n    return mo;\r\n  });"]}