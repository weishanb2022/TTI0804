{"version":3,"sources":["../../../widgets/Analysis/PortalAnalysis.js"],"names":["define","declare","lang","array","esriLang","userRole","portalSelf","constructor","canPerformAnalysis","privCheck","isAdmin","isPublisher","isCustom","canCreateItem","canPublishFeatures","canUseSpatialAnalysis","isPortal","isDefined","helperServices","analysis","url","canPerformSpatialAnalytics","isServiceAvailable","canPerformGeoAnalytics","geoanalytics","canPerformRasterAnalysis","rasterAnalytics","hasPrivileges","privileges","isArray","length","every","privilege","_canPerformNetworkAnalysis","_canPerformGeoEnrichment","_canPerformElevationAnalysis","_canPerformDriveAnalysis","_canPerformPlanRoutesAnalysis","_canPerformODAnalysis","_canPerformHydroAnalysis","_canPerformLocAllocationAnalysis","asyncClosestFacility","asyncServiceArea","asyncVRP","canUseNetworkAnalysis","geoenrichment","canUseGeoenrichment","elevation","routingUtilities","asyncRoute","_canPerformNearestAnalysis","asyncLocationAllocation","hydrology"],"mappings":"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","file":"PortalAnalysis.js","sourcesContent":["///////////////////////////////////////////////////////////////////////////\r\n// Copyright Â© Esri. All Rights Reserved.\r\n//\r\n// Licensed under the Apache License Version 2.0 (the \"License\");\r\n// you may not use this file except in compliance with the License.\r\n// You may obtain a copy of the License at\r\n//\r\n//    http://www.apache.org/licenses/LICENSE-2.0\r\n//\r\n// Unless required by applicable law or agreed to in writing, software\r\n// distributed under the License is distributed on an \"AS IS\" BASIS,\r\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n// See the License for the specific language governing permissions and\r\n// limitations under the License.\r\n///////////////////////////////////////////////////////////////////////////\r\n\r\ndefine([\r\n  'dojo/_base/declare',\r\n  'dojo/_base/lang',\r\n  'dojo/_base/array',\r\n  'esri/lang'\r\n], function(declare, lang, array, esriLang) {\r\n  return declare([], {\r\n    userRole: null,\r\n    portalSelf: null,\r\n\r\n    constructor: function(userRole, portalSelf){\r\n      this.userRole = userRole;\r\n      this.portalSelf = portalSelf;\r\n    },\r\n\r\n    canPerformAnalysis: function(){\r\n      var privCheck = false;\r\n      if (this.userRole && (this.userRole.isAdmin() || this.userRole.isPublisher())) {\r\n        privCheck = true;\r\n      } else if (this.userRole && this.userRole.isCustom()) {\r\n        privCheck = this.userRole.canCreateItem() &&\r\n            this.userRole.canPublishFeatures() &&\r\n            this.userRole.canUseSpatialAnalysis();\r\n      }\r\n\r\n      //check if helperservices are configured if running in portal.\r\n      //In online new trial orgs, analysis server is not configued until\r\n      //a feature service is created, hive is allocated, while job submission after\r\n      //createservice call its set\r\n      // Portal this is necessary condition for enabling analysis\r\n      if(this.portalSelf && this.portalSelf.isPortal) {\r\n        privCheck = privCheck &&\r\n            esriLang.isDefined(this.portalSelf.helperServices.analysis) &&\r\n            esriLang.isDefined(this.portalSelf.helperServices.analysis.url);\r\n      }\r\n      return privCheck;\r\n    },\r\n\r\n    canPerformSpatialAnalytics: function() {\r\n      var isServiceAvailable = esriLang.isDefined(this.portalSelf.helperServices.analysis) &&\r\n        esriLang.isDefined(this.portalSelf.helperServices.analysis.url);\r\n      return isServiceAvailable;\r\n    },\r\n\r\n    canPerformGeoAnalytics: function() {\r\n      var isServiceAvailable = esriLang.isDefined(this.portalSelf.helperServices.geoanalytics) &&\r\n        esriLang.isDefined(this.portalSelf.helperServices.geoanalytics.url);\r\n      return this.canPerformAnalysis() && isServiceAvailable;\r\n    },\r\n\r\n    canPerformRasterAnalysis: function () {\r\n      var isServiceAvailable = esriLang.isDefined(this.portalSelf.helperServices.rasterAnalytics) &&\r\n        esriLang.isDefined(this.portalSelf.helperServices.rasterAnalytics.url);\r\n      return this.canPerformAnalysis() && isServiceAvailable;\r\n    },\r\n\r\n    hasPrivileges: function(privileges){\r\n      if(lang.isArray(privileges) && privileges.length > 0){\r\n        return array.every(privileges, function(privilege){\r\n          if(privilege === 'networkanalysis'){\r\n            return this._canPerformNetworkAnalysis();\r\n          }else if(privilege === 'geoenrichment'){\r\n            return this._canPerformGeoEnrichment();\r\n          }else if(privilege === 'elevation'){\r\n            return this._canPerformElevationAnalysis();\r\n          }else if(privilege === 'drivetimearea'){\r\n            return this._canPerformDriveAnalysis();\r\n          }else if(privilege === 'planroutes'){\r\n            return this._canPerformPlanRoutesAnalysis();\r\n          }else if(privilege === 'od'){\r\n            return this._canPerformODAnalysis();\r\n          }else if(privilege === 'hydro'){\r\n            return this._canPerformHydroAnalysis();\r\n          }else if(privilege === 'loc'){\r\n            return this._canPerformLocAllocationAnalysis();\r\n          }else{\r\n            return false;\r\n          }\r\n        }, this);\r\n      }else{\r\n        return true;\r\n      }\r\n    },\r\n\r\n    _canPerformNetworkAnalysis: function() {\r\n      var isServiceAvailable =\r\n          esriLang.isDefined(this.portalSelf.helperServices.asyncClosestFacility) &&\r\n          esriLang.isDefined(this.portalSelf.helperServices.asyncServiceArea) &&\r\n          esriLang.isDefined(this.portalSelf.helperServices.asyncVRP);\r\n      return this.canPerformAnalysis() && isServiceAvailable &&\r\n          this.userRole.canUseNetworkAnalysis();\r\n    },\r\n\r\n    _canPerformGeoEnrichment: function() {\r\n      var isServiceAvailable =\r\n          esriLang.isDefined(this.portalSelf.helperServices.geoenrichment);\r\n      return this.canPerformAnalysis() && isServiceAvailable &&\r\n          this.userRole.canUseGeoenrichment();\r\n    },\r\n\r\n    _canPerformElevationAnalysis: function() {\r\n      var isServiceAvailable = esriLang.isDefined(this.portalSelf.helperServices.elevation);\r\n      return this.canPerformAnalysis() && isServiceAvailable;\r\n    },\r\n\r\n    _canPerformPlanRoutesAnalysis: function() {\r\n      var isServiceAvailable =\r\n          esriLang.isDefined(this.portalSelf.helperServices.routingUtilities) &&\r\n          esriLang.isDefined(this.portalSelf.helperServices.asyncVRP);\r\n      return this.canPerformAnalysis() && isServiceAvailable &&\r\n          this.userRole.canUseNetworkAnalysis();\r\n    },\r\n\r\n    _canPerformODAnalysis: function() {\r\n      var isServiceAvailable =\r\n          esriLang.isDefined(this.portalSelf.helperServices.routingUtilities) &&\r\n          esriLang.isDefined(this.portalSelf.helperServices.asyncRoute);\r\n      return this.canPerformAnalysis() && isServiceAvailable &&\r\n          this.userRole.canUseNetworkAnalysis();\r\n    },\r\n\r\n    _canPerformDriveAnalysis: function() {\r\n      var isServiceAvailable =\r\n          esriLang.isDefined(this.portalSelf.helperServices.routingUtilities) &&\r\n          esriLang.isDefined(this.portalSelf.helperServices.asyncServiceArea);\r\n      return this.canPerformAnalysis() && isServiceAvailable &&\r\n          this.userRole.canUseNetworkAnalysis();\r\n    },\r\n\r\n    _canPerformNearestAnalysis: function() {\r\n      var isServiceAvailable =\r\n          esriLang.isDefined(this.portalSelf.helperServices.routingUtilities) &&\r\n          esriLang.isDefined(this.portalSelf.helperServices.asyncClosestFacility);\r\n      return this.canPerformAnalysis() && isServiceAvailable &&\r\n          this.userRole.canUseNetworkAnalysis();\r\n    },\r\n\r\n    _canPerformLocAllocationAnalysis: function() {\r\n      var isServiceAvailable =\r\n          esriLang.isDefined(this.portalSelf.helperServices.routingUtilities) &&\r\n          esriLang.isDefined(this.portalSelf.helperServices.asyncLocationAllocation);\r\n      return this.canPerformAnalysis() && isServiceAvailable &&\r\n          this.userRole.canUseNetworkAnalysis();\r\n    },\r\n\r\n    _canPerformHydroAnalysis: function() {\r\n      var isServiceAvailable = esriLang.isDefined(this.portalSelf.helperServices.hydrology);\r\n      return this.canPerformAnalysis() && isServiceAvailable;\r\n    }\r\n  });\r\n});\r\n"]}