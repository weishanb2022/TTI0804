{"version":3,"sources":["../../../../widgets/AttributeTable/dgrid/Selection.js"],"names":["define","kernel","declare","Deferred","on","has","aspect","List","touchUtil","put","add","global","doc","element","compareDocumentPosition","style","prefixes","i","length","name","document","onselectstart","ctrlEquiv","hasUserSelect","hasPointer","hasMSPointer","slice","downType","upType","documentElement","msUserSelect","makeUnselectable","node","unselectable","value","elements","getElementsByTagName","tagName","setSelectable","grid","selectable","bodyNode","_selectstartHandle","evt","tag","target","preventDefault","remove","_unselectableHandle","after","row","selectionDelegate","selectionEvents","selectionTouchEvents","tap","deselectOnRefresh","allowSelectAll","selection","selectionMode","allowTextSelection","undefined","_selectionTargetType","create","inherited","arguments","postCreate","_initSelectionEvents","_setSelectionMode","destroy","_removeDeselectSignals","mode","clearSelection","_selectionHandlerName","_setAllowTextSelection","setSelectionMode","deprecated","set","allow","_handleSelect","event","allowSelect","type","parentType","_waitForMouseUp","_selectionTriggerEvent","keyCode","ctrlKey","shiftKey","isSelected","_singleSelectionHandler","_lastSelected","select","_multipleSelectionHandler","lastRow","_extendedSelectionHandler","button","_toggleSelectionHandler","contentNode","selector","_selectionEventQueues","deselect","_ignoreMouseSelect","addKeyHandler","test","className","allSelected","_setStore","_updateDeselectionAspect","self","store","beforeSignal","afterSignal","ifSelected","object","idToUpdate","methodName","id","idProperty","notify","before","rowElement","justCleanup","_fireSelectionEvent","queue","triggerEvent","eventObject","bubbles","emit","_fireSelectionEvents","queues","_select","toRow","previousValue","toElement","direction","addUiClasses","push","console","warn","_determineSelectionDirection","getElementById","from","to","result","sourceIndex","exceptId","dontResetLastSelected","selectAll","_rowIdToObject","data","refresh","renderArray","rows","when","selected"],"mappings":"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","file":"Selection.js","sourcesContent":["///////////////////////////////////////////////////////////////////////////\r\n// Copyright Â© Esri. All Rights Reserved.\r\n//\r\n// Licensed under the Apache License Version 2.0 (the \"License\");\r\n// you may not use this file except in compliance with the License.\r\n// You may obtain a copy of the License at\r\n//\r\n//    http://www.apache.org/licenses/LICENSE-2.0\r\n//\r\n// Unless required by applicable law or agreed to in writing, software\r\n// distributed under the License is distributed on an \"AS IS\" BASIS,\r\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n// See the License for the specific language governing permissions and\r\n// limitations under the License.\r\n///////////////////////////////////////////////////////////////////////////\r\n// jscs:disable\r\n/* jshint ignore:start */\r\ndefine([\"dojo/_base/kernel\", \"dojo/_base/declare\", \"dojo/_base/Deferred\", \"dojo/on\", \"dojo/has\", \"dojo/aspect\", \"dgrid/List\", \"dojo/has!touch?dgrid/util/touch\", \"put-selector/put\", \"dojo/query\", \"dojo/_base/sniff\"],\r\nfunction(kernel, declare, Deferred, on, has, aspect, List, touchUtil, put){\r\n\r\nhas.add(\"dom-comparedocumentposition\", function(global, doc, element){\r\n\treturn !!element.compareDocumentPosition;\r\n});\r\n\r\nhas.add(\"pointer\", function(global){\r\n\treturn \"PointerEvent\" in global ? \"pointer\" :\r\n\t\t\"MSPointerEvent\" in global ? \"MSPointer\" : false;\r\n});\r\n\r\n// Add feature test for user-select CSS property for optionally disabling\r\n// text selection.\r\n// (Can't use dom.setSelectable prior to 1.8.2 because of bad sniffs, see #15990)\r\nhas.add(\"css-user-select\", function(global, doc, element){\r\n\tvar style = element.style,\r\n\t\tprefixes = [\"Khtml\", \"O\", \"ms\", \"Moz\", \"Webkit\"],\r\n\t\ti = prefixes.length,\r\n\t\tname = \"userSelect\";\r\n\r\n\t// Iterate prefixes from most to least likely\r\n\tdo{\r\n\t\tif(typeof style[name] !== \"undefined\"){\r\n\t\t\t// Supported; return property name\r\n\t\t\treturn name;\r\n\t\t}\r\n\t}while(i-- && (name = prefixes[i] + \"UserSelect\"));\r\n\r\n\t// Not supported if we didn't return before now\r\n\treturn false;\r\n});\r\n\r\n// Also add a feature test for the onselectstart event, which offers a more\r\n// graceful fallback solution than node.unselectable.\r\nhas.add(\"dom-selectstart\", typeof document.onselectstart !== \"undefined\");\r\n\r\nvar ctrlEquiv = has(\"mac\") ? \"metaKey\" : \"ctrlKey\",\r\n\thasUserSelect = has(\"css-user-select\"),\r\n\thasPointer = has(\"pointer\"),\r\n\thasMSPointer = hasPointer && hasPointer.slice(0, 2) === \"MS\",\r\n\tdownType = hasPointer ? hasPointer + (hasMSPointer ? \"Down\" : \"down\") : \"mousedown\",\r\n\tupType = hasPointer ? hasPointer + (hasMSPointer ? \"Up\" : \"up\") : \"mouseup\";\r\n\r\nif (hasUserSelect === 'WebkitUserSelect' && typeof document.documentElement.style.msUserSelect !== 'undefined') {\r\n\t// Edge defines both webkit and ms prefixes, rendering feature detects as brittle as UA sniffs...\r\n\thasUserSelect = false;\r\n}\r\n\r\nfunction makeUnselectable(node, unselectable){\r\n\t// Utility function used in fallback path for recursively setting unselectable\r\n\tvar value = node.unselectable = unselectable ? \"on\" : \"\",\r\n\t\telements = node.getElementsByTagName(\"*\"),\r\n\t\ti = elements.length;\r\n\r\n\twhile(--i){\r\n\t\tif(elements[i].tagName === \"INPUT\" || elements[i].tagName === \"TEXTAREA\"){\r\n\t\t\tcontinue; // Don't prevent text selection in text input fields.\r\n\t\t}\r\n\t\telements[i].unselectable = value;\r\n\t}\r\n}\r\n\r\nfunction setSelectable(grid, selectable){\r\n\t// Alternative version of dojo/dom.setSelectable based on feature detection.\r\n\r\n\t// For FF < 21, use -moz-none, which will respect -moz-user-select: text on\r\n\t// child elements (e.g. form inputs).  In FF 21, none behaves the same.\r\n\t// See https://developer.mozilla.org/en-US/docs/CSS/user-select\r\n\tvar node = grid.bodyNode,\r\n\t\tvalue = selectable ? \"text\" : has(\"ff\") < 21 ? \"-moz-none\" : \"none\";\r\n\r\n\t// In IE10+, -ms-user-select: none will block selection from starting within the\r\n\t// element, but will not block an existing selection from entering the element.\r\n\t// When using a modifier key, IE will select text inside of the element as well\r\n\t// as outside of the element, because it thinks the selection started outside.\r\n\t// Therefore, fall back to other means of blocking selection for IE10+.\r\n\tif(hasUserSelect && hasUserSelect !== \"msUserSelect\"){\r\n\t\tnode.style[hasUserSelect] = value;\r\n\t}else if(has(\"dom-selectstart\")){\r\n\t\t// For browsers that don't support user-select but support selectstart (IE<10),\r\n\t\t// we can hook up an event handler as necessary.  Since selectstart bubbles,\r\n\t\t// it will handle any child elements as well.\r\n\t\t// Note, however, that both this and the unselectable fallback below are\r\n\t\t// incapable of preventing text selection from outside the targeted node.\r\n\t\tif(!selectable && !grid._selectstartHandle){\r\n\t\t\tgrid._selectstartHandle = on(node, \"selectstart\", function(evt){\r\n\t\t\t\tvar tag = evt.target && evt.target.tagName;\r\n\r\n\t\t\t\t// Prevent selection except where a text input field is involved.\r\n\t\t\t\tif(tag !== \"INPUT\" && tag !== \"TEXTAREA\"){\r\n\t\t\t\t\tevt.preventDefault();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}else if(selectable && grid._selectstartHandle){\r\n\t\t\tgrid._selectstartHandle.remove();\r\n\t\t\tdelete grid._selectstartHandle;\r\n\t\t}\r\n\t}else{\r\n\t\t// For browsers that don't support either user-select or selectstart (Opera),\r\n\t\t// we need to resort to setting the unselectable attribute on all nodes\r\n\t\t// involved.  Since this doesn't automatically apply to child nodes, we also\r\n\t\t// need to re-apply it whenever rows are rendered.\r\n\t\tmakeUnselectable(node, !selectable);\r\n\t\tif(!selectable && !grid._unselectableHandle){\r\n\t\t\tgrid._unselectableHandle = aspect.after(grid, \"renderRow\", function(row){\r\n\t\t\t\tmakeUnselectable(row, true);\r\n\t\t\t\treturn row;\r\n\t\t\t});\r\n\t\t}else if(selectable && grid._unselectableHandle){\r\n\t\t\tgrid._unselectableHandle.remove();\r\n\t\t\tdelete grid._unselectableHandle;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nreturn declare(\"dgrid.Selection\", null, {\r\n\t// summary:\r\n\t//\t\tAdd selection capabilities to a grid. The grid will have a selection property and\r\n\t//\t\tfire \"dgrid-select\" and \"dgrid-deselect\" events.\r\n\r\n\t// selectionDelegate: String\r\n\t//\t\tSelector to delegate to as target of selection events.\r\n\tselectionDelegate: \".dgrid-cell.dgrid-cell-padding.dgrid-column-selectionHandle.field-selectionHandle.selection-handle-column\", //\".dgrid-row\",\r\n\r\n\t// selectionEvents: String|Function\r\n\t//\t\tEvent (or comma-delimited events, or extension event) to listen on\r\n\t//\t\tto trigger select logic.\r\n\tselectionEvents: downType + \",\" + upType + \",dgrid-cellfocusin\",\r\n\r\n\t// selectionTouchEvents: String|Function\r\n\t//\t\tEvent (or comma-delimited events, or extension event) to listen on\r\n\t//\t\tin addition to selectionEvents for touch devices.\r\n\tselectionTouchEvents: has(\"touch\") ? touchUtil.tap : null,\r\n\r\n\t// deselectOnRefresh: Boolean\r\n\t//\t\tIf true, the selection object will be cleared when refresh is called.\r\n\tdeselectOnRefresh: true,\r\n\r\n\t// allowSelectAll: Boolean\r\n\t//\t\tIf true, allow ctrl/cmd+A to select all rows.\r\n\t//\t\tAlso consulted by the selector plugin for showing select-all checkbox.\r\n\tallowSelectAll: false,\r\n\r\n\t// selection:\r\n\t//\t\tAn object where the property names correspond to\r\n\t//\t\tobject ids and values are true or false depending on whether an item is selected\r\n\tselection: {},\r\n\r\n\t// selectionMode: String\r\n\t//\t\tThe selection mode to use, can be \"none\", \"multiple\", \"single\", or \"extended\".\r\n\tselectionMode: \"extended\",\r\n\r\n\t// allowTextSelection: Boolean\r\n\t//\t\tWhether to still allow text within cells to be selected.  The default\r\n\t//\t\tbehavior is to allow text selection only when selectionMode is none;\r\n\t//\t\tsetting this property to either true or false will explicitly set the\r\n\t//\t\tbehavior regardless of selectionMode.\r\n\tallowTextSelection: undefined,\r\n\r\n\t// _selectionTargetType: String\r\n\t//\t\tIndicates the property added to emitted events for selected targets;\r\n\t//\t\toverridden in CellSelection\r\n\t_selectionTargetType: \"rows\",\r\n\r\n\tcreate: function(){\r\n\t\tthis.selection = {};\r\n\t\treturn this.inherited(arguments);\r\n\t},\r\n\tpostCreate: function(){\r\n\t\tthis.inherited(arguments);\r\n\r\n\t\tthis._initSelectionEvents();\r\n\r\n\t\t// Force selectionMode setter to run\r\n\t\tvar selectionMode = this.selectionMode;\r\n\t\tthis.selectionMode = \"\";\r\n\t\tthis._setSelectionMode(selectionMode);\r\n\t},\r\n\r\n\tdestroy: function(){\r\n\t\tthis.inherited(arguments);\r\n\r\n\t\t// Remove any extra handles added by Selection.\r\n\t\tif(this._selectstartHandle){ this._selectstartHandle.remove(); }\r\n\t\tif(this._unselectableHandle){ this._unselectableHandle.remove(); }\r\n\t\tif(this._removeDeselectSignals){ this._removeDeselectSignals(); }\r\n\t},\r\n\r\n\t_setSelectionMode: function(mode){\r\n\t\t// summary:\r\n\t\t//\t\tUpdates selectionMode, resetting necessary variables.\r\n\t\tif(mode == this.selectionMode){ return; } // prevent unnecessary spinning\r\n\r\n\t\t// Start selection fresh when switching mode.\r\n\t\tthis.clearSelection();\r\n\r\n\t\tthis.selectionMode = mode;\r\n\r\n\t\t// Compute name of selection handler for this mode once\r\n\t\t// (in the form of _fooSelectionHandler)\r\n\t\tthis._selectionHandlerName = \"_\" + mode + \"SelectionHandler\";\r\n\r\n\t\t// Also re-run allowTextSelection setter in case it is in automatic mode.\r\n\t\tthis._setAllowTextSelection(this.allowTextSelection);\r\n\t},\r\n\tsetSelectionMode: function(mode){\r\n\t\tkernel.deprecated(\"setSelectionMode(...)\", 'use set(\"selectionMode\", ...) instead', \"dgrid 0.4\");\r\n\t\tthis.set(\"selectionMode\", mode);\r\n\t},\r\n\r\n\t_setAllowTextSelection: function(allow){\r\n\t\tif(typeof allow !== \"undefined\"){\r\n\t\t\tsetSelectable(this, allow);\r\n\t\t}else{\r\n\t\t\tsetSelectable(this, this.selectionMode === \"none\");\r\n\t\t}\r\n\t\tthis.allowTextSelection = allow;\r\n\t},\r\n\r\n\t_handleSelect: function(event, target){\r\n\t\t// Don't run if selection mode doesn't have a handler (incl. \"none\"), target can't be selected,\r\n\t\t// or if coming from a dgrid-cellfocusin from a mousedown\r\n\t\tif(!this[this._selectionHandlerName] || !this.allowSelect(this.row(target)) ||\r\n\t\t\t\t(event.type === \"dgrid-cellfocusin\" && event.parentType === \"mousedown\") ||\r\n\t\t\t\t(event.type === upType && target != this._waitForMouseUp)){\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis._waitForMouseUp = null;\r\n\t\tthis._selectionTriggerEvent = event;\r\n\r\n\t\t// Don't call select handler for ctrl+navigation\r\n\t\tif(!event.keyCode || !event.ctrlKey || event.keyCode == 32){\r\n\t\t\t// If clicking a selected item, wait for mouseup so that drag n' drop\r\n\t\t\t// is possible without losing our selection\r\n\t\t\tif(!event.shiftKey && event.type === downType && this.isSelected(target)){\r\n\t\t\t\tthis._waitForMouseUp = target;\r\n\t\t\t}else{\r\n\t\t\t\tthis[this._selectionHandlerName](event, target);\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis._selectionTriggerEvent = null;\r\n\t},\r\n\r\n\t_singleSelectionHandler: function(event, target){\r\n\t\t// summary:\r\n\t\t//\t\tSelection handler for \"single\" mode, where only one target may be\r\n\t\t//\t\tselected at a time.\r\n\r\n\t\tvar ctrlKey = event.keyCode ? event.ctrlKey : event[ctrlEquiv];\r\n\t\tif(this._lastSelected === target){\r\n\t\t\t// Allow ctrl to toggle selection, even within single select mode.\r\n\t\t\tthis.select(target, null, !ctrlKey || !this.isSelected(target));\r\n\t\t}else{\r\n\t\t\tthis.clearSelection();\r\n\t\t\tthis.select(target);\r\n\t\t\tthis._lastSelected = target;\r\n\t\t}\r\n\t},\r\n\r\n\t_multipleSelectionHandler: function(event, target){\r\n\t\t// summary:\r\n\t\t//\t\tSelection handler for \"multiple\" mode, where shift can be held to\r\n\t\t//\t\tselect ranges, ctrl/cmd can be held to toggle, and clicks/keystrokes\r\n\t\t//\t\twithout modifier keys will add to the current selection.\r\n\r\n\t\tvar lastRow = this._lastSelected,\r\n\t\t\tctrlKey = event.keyCode ? event.ctrlKey : event[ctrlEquiv],\r\n\t\t\tvalue;\r\n\r\n\t\tif(!event.shiftKey){\r\n\t\t\t// Toggle if ctrl is held; otherwise select\r\n\t\t\tvalue = ctrlKey ? null : true;\r\n\t\t\tlastRow = null;\r\n\t\t}\r\n\t\tthis.select(target, lastRow, value);\r\n\r\n\t\tif(!lastRow){\r\n\t\t\t// Update reference for potential subsequent shift+select\r\n\t\t\t// (current row was already selected above)\r\n\t\t\tthis._lastSelected = target;\r\n\t\t}\r\n\t},\r\n\r\n\t_extendedSelectionHandler: function(event, target){\r\n\t\t// summary:\r\n\t\t//\t\tSelection handler for \"extended\" mode, which is like multiple mode\r\n\t\t//\t\texcept that clicks/keystrokes without modifier keys will clear\r\n\t\t//\t\tthe previous selection.\r\n\r\n\t\t// Clear selection first for right-clicks outside selection and non-ctrl-clicks;\r\n\t\t// otherwise, extended mode logic is identical to multiple mode\r\n\t\tif(event.button === 2 ? !this.isSelected(target) :\r\n\t\t\t\t!(event.keyCode ? event.ctrlKey : event[ctrlEquiv])){\r\n\t\t\tthis.clearSelection(null, true);\r\n\t\t}\r\n\t\tthis._multipleSelectionHandler(event, target);\r\n\t},\r\n\r\n\t_toggleSelectionHandler: function(event, target){\r\n\t\t// summary:\r\n\t\t//\t\tSelection handler for \"toggle\" mode which simply toggles the selection\r\n\t\t//\t\tof the given target.  Primarily useful for touch input.\r\n\r\n\t\tthis.select(target, null, null);\r\n\t},\r\n\r\n\t_initSelectionEvents: function(){\r\n\t\t// summary:\r\n\t\t//\t\tPerforms first-time hookup of event handlers containing logic\r\n\t\t//\t\trequired for selection to operate.\r\n\r\n\t\tvar grid = this,\r\n\t\t\tcontentNode = this.contentNode,\r\n\t\t\tselector = this.selectionDelegate;\r\n\r\n\t\tthis._selectionEventQueues = {\r\n\t\t\tdeselect: [],\r\n\t\t\tselect: []\r\n\t\t};\r\n\r\n\t\tif(has(\"touch\") && !has(\"pointer\") && this.selectionTouchEvents){\r\n\t\t\t// Listen for taps, and also for mouse/keyboard, making sure not\r\n\t\t\t// to trigger both for the same interaction\r\n\t\t\ton(contentNode, touchUtil.selector(selector, this.selectionTouchEvents), function(evt){\r\n\t\t\t\tgrid._handleSelect(evt, this);\r\n\t\t\t\tgrid._ignoreMouseSelect = this;\r\n\t\t\t});\r\n\t\t\ton(contentNode, on.selector(selector, this.selectionEvents), function(event){\r\n\t\t\t\tif(grid._ignoreMouseSelect !== this){\r\n\t\t\t\t\tgrid._handleSelect(event, this);\r\n\t\t\t\t}else if(event.type === upType){\r\n\t\t\t\t\tgrid._ignoreMouseSelect = null;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}else{\r\n\t\t\t// Listen for mouse/keyboard actions that should cause selections\r\n\t\t\ton(contentNode, on.selector(selector, this.selectionEvents), function(event){\r\n\t\t\t\tgrid._handleSelect(event, this);\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// Also hook up spacebar (for ctrl+space)\r\n\t\tif(this.addKeyHandler){\r\n\t\t\tthis.addKeyHandler(32, function(event){\r\n\t\t\t\tgrid._handleSelect(event, event.target);\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// If allowSelectAll is true, bind ctrl/cmd+A to (de)select all rows,\r\n\t\t// unless the event was received from an editor component.\r\n\t\t// (Handler further checks against _allowSelectAll, which may be updated\r\n\t\t// if selectionMode is changed post-init.)\r\n\t\tif(this.allowSelectAll){\r\n\t\t\tthis.on(\"keydown\", function(event) {\r\n\t\t\t\tif(event[ctrlEquiv] && event.keyCode == 65 &&\r\n\t\t\t\t\t\t!/\\bdgrid-input\\b/.test(event.target.className)){\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\tgrid[grid.allSelected ? \"clearSelection\" : \"selectAll\"]();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// Update aspects if there is a store change\r\n\t\tif(this._setStore){\r\n\t\t\taspect.after(this, \"_setStore\", function(){\r\n\t\t\t\tgrid._updateDeselectionAspect();\r\n\t\t\t});\r\n\t\t}\r\n\t\tthis._updateDeselectionAspect();\r\n\t},\r\n\r\n\t_updateDeselectionAspect: function(){\r\n\t\t// summary:\r\n\t\t//\t\tHooks up logic to handle deselection of removed items.\r\n\t\t//\t\tAspects to an observable store's notify method if applicable,\r\n\t\t//\t\tor to the list/grid's removeRow method otherwise.\r\n\r\n\t\tvar self = this,\r\n\t\t\tstore = this.store,\r\n\t\t\tbeforeSignal,\r\n\t\t\tafterSignal;\r\n\r\n\t\tfunction ifSelected(object, idToUpdate, methodName){\r\n\t\t\t// Calls a method if the row corresponding to the object is selected.\r\n\t\t\tvar id = idToUpdate || (object && object[self.idProperty || \"id\"]);\r\n\t\t\tif(id != null){\r\n\t\t\t\tvar row = self.row(id),\r\n\t\t\t\t\tselection = row && self.selection[row.id];\r\n\t\t\t\t// Is the row currently in the selection list.\r\n\t\t\t\tif(selection){\r\n\t\t\t\t\tself[methodName](row, null, selection);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Remove anything previously configured\r\n\t\tif(this._removeDeselectSignals){\r\n\t\t\tthis._removeDeselectSignals();\r\n\t\t}\r\n\r\n\t\t// Is there currently an observable store?\r\n\t\tif(store && store.notify){\r\n\t\t\tbeforeSignal = aspect.before(store, \"notify\", function(object, idToUpdate){\r\n\t\t\t\tif(!object){\r\n\t\t\t\t\t// Call deselect on the row if the object is being removed.  This allows the\r\n\t\t\t\t\t// deselect event to reference the row element while it still exists in the DOM.\r\n\t\t\t\t\tifSelected(object, idToUpdate, \"deselect\");\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tafterSignal = aspect.after(store, \"notify\", function(object, idToUpdate){\r\n\t\t\t\t// When List updates an item, the row element is removed and a new one inserted.\r\n\t\t\t\t// If at this point the object is still in grid.selection, then call select on the row so the\r\n\t\t\t\t// element's CSS is updated.  If the object was removed then the aspect-before has already deselected it.\r\n\t\t\t\tifSelected(object, idToUpdate, \"select\");\r\n\t\t\t}, true);\r\n\r\n\t\t\tthis._removeDeselectSignals = function(){\r\n\t\t\t\tbeforeSignal.remove();\r\n\t\t\t\tafterSignal.remove();\r\n\t\t\t};\r\n\t\t}else{\r\n\t\t\tbeforeSignal = aspect.before(this, \"removeRow\", function(rowElement, justCleanup){\r\n\t\t\t\tvar row;\r\n\t\t\t\tif(!justCleanup){\r\n\t\t\t\t\trow = this.row(rowElement);\r\n\t\t\t\t\t// if it is a real row removal for a selected item, deselect it\r\n\t\t\t\t\tif(row && (row.id in this.selection)){\r\n\t\t\t\t\t\tthis.deselect(row);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tthis._removeDeselectSignals = function(){\r\n\t\t\t\tbeforeSignal.remove();\r\n\t\t\t};\r\n\t\t}\r\n\t},\r\n\r\n\tallowSelect: function(row){\r\n\t\t// summary:\r\n\t\t//\t\tA method that can be overriden to determine whether or not a row (or\r\n\t\t//\t\tcell) can be selected. By default, all rows (or cells) are selectable.\r\n\t\treturn true;\r\n\t},\r\n\r\n\t_fireSelectionEvent: function(type){\r\n\t\t// summary:\r\n\t\t//\t\tFires an event for the accumulated rows once a selection\r\n\t\t//\t\toperation is finished (whether singular or for a range)\r\n\r\n\t\tvar queue = this._selectionEventQueues[type],\r\n\t\t\ttriggerEvent = this._selectionTriggerEvent,\r\n\t\t\teventObject;\r\n\r\n\t\teventObject = {\r\n\t\t\tbubbles: true,\r\n\t\t\tgrid: this\r\n\t\t};\r\n\t\tif(triggerEvent){\r\n\t\t\teventObject.parentType = triggerEvent.type;\r\n\t\t}\r\n\t\teventObject[this._selectionTargetType] = queue;\r\n\r\n\t\t// Clear the queue so that the next round of (de)selections starts anew\r\n\t\tthis._selectionEventQueues[type] = [];\r\n\r\n\t\ton.emit(this.contentNode, \"dgrid-\" + type, eventObject);\r\n\t},\r\n\r\n\t_fireSelectionEvents: function(){\r\n\t\tvar queues = this._selectionEventQueues,\r\n\t\t\ttype;\r\n\r\n\t\tfor(type in queues){\r\n\t\t\tif(queues[type].length){\r\n\t\t\t\tthis._fireSelectionEvent(type);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t_select: function(row, toRow, value){\r\n\t\t// summary:\r\n\t\t//\t\tContains logic for determining whether to select targets, but\r\n\t\t//\t\tdoes not emit events.  Called from select, deselect, selectAll,\r\n\t\t//\t\tand clearSelection.\r\n\r\n\t\tvar selection,\r\n\t\t\tpreviousValue,\r\n\t\t\telement,\r\n\t\t\ttoElement,\r\n\t\t\tdirection;\r\n\r\n\t\tif(typeof value === \"undefined\"){\r\n\t\t\t// default to true\r\n\t\t\tvalue = true;\r\n\t\t}\r\n\t\tif(!row.element){\r\n\t\t\trow = this.row(row);\r\n\t\t}\r\n\r\n\t\t// Check whether we're allowed to select the given row before proceeding.\r\n\t\t// If a deselect operation is being performed, this check is skipped,\r\n\t\t// to avoid errors when changing column definitions, and since disabled\r\n\t\t// rows shouldn't ever be selected anyway.\r\n\t\tif(value === false || this.allowSelect(row)){\r\n\t\t\tselection = this.selection;\r\n\t\t\tpreviousValue = !!selection[row.id];\r\n\t\t\tif(value === null){\r\n\t\t\t\t// indicates a toggle\r\n\t\t\t\tvalue = !previousValue;\r\n\t\t\t}\r\n\t\t\telement = row.element;\r\n\t\t\tif(!value && !this.allSelected){\r\n\t\t\t\tdelete this.selection[row.id];\r\n\t\t\t}else{\r\n\t\t\t\tselection[row.id] = value;\r\n\t\t\t}\r\n\t\t\tif(element){\r\n\t\t\t\t// add or remove classes as appropriate\r\n\t\t\t\tif(value){\r\n\t\t\t\t\tput(element, \".dgrid-selected\" +\r\n\t\t\t\t\t\t(this.addUiClasses ? \".ui-state-active\" : \"\"));\r\n\t\t\t\t}else{\r\n\t\t\t\t\tput(element, \"!dgrid-selected!ui-state-active\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif(value !== previousValue && element){\r\n\t\t\t\t// add to the queue of row events\r\n\t\t\t\tthis._selectionEventQueues[(value ? \"\" : \"de\") + \"select\"].push(row);\r\n\t\t\t}\r\n\r\n\t\t\tif(toRow){\r\n\t\t\t\tif(!toRow.element){\r\n\t\t\t\t\ttoRow = this.row(toRow);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(!toRow){\r\n\t\t\t\t\tthis._lastSelected = element;\r\n\t\t\t\t\tconsole.warn(\"The selection range has been reset because the \" +\r\n\t\t\t\t\t\t\"beginning of the selection is no longer in the DOM. \" +\r\n\t\t\t\t\t\t\"If you are using OnDemandList, you may wish to increase \" +\r\n\t\t\t\t\t\t\"farOffRemoval to avoid this, but note that keeping more nodes \" +\r\n\t\t\t\t\t\t\"in the DOM may impact performance.\");\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\ttoElement = toRow.element;\r\n\t\t\t\tif(toElement){\r\n\t\t\t\t\tdirection = this._determineSelectionDirection(element, toElement);\r\n\t\t\t\t\tif(!direction){\r\n\t\t\t\t\t\t// The original element was actually replaced\r\n\t\t\t\t\t\ttoElement = document.getElementById(toElement.id);\r\n\t\t\t\t\t\tdirection = this._determineSelectionDirection(element, toElement);\r\n\t\t\t\t\t}\r\n\t\t\t\t\twhile(row.element != toElement && (row = this[direction](row))){\r\n\t\t\t\t\t\tthis._select(row, null, value);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t// Implement _determineSelectionDirection differently based on whether the\r\n\t// browser supports element.compareDocumentPosition; use sourceIndex for IE<9\r\n\t_determineSelectionDirection: has(\"dom-comparedocumentposition\") ? function (from, to) {\r\n\t\tvar result = to.compareDocumentPosition(from);\r\n\t\tif(result & 1){\r\n\t\t\treturn false; // Out of document\r\n\t\t}\r\n\t\treturn result === 2 ? \"down\" : \"up\";\r\n\t} : function(from, to) {\r\n\t\tif(to.sourceIndex < 1){\r\n\t\t\treturn false; // Out of document\r\n\t\t}\r\n\t\treturn to.sourceIndex > from.sourceIndex ? \"down\" : \"up\";\r\n\t},\r\n\r\n\tselect: function(row, toRow, value){\r\n\t\t// summary:\r\n\t\t//\t\tSelects or deselects the given row or range of rows.\r\n\t\t// row: Mixed\r\n\t\t//\t\tRow object (or something that can resolve to one) to (de)select\r\n\t\t// toRow: Mixed\r\n\t\t//\t\tIf specified, the inclusive range between row and toRow will\r\n\t\t//\t\tbe (de)selected\r\n\t\t// value: Boolean|Null\r\n\t\t//\t\tWhether to select (true/default), deselect (false), or toggle\r\n\t\t//\t\t(null) the row\r\n\r\n\t\tthis._select(row, toRow, value);\r\n\t\tthis._fireSelectionEvents();\r\n\t},\r\n\tdeselect: function(row, toRow){\r\n\t\t// summary:\r\n\t\t//\t\tDeselects the given row or range of rows.\r\n\t\t// row: Mixed\r\n\t\t//\t\tRow object (or something that can resolve to one) to deselect\r\n\t\t// toRow: Mixed\r\n\t\t//\t\tIf specified, the inclusive range between row and toRow will\r\n\t\t//\t\tbe deselected\r\n\r\n\t\tthis.select(row, toRow, false);\r\n\t},\r\n\r\n\tclearSelection: function(exceptId, dontResetLastSelected){\r\n\t\t// summary:\r\n\t\t//\t\tDeselects any currently-selected items.\r\n\t\t// exceptId: Mixed?\r\n\t\t//\t\tIf specified, the given id will not be deselected.\r\n\r\n\t\tthis.allSelected = false;\r\n\t\tfor(var id in this.selection){\r\n\t\t\tif(exceptId !== id){\r\n\t\t\t\tthis._select(id, null, false);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(!dontResetLastSelected){\r\n\t\t\tthis._lastSelected = null;\r\n\t\t}\r\n\t\tthis._fireSelectionEvents();\r\n\t},\r\n\tselectAll: function(){\r\n\t\tthis.allSelected = true;\r\n\t\tthis.selection = {}; // we do this to clear out pages from previous sorts\r\n\t\tfor(var i in this._rowIdToObject){\r\n\t\t\tvar row = this.row(this._rowIdToObject[i]);\r\n\t\t\tthis._select(row.id, null, true);\r\n\t\t}\r\n\t\tthis._fireSelectionEvents();\r\n\t},\r\n\r\n\tisSelected: function(object){\r\n\t\t// summary:\r\n\t\t//\t\tReturns true if the indicated row is selected.\r\n\r\n\t\tif(typeof object === \"undefined\" || object === null){\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tif(!object.element){\r\n\t\t\tobject = this.row(object);\r\n\t\t}\r\n\r\n\t\t// First check whether the given row is indicated in the selection hash;\r\n\t\t// failing that, check if allSelected is true (testing against the\r\n\t\t// allowSelect method if possible)\r\n\t\treturn (object.id in this.selection) ? !!this.selection[object.id] :\r\n\t\t\tthis.allSelected && (!object.data || this.allowSelect(object));\r\n\t},\r\n\r\n\trefresh: function(){\r\n\t\tif(this.deselectOnRefresh){\r\n\t\t\tthis.clearSelection();\r\n\t\t}\r\n\t\tthis._lastSelected = null;\r\n\t\treturn this.inherited(arguments);\r\n\t},\r\n\r\n\trenderArray: function(){\r\n\t\tvar grid = this,\r\n\t\t\trows = this.inherited(arguments);\r\n\r\n\t\tDeferred.when(rows, function(rows){\r\n\t\t\tvar selection = grid.selection,\r\n\t\t\t\ti, row, selected;\r\n\t\t\tfor(i = 0; i < rows.length; i++){\r\n\t\t\t\trow = grid.row(rows[i]);\r\n\t\t\t\tselected = row.id in selection ? selection[row.id] : grid.allSelected;\r\n\t\t\t\tif(selected){\r\n\t\t\t\t\tgrid._select(row, null, selected);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tgrid._fireSelectionEvents();\r\n\t\t});\r\n\t\treturn rows;\r\n\t}\r\n});\r\n\r\n});\r\n/* jshint ignore:end */\r\n"]}