{"version":3,"sources":["../../../../widgets/AttributeTable/a11y/WidgetMixin.js"],"names":["define","declare","array","lang","html","on","aspect","keys","focus","topic","string","jimuUtils","LayoutManager","_layoutManager","_focusedTab","focusToDisplay","hasBeenActivated","postCreate","inherited","arguments","getInstance","config","initiallyExpand","own","domNode","hitch","evt","hasClass","target","baseClass","keyCode","ENTER","showing","widgetManager","activateWidget","_switchTable","isInNavMode","subscribe","id","args","grid","_applyA11y2Grid","context","toolbar","_applyA11y2Toolbar","applyA11y","_isOnlyTable","removeAttr","switchBtn","e","SPACE","__focus2WidgetNode","tabContainer","hasChildren","_applyA11y2TabContainer","NoTableMessageDiv","setAttr","tabindex","initFirstFocusNode","initLastFocusNode","ESCAPE","__escape2WidgetSwitch","self","_activeCloseButtonTabIndex","activeControlButton","forEach","tablist","getChildren","controlButton","active","closeButton","closeNode","oldOnkeyDownMethod","onkeydown","__stackAdjacent","forward","isLeftToRight","tabPosition","test","children","idx","indexOf","pane2button","page","_currentChild","current","child","length","disabled","fromContainer","applyOldMethod","LEFT_ARROW","UP_ARROW","_djpage","PAGE_UP","ctrlKey","RIGHT_ARROW","DOWN_ARROW","PAGE_DOWN","HOME","focusNode","stopPropagation","preventDefault","END","DELETE","charCodeAt","closable","tabForwardStep","title","TAB","isLoading","apply","tab","checked","firstTabChild","appConfig","theme","name","after","getObject","selectedChildWidget","mixin","_onLeftArrow","_onRightArrow","shiftKey","_getFirstFocusableChild","_getLastFocusableChild","focusPrev","focusNext","__escape2ActiveTab","toggleColumnsMenuItem","_activeTable","__applyA11y2GridHiderMenu","hiderToggleNode","hiderMenuNode","toggleNode","menuNode","_customEvtHandlersInitialized","SCREENREADER_NODE_ID","screenReaderNode","create","footer","textContent","selectedIds","nls","selected","watch","oldFocusedNode","newFocusedNode","classList","contains","rowIndex","selection","Object","__IndexOfGridRowHandle","setAttribute","focusedNode","curNode","gridSelectionIds","selectedRowCount","selectedRowIndex","substitute","rowHeaderColumnTitle","rowId","rowHeaderColumnTitleMultiple","rowCount","_toggleColumnHiderMenu","_hiderMenuOpened","_onHeaderClick","isDomFocusable","_controllerDiv","closeable","oncreenIcons","layoutManager","onScreenWidgetIcons","widgetonScreenIcon","some","iconObj","widgetConfig","closeWidget","focusFirstFocusNode","isMenuHasChild","firstChild","lastChild","firstChildCheck","querySelector","__focusOnActiveTab","setTimeout","targetHandleNode","allSelectionHandles","querySelectorAll","handleNode","index","isEqualNode","console","log"],"mappings":"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","file":"WidgetMixin.js","sourcesContent":["define([\r\n\t'dojo/_base/declare',\r\n\t'dojo/_base/array',\r\n\t'dojo/_base/lang',\r\n\t'dojo/_base/html',\r\n\t'dojo/on',\r\n\t'dojo/aspect',\r\n\t'dojo/keys',\r\n\t'dijit/focus',\r\n\t'dojo/topic',\r\n  'dojo/string',\r\n\t'jimu/utils',\r\n\t'jimu/LayoutManager'\r\n], function (declare, array, lang, html, on, aspect, keys, focus, topic, string, jimuUtils, LayoutManager) {\r\n\treturn declare(null, {\r\n\r\n\t\t_layoutManager: null,\r\n\t\t_focusedTab: null,\r\n\t\tfocusToDisplay: false,\r\n\t\thasBeenActivated: false, //widget has been manually activated, such as by pressing the ENTER key\r\n\r\n\t\tpostCreate: function() {\r\n\t\t\tthis.inherited(arguments);\r\n\r\n\t\t\tthis._layoutManager = LayoutManager.getInstance();\r\n\r\n\t\t\tthis.focusToDisplay = true;\r\n\t\t\tthis.hasBeenActivated = this.config.initiallyExpand;\r\n\r\n\t\t\tthis.own(on(this.domNode, 'keydown', lang.hitch(this, function (evt) {\r\n\t\t\t\tif(html.hasClass(evt.target, this.baseClass) && evt.keyCode === keys.ENTER) {\r\n\t\t\t\t\tthis.focusToDisplay = false;\r\n\t\t\t\t\tthis.hasBeenActivated = true;\r\n\t\t\t\t\tif(!this.showing) {\r\n\t\t\t\t\t\tthis.widgetManager.activateWidget(this);//active it to add z-index for dashboardTheme\r\n\t\t\t\t\t\tthis._switchTable(); //show widget temporarily\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t})));\r\n\t\t\tthis.own(on(this.domNode, 'focus', lang.hitch(this, function () {\r\n\t\t\t\tif(jimuUtils.isInNavMode() && this.focusToDisplay && !this.showing) {\r\n\t\t\t\t\tthis.widgetManager.activateWidget(this); //active it to add z-index for dashboardTheme\r\n\t\t\t\t\tthis._switchTable(); //show widget temporarily\r\n\t\t\t\t}\r\n\t\t\t})));\r\n\t\t\tthis.own(on(this.domNode, 'blur', lang.hitch(this, function () {\r\n\t\t\t\tif(jimuUtils.isInNavMode() && this.focusToDisplay && this.showing) {\r\n\t\t\t\t\tif(!this.hasBeenActivated) {\r\n\t\t\t\t\t\tthis._switchTable(); //hide widget\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tthis.focusToDisplay = true; // turn it back on\r\n\t\t\t\t// turn flags off when the widget is mimimized\r\n\t\t\t\tif(!this.showing) {\r\n\t\t\t\t\tthis.hasBeenActivated = false;\r\n\t\t\t\t}\r\n\t\t\t})));\r\n\r\n\t\t\tthis.own(\r\n\t\t\t\t// listen to event when a feature table is created / activated\r\n\t\t\t\ttopic.subscribe(this.id + '_table_created', lang.hitch(this, function(args) {\r\n\t\t\t\t\tvar grid = args && args.grid;\r\n\t\t\t\t\tthis._applyA11y2Grid(grid, args && args.context);\r\n\t\t\t\t})),\r\n\t\t\t\t// listen to event when a toolbar is created / activated\r\n\t\t\t\ttopic.subscribe(this.id + '_toolbar_created', lang.hitch(this, function(args) {\r\n\t\t\t\t\tvar toolbar = args && args.toolbar;\r\n\t\t\t\t\tthis._applyA11y2Toolbar(toolbar, args && args.context);\r\n\t\t\t\t}))\r\n\t\t\t);\r\n\t\t},\r\n\r\n\t\tapplyA11y: function () {\r\n\r\n\t\t\t// handle Launchpad and Billboard themes\r\n\t\t\tif(this._isOnlyTable()){\r\n\t\t\t\thtml.removeAttr(this.domNode, 'tabindex');\r\n\t\t\t}\r\n\r\n\t\t\t// step 1:\r\n\t\t\t//\r\n\t\t\tif(this.switchBtn) {\r\n\t\t\t\tthis.own(\r\n\t\t\t\t\ton(this.switchBtn, 'keydown', lang.hitch(this, function (e) {\r\n\t\t\t\t\t\tif(e.keyCode === keys.SPACE || e.keyCode === keys.ENTER) {\r\n\t\t\t\t\t\t\tthis._switchTable();\r\n\t\t\t\t\t\t\tthis.focusToDisplay = this.showing;\r\n\t\t\t\t\t\t\tthis.__focus2WidgetNode();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}))\r\n\t\t\t\t);\r\n\t\t\t}\r\n\r\n\t\t\t// step 2: tab container or no data message\r\n\t\t\t//\r\n\t\t\tif(this.tabContainer && this.tabContainer.hasChildren()) {\r\n\t\t\t\tthis._applyA11y2TabContainer(this.tabContainer);\r\n\t\t\t} else {\r\n\t\t\t\tif(this.NoTableMessageDiv) {\r\n\t\t\t\t\thtml.setAttr(this.NoTableMessageDiv, {tabindex: '0'});\r\n\t\t\t\t\tjimuUtils.initFirstFocusNode(this.domNode, this.NoTableMessageDiv);\r\n\t\t\t\t\tjimuUtils.initLastFocusNode(this.domNode, this.NoTableMessageDiv);\r\n\t\t\t\t\tthis.own(\r\n\t\t\t\t\t\ton(this.NoTableMessageDiv, 'keydown', lang.hitch(this, function (evt) {\r\n\t\t\t\t\t\t\tif(evt.keyCode === keys.ESCAPE) {\r\n\t\t\t\t\t\t\t\tthis.__escape2WidgetSwitch(evt);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}))\r\n\t\t\t\t\t);\r\n\t\t\t\t\tif(this._isOnlyTable()){\r\n\t\t\t\t\t\tfocus.focus(this.NoTableMessageDiv);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_applyA11y2TabContainer: function(tabContainer) {\r\n\t\t\tif(!tabContainer) return;\r\n\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tvar _activeCloseButtonTabIndex = function(activeControlButton) {\r\n\t\t\t\tif(!activeControlButton) return;\r\n\r\n\t\t\t\t// mute tab indexes for all other tabs\r\n\t\t\t\tarray.forEach(tabContainer.tablist.getChildren(), function(controlButton) {\r\n\t\t\t\t\tif(!controlButton.active &&\r\n\t\t\t\t\t\tcontrolButton.closeButton &&\r\n\t\t\t\t\t\tcontrolButton.id !== activeControlButton.id\r\n\t\t\t\t\t) {\r\n\t\t\t\t\t\thtml.setAttr(controlButton.closeNode, 'tabindex', -1);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\t// activate tab index for the active tab\r\n\t\t\t\thtml.setAttr(activeControlButton.closeNode, 'tabindex', 0);\r\n\t\t\t};\r\n\r\n\t\t\t// step 1:\r\n\t\t\t// monkey patch the StackController in the tabContainer\r\n\t\t\t//\r\n\t\t\tvar oldOnkeyDownMethod = tabContainer.tablist.onkeydown;\r\n\r\n\t\t\t// override the \"adjacent\" method in dijit/layout/StackController\r\n\t\t\tvar __stackAdjacent = function(forward, context){\r\n\t\t\t\tif(!context.isLeftToRight() &&\r\n\t\t\t\t\t(!context.tabPosition || /top|bottom/.test(context.tabPosition))\r\n\t\t\t\t\t) {\r\n\t\t\t\t\tforward = !forward;\r\n\t\t\t\t}\r\n\t\t\t\tvar children = context.getChildren();\r\n\t\t\t\tvar idx = array.indexOf(children, context.pane2button(\r\n\t\t\t\t\tself._focusedTab ?\r\n\t\t\t\t\tself._focusedTab.page && self._focusedTab.page.id :\r\n\t\t\t\t\t\tcontext._currentChild.id)),\r\n\t\t\t\t\tcurrent = children[idx];\r\n\t\t\t\tvar child;\r\n\r\n\t\t\t\tdo{\r\n\t\t\t\t\tidx = (idx + (forward ? 1 : children.length - 1)) % children.length;\r\n\t\t\t\t\tchild = children[idx];\r\n\t\t\t\t}while(child.disabled && child !== current);\r\n\r\n\t\t\t\treturn child;\r\n\t\t\t};\r\n\r\n\t\t\ttabContainer.tablist.onkeydown = function(e, fromContainer) {\r\n\t\t\t\tvar forward = null, applyOldMethod = false;\r\n\t\t\t\tswitch(e.keyCode) {\r\n\t\t\t\t\tcase keys.LEFT_ARROW:\r\n\t\t\t\t\tcase keys.UP_ARROW:\r\n\t\t\t\t\t\tif(!e._djpage){\r\n\t\t\t\t\t\t\tforward = false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase keys.PAGE_UP:\r\n\t\t\t\t\t\tif(e.ctrlKey){\r\n\t\t\t\t\t\t\tforward = false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase keys.RIGHT_ARROW:\r\n\t\t\t\t\tcase keys.DOWN_ARROW:\r\n\t\t\t\t\t\tif(!e._djpage){\r\n\t\t\t\t\t\t\tforward = true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase keys.PAGE_DOWN:\r\n\t\t\t\t\t\tif(e.ctrlKey){\r\n\t\t\t\t\t\t\tforward = true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase keys.HOME:\r\n\t\t\t\t\t\tvar children = this.getChildren();\r\n\t\t\t\t\t\tfor(var idx = 0; idx < children.length; idx++){\r\n\t\t\t\t\t\t\tvar child = children[idx];\r\n\t\t\t\t\t\t\tif(!child.disabled){\r\n\t\t\t\t\t\t\t\tfocus.focus(child.focusNode);\r\n\t\t\t\t\t\t\t\tself._focusedTab = child;\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\te.stopPropagation();\r\n\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase keys.END:\r\n\t\t\t\t\t\tvar children = this.getChildren();\r\n\t\t\t\t\t\tfor(var idx = children.length - 1; idx >= 0; idx--){\r\n\t\t\t\t\t\t\tvar child = children[idx];\r\n\t\t\t\t\t\t\tif(!child.disabled){\r\n\t\t\t\t\t\t\t\tfocus.focus(child.focusNode);\r\n\t\t\t\t\t\t\t\tself._focusedTab = child;\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\te.stopPropagation();\r\n\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase keys.DELETE:\r\n\t\t\t\t\tcase \"W\".charCodeAt(0):    // ctrl-W\r\n\t\t\t\t\t\t// remove default delete keyboard behavior\r\n\t\t\t\t\t\tif(this._currentChild.closable &&\r\n\t\t\t\t\t\t\t(e.keyCode == keys.DELETE || e.ctrlKey)){\r\n\t\t\t\t\t\t\te.stopPropagation();\r\n\t\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase keys.ENTER:\r\n\t\t\t\t\tcase keys.SPACE:\r\n\t\t\t\t\t\tself.tabForwardStep = 0;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase keys.ESCAPE:\r\n\t\t\t\t\t\tif(e.target.title === 'Close') {\r\n\t\t\t\t\t\t\tself._focusedTab && focus.focus(self._focusedTab.focusNode);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tself.__escape2WidgetSwitch(e);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\te.stopPropagation();\r\n\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase keys.TAB:\r\n\t\t\t\t\t\tif(self.isLoading()) {\r\n\t\t\t\t\t\t\te.stopPropagation();\r\n\t\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tapplyOldMethod = true;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(forward !== null) {\r\n\t\t\t\t\tself._focusedTab = __stackAdjacent(forward, this);\r\n\t\t\t\t\tfocus.focus(self._focusedTab.focusNode);\r\n\r\n\t\t\t\t\te.stopPropagation();\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(applyOldMethod) {\r\n\t\t\t\t\toldOnkeyDownMethod.apply(this, arguments);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\t// step 2:\r\n\t\t\t// make first tab as the first focusable node in widget\r\n\t\t\t//\r\n\t\t\tif(tabContainer.hasChildren()) {\r\n\t\t\t\tarray.forEach(tabContainer.getChildren(), lang.hitch(this, function(tab) {\r\n\t\t\t\t\tif(!tab.controlButton.checked) {\r\n\t\t\t\t\t\thtml.setAttr(tab.controlButton.focusNode, 'aria-selected', 'false');\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(tab.closable) {\r\n\t\t\t\t\t\thtml.setAttr(tab.controlButton.closeNode, 'role', 'button');\r\n\t\t\t\t\t}\r\n\t\t\t\t}));\r\n\r\n\t\t\t\tvar firstTabChild = tabContainer.tablist.getChildren()[0];\r\n\r\n\t\t\t\tthis._focusedTab = firstTabChild;\r\n\t\t\t\tjimuUtils.initFirstFocusNode(this.domNode, firstTabChild.focusNode);\r\n\t\t\t\tif(firstTabChild.closeNode) {\r\n\t\t\t\t\t_activeCloseButtonTabIndex(firstTabChild);\r\n\t\t\t\t}\r\n\t\t\t\tif(this._isOnlyTable() &&\r\n\t\t\t\t\t (this.appConfig.theme.name ==='LaunchpadTheme' ||\r\n\t\t\t\t\t\tthis.appConfig.theme.name ==='BillboardTheme')) { // TODO: have a better check?\r\n\t\t\t\t\tfocus.focus(firstTabChild.focusNode);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// step 3:\r\n\t\t\t// attach event handlers\r\n\t\t\t//\r\n\r\n\t\t\tthis.own(\r\n\t\t\t\taspect.after(tabContainer, 'selectChild', function() {\r\n\t\t\t\t\tvar controlButton = lang.getObject(\r\n\t\t\t\t\t\t'controlButton',\r\n\t\t\t\t\t\tfalse,\r\n\t\t\t\t\t\tthis.selectedChildWidget);\r\n\t\t\t\t\tif(controlButton) {\r\n\t\t\t\t\t\tjimuUtils.initFirstFocusNode(self.domNode, controlButton.focusNode);\r\n\t\t\t\t\t\tif(controlButton.closeNode) {\r\n\t\t\t\t\t\t\t_activeCloseButtonTabIndex(controlButton);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tself._focusedTab = controlButton;\r\n\t\t\t\t}),\r\n\t\t\t\t// reset _focusedTab when tablist loses focus\r\n\t\t\t\ton(tabContainer.tablist, 'blur', lang.hitch(this, function() {\r\n\t\t\t\t\tthis._focusedTab = null;\r\n\t\t\t\t}))\r\n\t\t\t\t// // reset _focusedTab when tablist loses focus\r\n\t\t\t\t// on(tabContainer.tablist, 'keydown', lang.hitch(this, function(e) {\r\n\t\t\t\t// \tif(e.keyCode === keys.ESCAPE) {\r\n\t\t\t\t// \t\tif(e.target.title === 'Close') {\r\n\t\t\t\t// \t\t\tthis._focusedTab && focus.focus(this._focusedTab.focusNode);\r\n\t\t\t\t// \t\t} else {\r\n\t\t\t\t// \t\t\tthis.__escape2WidgetSwitch(e);\r\n\t\t\t\t// \t\t}\r\n\t\t\t\t// \t\te.stopPropagation();\r\n\t\t\t\t// \t\te.preventDefault();\r\n\t\t\t\t// \t}\r\n\t\t\t\t// }))\r\n\t\t\t);\r\n\t\t},\r\n\r\n\t\t_applyA11y2Toolbar: function(toolbar, context) {\r\n\t\t\tif(!toolbar) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t// step 1:\r\n\t\t\t// override the default on left / right arrow click navigation\r\n\t\t\t//\r\n\t\t\tlang.mixin(toolbar, {\r\n\t\t\t\t_onLeftArrow: function() {/* null */},\r\n\t\t\t\t_onRightArrow: function() {/* null */}\r\n\t\t\t});\r\n\r\n\t\t\t// step 2:\r\n\t\t\t// attach keyboard event handlers\r\n\t\t\t//\r\n\t\t\tthis.own(\r\n\t\t\t\ton(toolbar, 'keydown', lang.hitch(this, function(e) {\r\n\t\t\t\t\tif(e.keyCode === keys.TAB) {\r\n\t\t\t\t\t\tif(e.shiftKey) {\r\n\t\t\t\t\t\t\tif(e.target.id === toolbar._getFirstFocusableChild().id) {\r\n\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tif(e.target.id === toolbar._getLastFocusableChild().id) {\r\n\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\te.shiftKey ? toolbar.focusPrev() : toolbar.focusNext();\r\n\t\t\t\t\t\te.stopPropagation();\r\n\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t} else if(e.keyCode === keys.ESCAPE) {\r\n\t\t\t\t\t\tthis.__escape2ActiveTab(e);\r\n\t\t\t\t\t}\r\n\t\t\t\t}))\r\n\t\t\t);\r\n\t\t\tif(context && context.toggleColumnsMenuItem) {\r\n\t\t\t\tthis.own(\r\n\t\t\t\t\ton(context.toggleColumnsMenuItem, 'click', lang.hitch(this, function(e) {\r\n\t\t\t\t\t\tif(jimuUtils.isInNavMode()) {\r\n\t\t\t\t\t\t\tvar grid  = this._activeTable && this._activeTable.grid;\r\n\t\t\t\t\t\t\tthis.__applyA11y2GridHiderMenu(grid);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}))\r\n\t\t\t\t)\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_applyA11y2Grid: function(grid, context) {\r\n\t\t\tif(!grid || !grid.hiderToggleNode || !grid.hiderMenuNode) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tvar toggleNode = grid.hiderToggleNode,\r\n\t\t\t\t\tmenuNode = grid.hiderMenuNode;\r\n\r\n\t\t\t// step 1:\r\n\t\t\t// set last focus node to the column hider button in the active grid\r\n\t\t\t// as the last focusable node in the widget\r\n\t\t\t//\r\n\t\t\tjimuUtils.initLastFocusNode(this.domNode, toggleNode);\r\n\r\n\t\t\t// step 2:\r\n\t\t\t// attach keyboard and focus handlers\r\n\t\t\t//\r\n\t\t\tif(!grid._customEvtHandlersInitialized) {\r\n\t\t\t\t// add a dom node to store screen reader content\r\n\t\t\t\tvar SCREENREADER_NODE_ID = context.id + '_ScreenReader_Node';\r\n\t\t\t\tvar screenReaderNode = html.create('div', {\r\n\t\t\t\t\t'class': 'sr-only',\r\n\t\t\t\t\t'aria-live': 'assertive',\r\n\t\t\t\t\t'id': SCREENREADER_NODE_ID\r\n\t\t\t\t}, context.footer, 'after');\r\n\r\n\t\t\t\tthis.own(\r\n\t\t\t\t\ton(context, 'row-click', function(e) {\r\n\t\t\t\t\t\tif(jimuUtils.isInNavMode()) {\r\n\t\t\t\t\t\t\t// add selected row count to screen reader node\r\n\t\t\t\t\t\t\tscreenReaderNode.textContent = e.selectedIds.length + ' ' + this.nls.selected;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}),\r\n\t\t\t\t\ton(context, 'clear-selection', function() {\r\n\t\t\t\t\t\tif(jimuUtils.isInNavMode()) {\r\n\t\t\t\t\t\t\t// clear screen reader node\r\n\t\t\t\t\t\t\tscreenReaderNode.textContent = '';\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}),\r\n\t\t\t\t\ton(grid, 'keydown', lang.hitch(this, function(e) {\r\n\t\t\t\t\t\tif(jimuUtils.isInNavMode() && e.keyCode === keys.ESCAPE) {\r\n\t\t\t\t\t\t\tscreenReaderNode.textContent = '';\r\n\t\t\t\t\t\t\tthis.__escape2ActiveTab(e);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})),\r\n\t\t\t\t\tfocus.watch(\"curNode\", lang.hitch(this,function(name, oldFocusedNode, newFocusedNode) {\r\n\t\t\t\t\t\t// update \"title\" of the row handle when focused but not selected\r\n\t\t\t\t\t\tif(jimuUtils.isInNavMode() && newFocusedNode && newFocusedNode.classList &&\r\n\t\t\t\t\t\t\tnewFocusedNode.classList.contains('dgrid-column-selectionHandle')) {\r\n\t\t\t\t\t\t\tvar rowIndex = -1;\r\n\t\t\t\t\t\t\tif(grid.selection && Object.keys(grid.selection).length === 0) {\r\n\t\t\t\t\t\t\t\trowIndex = this.__IndexOfGridRowHandle(newFocusedNode, grid);\r\n\t\t\t\t\t\t\t\tif(rowIndex > -1) {\r\n\t\t\t\t\t\t\t\t\tscreenReaderNode.textContent = 'Row ' + rowIndex + ', Selection Handle.';\r\n\t\t\t\t\t\t\t\t\tnewFocusedNode.setAttribute('aria-labelledby', SCREENREADER_NODE_ID);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})),\r\n\t\t\t\t\ton(grid, 'dgrid-select', lang.hitch(this, function(e) {\r\n\t\t\t\t\t\tvar focusedNode = focus.curNode;\r\n\t\t\t\t\t\tif(jimuUtils.isInNavMode() && focusedNode && focusedNode.classList &&\r\n\t\t\t\t\t\t\tfocusedNode.classList.contains('dgrid-column-selectionHandle')) {\r\n\t\t\t\t\t\t\t// update \"title\" of the row handle when selected\r\n\t\t\t\t\t\t\tvar gridSelectionIds = grid.selection && Object.keys(grid.selection),\r\n\t\t\t\t\t\t\t\tselectedRowCount = gridSelectionIds.length,\r\n\t\t\t\t\t\t\t\tselectedRowIndex = -1;\r\n\t\t\t\t\t\t\tif(selectedRowCount > 0) {\r\n\t\t\t\t\t\t\t\tif(focusedNode) {\r\n\t\t\t\t\t\t\t\t\tselectedRowIndex = this.__IndexOfGridRowHandle(focusedNode, grid);\r\n\t\t\t\t\t\t\t\t\tif(selectedRowIndex > -1) {\r\n\t\t\t\t\t\t\t\t\t\tif(selectedRowCount === 1) {\r\n\t\t\t\t\t\t\t\t\t\t\tscreenReaderNode.textContent = string.substitute(\r\n\t\t\t\t\t\t\t\t\t\t\t\tthis.nls.rowHeaderColumnTitle, {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\trowId: selectedRowIndex\r\n\t\t\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\t\tscreenReaderNode.textContent = string.substitute(\r\n\t\t\t\t\t\t\t\t\t\t\t\tthis.nls.rowHeaderColumnTitleMultiple, {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\trowId: selectedRowIndex,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\trowCount: selectedRowCount\r\n\t\t\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\tfocusedNode.setAttribute('aria-labelledby', SCREENREADER_NODE_ID);\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})),\r\n\t\t\t\t\ton(toggleNode, 'keydown', lang.hitch(this, function(e) {\r\n\t\t\t\t\t\tif(e.keyCode === keys.SPACE || e.keyCode === keys.ENTER) {\r\n\t\t\t\t\t\t\tgrid._toggleColumnHiderMenu();\r\n\t\t\t\t\t\t\tthis.__applyA11y2GridHiderMenu(grid);\r\n\t\t\t\t\t\t\te.stopPropagation();\r\n\t\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})),\r\n\t\t\t\t\ton(menuNode, 'keydown', lang.hitch(this, function(e) {\r\n\t\t\t\t\t\tif(e.keyCode === keys.ESCAPE) {\r\n\t\t\t\t\t\t\ttoggleNode.focus();\r\n\t\t\t\t\t\t\tif(grid._hiderMenuOpened) {\r\n\t\t\t\t\t\t\t\tgrid._toggleColumnHiderMenu(e);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\te.stopPropagation();\r\n\t\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})),\r\n\t\t\t\t\ton(grid, '.dgrid-header .dgrid-cell:keydown', lang.hitch(this, function(e) {\r\n\t\t\t\t\t\tif(e.keyCode === keys.ENTER) {\r\n\t\t\t\t\t\t\tthis._activeTable && this._activeTable._onHeaderClick(e);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}))\r\n\t\t\t\t);\r\n\t\t\t\tgrid._customEvtHandlersInitialized = true;\r\n\t\t\t}\r\n\r\n\t\t\tif(this._focusedTab && this._focusedTab.checked && context) {\r\n\t\t\t\thtml.setAttr(\r\n\t\t\t\t\tthis._focusedTab.focusNode,\r\n\t\t\t\t\t'aria-labelledby',\r\n\t\t\t\t\tthis._focusedTab.focusNode.id + ' ' + this.id + '_' + context.id + '_footer'\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t__escape2WidgetSwitch: function(e) {\r\n\t\t\tif(this.switchBtn) {\r\n\t\t\t\tthis.switchBtn.focus();\r\n\t\t\t} else {\r\n\t\t\t\tif(jimuUtils.isDomFocusable(this.domNode)) {\r\n\t\t\t\t\tthis.__focus2WidgetNode();\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis._controllerDiv && this._controllerDiv.focus();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif(this.closeable && this._isOnlyTable()) {\r\n\t\t\t\tif(this.widgetManager) {\r\n\t\t\t\t\tvar oncreenIcons = this._layoutManager &&\r\n\t\t\t\t\tthis._layoutManager.layoutManager &&\r\n\t\t\t\t\tthis._layoutManager.layoutManager.onScreenWidgetIcons;\r\n\t\t\t\t\tvar widgetonScreenIcon;\r\n\t\t\t\t\tarray.some(oncreenIcons, lang.hitch(this, function(iconObj) {\r\n\t\t\t\t\t\tif(iconObj && iconObj.widgetConfig && iconObj.widgetConfig.id === this.id) {\r\n\t\t\t\t\t\t\twidgetonScreenIcon = iconObj;\r\n\t\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}));\r\n\t\t\t\t\tif(widgetonScreenIcon) {\r\n\t\t\t\t\t\twidgetonScreenIcon.domNode.focus();\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.widgetManager.closeWidget(this); // close widget to focus the icon\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif(e) {\r\n\t\t\t\te.stopPropagation();\r\n\t\t\t\te.preventDefault();\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t__focus2WidgetNode: function() {\r\n\t\t\tthis.domNode.focus();\r\n\t\t},\r\n\r\n\t\t__escape2ActiveTab: function(e) {\r\n\t\t\tjimuUtils.focusFirstFocusNode(this.domNode);\r\n\t\t\tif(e) {\r\n\t\t\t\te.stopPropagation();\r\n\t\t\t\te.preventDefault();\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t__applyA11y2GridHiderMenu: function(grid) {\r\n\t\t\tif(grid && grid._hiderMenuOpened) {\r\n\t\t\t\tvar menuNode = grid.hiderMenuNode;\r\n\t\t\t\tvar isMenuHasChild = menuNode.children && menuNode.children.length > 0;\r\n\t\t\t\tif(isMenuHasChild) {\r\n\t\t\t\t\tvar firstChild = menuNode.children[0],\r\n\t\t\t\t\t\t\tlastChild = menuNode.children[menuNode.children.length - 1];\r\n\t\t\t\t\tvar firstChildCheck = firstChild.querySelector('input');\r\n\r\n\t\t\t\t\t// init focusable nodes in the column hider menu\r\n\t\t\t\t\tjimuUtils.initFirstFocusNode(menuNode, firstChild.querySelector('input'));\r\n\t\t\t\t\tjimuUtils.initLastFocusNode(menuNode, lastChild.querySelector('input'));\r\n\r\n\t\t\t\t\tif(firstChildCheck) {\r\n\t\t\t\t\t\tfirstChildCheck.focus();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t__focusOnActiveTab: function() {\r\n\t\t\tsetTimeout(lang.hitch(this, function(){\r\n\t\t\t\tjimuUtils.focusFirstFocusNode(this.domNode);\r\n\t\t\t}),600);\r\n\t\t},\r\n\r\n\t\t__IndexOfGridRowHandle: function(targetHandleNode, grid) {\r\n\t\t\tvar rowIndex;\r\n\t\t\tvar allSelectionHandles = grid.domNode.querySelectorAll('.dgrid-column-selectionHandle');\r\n\t\t\tarray.some(allSelectionHandles, function(handleNode, index){\r\n\t\t\t\tif(handleNode.isEqualNode(targetHandleNode)) {\r\n\t\t\t\tconsole.log(index);\r\n\t\t\t\t\trowIndex = index;\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\treturn rowIndex;\r\n\t\t}\r\n\r\n\t});\r\n});"]}