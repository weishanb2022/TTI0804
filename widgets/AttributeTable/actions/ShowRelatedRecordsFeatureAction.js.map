{"version":3,"sources":["../../../../widgets/AttributeTable/actions/ShowRelatedRecordsFeatureAction.js"],"names":["define","declare","lang","array","BaseFeatureAction","WidgetManager","LayerInfos","clazz","map","iconClass","isFeatureSupported","featureSet","layer","layerInfos","getInstanceSync","features","length","relationships","layerInfo","getLayerInfoById","id","getRelatedTableInfoArray","then","relatedTableInfoArray","onExecute","selectedLayerInfo","selectedIds","hitch","f","attributes","objectIdField","getInstance","triggerWidgetOpen","widgetId","attrWidget","showRelatedRecordsFromPopup"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEAA,OAAO,CACL,oBADK,EAEL,iBAFK,EAGL,kBAHK,EAIL,wBAJK,EAKL,oBALK,EAML,4BANK,CAAP,EAOG,UAASC,OAAT,EAAkBC,IAAlB,EAAwBC,KAAxB,EAA+BC,iBAA/B,EAAkDC,aAAlD,EAAiEC,UAAjE,EAA4E;AAC7E,MAAIC,QAAQN,QAAQG,iBAAR,EAA2B;AACrCI,SAAK,IADgC;AAErCC,eAAW,0BAF0B;;AAIrCC,wBAAoB,4BAASC,UAAT,EAAqBC,KAArB,EAA2B;AAC7C,UAAIC,aAAaP,WAAWQ,eAAX,EAAjB;AACA,UAAGH,WAAWI,QAAX,CAAoBC,MAApB,KAA+B,CAA/B,IAAoC,CAACJ,KAAxC,EAA8C;AAC5C,eAAO,KAAP;AACD;;AAED,UAAGC,cAAcD,KAAd,IAAuBA,MAAMK,aAA7B,IAA+CL,MAAMK,aAAN,CAAoBD,MAApB,GAA6B,CAA/E,EAAmF;AACjF,YAAIE,YAAYL,WAAWM,gBAAX,CAA4BP,MAAMQ,EAAlC,CAAhB;AACA,YAAGF,SAAH,EAAc;AACZ,iBAAOA,UAAUG,wBAAV,GAAqCC,IAArC,CAA0C,UAASC,qBAAT,EAAgC;AAC/E,gBAAGA,sBAAsBP,MAAtB,GAA+B,CAAlC,EAAqC;AACnC,qBAAO,IAAP;AACD,aAFD,MAEO;AACL,qBAAO,KAAP;AACD;AACF,WANM,CAAP;AAOD,SARD,MAQO;AACL,iBAAO,KAAP;AACD;AACF,OAbD,MAaO;AACL,eAAO,KAAP;AACD;AACF,KA1BoC;;AA4BrCQ,eAAW,mBAASb,UAAT,EAAqBC,KAArB,EAA2B;AACpC,UAAIC,aAAaP,WAAWQ,eAAX,EAAjB;AACA,UAAIW,oBAAoBZ,WAAWM,gBAAX,CAA4BP,MAAMQ,EAAlC,CAAxB;AACA,UAAIM,cAAcvB,MAAMK,GAAN,CAAUG,WAAWI,QAArB,EAA+Bb,KAAKyB,KAAL,CAAW,IAAX,EAAiB,UAASC,CAAT,EAAY;AAC5E,eAAOA,EAAEC,UAAF,CAAajB,MAAMkB,aAAnB,CAAP;AACD,OAFgD,CAA/B,CAAlB;;AAIAzB,oBAAc0B,WAAd,GAA4BC,iBAA5B,CAA8C,KAAKC,QAAnD,EACCX,IADD,CACM,UAASY,UAAT,EAAqB;AACzBA,mBAAWC,2BAAX,CAAuCV,iBAAvC,EAA0DC,WAA1D;AACD,OAHD;AAID;AAvCoC,GAA3B,CAAZ;AAyCA,SAAOnB,KAAP;AACD,CAlDD","file":"ShowRelatedRecordsFeatureAction.js","sourcesContent":["///////////////////////////////////////////////////////////////////////////\r\n// Copyright Â© Esri. All Rights Reserved.\r\n//\r\n// Licensed under the Apache License Version 2.0 (the \"License\");\r\n// you may not use this file except in compliance with the License.\r\n// You may obtain a copy of the License at\r\n//\r\n//    http://www.apache.org/licenses/LICENSE-2.0\r\n//\r\n// Unless required by applicable law or agreed to in writing, software\r\n// distributed under the License is distributed on an \"AS IS\" BASIS,\r\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n// See the License for the specific language governing permissions and\r\n// limitations under the License.\r\n///////////////////////////////////////////////////////////////////////////\r\n\r\ndefine([\r\n  'dojo/_base/declare',\r\n  'dojo/_base/lang',\r\n  'dojo/_base/array',\r\n  'jimu/BaseFeatureAction',\r\n  'jimu/WidgetManager',\r\n  'jimu/LayerInfos/LayerInfos'\r\n], function(declare, lang, array, BaseFeatureAction, WidgetManager, LayerInfos){\r\n  var clazz = declare(BaseFeatureAction, {\r\n    map: null,\r\n    iconClass: 'icon-show-related-record',\r\n\r\n    isFeatureSupported: function(featureSet, layer){\r\n      var layerInfos = LayerInfos.getInstanceSync();\r\n      if(featureSet.features.length === 0 || !layer){\r\n        return false;\r\n      }\r\n\r\n      if(layerInfos && layer && layer.relationships && (layer.relationships.length > 0)) {\r\n        var layerInfo = layerInfos.getLayerInfoById(layer.id);\r\n        if(layerInfo) {\r\n          return layerInfo.getRelatedTableInfoArray().then(function(relatedTableInfoArray) {\r\n            if(relatedTableInfoArray.length > 0) {\r\n              return true;\r\n            } else {\r\n              return false;\r\n            }\r\n          });\r\n        } else {\r\n          return false;\r\n        }\r\n      } else {\r\n        return false;\r\n      }\r\n    },\r\n\r\n    onExecute: function(featureSet, layer){\r\n      var layerInfos = LayerInfos.getInstanceSync();\r\n      var selectedLayerInfo = layerInfos.getLayerInfoById(layer.id);\r\n      var selectedIds = array.map(featureSet.features, lang.hitch(this, function(f) {\r\n        return f.attributes[layer.objectIdField];\r\n      }));\r\n\r\n      WidgetManager.getInstance().triggerWidgetOpen(this.widgetId)\r\n      .then(function(attrWidget) {\r\n        attrWidget.showRelatedRecordsFromPopup(selectedLayerInfo, selectedIds);\r\n      });\r\n    }\r\n  });\r\n  return clazz;\r\n});"]}