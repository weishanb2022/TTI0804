{"version":3,"sources":["../../../widgets/AttributeTable/Widget.js"],"names":["define","declare","html","_WidgetsInTemplateMixin","BaseWidget","TabContainer","ContentPane","utils","Message","Deferred","all","FeatureLayer","esriLang","lang","on","touch","topic","aspect","array","domQuery","LoadingIndicator","FilterManager","_ResourceManager","attrUtils","A11yWidgetMixin","clazz","name","baseClass","normalHeight","openHeight","arrowDivHeight","_relatedDef","_resourceManager","_activeLayerInfoId","_layerTypes","FEATURELAYER","RELATIONSHIPTABLE","postMixInProperties","nls","features","postCreate","inherited","arguments","loadStyleLink","apiUrl","_loadInfoDef","AttributeTableDiv","NoTableMessageDiv","_delayedLayerInfos","layerTabPages","tabContainer","moveMode","moveY","previousDomHeight","noGridHeight","bottomPosition","layerTabPagesIndex","showing","_getNormalHeight","_dragingHandlers","_activeTable","_activeTableHandles","filterManager","getInstance","_createUtilitiesUI","widgetId","id","map","parent","setConfig","config","onFeatureSelectionChange","hitch","selectionInfo","publishData","own","subscribe","_onMapPositionChange","readLayerInfosObj","then","layerInfosObj","domNode","onLayerInfosIsShowInMapChanged","onLayerInfosChanged","onLayerInfosFilterChanged","_createSwitchUI","_createBarUI","arrowDiv","create","addClass","place","arrowDivBox","getMarginBox","h","_onDragStart","press","_isOnlyTable","closeable","isOnScreen","switchBtn","className","tabindex","role","_switchTable","hasBeenActivated","focusToDisplay","_processOpenBarUI","removeClass","setAttr","closeTableTip","_processCloseBarUI","openTableTip","_openTable","_closeTable","loading","placeAt","_toggleLoading","updateLayerInfoResources","_init","showRefreshing","resolve","err","console","error","reject","isFulfilled","_processDelayedLayerInfos","active","_changeHeight","_onCloseBtnClicked","widgetManager","closeWidget","deactive","setStyle","setTimeout","initDiv","resize","window","document","_onDragEnd","_onDraging","move","release","length","forEach","delayedLayerInfo","addLayerInfo","changedLayerInfos","changeToolbarStatus","syncWithLayers","changedLayerInfo","getSubLayers","isVisible","isShowInMap","configInfo","getConfigInfoFromLayerInfo","page","getExistLayerTabPage","closable","set","layerInfoIndex","getVisivleLayerInfoIndexById","isInResources","getLayerInfoById","params","layer","isActive","index","_addLayerToTable","layerTabPageClose","layerInfo","changeType","layerInfoSelf","getSupportTableInfo","supportTableInfo","isSupportedLayer","selfId","removeLayerInfo","getConfigInfoById","removeConfigInfo","some","info","_relatedQuery","startQuery","destroy","_destroyed","len","i","paneId","table","getObject","filterObj","getFilterObj","isDefined","expr","applyWidgetFilter","empty","onOpen","onClose","changeHeight","publish","bottom","minOpenHeight","pos","isFinite","left","isRTL","parseFloat","right","setPosition","position","parseInt","parentNode","jimuConfig","layoutId","setInitialPosition","isEmpty","ngHeight","_getGridTopSectionHeight","domHeight","getStyle","_startQueryOnLayerTab","tabId","featureSet","tabPage","getQueryTable","filterByMapExtent","hideExportButton","allowTextSelection","result","isSupportQuery","getParent","setActiveTable","tip","toDom","unsupportQueryWarning","message","_startQueryOnRelationTab","infoId","relationShipKey","selectedIds","originalInfoId","originalInfo","layerObject","getRelationTable","tabChanged","selectedChildWidget","layerType","relKey","oids","selectIds","refresh","evt","clientY","concat","ownerDocument","e","stopPropagation","preventDefault","ownerDocumentBody","y","pop","remove","body","clientHeight","appInfo","isRunInMobile","initiallyExpand","_bindActiveTableEvents","that","push","layerInfoId","objectIds","relationShip","relationshipObj","_showRelatedRecordsByRelationship","events","_unbindActiveTableEvents","handlers","options","cancelThread","tableCreated","matchingMap","validFeatureSet","queryRecordsByRelationship","primaryId","displayFieldName","featureIds","f","attributes","tabDiv","style","startup","configInfos","getConfigInfos","j","show","json","clone","paneJson","title","cp","addChild","_toggleNoTableMessage","setVerticalCenter","after","applyA11y","getLayerInfoLabel","label","getLayerInfoId","tabPageWrapper","widgetTop","tabPaneTop","_getLayerInfoByIdFromConfigJSON","configedInfos","filter","layerInfos","linfo","objIds","relationship","activeTable","_layer","ships","relationships","s","isEqual","addNewRelationTab","addNewLayerTab","viewInTableFlag","mixin","addConfigInfo","selectChild","__focusOnActiveTab","relationshipInfo","getRelationShipInfo","lInfo","pageId","paneTitle","_relKey","onReceiveData","source","target","state","warn","getLayerObject","loaded","url","get","isRemoveChild","activeId","removeChild","destroyRecursive","splice","layerIndex","_processRelatedRecordsFromPopup","defs","getRelatedTableInfoArray","results","relatedTableInfos","collectRelationShips","showRelatedRecordsFromPopup","srcRef","messageText","noTablesAvailable","checkLayerListToSelectLayers","checkConfigutationToSelectLayers","innerHTML","undefined","isHidden","hidden","hide","isLoading","inPanel","hasUIFile"],"mappings":"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","file":"Widget.js","sourcesContent":["///////////////////////////////////////////////////////////////////////////\r\n// Copyright © Esri. All Rights Reserved.\r\n//\r\n// Licensed under the Apache License Version 2.0 (the \"License\");\r\n// you may not use this file except in compliance with the License.\r\n// You may obtain a copy of the License at\r\n//\r\n//    http://www.apache.org/licenses/LICENSE-2.0\r\n//\r\n// Unless required by applicable law or agreed to in writing, software\r\n// distributed under the License is distributed on an \"AS IS\" BASIS,\r\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n// See the License for the specific language governing permissions and\r\n// limitations under the License.\r\n///////////////////////////////////////////////////////////////////////////\r\ndefine([\r\n    'dojo/_base/declare',\r\n    'dojo/_base/html',\r\n    'dijit/_WidgetsInTemplateMixin',\r\n    'jimu/BaseWidget',\r\n    'dijit/layout/TabContainer',\r\n    \"dijit/layout/ContentPane\",\r\n    'jimu/utils',\r\n    'jimu/dijit/Message',\r\n    \"dojo/Deferred\",\r\n    \"dojo/promise/all\",\r\n    \"esri/layers/FeatureLayer\",\r\n    \"esri/lang\",\r\n    'dojo/_base/lang',\r\n    \"dojo/on\",\r\n    'dojo/touch',\r\n    'dojo/topic',\r\n    'dojo/aspect',\r\n    \"dojo/_base/array\",\r\n    \"dojo/query\",\r\n    'jimu/dijit/LoadingIndicator',\r\n    'jimu/FilterManager',\r\n    './_ResourceManager',\r\n    // './_TableFunctionController',\r\n    './utils',\r\n    './a11y/WidgetMixin'\r\n  ],\r\n  function(\r\n    declare,\r\n    html,\r\n    _WidgetsInTemplateMixin,\r\n    BaseWidget,\r\n    TabContainer,\r\n    ContentPane,\r\n    utils,\r\n    Message,\r\n    Deferred,\r\n    all,\r\n    FeatureLayer,\r\n    esriLang,\r\n    lang,\r\n    on,\r\n    touch,\r\n    topic,\r\n    aspect,\r\n    array,\r\n    domQuery,\r\n    LoadingIndicator,\r\n    FilterManager,\r\n    _ResourceManager,\r\n    attrUtils,\r\n    A11yWidgetMixin) {\r\n    var clazz = declare([BaseWidget, _WidgetsInTemplateMixin, A11yWidgetMixin], {\r\n      /* global apiUrl */\r\n      name: 'AttributeTable',\r\n      baseClass: 'jimu-widget-attributetable',\r\n      normalHeight: 0,\r\n      openHeight: 0,\r\n      arrowDivHeight: null,\r\n\r\n      _relatedDef: null,\r\n\r\n      _resourceManager: null,\r\n\r\n      _activeLayerInfoId: null,\r\n\r\n      // TODO: layerType: FeatureLayer,  RelationshipTable\r\n      _layerTypes: {\r\n        FEATURELAYER: 'FeatureLayerTable',\r\n        RELATIONSHIPTABLE: 'RelationshipTable'\r\n      },\r\n\r\n      postMixInProperties: function() {\r\n        this.nls.features = this.nls.features || 'features';\r\n      },\r\n\r\n      postCreate: function() {\r\n        this.inherited(arguments);\r\n\r\n        utils.loadStyleLink(\"dgrid\", apiUrl + \"dgrid/css/dgrid.css\");\r\n        this._loadInfoDef = null;\r\n        this.AttributeTableDiv = null;\r\n        this.NoTableMessageDiv = null;\r\n\r\n        this._delayedLayerInfos = [];\r\n        this.layerTabPages = [];//[ContentPane]\r\n        // one layer may be have multiple relationships, so we use key-value to store relationships\r\n        // this.relationTabPagesSet = {};\r\n\r\n        this.tabContainer = null;//TabContainer\r\n\r\n        this.moveMode = false;\r\n        this.moveY = 0; //currentHeight - previousDomHeight\r\n        this.previousDomHeight = 0;\r\n        this.noGridHeight = 0;\r\n        this.bottomPosition = 0;\r\n        this.layerTabPagesIndex = -1;\r\n\r\n        this.showing = false;\r\n\r\n        // set initial position\r\n        this.openHeight = this.normalHeight = this._getNormalHeight();\r\n        this.arrowDivHeight = 0;\r\n\r\n        // event handlers on draging\r\n        this._dragingHandlers = [];\r\n\r\n        this._activeTable = null;// _FeatureTable\r\n        this._activeTableHandles = [];\r\n\r\n        this.filterManager = FilterManager.getInstance();\r\n\r\n        this._createUtilitiesUI();\r\n\r\n        this._resourceManager = new _ResourceManager({\r\n          widgetId: this.id,\r\n          map: this.map,\r\n          nls: this.nls,\r\n          parent: this\r\n        });\r\n        this._resourceManager.setConfig(this.config);\r\n        //Broadcast the selection info data through the widget\r\n        this._resourceManager.onFeatureSelectionChange = lang.hitch(this, function (selectionInfo) {\r\n          this.publishData({\r\n            'selectionInfo': selectionInfo\r\n          });\r\n        });\r\n        //eg: TabTheme maxmize or minimize\r\n        this.own(topic.subscribe('changeMapPosition', lang.hitch(this, this._onMapPositionChange)));\r\n        attrUtils.readLayerInfosObj(this.map).then(lang.hitch(this, function(layerInfosObj) {\r\n          if (!this.domNode || !layerInfosObj) {\r\n            return;\r\n          }\r\n          this.own(on(\r\n            layerInfosObj,\r\n            'layerInfosIsShowInMapChanged',\r\n            lang.hitch(this, this.onLayerInfosIsShowInMapChanged)));\r\n          this.own(layerInfosObj.on(\r\n            'layerInfosChanged',\r\n            lang.hitch(this, this.onLayerInfosChanged)));\r\n          this.own(layerInfosObj.on(\r\n            'layerInfosFilterChanged',\r\n            lang.hitch(this, this.onLayerInfosFilterChanged)));\r\n        }));\r\n      },\r\n\r\n      _createUtilitiesUI: function() {\r\n        this._createSwitchUI();//eg: LaunchPad Theme\r\n\r\n        this._createBarUI();\r\n      },\r\n\r\n      _createBarUI: function() {\r\n        this.arrowDiv = html.create(\"div\");\r\n        html.addClass(this.arrowDiv, \"jimu-widget-attributetable-move\");\r\n        html.create('div', {\r\n          'class': \"jimu-widget-attributetable-thumb\"\r\n        }, this.arrowDiv);\r\n        html.place(this.arrowDiv, this.domNode);\r\n\r\n        if (!this.arrowDivHeight) {\r\n          var arrowDivBox = html.getMarginBox(this.arrowDiv);\r\n          this.arrowDivHeight = arrowDivBox && arrowDivBox.h ? arrowDivBox.h : 7;\r\n        }\r\n\r\n        this.own(on(this.arrowDiv, 'mousedown', lang.hitch(this, this._onDragStart)));\r\n        this.own(on(this.arrowDiv, touch.press, lang.hitch(this, this._onDragStart)));\r\n      },\r\n\r\n      _isOnlyTable: function() {\r\n        return this.closeable || !this.isOnScreen;\r\n      },\r\n\r\n      _createSwitchUI: function() {\r\n        if (!this._isOnlyTable()) {\r\n          this.switchBtn = html.create(\"div\", {\r\n            className: \"jimu-widget-attributetable-switch\",\r\n            tabindex: '0',\r\n            role: 'button'\r\n          }, this.domNode);\r\n          // html.addClass(this.switchBtn, \"jimu-widget-attributetable-switch\");\r\n          // html.place(this.switchBtn, this.domNode);\r\n          // this.highlightLine = html.create(\"div\", {\r\n          //   className: \"jimu-widget-attributetable-highlight-line\"\r\n          // }, this.domNode);\r\n\r\n          this.own(on(this.switchBtn, 'click', lang.hitch(this, function() {\r\n            this._switchTable();\r\n            this.hasBeenActivated = this.showing;\r\n            this.focusToDisplay = !this.showing;\r\n          })));\r\n        }\r\n      },\r\n\r\n      _processOpenBarUI: function() {\r\n        if (!this._isOnlyTable()) {\r\n          html.removeClass(this.switchBtn, 'close');\r\n          html.addClass(this.switchBtn, 'open');\r\n          html.setAttr(this.switchBtn, 'title', this.nls.closeTableTip);\r\n          html.setAttr(this.switchBtn, 'aria-label', this.nls.closeTableTip);\r\n        }\r\n      },\r\n\r\n      _processCloseBarUI: function() {\r\n        if (!this._isOnlyTable()) {\r\n          html.removeClass(this.switchBtn, 'open');\r\n          html.addClass(this.switchBtn, 'close');\r\n          html.setAttr(this.switchBtn, 'title', this.nls.openTableTip);\r\n          html.setAttr(this.switchBtn, 'aria-label', this.nls.openTableTip);\r\n        }\r\n      },\r\n\r\n      _switchTable: function() {\r\n        if (!this.showing) {\r\n          this._openTable();\r\n        } else {\r\n          this._closeTable();\r\n        }\r\n      },\r\n\r\n      _openTable: function() {\r\n        html.removeClass(this.domNode, 'closed');\r\n\r\n        if (!this._loadInfoDef) {\r\n          this._loadInfoDef = new Deferred();\r\n          this.own(this._loadInfoDef);\r\n          if (!this.loading) {\r\n            this.loading = new LoadingIndicator();\r\n          }\r\n          this.loading.placeAt(this.domNode);\r\n          this._toggleLoading(true);\r\n\r\n          this._resourceManager.updateLayerInfoResources(true)\r\n          .then(lang.hitch(this, function() {\r\n            if (!this.domNode) {\r\n              return;\r\n            }\r\n\r\n            this._init();\r\n            this.showRefreshing(false);\r\n\r\n            this.showing = true;\r\n            this._loadInfoDef.resolve();\r\n          }), lang.hitch(this, function(err) {\r\n            console.error(err);\r\n            this._loadInfoDef.reject(err);\r\n          }));\r\n        } else if (this._loadInfoDef && this._loadInfoDef.isFulfilled()) {\r\n          this.showing = true;\r\n          this._processDelayedLayerInfos();\r\n          if (this._activeTable) {\r\n            this._activeTable.active();\r\n          }\r\n        }\r\n\r\n        this._changeHeight(this.openHeight);\r\n        // if (this.highlightLine) {\r\n        //   html.setStyle(this.highlightLine, 'display', 'none');\r\n        // }\r\n        this._processOpenBarUI();\r\n        return this._loadInfoDef;\r\n      },\r\n\r\n      _onCloseBtnClicked: function() {\r\n        if (this.showing && this._isOnlyTable()) {\r\n          this.widgetManager.closeWidget(this);\r\n        } else if (this.showing) {\r\n          this._closeTable();\r\n        }\r\n\r\n        if (this._activeTable) {\r\n          this._activeTable.deactive();\r\n        }\r\n      },\r\n\r\n      _closeTable: function() {\r\n        html.addClass(this.domNode, 'closed');\r\n\r\n        this._changeHeight(0);\r\n        this.showRefreshing(false);\r\n        this._processCloseBarUI();\r\n        // this._tableFunctionController.deactive();\r\n        if (this._activeTable) {\r\n          this._activeTable.deactive();\r\n        }\r\n\r\n        this.showing = false;\r\n\r\n        // if (this.highlightLine) {\r\n        //   html.setStyle(this.highlightLine, 'display', '');\r\n        // }\r\n        // fix arrowDiv display bug on bottom when close table (only mobile)\r\n        html.setStyle(this.arrowDiv, 'display', 'none');\r\n        html.setStyle(this.domNode, 'overflow', 'hidden');\r\n        setTimeout(lang.hitch(this, function() {\r\n          if (!this.domNode) {\r\n            return;\r\n          }\r\n          html.setStyle(this.domNode, 'overflow', 'visible');\r\n          html.setStyle(this.arrowDiv, 'display', 'block');\r\n        }), 10);\r\n      },\r\n\r\n      _init: function() {\r\n        this.initDiv();\r\n        this._changeHeight(this.openHeight);\r\n        this.resize();\r\n\r\n        this.own(on(window.document, \"mouseup\", lang.hitch(this, this._onDragEnd)));\r\n        this.own(on(window.document, \"mousemove\", lang.hitch(this, this._onDraging)));\r\n        this.own(on(window.document, touch.move, lang.hitch(this, this._onDraging)));\r\n        this.own(on(window.document, touch.release, lang.hitch(this, this._onDragEnd)));\r\n      },\r\n\r\n      _processDelayedLayerInfos: function() { // must be invoke after initialize this._layerInfos\r\n        if (this._delayedLayerInfos.length > 0) {\r\n          array.forEach(this._delayedLayerInfos, lang.hitch(this, function(delayedLayerInfo) {\r\n            this._resourceManager.addLayerInfo(delayedLayerInfo);\r\n          }));\r\n\r\n          this._delayedLayerInfos = [];\r\n        }\r\n      },\r\n\r\n      onLayerInfosIsShowInMapChanged: function(changedLayerInfos) {\r\n        if (this._activeTable) {\r\n          this._activeTable.changeToolbarStatus();\r\n        }\r\n\r\n        // check if the tabs are configured to synchronize with\r\n        // layer visibilities:\r\n        if(this.config.syncWithLayers) {\r\n          array.forEach(changedLayerInfos, lang.hitch(this, function(changedLayerInfo) {\r\n            // check if is leaf layer\r\n            if(!changedLayerInfo.getSubLayers().length) {\r\n              var isVisible = changedLayerInfo.isShowInMap();\r\n              var configInfo = attrUtils.getConfigInfoFromLayerInfo(changedLayerInfo);\r\n              var page = this.getExistLayerTabPage(configInfo.id);\r\n\r\n              if(isVisible) {\r\n                if (page) {\r\n                  if(page.closable) {\r\n                    // remove the \"X\" button if the layer is turned on\r\n                    page.set('closable', false);\r\n                  }\r\n                } else {\r\n                  var layerInfoIndex = this._resourceManager.getVisivleLayerInfoIndexById(changedLayerInfo.id);\r\n                  var isInResources = this._resourceManager.getLayerInfoById(changedLayerInfo.id);\r\n                  var params = {\r\n                    layer: changedLayerInfo,\r\n                    closeable: false,\r\n                    isActive: false,\r\n                    index: layerInfoIndex\r\n                  };\r\n\r\n                  if (!isInResources) {\r\n                    this._resourceManager.updateLayerInfoResources(false)\r\n                    .then(lang.hitch(this, function() {\r\n                      layerInfoIndex = this._resourceManager.getVisivleLayerInfoIndexById(changedLayerInfo.id);\r\n                      params.index = layerInfoIndex;\r\n                      this._addLayerToTable(params);\r\n                    }));\r\n                  } else {\r\n                    this._addLayerToTable(params);\r\n                  }\r\n                }\r\n              } else {\r\n                if(page) {\r\n                  this.layerTabPageClose(configInfo.id, true);\r\n                }\r\n              }\r\n            }\r\n          }));\r\n        }\r\n\r\n      },\r\n\r\n      onLayerInfosChanged: function(layerInfo, changeType, layerInfoSelf) {\r\n        if (!layerInfoSelf || !layerInfo) {\r\n          return;\r\n        }\r\n\r\n        if ('added' === changeType) {\r\n          layerInfoSelf.getSupportTableInfo().then(lang.hitch(this, function(supportTableInfo) {\r\n            if (supportTableInfo.isSupportedLayer) {\r\n              this._resourceManager.addLayerInfo(layerInfoSelf);\r\n            }\r\n          }));\r\n        } else if ('removed' === changeType) {\r\n          var selfId = layerInfoSelf.id;\r\n          if (this.getExistLayerTabPage(selfId)) {\r\n            this.layerTabPageClose(selfId, true);\r\n          }\r\n\r\n          if (this._resourceManager.getLayerInfoById(selfId)) {\r\n            this._resourceManager.removeLayerInfo(selfId);\r\n          }\r\n          if (this._resourceManager.getConfigInfoById(selfId)) {\r\n            this._resourceManager.removeConfigInfo(selfId);\r\n          }\r\n        }\r\n      },\r\n\r\n      onLayerInfosFilterChanged: function(changedLayerInfos) {\r\n        array.some(changedLayerInfos, lang.hitch(this, function(info) {\r\n          if (this._activeTable && info.id === this._activeTable.layerInfo.id) {\r\n            if (!this._activeTable._relatedQuery) {\r\n              this._activeTable.startQuery();\r\n            }\r\n            return true;\r\n          }\r\n        }));\r\n      },\r\n\r\n      destroy: function() {\r\n        if (this._destroyed) {\r\n          return;\r\n        }\r\n        var len, i;\r\n        if (this.layerTabPages && this.layerTabPages.length > 0) {\r\n          len = this.layerTabPages.length;\r\n          for (i = 0; i < len; i++) {\r\n            var paneId = this.layerTabPages[i].paneId;\r\n            var table = lang.getObject('_resourceManager.featureTableSet.' + paneId, false, this);\r\n            if (table) {\r\n              var filterObj = table.getFilterObj();\r\n              if (filterObj && esriLang.isDefined(filterObj.expr)) {\r\n                this.filterManager.applyWidgetFilter(paneId, this.id, \"\");\r\n              }\r\n            }\r\n            this.layerTabPages[i].destroy();\r\n          }\r\n          this.layerTabPages = null;\r\n        }\r\n\r\n        // if (this.relationTabPagesSet) {\r\n        //   for (var p in this.relationTabPagesSet) {\r\n        //     if (this.relationTabPagesSet[p]) {\r\n        //       this.relationTabPagesSet[p].destroy();\r\n        //     }\r\n        //   }\r\n        //   this.relationTabPagesSet = null;\r\n        // }\r\n\r\n        if (this.tabContainer) {\r\n          this.tabContainer.destroy();\r\n          this.tabContainer = null;\r\n        }\r\n\r\n        this.AttributeTableDiv = null;\r\n        this._loadInfoDef = null;\r\n        this._activeLayerInfoId = null;\r\n        if (this._resourceManager) {\r\n          this._resourceManager.empty();\r\n        }\r\n        this.inherited(arguments);\r\n      },\r\n\r\n      onOpen: function() {\r\n        if (!this.showing && this._isOnlyTable()) {\r\n          this._openTable();\r\n          this.hasBeenActivated = true;\r\n        }\r\n      },\r\n\r\n      onClose: function() {\r\n        if (this.showing) {\r\n          this._closeTable();\r\n          this.hasBeenActivated = false;\r\n        }\r\n      },\r\n\r\n      _changeHeight: function(h) {\r\n        html.setStyle(this.domNode, \"height\", h + \"px\");\r\n        if (this.tabContainer && this.tabContainer.domNode &&\r\n          (h - this.arrowDivHeight >= 0)) {\r\n          html.setStyle(\r\n            this.tabContainer.domNode,\r\n            \"height\",\r\n            (h - this.arrowDivHeight) + \"px\"\r\n          );\r\n        }\r\n\r\n        if (this._activeTable) {\r\n          this._activeTable.changeHeight(h - this.noGridHeight);\r\n        }\r\n\r\n        // publish changeMapPosition to MapManager\r\n        topic.publish('changeMapPosition', {\r\n          bottom: h + this.bottomPosition\r\n        });\r\n        // publish changeMapPosition to other widgets\r\n        this.publishData({\r\n          'changeMapPosition': {\r\n            bottom: h + this.bottomPosition\r\n          }\r\n        });\r\n\r\n        if (h !== 0) {\r\n          var minOpenHeight = this.arrowDivHeight;\r\n\r\n          this.openHeight = (h >= minOpenHeight) ? h : this.normalHeight;\r\n        }\r\n      },\r\n\r\n      _onMapPositionChange: function(pos) {\r\n        if (isFinite(pos.left) && typeof pos.left === 'number') {\r\n          if (window.isRTL) {\r\n            html.setStyle(this.domNode, 'right', parseFloat(pos.left) + 'px');\r\n          } else {\r\n            html.setStyle(this.domNode, 'left', parseFloat(pos.left) + 'px');\r\n          }\r\n        }\r\n        if (isFinite(pos.right) && typeof pos.right === 'number') {\r\n          if (window.isRTL) {\r\n            html.setStyle(this.domNode, 'left', parseFloat(pos.right) + 'px');\r\n          } else {\r\n            html.setStyle(this.domNode, 'right', parseFloat(pos.right) + 'px');\r\n          }\r\n        }\r\n\r\n        if (this.tabContainer) {\r\n          this.tabContainer.resize();\r\n        }\r\n      },\r\n\r\n      setPosition: function(position) {\r\n        this.position = position;\r\n        if (this._isOnlyTable()) {\r\n          this.bottomPosition = 0;\r\n        } else {\r\n          if (\"bottom\" in position) {\r\n            this.bottomPosition = parseInt(position.bottom, 10);\r\n          } else {\r\n            this.bottomPosition = 0;\r\n          }\r\n        }\r\n        if (!this.domNode.parentNode || this.domNode.parentNode.id !== window.jimuConfig.layoutId) {\r\n          html.place(this.domNode, window.jimuConfig.layoutId);\r\n          this.setInitialPosition(position);\r\n\r\n          this.showRefreshing(false);\r\n        }\r\n        html.setStyle(this.domNode, \"bottom\", this.bottomPosition + \"px\");\r\n        if (!this._resourceManager.isEmpty()) {\r\n          setTimeout(lang.hitch(this, function() {\r\n            var ngHeight = this._getGridTopSectionHeight();\r\n            var domHeight = html.getStyle(this.domNode, 'height');\r\n            if (ngHeight > 0) {\r\n              this.noGridHeight = ngHeight;\r\n            }\r\n            if (domHeight > 0) {\r\n              this._changeHeight(domHeight);\r\n            }\r\n          }), 20);\r\n        }\r\n      },\r\n\r\n      _startQueryOnLayerTab: function(tabId, featureSet) {\r\n        var layerInfo = this._resourceManager.getLayerInfoById(tabId);\r\n        var tabPage = this.getExistLayerTabPage(tabId);\r\n\r\n        if (layerInfo && tabPage) {\r\n          this.showRefreshing(true);\r\n          this._resourceManager.getQueryTable(\r\n          tabId,\r\n          this.config.filterByMapExtent,\r\n          this.config.hideExportButton,\r\n          this.config.allowTextSelection).then(lang.hitch(this, function(result) {\r\n            //prevent overwrite by another asynchronous callback\r\n            if (this._activeLayerInfoId !== tabId || !result) {\r\n              return;\r\n            }\r\n            //prevent overwrite by another asynchronous callback\r\n            tabPage = this.getExistLayerTabPage(tabId);\r\n\r\n            if (result.isSupportQuery) {\r\n              var table = result.table;\r\n              if (table.getParent() !== tabPage) {\r\n                table.placeAt(tabPage);\r\n              }\r\n\r\n              this.setActiveTable(table, {\r\n                h: this.openHeight - this.noGridHeight,\r\n                featureSet: featureSet\r\n              });\r\n            } else {\r\n              var tip = html.toDom('<div>' + this.nls.unsupportQueryWarning + '</div>');\r\n              tabPage.set('content', tip);\r\n\r\n              if (this._activeTable) {\r\n                this._activeTable.changeToolbarStatus();\r\n              }\r\n            }\r\n            this.showRefreshing(false);\r\n          }), lang.hitch(this, function(err) {\r\n            new Message({\r\n              message: err.message || err\r\n            });\r\n            this.showRefreshing(false);\r\n          }));\r\n        }\r\n      },\r\n\r\n      _startQueryOnRelationTab: function(infoId, relationShipKey, selectedIds, originalInfoId) {\r\n        var originalInfo = this._resourceManager.getLayerInfoById(originalInfoId);\r\n        var tabPage = this.getExistLayerTabPage(infoId);\r\n        if (!(originalInfo && originalInfo.layerObject) || !tabPage) {\r\n          return;\r\n        }\r\n\r\n        this._resourceManager.getRelationTable(originalInfoId, relationShipKey,\r\n          false, this.config.hideExportButton, this.config.allowTextSelection)\r\n        .then(lang.hitch(this, function(result) {\r\n          //prevent overwrite by another asynchronous callback\r\n          if (this._activeLayerInfoId !== infoId || !result) {\r\n            return;\r\n          }\r\n          //prevent overwrite by another asynchronous callback\r\n          tabPage = this.getExistLayerTabPage(infoId);\r\n\r\n          if (result.isSupportQuery) {\r\n            var table = result.table;\r\n            if (table.getParent() !== tabPage) {\r\n              table.placeAt(tabPage);\r\n            }\r\n\r\n            this.setActiveTable(table, {\r\n              h: this.openHeight - this.noGridHeight,\r\n              layer: originalInfo.layerObject,\r\n              selectedIds: selectedIds\r\n            });\r\n\r\n          } else {\r\n            var tip = html.toDom('<div>' + this.nls.unsupportQueryWarning + '</div>');\r\n            tabPage.set('content', tip);\r\n\r\n            if (this._activeTable) {\r\n              this._activeTable.changeToolbarStatus();\r\n            }\r\n          }\r\n          this.showRefreshing(false);\r\n        }));\r\n      },\r\n\r\n      tabChanged: function() {\r\n        if (this.tabContainer && this.tabContainer.selectedChildWidget) {\r\n          if (this.noGridHeight <= 0) {\r\n            this.noGridHeight = this._getGridTopSectionHeight() + 5;\r\n          }\r\n          var params = this.tabContainer.selectedChildWidget.params; // ContentPage.params\r\n\r\n          var layerType = params.layerType;\r\n          var infoId = params.paneId;\r\n          var relKey = params.relKey;\r\n\r\n          if (layerType === this._layerTypes.FEATURELAYER &&\r\n            // change tab or the lasest operate is queryRelatedRecords\r\n            (this._activeLayerInfoId !== infoId || params.oids || params.featureSet)) {\r\n            this.setActiveTable(null);\r\n            delete params.oids;\r\n            this._activeLayerInfoId = infoId;\r\n            this._startQueryOnLayerTab(infoId, params.featureSet);\r\n\r\n          } else if (layerType === this._layerTypes.RELATIONSHIPTABLE) {\r\n            // need key and oids to judgement\r\n            this.setActiveTable(null);\r\n            var selectIds = params.oids;\r\n            var originalInfoId = params.originalInfoId;\r\n            this._activeLayerInfoId = infoId;\r\n            this._startQueryOnRelationTab(infoId, relKey, selectIds, originalInfoId);\r\n          }\r\n\r\n          // html.setAttr(this.tabContainer.selectedChildWidget.domNode, 'tabindex', '0');\r\n        }\r\n      },\r\n\r\n      showRefreshing: function(refresh) {\r\n        if (!this.loading) {\r\n          return;\r\n        }\r\n\r\n        this._toggleLoading(refresh);\r\n      },\r\n\r\n      _onDragStart: function(evt) {\r\n        this.moveMode = true;\r\n        this.moveY = evt.clientY;\r\n        this.previousDomHeight = html.getStyle(this.domNode, \"height\");\r\n        html.addClass(this.arrowDiv, \"draging\");\r\n\r\n        this._dragingHandlers = this._dragingHandlers.concat([\r\n          on(this.ownerDocument, 'dragstart', function(e) {\r\n            e.stopPropagation();\r\n            e.preventDefault();\r\n          }),\r\n          on(this.ownerDocumentBody, 'selectstart', function(e) {\r\n            e.stopPropagation();\r\n            e.preventDefault();\r\n          })\r\n        ]);\r\n      },\r\n\r\n      _onDraging: function(evt) {\r\n        if (this.moveMode && (evt.clientY >= 125)) {\r\n          var y = this.moveY - evt.clientY;\r\n          this._changeHeight(y + this.previousDomHeight);\r\n        }\r\n      },\r\n\r\n      _onDragEnd: function() {\r\n        this.moveMode = false;\r\n        html.removeClass(this.arrowDiv, \"draging\");\r\n\r\n        var h = this._dragingHandlers.pop();\r\n        while (h) {\r\n          h.remove();\r\n          h = this._dragingHandlers.pop();\r\n        }\r\n      },\r\n\r\n      _getNormalHeight: function() {\r\n        var h = document.body.clientHeight;\r\n        return window.appInfo.isRunInMobile ? h / 2 : h / 3;\r\n      },\r\n\r\n      setInitialPosition: function() {\r\n        // Attribute Table decide position by itself if there is no configuration in theme.\r\n        var left = html.getStyle(this.domNode, 'left');\r\n        var right = html.getStyle(this.domNode, 'right');\r\n        if(!left){\r\n          html.setStyle(this.domNode, \"left\", \"0px\");\r\n        }\r\n        if(!right){\r\n          html.setStyle(this.domNode, \"right\", \"0px\");\r\n        }\r\n        html.setStyle(this.domNode, \"top\", \"auto\");\r\n        html.setStyle(this.domNode, \"position\", \"absolute\");\r\n\r\n        if (!this._isOnlyTable()) {\r\n          if (this.config && this.config.initiallyExpand) {\r\n            this._openTable();\r\n          } else {\r\n            this._closeTable();\r\n          }\r\n        } // else use openAtStart by widgetManager or controller\r\n      },\r\n\r\n      _bindActiveTableEvents: function (){\r\n        var that = this;\r\n        if (that._activeTable) {\r\n          that._activeTableHandles.push(on(that._activeTable,\r\n            'show-related-records', function(evt) {\r\n              var layerInfoId = evt.layerInfoId;\r\n              var selectedIds = evt.objectIds;\r\n              var relationShip = evt.relationshipObj;\r\n              // that._showRelatedRecords(layerInfoId, selectedIds);\r\n              that._showRelatedRecordsByRelationship(layerInfoId, selectedIds, relationShip);\r\n            })\r\n          );\r\n          that._activeTableHandles.push(on(that._activeTable,\r\n            'show-all-records', function(evt) {\r\n              var page = that.getExistLayerTabPage(evt.layerInfoId);\r\n              page.params.layerType = that._layerTypes.FEATURELAYER;\r\n            })\r\n          );\r\n          that._activeTableHandles.push(on(that._activeTable,\r\n            'refresh', function(evt) {\r\n              var page = that.getExistLayerTabPage(evt.layerInfoId);\r\n              // page.params.layerType = that._layerTypes.FEATURELAYER;\r\n              delete page.params.featureSet;\r\n            })\r\n          );\r\n          // that._activeTableHandles.push(on(that._activeTable,\r\n          //   'row-click', function() {\r\n          //     var tables = that._resourceManager.featureTableSet;\r\n          //     for (var p in tables) {\r\n          //       var t = tables[p];\r\n          //       if (t !== that._activeTable) {\r\n          //         t.clearSelection(false);\r\n          //       }\r\n          //     }\r\n          //   }));\r\n          that._activeTableHandles.push(on(that._activeTable, 'apply-filter', function(events) {\r\n            that.filterManager.applyWidgetFilter(events.layerInfoId, that.id, events.expr);\r\n            that._activeTable.startQuery();\r\n          }));\r\n        }\r\n      },\r\n\r\n      _unbindActiveTableEvents: function (){\r\n        var that = this;\r\n        var handlers = that._activeTableHandles;\r\n        while(handlers.length > 0) {\r\n          var h = handlers.pop();\r\n          if (h && h.remove) {\r\n            h.remove();\r\n          }\r\n        }\r\n      },\r\n\r\n      setActiveTable: function(table, options) {\r\n        if (this._activeTable) {\r\n          this._activeTable.cancelThread();\r\n          this._activeTable.deactive();\r\n          this._unbindActiveTableEvents();\r\n          this._activeTable = null;\r\n        }\r\n        if (table) {\r\n          this._activeTable = table;\r\n          this._activeTable.active();\r\n          this._activeTable.changeHeight(options.h);\r\n          if (!this._activeTable.tableCreated ||\r\n            (this._activeTable.tableCreated && this._activeTable.matchingMap) ||\r\n            (this._activeTable.tableCreated &&\r\n              !this._activeTable.matchingMap && options.featureSet) ||\r\n            (options.layer && options.selectedIds)) {// queryRecordsByRelationship\r\n\r\n            var validFeatureSet = lang.getObject('featureSet.features.length', false, options);\r\n            if (options.layer && options.selectedIds) {\r\n              this._activeTable.queryRecordsByRelationship(options);\r\n            } else if (validFeatureSet) {\r\n              var primaryId = options.featureSet.displayFieldName;\r\n              var featureIds = array.map(options.featureSet.features, function(f) {\r\n                return f.attributes[primaryId];\r\n              });\r\n              this._activeTable.startQuery(featureIds);\r\n            } else {\r\n              this._activeTable.startQuery();\r\n            }\r\n          }\r\n          this._bindActiveTableEvents();\r\n          this._activeTable.changeToolbarStatus();\r\n        }\r\n      },\r\n\r\n      initDiv: function() {\r\n        this.AttributeTableDiv = html.create(\"div\", {}, this.domNode);\r\n        html.addClass(this.AttributeTableDiv, \"jimu-widget-attributetable-main\");\r\n\r\n        var tabDiv = html.create(\"div\");\r\n        html.place(tabDiv, this.AttributeTableDiv);\r\n\r\n        this.tabContainer = new TabContainer({\r\n          style: \"width: 100%;\"\r\n        }, tabDiv);\r\n        html.setStyle(this.tabContainer.domNode, 'height', (this.normalHeight) + 'px');\r\n\r\n        //if(has(\"mozilla\")){\r\n        //  this.tabContainer.tablist.containerNode.style.width = \"50000px\";\r\n        //}\r\n        //We need to startup tabContainer before call addChild method, or it will result in issue #8678\r\n        this.tabContainer.startup();\r\n\r\n        var configInfos = this._resourceManager.getConfigInfos();\r\n        var len = configInfos.length;\r\n\r\n        for (var j = 0; j < len; j++) {\r\n          var configInfo = configInfos[j];\r\n          if (configInfo.show) {\r\n            var json = lang.clone(configInfo);\r\n            var paneJson = {};\r\n\r\n            paneJson.paneId = json.id;\r\n            paneJson.title = json.name;\r\n            paneJson.name = json.name;\r\n            paneJson.layerType = this._layerTypes.FEATURELAYER;\r\n            paneJson.style = \"height: 100%; width: 100%; overflow: visible;\";\r\n            var cp = new ContentPane(paneJson);\r\n            this.layerTabPages[j] = cp;\r\n            this.tabContainer.addChild(cp);\r\n          }\r\n        }\r\n\r\n        if (len > 0) {\r\n          // tabListWrapperHeight + tolerance\r\n          this.noGridHeight = this._getGridTopSectionHeight() + 5;\r\n        } else {\r\n          this._toggleNoTableMessage(true);\r\n        }\r\n        // vertical center\r\n        utils.setVerticalCenter(this.tabContainer.domNode);\r\n        this.tabChanged();\r\n        this.own(aspect.after(this.tabContainer, \"selectChild\", lang.hitch(this, this.tabChanged)));\r\n\r\n        // apply extra work to make widget accessible:\r\n        if(this.applyA11y) {\r\n          this.applyA11y();\r\n        }\r\n      },\r\n\r\n      getLayerInfoLabel: function(layerInfo) {\r\n        var label = layerInfo.name || layerInfo.title;\r\n        return label;\r\n      },\r\n\r\n      getLayerInfoId: function(layerInfo) {\r\n        return layerInfo && layerInfo.id || \"\";\r\n      },\r\n\r\n      _getGridTopSectionHeight: function() {\r\n        var tabPageWrapper = domQuery('.dijitTabPaneWrapper', this.domNode)[0];\r\n        if (tabPageWrapper) {\r\n          var widgetTop = html.position(this.domNode).y;\r\n          var tabPaneTop = html.position(tabPageWrapper).y;\r\n          return tabPaneTop - widgetTop;\r\n        } else {\r\n          return 0;\r\n        }\r\n      },\r\n\r\n      _getLayerInfoByIdFromConfigJSON: function(id) {\r\n        var configedInfos = array.filter(this.config.layerInfos, function(linfo) {\r\n          return linfo.id === id;\r\n        });\r\n        return (configedInfos && configedInfos.length > 0) && configedInfos[0];\r\n      },\r\n\r\n\r\n      // _showRelatedRecords: function(infoId, objIds) {\r\n      //   var activeTable = this._activeTable;\r\n      //   if (activeTable) {\r\n      //     var layerInfo = activeTable.layerInfo;\r\n      //     if (layerInfo && layerInfo.id === infoId && layerInfo.layerObject) {\r\n      //       var _layer = layerInfo.layerObject;\r\n      //       var ships = _layer.relationships;\r\n      //       // var objIds = activeTable.getSelectedRows();\r\n\r\n      //       for (var i = 0, len = ships.length; i < len; i++) {\r\n      //         this.addNewRelationTab(objIds, ships[i], layerInfo.id, true, true);\r\n      //       }\r\n      //     }\r\n      //   }\r\n      // },\r\n\r\n      _showRelatedRecordsByRelationship: function(infoId, objIds, relationship) {\r\n        var activeTable = this._activeTable;\r\n        if (activeTable) {\r\n          var layerInfo = activeTable.layerInfo;\r\n          if (layerInfo && layerInfo.id === infoId && layerInfo.layerObject) {\r\n            var _layer = layerInfo.layerObject;\r\n            var ships = _layer.relationships;\r\n            if(array.some(ships, function(s) { return utils.isEqual(s, relationship); })) {\r\n              this.addNewRelationTab(objIds, relationship, layerInfo.id, true, true);\r\n            }\r\n          }\r\n        }\r\n      },\r\n\r\n      addNewLayerTab: function(infoId, featureSet, closeable, isActive, index, viewInTableFlag) {\r\n        var layerInfo = this._resourceManager.getLayerInfoById(infoId);\r\n        if (!layerInfo) {\r\n          return;\r\n        }\r\n        var page = this.getExistLayerTabPage(infoId);\r\n        var json = {};\r\n        json.title = this.getLayerInfoLabel(layerInfo);\r\n        json.name = json.title;\r\n        json.paneId = this.getLayerInfoId(layerInfo);\r\n        json.closable = closeable;\r\n        json.layerType = this._layerTypes.FEATURELAYER;\r\n        json.featureSet = featureSet;\r\n        json.viewInTableFlag = viewInTableFlag;\r\n        if (page) {\r\n          lang.mixin(page.params, json);\r\n          this.onOpen();\r\n          // this.tabContainer.selectChild(page);\r\n        } else {\r\n          if (!this._resourceManager.getConfigInfoById(layerInfo.id)) {\r\n            this._resourceManager.addConfigInfo(layerInfo);\r\n          }\r\n          if (!this._resourceManager.getLayerInfoById(layerInfo.id)) {\r\n            this._resourceManager.addLayerInfo(layerInfo);\r\n          }\r\n          this.onOpen();\r\n\r\n          json.style = \"height: 100%; width: 100%; overflow: visible\";\r\n          page = new ContentPane(json);\r\n          this.layerTabPages.push(page);\r\n\r\n          page.set(\"title\", json.name);\r\n          // tabContainer will remove the page and destroy the page by itself.\r\n          this.own(on(page, \"close\", lang.hitch(this, this.layerTabPageClose, json.paneId, true)));\r\n          this.tabContainer.addChild(page, index);\r\n        }\r\n        if(isActive) {\r\n          this.tabContainer.selectChild(page); // goto tabChanged\r\n          this.__focusOnActiveTab();\r\n        }\r\n        if(this.layerTabPages.length === 1) {\r\n          this._toggleNoTableMessage(false);\r\n        }\r\n      },\r\n\r\n      addNewRelationTab: function(oids, relationShip, originalInfoId, closeable, isActive) {\r\n        var relationshipInfo = this._resourceManager.getRelationShipInfo(relationShip);\r\n        var lInfo = relationShip && relationshipInfo;\r\n        if (!lInfo) {\r\n          return;\r\n        }\r\n        var pageId = relationshipInfo.id;\r\n        var page = this.getExistLayerTabPage(pageId);\r\n\r\n        var json = {};\r\n        json.oids = oids;\r\n        var paneTitle = lInfo.title || lInfo.name || relationShip.name;\r\n        json.title = paneTitle;\r\n        json.name = json.title;\r\n        json.paneId = lInfo.id;\r\n        json.relKey = relationShip._relKey;\r\n        json.originalInfoId = originalInfoId;\r\n        json.closable = closeable;\r\n        json.layerType = this._layerTypes.RELATIONSHIPTABLE;\r\n        json.viewInTableFlag = true;\r\n\r\n        if (page) {\r\n          lang.mixin(page.params, json);\r\n        } else {\r\n          if (!this._resourceManager.getConfigInfoById(lInfo.id)) {\r\n            this._resourceManager.addConfigInfo(lInfo);\r\n          }\r\n          if (!this._resourceManager.getLayerInfoById(lInfo.id)) {\r\n            this._resourceManager.addLayerInfo(lInfo);\r\n          }\r\n          json.style = \"height: 100%; width: 100%; overflow: visible\";\r\n          page = new ContentPane(json);\r\n          this.layerTabPages.push(page);\r\n          page.set(\"title\", json.name);\r\n          // tabContainer will remove the page and destroy the page by itself.\r\n          this.own(on(page, \"close\", lang.hitch(this, this.layerTabPageClose, json.paneId, true)));\r\n\r\n          this.tabContainer.addChild(page);\r\n        }\r\n        if(isActive) {\r\n          this.tabContainer.selectChild(page); // goto tabChanged\r\n        }\r\n      },\r\n\r\n      onReceiveData: function(name, source, params) {\r\n        /*jshint unused:vars*/\r\n        if (params && params.target === \"AttributeTable\") {\r\n          if (this._isOnlyTable()) {\r\n            if (this.state === 'closed') {\r\n              console.warn('Please open Attribute Table!');\r\n              return;\r\n            }\r\n          }\r\n          params.layer = params.layer || params.layerInfo;\r\n          params.closeable = true;\r\n          params.isActive = true;\r\n\r\n          if (!this.showing) {\r\n            this._openTable().then(lang.hitch(this, function() {\r\n              var isInResources = !!this._resourceManager.getLayerInfoById(params.layer.id);\r\n              if (!isInResources) {\r\n                this._resourceManager.updateLayerInfoResources(false)\r\n                .then(lang.hitch(this, function() {\r\n                  this._addLayerToTable(params);\r\n                }));\r\n              } else {\r\n                this._addLayerToTable(params);\r\n              }\r\n            }));\r\n          } else {\r\n            this._resourceManager.updateLayerInfoResources(false)\r\n            .then(lang.hitch(this, function() {\r\n              this._addLayerToTable(params);\r\n            }));\r\n          }\r\n        }\r\n      },\r\n\r\n      _addLayerToTable: function(params) {\r\n        var layer = null;\r\n        if (!(lang.getObject('layer.id', false, params) ||\r\n          lang.getObject('layerInfo.id', false, params))) {\r\n          return;\r\n        }\r\n        var layerInfo = this._resourceManager\r\n          .getLayerInfoById(\r\n            (params.layerInfo && params.layerInfo.id) ||\r\n            (params.layer && params.layer.id)\r\n          );\r\n        layerInfo.getLayerObject().then(lang.hitch(this, function(layerObject) {\r\n          if (layerObject) {\r\n            layerObject.id = params.layer.id;\r\n            if (layerObject.loaded) {\r\n              this.addNewLayerTab(\r\n                layerInfo.id,\r\n                params.featureSet,\r\n                !!params.closeable,\r\n                !!params.isActive,\r\n                params.index,\r\n                params.viewInTableFlag);\r\n            } else {\r\n              this.own(on(layerObject, \"load\",\r\n                lang.hitch(this,\r\n                  this.addNewLayerTab,\r\n                  layerInfo.id,\r\n                  params.featureSet,\r\n                  !!params.closeable,\r\n                  !!params.isActive,\r\n                  params.index,\r\n                  params.viewInTableFlag)));\r\n            }\r\n          } else if (params.url) {\r\n            layer = new FeatureLayer(params.url);\r\n            this.own(\r\n              on(layer, \"load\",\r\n                lang.hitch(this,\r\n                  this.addNewLayerTab,\r\n                  layerInfo.id,\r\n                  params.featureSet,\r\n                  !!params.closeable,\r\n                  !!params.isActive,\r\n                  params.index,\r\n                  params.viewInTableFlag))\r\n            );\r\n          }\r\n        }), lang.hitch(this, function(err) {\r\n          new Message({\r\n            message: err.message || err\r\n          });\r\n        }));\r\n      },\r\n\r\n      getExistLayerTabPage: function(paneId) {\r\n        var len = this.layerTabPages.length;\r\n        for (var i = 0; i < len; i++) {\r\n          if (this.layerTabPages[i] && this.layerTabPages[i].get('paneId') === paneId) {\r\n            return this.layerTabPages[i];\r\n          }\r\n        }\r\n        return null;\r\n      },\r\n\r\n      layerTabPageClose: function(paneId, isRemoveChild) {\r\n        var len = this.layerTabPages.length;\r\n        var activeId = lang.getObject('_activeTable.layerInfo.id', false, this);\r\n        if (activeId === paneId) {\r\n          this.setActiveTable(null);\r\n        }\r\n        for (var i = 0; i < len; i++) {\r\n          if (this.layerTabPages[i] && this.layerTabPages[i].paneId === paneId) {\r\n            // this.featureTableSet\r\n\r\n            // var table = that._resourceManager.featureTableSet[paneId];\r\n            var table = lang.getObject('_resourceManager.featureTableSet.' + paneId, false, this);\r\n            if (table) {\r\n              var filterObj = table.getFilterObj();\r\n              if (filterObj && esriLang.isDefined(filterObj.expr)) {\r\n                this.filterManager.applyWidgetFilter(paneId, this.id, \"\");\r\n              }\r\n            }\r\n            if (isRemoveChild === true) {\r\n              this.tabContainer.removeChild(this.layerTabPages[i]);\r\n              this.layerTabPages[i].destroyRecursive();\r\n            }\r\n            if (this.layerTabPages && this.layerTabPages[i]) {\r\n              this.layerTabPages.splice(i, 1); // removed contentpane from memory\r\n            }\r\n\r\n            this._resourceManager.removeConfigInfo(paneId); // destroy featureTable\r\n            this._resourceManager.removeLayerInfo(paneId);\r\n\r\n            if (len === 1) {\r\n              this._activeLayerInfoId = null;\r\n              this.onClose();\r\n              this._toggleNoTableMessage(true);\r\n              return;\r\n            } else if(paneId === this._activeLayerInfoId) {\r\n              var layerIndex = len - 2; // show last contentpane\r\n              this.tabContainer.selectChild(this.layerTabPages[layerIndex]);\r\n            }\r\n            break;\r\n          }\r\n        }\r\n      },\r\n\r\n      _processRelatedRecordsFromPopup: function(layerInfo, featureIds) {\r\n        if (layerInfo) {\r\n          var defs = [];\r\n          defs.push(layerInfo.getLayerObject());\r\n          defs.push(layerInfo.getRelatedTableInfoArray());\r\n          all(defs).then(lang.hitch(this, function(results) {\r\n            if (results) {\r\n              var layerObject = results[0];\r\n              var relatedTableInfos = results[1];\r\n              this._resourceManager.collectRelationShips(layerInfo, relatedTableInfos);\r\n              var ships = layerObject.relationships;\r\n              for (var i = 0, len = ships.length; i < len; i++) {\r\n                this.addNewRelationTab(featureIds, ships[i], layerInfo.id, true, true);\r\n              }\r\n            }\r\n          }));\r\n        }\r\n      },\r\n\r\n      showRelatedRecordsFromPopup: function(layerInfo, featureIds) {\r\n        if (!this.showing) {\r\n          this._openTable().then(lang.hitch(this, function() {\r\n            var isInResources = !!this._resourceManager.getLayerInfoById(layerInfo.id);\r\n            if (!isInResources) {\r\n              this._resourceManager.updateLayerInfoResources(false)\r\n              .then(lang.hitch(this, function() {\r\n                this._processRelatedRecordsFromPopup(layerInfo, featureIds);\r\n              }));\r\n            } else {\r\n              this._processRelatedRecordsFromPopup(layerInfo, featureIds);\r\n            }\r\n          }));\r\n        } else {\r\n          this._resourceManager.updateLayerInfoResources(false)\r\n          .then(lang.hitch(this, function() {\r\n            this._processRelatedRecordsFromPopup(layerInfo, featureIds);\r\n          }));\r\n        }\r\n      },\r\n\r\n      getRelationShipInfo: function(relationship) {\r\n        return this._resourceManager && this._resourceManager.getRelationShipInfo(relationship);\r\n      },\r\n\r\n      _toggleNoTableMessage: function(show) {\r\n        if(!this.NoTableMessageDiv) {\r\n          var srcRef = this.AttributeTableDiv || this.domNode;\r\n          var messageText = this.nls.noTablesAvailable + '<br/><br/>' +\r\n          (this.config.syncWithLayers ?\r\n          this.nls.checkLayerListToSelectLayers : this.nls.checkConfigutationToSelectLayers);\r\n\r\n          this.NoTableMessageDiv = html.create('div', {\r\n            innerHTML: messageText,\r\n            className: 'jimu-widget-attributetable-notable hidden'\r\n          });\r\n          html.place(this.NoTableMessageDiv, srcRef);\r\n        }\r\n        html[show ? 'removeClass':'addClass'](this.NoTableMessageDiv, 'hidden');\r\n      },\r\n\r\n      _toggleLoading: function(show) {\r\n        if(show === undefined) {\r\n          var isHidden = this.loading.hidden;\r\n          if(isHidden) {\r\n            this.loading.show();\r\n          } else {\r\n            this.loading.hide();\r\n          }\r\n        } else {\r\n          if(show) {\r\n            this.loading.show();\r\n          } else {\r\n            this.loading.hide();\r\n          }\r\n        }\r\n      },\r\n\r\n      isLoading: function() {\r\n        return this.loading && !this.loading.hidden || // widget is loading\r\n               this._activeTable && this._activeTable.loading && !this._activeTable.loading.hidden; // table is loading\r\n      }\r\n    });\r\n\r\n    clazz.inPanel = false;\r\n    clazz.hasUIFile = false;\r\n    return clazz;\r\n  });"]}