{"version":3,"sources":["../../../widgets/LayerList/PopupMenu.js"],"names":["define","declare","array","html","lang","query","on","keys","focusUtil","Deferred","DropMenu","jimuUtils","_TemplatedMixin","HorizSlider","HorzRuleLabels","template","domStyle","VisibleScaleRangeSlider","NlsStrings","PopupMenuInfo","templateString","popupMenuInfo","loading","_deniedItems","_deniedItemsFromConfig","_layerInfo","constructor","nls","value","postCreate","inherited","arguments","_initDeniedItems","create","popupMenuNode","deniedItemsFromConfigKeys","menuItemDictionary","menuItem","_config","contextMenu","hasOwnProperty","concat","split","forEach","hitch","deniedItemKey","push","_getDropMenuPosition","top","right","zIndex","_getTransNodePosition","_onBtnClick","_refresh","_denyItems","_changeItemsUI","itemNodes","dropMenuNode","itemNode","removeClass","deniedItem","key","denyType","addClass","setAttr","itemA","removeAttr","lastDisplayItemNodeIndex","i","length","hasClass","displayItemNodes","filter","isPopupNestedEnabled","removePopup","enablePopup","canShowLabel","isShowLabels","hideLables","showLabels","_switchLoadingState","isShow","setStyle","selectItem","item","evt","found","emit","stopPropagation","openDropMenu","inheritedCallBack","popupMenuInfoDef","layerListWidget","then","items","getDisplayItems","_createDropMenuNode","resolve","getDeniedItems","deniedItems","closeDropMenu","hideTransNode","hideSetVisibilityRangeNode","_onTransparencyDivClick","showTransNode","transValue","transHorizSlider","_createTransparencyWidget","set","transparencyDiv","isRTL","focus","minimum","maximum","intermediateChanges","transparencyBody","own","newTransValue","data","domNode","e","keyCode","ESCAPE","preventDefault","getMenuItemNodeByItemKey","TAB","_enableNavMode","container","transparencyRule","_onSetVisibilityRangeNode","showSetVisibilityRangeNode","layerInfo","visibleScaleRangeSlider","scaleRange","getScaleRange","map","minScale","maxScale","placeAt","setVisibilityRangeNode","startup","_supportsVisibilityRange508Accessibility","setScaleRange","_slider","hide","show","isInNavMode","document","body","sliderBtns","firstFocusNode","downArrowButtons","lastFocusNode","firstDownArrowButton","secondDownArrowButton","shiftKey","ENTER","setTimeout","_bindEsriScaleMenuPopupKey","focusNodeWhenLeave","esriScaleMenuPopup","_getEsriScaleMenuPopup","dijitInputInner","esriHeaders","esriCurrent","innerText","_hasBeenBoundKey","esriScaleMenuList","esriScaleMenuItems","menuItemInfo","_getMenuItemInfo","DOWN_ARROW","nextMenuItem","UP_ARROW","previousMenuItem","event","createEvent","initEvent","dispatchEvent","firstMenuItem","currentMenuItem","lastMenuItem","some","index","scaleMenu","getStyle"],"mappings":"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","file":"PopupMenu.js","sourcesContent":["///////////////////////////////////////////////////////////////////////////\r\n// Copyright © Esri. All Rights Reserved.\r\n//\r\n// Licensed under the Apache License Version 2.0 (the \"License\");\r\n// you may not use this file except in compliance with the License.\r\n// You may obtain a copy of the License at\r\n//\r\n//    http://www.apache.org/licenses/LICENSE-2.0\r\n//\r\n// Unless required by applicable law or agreed to in writing, software\r\n// distributed under the License is distributed on an \"AS IS\" BASIS,\r\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n// See the License for the specific language governing permissions and\r\n// limitations under the License.\r\n///////////////////////////////////////////////////////////////////////////\r\ndefine([\r\n  'dojo/_base/declare',\r\n  'dojo/_base/array',\r\n  'dojo/_base/html',\r\n  'dojo/_base/lang',\r\n  'dojo/query',\r\n  'dojo/on',\r\n  'dojo/keys',\r\n  'dijit/focus',\r\n  'dojo/Deferred',\r\n  'jimu/dijit/DropMenu',\r\n  'jimu/utils',\r\n  'dijit/_TemplatedMixin',\r\n  'dijit/form/HorizontalSlider',\r\n  'dijit/form/HorizontalRuleLabels',\r\n  'dojo/text!./PopupMenu.html',\r\n  'dojo/dom-style',\r\n  'esri/dijit/VisibleScaleRangeSlider',\r\n  './NlsStrings',\r\n  './PopupMenuInfo'\r\n], function(declare, array, html, lang, query, on, keys, focusUtil, Deferred, DropMenu, jimuUtils,\r\n  _TemplatedMixin, HorizSlider, HorzRuleLabels, template, domStyle, VisibleScaleRangeSlider,\r\n  NlsStrings, PopupMenuInfo) {\r\n  return declare([DropMenu, _TemplatedMixin], {\r\n    templateString: template,\r\n    popupMenuInfo: null,\r\n    loading: null,\r\n    _deniedItems: null,\r\n    _deniedItemsFromConfig: null,\r\n    _layerInfo: null,\r\n    constructor: function() {\r\n      this.nls = NlsStrings.value;\r\n    },\r\n\r\n    postCreate: function() {\r\n      this.inherited(arguments);\r\n      this._initDeniedItems();\r\n      this.loading = html.create('div', {\r\n        'class': 'popup-menu-loading'\r\n      }, this.popupMenuNode);\r\n\r\n      // if(!this.hasContentMenu()) {\r\n      //   this.hide();\r\n      //   domStyle.set(this.popupMenuNode, 'display', 'none');\r\n      // }\r\n    },\r\n\r\n    _initDeniedItems: function() {\r\n      var deniedItemsFromConfigKeys = [];\r\n      var menuItemDictionary = {\r\n        \"ZoomTo\": \"zoomto\",\r\n        \"Transparency\": \"transparency\",\r\n        \"SetVisibilityRange\": \"setVisibilityRange\",\r\n        \"EnableOrDisablePopup\": \"controlPopup\",\r\n        \"ControlLabels\": \"controlLabels\",\r\n        \"MoveupOrMovedown\": \"moveup movedown\",\r\n        \"OpenAttributeTable\": \"table\",\r\n        \"DescriptionOrShowItemDetailsOrDownload\": \"url\"\r\n      };\r\n      this._deniedItems = [];\r\n      this._deniedItemsFromConfig = [];\r\n      // ignore if this._config.contextMenu has not configured.\r\n      // compatible with old version app.\r\n      for (var menuItem in this._config.contextMenu) {\r\n        if(this._config.contextMenu.hasOwnProperty(menuItem) &&\r\n            (typeof this._config.contextMenu[menuItem] !== 'function') &&\r\n            this._config.contextMenu[menuItem] === false) {\r\n          deniedItemsFromConfigKeys =\r\n            deniedItemsFromConfigKeys.concat(menuItemDictionary[menuItem].split(\" \"));\r\n        }\r\n      }\r\n\r\n      array.forEach(deniedItemsFromConfigKeys,\r\n                    lang.hitch(this, function(deniedItemKey) {\r\n        this._deniedItemsFromConfig.push({\r\n          'key': deniedItemKey,\r\n          'denyType': 'hidden'\r\n        });\r\n      }));\r\n    },\r\n\r\n    _getDropMenuPosition: function() {\r\n      return {\r\n        top: \"40px\",\r\n        right: \"0px\",\r\n        zIndex: 1\r\n      };\r\n    },\r\n\r\n    _getTransNodePosition: function() {\r\n      return {\r\n        top: \"28px\",\r\n        //left: \"-107px\"\r\n        //left: -1 * html.getStyle(this.transparencyDiv, 'width') + 'px'\r\n        right: \"2px\"\r\n      };\r\n    },\r\n\r\n    _onBtnClick: function() {},\r\n\r\n    // will call after openDropMenu\r\n    _refresh: function() {\r\n      this._denyItems();\r\n      this._changeItemsUI();\r\n    },\r\n\r\n    _denyItems: function() {\r\n      var itemNodes = query(\"[class~='menu-item-identification']\", this.dropMenuNode);\r\n      itemNodes.forEach(function(itemNode) {\r\n        html.removeClass(itemNode, \"menu-item-dissable\");\r\n        html.removeClass(itemNode, \"menu-item-hidden\");\r\n      }, this);\r\n      html.removeClass(this.dropMenuNode, \"no-border\");\r\n      array.forEach(this._deniedItems, function(deniedItem) {\r\n        var itemNode = query(\"div[itemId='\" + deniedItem.key + \"']\", this.dropMenuNode)[0];\r\n        if (itemNode) {\r\n          if (deniedItem.denyType === \"disable\") {\r\n            html.addClass(itemNode, \"menu-item-dissable\");\r\n            html.setAttr(itemNode, 'aria-disabled', 'true');\r\n            if (deniedItem.key === 'url') {\r\n              query(\".menu-item-description\", itemNode).forEach(function(itemA) {\r\n                html.setAttr(itemA, 'href', '#');\r\n                html.removeAttr(itemA, 'target');\r\n              });\r\n            }\r\n          } else {\r\n            html.removeAttr(itemNode, 'aria-disabled');\r\n            html.addClass(itemNode, \"menu-item-hidden\");\r\n          }\r\n        }\r\n      }, this);\r\n\r\n      // handle separator line\r\n      var lastDisplayItemNodeIndex = -1;\r\n      for (var i = 0; i < itemNodes.length; i++) {\r\n        if (html.hasClass(itemNodes[i], 'menu-item-line')) {\r\n          if (lastDisplayItemNodeIndex === -1 ||\r\n            html.hasClass(itemNodes[lastDisplayItemNodeIndex], 'menu-item-line')) {\r\n            html.addClass(itemNodes[i], \"menu-item-hidden\");\r\n          }\r\n        }\r\n\r\n        if (!html.hasClass(itemNodes[i], 'menu-item-hidden')) {\r\n          lastDisplayItemNodeIndex = i;\r\n        }\r\n      }\r\n      // Hide last item if that is a line.\r\n      var displayItemNodes = array.filter(itemNodes, function(itemNode) {\r\n        return !html.hasClass(itemNode, 'menu-item-hidden');\r\n      });\r\n      if (displayItemNodes.length === 0) {\r\n        html.addClass(this.dropMenuNode, \"no-border\");\r\n      } else {\r\n        html.removeClass(this.dropMenuNode, \"no-border\");\r\n        if (html.hasClass(displayItemNodes[displayItemNodes.length - 1], 'menu-item-line')) {\r\n          html.addClass(displayItemNodes[displayItemNodes.length - 1], \"menu-item-hidden\");\r\n        }\r\n      }\r\n    },\r\n\r\n    _changeItemsUI: function() {\r\n      //handle controlPopup item.\r\n      var itemNode = query(\"[itemid=controlPopup]\", this.dropMenuNode)[0];\r\n      if (itemNode) {\r\n        //if (this._layerInfo.controlPopupInfo.enablePopup) {\r\n        if (this._layerInfo.isPopupNestedEnabled()) {\r\n          html.setAttr(itemNode, 'innerHTML', this.nls.removePopup);\r\n        } else {\r\n          html.setAttr(itemNode, 'innerHTML', this.nls.enablePopup);\r\n        }\r\n      }\r\n      //handle controlLabels item.\r\n      itemNode = query(\"[itemid=controlLabels]\", this.dropMenuNode)[0];\r\n      if (itemNode && this._layerInfo.canShowLabel()) {\r\n        if (this._layerInfo.isShowLabels()) {\r\n          html.setAttr(itemNode, 'innerHTML', this.nls.hideLables);\r\n        } else {\r\n          html.setAttr(itemNode, 'innerHTML', this.nls.showLabels);\r\n        }\r\n      }\r\n      //add tartet to a tag.\r\n      itemNode = query(\"[itemid=url] a\", this.dropMenuNode)[0];\r\n      if(itemNode) {\r\n        html.setAttr(itemNode, 'target', '_blank');\r\n      }\r\n    },\r\n\r\n    _switchLoadingState: function(isShow) {\r\n      if(isShow) {\r\n        html.setStyle(this.loading, 'display', 'block');\r\n      } else {\r\n        html.setStyle(this.loading, 'display', 'none');\r\n      }\r\n    },\r\n\r\n    selectItem: function(item, evt) {\r\n      var found = false;\r\n      for (var i = 0; i < this._deniedItems.length; i++) {\r\n        if (this._deniedItems[i].key === item.key) {\r\n          found = true;\r\n          break;\r\n        }\r\n      }\r\n      if (!found) {\r\n        this.emit('onMenuClick', item);\r\n      }\r\n      evt.stopPropagation(evt);\r\n    },\r\n\r\n    openDropMenu: function() {\r\n      var inheritedCallBack = lang.hitch(this, this.inherited, arguments);\r\n      var popupMenuInfoDef = new Deferred();\r\n      this._switchLoadingState(true);\r\n      if (!this.dropMenuNode) {\r\n        // create popupMenuInfo first.\r\n        PopupMenuInfo.create(this._layerInfo, this.layerListWidget)\r\n          .then(lang.hitch(this, function(popupMenuInfo) {\r\n            // set environment and create.\r\n            this.items = popupMenuInfo.getDisplayItems();\r\n            this.popupMenuInfo = popupMenuInfo;\r\n            this._createDropMenuNode();\r\n            popupMenuInfoDef.resolve(this.popupMenuInfo);\r\n          }));\r\n      } else {\r\n        popupMenuInfoDef.resolve(this.popupMenuInfo);\r\n      }\r\n\r\n      popupMenuInfoDef.then(lang.hitch(this, function() {\r\n        // get deniedItems\r\n        this.popupMenuInfo.getDeniedItems().then(lang.hitch(this, function(deniedItems) {\r\n          this._deniedItems = this._deniedItemsFromConfig.concat(deniedItems);\r\n          // deny items\r\n          this._refresh();\r\n          // display dropMenuNode.\r\n          inheritedCallBack(arguments);\r\n          this._switchLoadingState(false);\r\n        }), lang.hitch(this, function() {\r\n          this._switchLoadingState(false);\r\n        }));\r\n      }), lang.hitch(this, function() {\r\n        this._switchLoadingState(false);\r\n      }));\r\n    },\r\n\r\n    closeDropMenu: function() {\r\n      this.inherited(arguments);\r\n      this.hideTransNode();\r\n      this.hideSetVisibilityRangeNode();\r\n    },\r\n\r\n    // about transparcency\r\n    _onTransparencyDivClick: function(evt) {\r\n      // summary:\r\n      //    response to click transparency in popummenu.\r\n      evt.stopPropagation();\r\n    },\r\n\r\n    showTransNode: function(transValue, item) {\r\n      /* global isRTL */\r\n      this.hideSetVisibilityRangeNode();\r\n      if (!this.transHorizSlider) {\r\n        this._createTransparencyWidget(item);\r\n        this.transHorizSlider.set(\"value\", 1 - transValue);\r\n      } else {\r\n        this.transHorizSlider.set(\"value\", 1 - transValue);\r\n      }\r\n      domStyle.set(this.transparencyDiv, \"top\", this._getTransNodePosition().top);\r\n      if (isRTL) {\r\n        domStyle.set(this.transparencyDiv, \"left\", this._getTransNodePosition().right);\r\n      } else {\r\n        domStyle.set(this.transparencyDiv, \"right\", this._getTransNodePosition().right);\r\n      }\r\n      domStyle.set(this.transparencyDiv, \"display\", \"block\");\r\n      this.transHorizSlider.focus();\r\n    },\r\n\r\n    hideTransNode: function() {\r\n      domStyle.set(this.transparencyDiv, \"display\", \"none\");\r\n    },\r\n\r\n    _createTransparencyWidget: function(item) {\r\n      this.transHorizSlider = new HorizSlider({\r\n        minimum: 0,\r\n        maximum: 1,\r\n        intermediateChanges: true\r\n      }, this.transparencyBody);\r\n\r\n      this.own(this.transHorizSlider.on(\"change\", lang.hitch(this, function(newTransValue) {\r\n        var data = {\r\n          newTransValue: newTransValue\r\n        };\r\n        this.emit('onMenuClick', {\r\n          key: 'transparencyChanged'\r\n        }, data);\r\n      })));\r\n\r\n      this.own(on(this.transHorizSlider.domNode, \"keydown\", lang.hitch(this, function(e) {\r\n        if(e.keyCode === keys.ESCAPE) {\r\n          e.stopPropagation();\r\n          e.preventDefault();\r\n          this.hideTransNode();\r\n          var menuItem = this.getMenuItemNodeByItemKey(item.key);\r\n          if(menuItem) {\r\n            focusUtil.focus(menuItem);\r\n          }\r\n        } else if(e.keyCode === keys.TAB) {\r\n          e.stopPropagation();\r\n          e.preventDefault();\r\n          this._enableNavMode(e);\r\n        }\r\n      })));\r\n\r\n      new HorzRuleLabels({\r\n        container: \"bottomDecoration\"\r\n      }, this.transparencyRule);\r\n    },\r\n\r\n    _onSetVisibilityRangeNode: function(evt) {\r\n      // summary:\r\n      //    response to click transparency in popummenu.\r\n      evt.stopPropagation();\r\n    },\r\n\r\n    showSetVisibilityRangeNode: function(layerInfo, item) {\r\n      /* global isRTL */\r\n      this.hideTransNode();\r\n      if (!this.visibleScaleRangeSlider) {\r\n        var scaleRange = layerInfo.getScaleRange();\r\n        this.visibleScaleRangeSlider = new VisibleScaleRangeSlider({\r\n          map: layerInfo.map,\r\n          minScale: scaleRange.minScale,\r\n          maxScale: scaleRange.maxScale\r\n        }).placeAt(this.setVisibilityRangeNode);\r\n        this.visibleScaleRangeSlider.startup();\r\n        this._supportsVisibilityRange508Accessibility(item);\r\n      }\r\n\r\n      this.own(this.visibleScaleRangeSlider.on(\"scale-range-change\", lang.hitch(this, function(scaleRange) {\r\n        layerInfo.setScaleRange(scaleRange.minScale, scaleRange.maxScale);\r\n      })));\r\n\r\n      domStyle.set(this.setVisibilityRangeNode, \"top\", this._getTransNodePosition().top);\r\n      if (isRTL) {\r\n        domStyle.set(this.setVisibilityRangeNode, \"left\", this._getTransNodePosition().right);\r\n      } else {\r\n        domStyle.set(this.setVisibilityRangeNode, \"right\", this._getTransNodePosition().right);\r\n      }\r\n      domStyle.set(this.setVisibilityRangeNode, \"display\", \"block\");\r\n      this.visibleScaleRangeSlider._slider.focus();\r\n      this.visibleScaleRangeSlider._slider.focus();\r\n    },\r\n\r\n    hideSetVisibilityRangeNode: function() {\r\n      domStyle.set(this.setVisibilityRangeNode, \"display\", \"none\");\r\n    },\r\n\r\n    hide: function() {\r\n      domStyle.set(this.domNode, 'display', 'none');\r\n    },\r\n\r\n    show: function() {\r\n      domStyle.set(this.domNode, 'display', 'block');\r\n    },\r\n\r\n    _enableNavMode:function(evt) {\r\n      if(evt.keyCode === keys.TAB && !jimuUtils.isInNavMode()){\r\n        html.addClass(document.body, 'jimu-nav-mode');\r\n      }\r\n    },\r\n\r\n    /*\r\n    hasContentMenu: function() {\r\n      var hasContentMenu = false;\r\n      var item;\r\n      if(this._config.contextMenu) {\r\n        for (item in this._config.contextMenu) {\r\n          if(this._config.contextMenu.hasOwnProperty(item) &&\r\n             (typeof this._config.contextMenu[item] !== 'function')) {\r\n            hasContentMenu = hasContentMenu || this._config.contextMenu[item];\r\n          }\r\n        }\r\n      } else {\r\n        hasContentMenu = true;\r\n      }\r\n      return hasContentMenu;\r\n    }\r\n    */\r\n    /***************************************************\r\n     * methods for 508 accessibility.\r\n     ***************************************************/\r\n\r\n    _supportsVisibilityRange508Accessibility: function(item) {\r\n      var sliderBtns = query('.dijitSliderImageHandle', this.setVisibilityRangeNode);\r\n      var firstFocusNode = sliderBtns[0];\r\n      var downArrowButtons = query('.dijitDownArrowButton', this.setVisibilityRangeNode);\r\n      var lastFocusNode = downArrowButtons[1];\r\n      var firstDownArrowButton = downArrowButtons[0];\r\n      var secondDownArrowButton = downArrowButtons[1];\r\n\r\n      this.own(on(firstFocusNode, \"keydown\", lang.hitch(this, function(e) {\r\n        if(e.keyCode === keys.TAB && e.shiftKey) {\r\n          e.stopPropagation();\r\n          e.preventDefault();\r\n        }\r\n      })));\r\n\r\n      this.own(on(lastFocusNode, \"keydown\", lang.hitch(this, function(e) {\r\n        if(e.keyCode === keys.TAB && !e.shiftKey) {\r\n          e.stopPropagation();\r\n          e.preventDefault();\r\n        } else if (e.keyCode === keys.ENTER) {\r\n          e.stopPropagation();\r\n          e.preventDefault();\r\n          setTimeout(lang.hitch(this, function() {\r\n            this._bindEsriScaleMenuPopupKey(secondDownArrowButton);\r\n          }), 200);\r\n        }\r\n      })));\r\n\r\n      this.own(on(firstDownArrowButton, \"keydown\", lang.hitch(this, function(e) {\r\n        if (e.keyCode === keys.ENTER) {\r\n          e.stopPropagation();\r\n          e.preventDefault();\r\n          setTimeout(lang.hitch(this, function() {\r\n            this._bindEsriScaleMenuPopupKey(firstDownArrowButton);\r\n          }), 200);\r\n        }\r\n      })));\r\n\r\n      this.own(on(firstDownArrowButton, \"click\", lang.hitch(this, function(e) {\r\n        e.stopPropagation();\r\n        e.preventDefault();\r\n        setTimeout(lang.hitch(this, function() {\r\n          this._bindEsriScaleMenuPopupKey(firstDownArrowButton);\r\n        }), 200);\r\n      })));\r\n\r\n      this.own(on(secondDownArrowButton, \"click\", lang.hitch(this, function(e) {\r\n        e.stopPropagation();\r\n        e.preventDefault();\r\n        setTimeout(lang.hitch(this, function() {\r\n          this._bindEsriScaleMenuPopupKey(secondDownArrowButton);\r\n        }), 200);\r\n      })));\r\n\r\n      this.own(on(this.setVisibilityRangeNode, \"keydown\", lang.hitch(this, function(e) {\r\n        if(e.keyCode === keys.ESCAPE) {\r\n          e.stopPropagation();\r\n          e.preventDefault();\r\n          this.hideSetVisibilityRangeNode();\r\n          var menuItem = this.getMenuItemNodeByItemKey(item.key);\r\n          if(menuItem) {\r\n            focusUtil.focus(menuItem);\r\n          }\r\n        } else if(e.keyCode === keys.TAB) {\r\n          e.stopPropagation();\r\n          //e.preventDefault();\r\n          this._enableNavMode(e);\r\n        } else if(e.keyCode === keys.ENTER) {\r\n          e.stopPropagation();\r\n        }\r\n      })));\r\n    },\r\n\r\n    _bindEsriScaleMenuPopupKey: function(focusNodeWhenLeave) {\r\n      var esriScaleMenuPopup = this._getEsriScaleMenuPopup();\r\n      var dijitInputInner;\r\n      var esriHeaders;\r\n      var esriCurrent;\r\n\r\n      if(esriScaleMenuPopup) {\r\n        //var dijitTextBox = query('.dijitTextBox', esriScaleMenuPopup)[0];\r\n        dijitInputInner = query('.dijitInputInner', esriScaleMenuPopup)[0];\r\n        html.setAttr(dijitInputInner, 'tabindex', '0');\r\n        esriHeaders = query('.esriHeader', esriScaleMenuPopup);\r\n        esriCurrent = query('.esriCurrent', esriScaleMenuPopup)[0];\r\n        if(esriHeaders[0] && esriCurrent) {\r\n          html.setAttr(dijitInputInner, 'aria-label', esriHeaders[0].innerText + ' ' + esriCurrent.innerText);\r\n        }\r\n        focusUtil.focus(dijitInputInner);\r\n      }\r\n\r\n      if(esriScaleMenuPopup && !esriScaleMenuPopup._hasBeenBoundKey) {\r\n        var esriScaleMenuList = query('.esriContent', esriScaleMenuPopup)[1];\r\n        html.setAttr(esriScaleMenuList, 'tabindex', '0');\r\n        if(esriHeaders[1]) {\r\n          html.setAttr(esriScaleMenuList, 'aria-label', esriHeaders[1].innerText + ' ');\r\n        }\r\n\r\n        //var firstMenuItem = null;\r\n        //var lastMenuItem = null;\r\n        var esriScaleMenuItems = query('li.esriItem', esriScaleMenuPopup);\r\n        /*\r\n        esriScaleMenuItems = array.filter(esriScaleMenuItems, lang.hitch(this, function(menuItem) {\r\n          if(html.hasClass(menuItem, 'esriHidden')) {\r\n            return false;\r\n          } else {\r\n            return true;\r\n          }\r\n        }));\r\n        */\r\n        array.forEach(esriScaleMenuItems, function(menuItem) {\r\n          /*\r\n          var isFirstMenuItem = false;\r\n          var isLastMenuItem = false;\r\n          var previousMenuItem = null;\r\n          var nextMenuItem = null;\r\n          if(index === 0) {\r\n            firstMenuItem = menuItem;\r\n            isFirstMenuItem = true;\r\n          }\r\n          if(index === esriScaleMenuItems.lenght - 1) {\r\n            lastMenuItem = menuItem;\r\n            isLastMenuItem = true;\r\n          }\r\n          previousMenuItem = esriScaleMenuItems[index - 1];\r\n          nextMenuItem = esriScaleMenuItems[index + 1];\r\n          */\r\n          html.setAttr(menuItem, 'tabindex', '0');\r\n\r\n          this.own(on(menuItem, \"keydown\", lang.hitch(this, function(e) {\r\n            var menuItemInfo = this._getMenuItemInfo(esriScaleMenuPopup, menuItem);\r\n            if(e.keyCode === keys.TAB) {\r\n              e.stopPropagation();\r\n              e.preventDefault();\r\n              if(esriScaleMenuList) {\r\n                focusUtil.focus(esriScaleMenuList);\r\n              }\r\n            } else if(e.keyCode === keys.DOWN_ARROW){\r\n              e.stopPropagation();\r\n              e.preventDefault();\r\n              if(menuItemInfo.nextMenuItem) {\r\n                focusUtil.focus(menuItemInfo.nextMenuItem);\r\n              }\r\n            } else if(e.keyCode === keys.UP_ARROW){\r\n              e.stopPropagation();\r\n              e.preventDefault();\r\n              if(menuItemInfo.previousMenuItem) {\r\n                focusUtil.focus(menuItemInfo.previousMenuItem);\r\n              }\r\n            } else if(e.keyCode === keys.ESCAPE){\r\n              e.stopPropagation();\r\n              e.preventDefault();\r\n              if(esriScaleMenuList) {\r\n                focusUtil.focus(esriScaleMenuList);\r\n              }\r\n            } else if(e.keyCode === keys.ENTER){\r\n              e.stopPropagation();\r\n              e.preventDefault();\r\n              var event = document.createEvent(\"MouseEvents\");\r\n              event.initEvent('click', true, true);\r\n              menuItem.dispatchEvent(event);\r\n              if(focusNodeWhenLeave) {\r\n                focusUtil.focus(focusNodeWhenLeave);\r\n              }\r\n            }\r\n          })));\r\n        }, this);\r\n\r\n        this.own(on(dijitInputInner, \"keydown\", lang.hitch(this, function(e) {\r\n          if(e.keyCode === keys.TAB) {\r\n            e.stopPropagation();\r\n            e.preventDefault();\r\n            this._enableNavMode(e);\r\n            focusUtil.focus(esriScaleMenuList);\r\n          } else if(e.keyCode === keys.ESCAPE){\r\n            if(focusNodeWhenLeave) {\r\n              focusUtil.focus(focusNodeWhenLeave);\r\n            }\r\n          } else if(e.keyCode === keys.ENTER){\r\n            if(focusNodeWhenLeave) {\r\n              focusUtil.focus(focusNodeWhenLeave);\r\n            }\r\n          }\r\n        })));\r\n\r\n        if(esriScaleMenuList) {\r\n          this.own(on(esriScaleMenuList, \"keydown\", lang.hitch(this, function(e) {\r\n            var menuItemInfo = this._getMenuItemInfo(esriScaleMenuPopup);\r\n            if(e.keyCode === keys.TAB) {\r\n              e.stopPropagation();\r\n              e.preventDefault();\r\n              this._enableNavMode(e);\r\n              focusUtil.focus(dijitInputInner);\r\n            } else if (e.keyCode === keys.ENTER) {\r\n              e.stopPropagation();\r\n              e.preventDefault();\r\n              if(menuItemInfo.firstMenuItem) {\r\n                focusUtil.focus(menuItemInfo.firstMenuItem);\r\n              }\r\n            } else if(e.keyCode === keys.ESCAPE){\r\n              if(focusNodeWhenLeave) {\r\n                focusUtil.focus(focusNodeWhenLeave);\r\n              }\r\n            }\r\n          })));\r\n        }\r\n        esriScaleMenuPopup._hasBeenBoundKey = true;\r\n      }\r\n\r\n    },\r\n\r\n    _getMenuItemInfo: function(esriScaleMenuPopup, currentMenuItem) {\r\n      var menuItemInfo = {\r\n        firstMenuItem: null,\r\n        lastMenuItem: null,\r\n        previousMenuItem: null,\r\n        nextMenuItem: null\r\n      };\r\n      var esriScaleMenuItems = query('li.esriItem', esriScaleMenuPopup);\r\n      esriScaleMenuItems = array.filter(esriScaleMenuItems, lang.hitch(this, function(menuItem) {\r\n        if(html.hasClass(menuItem, 'esriHidden')) {\r\n          return false;\r\n        } else {\r\n          return true;\r\n        }\r\n      }));\r\n      if(currentMenuItem) {\r\n        array.some(esriScaleMenuItems, function(menuItem, index) {\r\n          if(menuItem === currentMenuItem) {\r\n            menuItemInfo.previousMenuItem = esriScaleMenuItems[index - 1];\r\n            menuItemInfo.nextMenuItem = esriScaleMenuItems[index + 1];\r\n            return true;\r\n          } else {\r\n            return false;\r\n          }\r\n        }, this);\r\n      }\r\n      menuItemInfo.firstMenuItem = esriScaleMenuItems[0];\r\n      menuItemInfo.lastMenuItem = esriScaleMenuItems[esriScaleMenuItems.length - 1];\r\n      return menuItemInfo;\r\n    },\r\n\r\n    _getEsriScaleMenuPopup: function() {\r\n      var esriScaleMenuPopup = null;\r\n      query('.esriScaleMenuPopup', document.body).some(function(scaleMenu) {\r\n        if(html.getStyle(scaleMenu, 'display') === 'block') {\r\n          esriScaleMenuPopup = scaleMenu;\r\n          return true;\r\n        } else {\r\n          return false;\r\n        }\r\n      });\r\n      return esriScaleMenuPopup;\r\n    }\r\n  });\r\n});\r\n"]}