{"version":3,"sources":["../../../../widgets/LayerList/setting/LayerSelector.js"],"names":["define","_WidgetBase","declare","lang","array","domConstruct","on","query","jimuUtils","CheckBox","_TemplatedMixin","template","domClass","domStyle","templateString","baseClass","_currentSelectedLayerRowNode","_displayStateStorage","postMixInProperties","inherited","arguments","postCreate","forEach","operLayerInfos","getLayerInfoArrayOfWebmap","layerInfo","drawListNode","layerListTable","getTableInfoArray","tableListTable","level","toTableNode","nodeAndSubNode","newSubLayers","length","addLayerNode","add","currentNode","hitch","subLayerInfo","subNode","layerTrNode","create","id","layerTdNode","ckSelectDiv","ckSelect","imageTableDiv","popupMenuNode","i","imageShowLegendDiv","popupMenu","divLabel","checkedValue","config","layerOptions","undefined","display","checked","place","domNode","set","layerTitleTdNode","isTable","layerTitleDivIdClass","sanitizeHTML","title","trNode","tdNode","tableNode","initDisplayStateStorage","own","_onRowTrClick","_onLayerNodeMouseover","_onLayerNodeMouseout","_onCkSelectNodeClick","_fold","state","get","src","remove","evt","traversal","_grayedLayerLabel","stopPropagation","btnNode","_changeSelectedLayerRow","displayCK","labelDiv","currentLayerInfo","parentLayerInfo","getLayerOptions","child","hasOwnProperty"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEAA,OAAO,CACL,mBADK,EAEL,oBAFK,EAGL,iBAHK,EAIL,kBAJK,EAKL,oBALK,EAML,SANK,EAOL,YAPK,EAQL,YARK,EASL,qBATK,EAUL,uBAVK,EAWL,gCAXK,EAYL,gBAZK,EAaL,gBAbK,CAAP,EAcG,UAASC,WAAT,EAAsBC,OAAtB,EAA+BC,IAA/B,EAAqCC,KAArC,EAA4CC,YAA5C,EAA0DC,EAA1D,EAA8DC,KAA9D,EACDC,SADC,EACUC,QADV,EACoBC,eADpB,EACqCC,QADrC,EAEDC,QAFC,EAESC,QAFT,EAEmB;;AAEpB,SAAOX,QAAQ,CAACD,WAAD,EAAcS,eAAd,CAAR,EAAwC;AAC7CI,oBAAgBH,QAD6B;AAE7CI,eAAW,gBAFkC;AAG7CC,kCAA8B,IAHe;AAI7CC,0BAAsB,IAJuB;;AAM7CC,yBAAqB,+BAAW;AAC9B,WAAKC,SAAL,CAAeC,SAAf;AACA,WAAKH,oBAAL,GAA4B,EAA5B;AACD,KAT4C;;AAW7CI,gBAAY,sBAAW;AACrBjB,YAAMkB,OAAN,CAAc,KAAKC,cAAL,CAAoBC,yBAApB,EAAd,EAA+D,UAASC,SAAT,EAAoB;AACjF,aAAKC,YAAL,CAAkBD,SAAlB,EAA6B,CAA7B,EAAgC,KAAKE,cAArC;AACD,OAFD,EAEG,IAFH;;AAIAvB,YAAMkB,OAAN,CAAc,KAAKC,cAAL,CAAoBK,iBAApB,EAAd,EAAuD,UAASH,SAAT,EAAoB;AACzE,aAAKC,YAAL,CAAkBD,SAAlB,EAA6B,CAA7B,EAAgC,KAAKI,cAArC;AACD,OAFD,EAEG,IAFH;AAGD,KAnB4C;;AAqB7CH,kBAAc,sBAASD,SAAT,EAAoBK,KAApB,EAA2BC,WAA3B,EAAwC;AACpD,UAAIC,cAAJ;AACA,UAAIP,UAAUQ,YAAV,CAAuBC,MAAvB,KAAkC,CAAtC,EAAyC;AACvC;AACAF,yBAAiB,KAAKG,YAAL,CAAkBV,SAAlB,EAA6BK,KAA7B,EAAoCC,WAApC,CAAjB;;AAEA;AACAnB,iBAASwB,GAAT,CAAa7B,MAAM,iBAAN,EACXyB,eAAeK,WADJ,EACiB,CADjB,CAAb,EAEE,QAFF;AAGA;AACD;AACD;AACAL,uBAAiB,KAAKG,YAAL,CAAkBV,SAAlB,EAA6BK,KAA7B,EAAoCC,WAApC,CAAjB;AACA3B,YAAMkB,OAAN,CAAcG,UAAUQ,YAAxB,EAAsC9B,KAAKmC,KAAL,CAAW,IAAX,EAAiB,UAASR,KAAT,EAAgBS,YAAhB,EAA8B;AACnF,aAAKb,YAAL,CAAkBa,YAAlB,EAAgCT,QAAQ,CAAxC,EAA2CE,eAAeQ,OAA1D;AACD,OAFqC,EAEnCV,KAFmC,CAAtC;AAGD,KAtC4C;;AAwC7CK,kBAAc,sBAASV,SAAT,EAAoBK,KAApB,EAA2BC,WAA3B,EAAwC;AACpD,UAAIU,cAAcpC,aAAaqC,MAAb,CAAoB,IAApB,EAA0B;AACxC,iBAAS,iCACL,WAAY,QAAQ,0BAAR,GAAqC,EAD5C,CAD+B;AAGxC,yBAAiBjB,UAAUkB;AAHa,OAA1B,EAIbZ,WAJa,CAAlB;AAAA,UAKEa,WALF;AAAA,UAKeC,WALf;AAAA,UAK4BC,QAL5B;AAAA,UAKsCC,aALtC;AAAA,UAMEC,aANF;AAAA,UAMiBC,CANjB;AAAA,UAMoBC,kBANpB;AAAA,UAMwCC,SANxC;AAAA,UAMmDC,QANnD;;AAQAR,oBAAcvC,aAAaqC,MAAb,CAAoB,IAApB,EAA0B;AACtC,iBAAS;AAD6B,OAA1B,EAEXD,WAFW,CAAd;;AAIA,WAAKQ,IAAI,CAAT,EAAYA,IAAInB,KAAhB,EAAuBmB,GAAvB,EAA4B;AAC1B5C,qBAAaqC,MAAb,CAAoB,KAApB,EAA2B;AACzB,mBAAS,oCADgB;AAEzB,uBAAa;AAFY,SAA3B,EAGGE,WAHH;AAID;;AAGDM,2BAAqB7C,aAAaqC,MAAb,CAAoB,KAApB,EAA2B;AAC9C,iBAAS;AADqC,OAA3B,EAElBE,WAFkB,CAArB;;AAKAC,oBAAcxC,aAAaqC,MAAb,CAAoB,KAApB,EAA2B;AACvC,iBAAS;AAD8B,OAA3B,EAEXE,WAFW,CAAd;;AAIA;;;;;;;;;;;;;;AAeA;AACA;AACA;AACA,UAAIS,eAAe,IAAnB;AACA,UAAG,KAAKC,MAAL,CAAYC,YAAZ,IAA4B,KAAKD,MAAL,CAAYC,YAAZ,CAAyB9B,UAAUkB,EAAnC,MAA2Ca,SAA1E,EAAqF;AACnFH,uBAAe,KAAKC,MAAL,CAAYC,YAAZ,CAAyB9B,UAAUkB,EAAnC,EAAuCc,OAAtD;AACD;AACDX,iBAAW,IAAIrC,QAAJ,CAAa;AACtBiD,iBAASL,YADa;AAEtB,iBAAS,sBAAsB5B,UAAUkB;AAFnB,OAAb,CAAX;;AAKAtC,mBAAasD,KAAb,CAAmBb,SAASc,OAA5B,EAAqCf,WAArC;;AAGA;AACAhC,eAASgD,GAAT,CAAajB,WAAb,EAA0B,OAA1B,EAAmCd,QAAQ,EAAR,GAAa,EAAb,GAAkB,IAArD;;AAEA,UAAIgC,mBAAmBzD,aAAaqC,MAAb,CAAoB,IAApB,EAA0B;AAC/C,iBAAS;AADsC,OAA1B,EAEpBD,WAFoB,CAAvB;;AAIAM,sBAAgB1C,aAAaqC,MAAb,CAAoB,KAApB,EAA2B;AACzC,iBAAS;AADgC,OAA3B,EAEboB,gBAFa,CAEG,eAFH,CAAhB;AAGA,UAAIrC,UAAUsC,OAAd,EAAuB;AACrBnD,iBAASwB,GAAT,CAAaW,aAAb,EAA4B,OAA5B;AACD;AACD,UAAItB,UAAUsC,OAAd,EAAuB;AACrB;AACA;AACAlD,iBAASgD,GAAT,CAAad,aAAb,EAA4B,SAA5B,EAAuC,OAAvC;AACD;;AAED;;;;;;;;;;AAUA,UAAIiB,uBAAuB,qBAAqBvC,UAAUkB,EAA1D;AACAS,iBAAW/C,aAAaqC,MAAb,CAAoB,KAApB,EAA2B;AACpC,qBAAalC,UAAUyD,YAAV,CAAuBxC,UAAUyC,KAAjC,CADuB;AAEpC,iBAAQF,uBAAuB;AAFK,OAA3B,EAGRF,gBAHQ,CAAX;;AAKA;;AAEAlB,oBAAcvC,aAAaqC,MAAb,CAAoB,IAApB,EAA0B;AACtC,iBAAS;AAD6B,OAA1B,EAEXD,WAFW,CAAd;;AAIA;AACAO,sBAAgB3C,aAAaqC,MAAb,CAAoB,KAApB,EAA2B;AACzC,iBAAS;AADgC,OAA3B,EAEbE,WAFa,CAAhB;;AAIA;AACA,UAAIuB,SAAS9D,aAAaqC,MAAb,CAAoB,IAApB,EAA0B;AACrC,iBAAS,EAD4B;AAErC,gCAAwBjB,UAAUkB;AAFG,OAA1B,EAGVZ,WAHU,CAAb;;AAKA,UAAIqC,SAAS/D,aAAaqC,MAAb,CAAoB,IAApB,EAA0B;AACrC,iBAAS,EAD4B;AAErC,mBAAW;AAF0B,OAA1B,EAGVyB,MAHU,CAAb;;AAKA,UAAIE,YAAYhE,aAAaqC,MAAb,CAAoB,OAApB,EAA6B;AAC3C,iBAAS;AADkC,OAA7B,EAEb0B,MAFa,CAAhB;;AAIA,WAAKE,uBAAL,CAA6B7C,SAA7B,EAAwCqB,QAAxC,EAAkDM,QAAlD;;AAEA;AACA;;;;;;;;;;;AAWA,WAAKmB,GAAL,CAASjE,GAAG4C,kBAAH,EACP,OADO,EAEP/C,KAAKmC,KAAL,CAAW,IAAX,EACE,KAAKkC,aADP,EAEE/C,SAFF,EAGEyB,kBAHF,EAIET,WAJF,EAKE4B,SALF,CAFO,CAAT;;AASA,WAAKE,GAAL,CAASjE,GAAGmC,WAAH,EACP,WADO,EAEPtC,KAAKmC,KAAL,CAAW,IAAX,EAAiB,KAAKmC,qBAAtB,EAA6ChC,WAA7C,EAA0DU,SAA1D,CAFO,CAAT;AAGA,WAAKoB,GAAL,CAASjE,GAAGmC,WAAH,EACP,UADO,EAEPtC,KAAKmC,KAAL,CAAW,IAAX,EAAiB,KAAKoC,oBAAtB,EAA4CjC,WAA5C,EAAyDU,SAAzD,CAFO,CAAT;AAGA,WAAKoB,GAAL,CAASjE,GAAGwC,SAASc,OAAZ,EAAqB,OAArB,EAA8BzD,KAAKmC,KAAL,CAAW,IAAX,EACrC,KAAKqC,oBADgC,EAErClD,SAFqC,EAGrCqB,QAHqC,CAA9B,CAAT;;AAKA;;;;;;;;AAQA,aAAO;AACLT,qBAAaI,WADR;AAELD,iBAAS6B;AAFJ,OAAP;AAID,KA/M4C;;AAkN7C;AACA;AACA;AACAO,WAAO,eAASnD,SAAT,EAAoByB,kBAApB,EAAwCV,OAAxC,EAAiD;AACtD;AACA,UAAIqC,KAAJ;AACA,UAAIhE,SAASiE,GAAT,CAAatC,OAAb,EAAsB,SAAtB,MAAqC,MAAzC,EAAiD;AAC/C;AACA3B,iBAASgD,GAAT,CAAarB,OAAb,EAAsB,SAAtB,EAAiC,OAAjC;AACA5B,iBAASwB,GAAT,CAAac,kBAAb,EAAiC,QAAjC;AACA2B,gBAAQ,KAAR,CAJ+C,CAIhC;AAChB,OALD,MAKO;AACL;AACAhE,iBAASgD,GAAT,CAAarB,OAAb,EAAsB,SAAtB,EAAiC,MAAjC;AACA,YAAIuC,GAAJ;AACAnE,iBAASoE,MAAT,CAAgB9B,kBAAhB,EAAoC,QAApC;AACA2B,gBAAQ,IAAR,CALK,CAKS;AACf;AACD,aAAOA,KAAP;AACD,KArO4C;;AAuO7CF,0BAAsB,8BAASlD,SAAT,EAAoBqB,QAApB,EAA8BmC,GAA9B,EAAmC;AACvD;AACAxD,gBAAUyD,SAAV,CAAoB/E,KAAKmC,KAAL,CAAW,IAAX,EAAiB,UAASC,YAAT,EAAuB;AAC1D,aAAK4C,iBAAL,CAAuB5C,YAAvB;AACD,OAFmB,CAApB;AAGA0C,UAAIG,eAAJ;AACD,KA7O4C;;AA+O7CX,2BAAuB,+BAAShC,WAAT,EAAsBU,SAAtB,EAAiC;AACtDvC,eAASwB,GAAT,CAAaK,WAAb,EAA0B,qBAA1B;AACA,UAAIU,SAAJ,EAAe;AACb;AACAvC,iBAASwB,GAAT,CAAae,UAAUkC,OAAvB,EAAgC,wBAAhC;AACD;AACF,KArP4C;;AAuP7CX,0BAAsB,8BAASjC,WAAT,EAAsBU,SAAtB,EAAiC;AACrDvC,eAASoE,MAAT,CAAgBvC,WAAhB,EAA6B,qBAA7B;AACA,UAAIU,SAAJ,EAAe;AACb;AACAvC,iBAASoE,MAAT,CAAgB7B,UAAUkC,OAA1B,EAAmC,wBAAnC;AACD;AACF,KA7P4C;;AA+P7Cb,mBAAe,uBAAS/C,SAAT,EAAoByB,kBAApB,EAAwCT,WAAxC,EAAqDD,OAArD,EAA8D;AAC3E,WAAK8C,uBAAL,CAA6B7C,WAA7B;AACA,WAAKmC,KAAL,CAAWnD,SAAX,EAAsByB,kBAAtB,EAA0CV,OAA1C;AACD,KAlQ4C;;AAoQ7C8C,6BAAyB,iCAAS7C,WAAT,EAAsB;AAC7C,UAAI,KAAKzB,4BAAL,IAAqC,KAAKA,4BAAL,KAAsCyB,WAA/E,EAA4F;AAC1F;AACD;AACD,UAAI,KAAKzB,4BAAT,EAAuC;AACrCJ,iBAASoE,MAAT,CAAgB,KAAKhE,4BAArB,EAAmD,0BAAnD;AACD;AACDJ,eAASwB,GAAT,CAAaK,WAAb,EAA0B,0BAA1B;AACA,WAAKzB,4BAAL,GAAoCyB,WAApC;AACD,KA7Q4C;;AA+Q7C6B,6BAAyB,iCAAS7C,SAAT,EAAoB8D,SAApB,EAA+BC,QAA/B,EAAyC;AAChE,WAAKvE,oBAAL,CAA0BQ,UAAUkB,EAApC,IAA0C;AACxC4C,mBAAWA,SAD6B;AAExCC,kBAAUA;AAF8B,OAA1C;AAIA,WAAKL,iBAAL,CAAuB1D,SAAvB;AACD,KArR4C;;AAuR7C0D,uBAAmB,2BAAS1D,SAAT,EAAoB;AACrC,UAAIgC,UAAU,IAAd;AACA,UAAIgC,mBAAmBhE,SAAvB;AACA,UAAI+D,WAAW,KAAKvE,oBAAL,CAA0BQ,UAAUkB,EAApC,EAAwC6C,QAAvD;AACA,UAAGA,QAAH,EAAa;AACX,eAAMC,gBAAN,EAAwB;AACtBhC,oBAAUA,WAAW,KAAKxC,oBAAL,CAA0BwE,iBAAiB9C,EAA3C,EAA+C4C,SAA/C,CAAyD7B,OAA9E;AACA,cAAG,CAACD,OAAJ,EAAa;AACX;AACD;AACDgC,6BAAmBA,iBAAiBC,eAApC;AACD;AACD,YAAG,CAACjC,OAAJ,EAAa;AACX7C,mBAASwB,GAAT,CAAaoD,QAAb,EAAuB,cAAvB;AACD,SAFD,MAEO;AACL5E,mBAASoE,MAAT,CAAgBQ,QAAhB,EAA0B,cAA1B;AACD;AACF;AACF,KAzS4C;;AA2S7CG,qBAAiB,2BAAW;AAC1B,UAAIpC,eAAe,EAAnB;AACA,WAAI,IAAIqC,KAAR,IAAiB,KAAK3E,oBAAtB,EAA4C;AAC1C,YAAG,KAAKA,oBAAL,CAA0B4E,cAA1B,CAAyCD,KAAzC,KACE,OAAO,KAAK3E,oBAAL,CAA0B2E,KAA1B,CAAP,KAA4C,UADjD,EAC8D;AAC5DrC,uBAAaqC,KAAb,IAAsB,EAACnC,SAAS,KAAKxC,oBAAL,CAA0B2E,KAA1B,EAAiCL,SAAjC,CAA2C7B,OAArD,EAAtB;AACD;AACF;AACD,aAAOH,YAAP;AACD;;AApT4C,GAAxC,CAAP;AAuTD,CAzUD","file":"LayerSelector.js","sourcesContent":["///////////////////////////////////////////////////////////////////////////\r\n// Copyright Â© Esri. All Rights Reserved.\r\n//\r\n// Licensed under the Apache License Version 2.0 (the \"License\");\r\n// you may not use this file except in compliance with the License.\r\n// You may obtain a copy of the License at\r\n//\r\n//    http://www.apache.org/licenses/LICENSE-2.0\r\n//\r\n// Unless required by applicable law or agreed to in writing, software\r\n// distributed under the License is distributed on an \"AS IS\" BASIS,\r\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n// See the License for the specific language governing permissions and\r\n// limitations under the License.\r\n///////////////////////////////////////////////////////////////////////////\r\n\r\ndefine([\r\n  'dijit/_WidgetBase',\r\n  'dojo/_base/declare',\r\n  'dojo/_base/lang',\r\n  'dojo/_base/array',\r\n  'dojo/dom-construct',\r\n  'dojo/on',\r\n  'dojo/query',\r\n  'jimu/utils',\r\n  'jimu/dijit/CheckBox',\r\n  'dijit/_TemplatedMixin',\r\n  'dojo/text!./LayerSelector.html',\r\n  'dojo/dom-class',\r\n  'dojo/dom-style'\r\n], function(_WidgetBase, declare, lang, array, domConstruct, on, query,\r\n  jimuUtils, CheckBox, _TemplatedMixin, template,\r\n  domClass, domStyle) {\r\n\r\n  return declare([_WidgetBase, _TemplatedMixin], {\r\n    templateString: template,\r\n    baseClass: 'layer-selector',\r\n    _currentSelectedLayerRowNode: null,\r\n    _displayStateStorage: null,\r\n\r\n    postMixInProperties: function() {\r\n      this.inherited(arguments);\r\n      this._displayStateStorage = {};\r\n    },\r\n\r\n    postCreate: function() {\r\n      array.forEach(this.operLayerInfos.getLayerInfoArrayOfWebmap(), function(layerInfo) {\r\n        this.drawListNode(layerInfo, 0, this.layerListTable);\r\n      }, this);\r\n\r\n      array.forEach(this.operLayerInfos.getTableInfoArray(), function(layerInfo) {\r\n        this.drawListNode(layerInfo, 0, this.tableListTable);\r\n      }, this);\r\n    },\r\n\r\n    drawListNode: function(layerInfo, level, toTableNode) {\r\n      var nodeAndSubNode;\r\n      if (layerInfo.newSubLayers.length === 0) {\r\n        //addLayerNode\r\n        nodeAndSubNode = this.addLayerNode(layerInfo, level, toTableNode);\r\n\r\n        // don't add legend node, hide show legend image.\r\n        domClass.add(query(\".showLegend-div\",\r\n          nodeAndSubNode.currentNode)[0],\r\n          'hidden');\r\n        return;\r\n      }\r\n      //addLayerNode\r\n      nodeAndSubNode = this.addLayerNode(layerInfo, level, toTableNode);\r\n      array.forEach(layerInfo.newSubLayers, lang.hitch(this, function(level, subLayerInfo) {\r\n        this.drawListNode(subLayerInfo, level + 1, nodeAndSubNode.subNode);\r\n      }, level));\r\n    },\r\n\r\n    addLayerNode: function(layerInfo, level, toTableNode) {\r\n      var layerTrNode = domConstruct.create('tr', {\r\n          'class': 'jimu-widget-row layer-row ' +\r\n            ( /*visible*/ false ? 'jimu-widget-row-selected' : ''),\r\n          'layerTrNodeId': layerInfo.id\r\n        }, toTableNode),\r\n        layerTdNode, ckSelectDiv, ckSelect, imageTableDiv,\r\n        popupMenuNode, i, imageShowLegendDiv, popupMenu, divLabel;\r\n\r\n      layerTdNode = domConstruct.create('td', {\r\n        'class': 'col col1'\r\n      }, layerTrNode);\r\n\r\n      for (i = 0; i < level; i++) {\r\n        domConstruct.create('div', {\r\n          'class': 'begin-blank-div jimu-float-leading',\r\n          'innerHTML': ''\r\n        }, layerTdNode);\r\n      }\r\n\r\n\r\n      imageShowLegendDiv = domConstruct.create('div', {\r\n        'class': 'showLegend-div jimu-float-leading'\r\n      }, layerTdNode);\r\n\r\n\r\n      ckSelectDiv = domConstruct.create('div', {\r\n        'class': 'div-select jimu-float-leading'\r\n      }, layerTdNode);\r\n\r\n      /*\r\n      imageTableDiv = domConstruct.create('div', {\r\n        'class': 'noLegend-div jimu-float-leading'\r\n      }, layerTdNode);\r\n      if (layerInfo.isTable) {\r\n        domClass.add(imageTableDiv, 'table');\r\n      }\r\n      if (layerInfo.isTable) {\r\n        //domStyle.set(imageShowLegendDiv, 'display', 'none');\r\n        //domStyle.set(ckSelectDiv, 'display', 'none');\r\n        domStyle.set(imageTableDiv, 'display', 'block');\r\n      }\r\n      */\r\n\r\n\r\n      // if config has not been configured, default value is 'true'.\r\n      // if config has been configured, but new layer of webmap is ont in config file,\r\n      //   default value is 'true'.\r\n      var checkedValue = true;\r\n      if(this.config.layerOptions && this.config.layerOptions[layerInfo.id] !== undefined) {\r\n        checkedValue = this.config.layerOptions[layerInfo.id].display;\r\n      }\r\n      ckSelect = new CheckBox({\r\n        checked: checkedValue,\r\n        'class': \"visible-checkbox-\" + layerInfo.id\r\n      });\r\n\r\n      domConstruct.place(ckSelect.domNode, ckSelectDiv);\r\n\r\n\r\n      // set tdNode width\r\n      domStyle.set(layerTdNode, 'width', level * 12 + 35 + 'px');\r\n\r\n      var layerTitleTdNode = domConstruct.create('td', {\r\n        'class': 'col col2'\r\n      }, layerTrNode);\r\n\r\n      imageTableDiv = domConstruct.create('div', {\r\n        'class': 'noLegend-div jimu-float-leading'\r\n      }, layerTitleTdNode/*layerTdNode*/);\r\n      if (layerInfo.isTable) {\r\n        domClass.add(imageTableDiv, 'table');\r\n      }\r\n      if (layerInfo.isTable) {\r\n        //domStyle.set(imageShowLegendDiv, 'display', 'none');\r\n        //domStyle.set(ckSelectDiv, 'display', 'none');\r\n        domStyle.set(imageTableDiv, 'display', 'block');\r\n      }\r\n\r\n      /*\r\n      var grayedTitleClass = '';\r\n      try {\r\n        if (!layerInfo.isInScale()) {\r\n          grayedTitleClass = 'grayed-title';\r\n        }\r\n      } catch (err) {\r\n        console.warn(err.message);\r\n      }\r\n      */\r\n      var layerTitleDivIdClass = 'layer-title-div-' + layerInfo.id;\r\n      divLabel = domConstruct.create('div', {\r\n        'innerHTML': jimuUtils.sanitizeHTML(layerInfo.title),\r\n        'class':layerTitleDivIdClass + ' div-content jimu-float-leading '\r\n      }, layerTitleTdNode);\r\n\r\n      //domStyle.set(divLabel, 'width', 263 - level*13 + 'px');\r\n\r\n      layerTdNode = domConstruct.create('td', {\r\n        'class': 'col col3'\r\n      }, layerTrNode);\r\n\r\n      // add popupMenu\r\n      popupMenuNode = domConstruct.create('div', {\r\n        'class': 'layers-list-popupMenu-div'\r\n      }, layerTdNode);\r\n\r\n      //add a tr node to toTableNode.\r\n      var trNode = domConstruct.create('tr', {\r\n        'class': '',\r\n        'layerContentTrNodeId': layerInfo.id\r\n      }, toTableNode);\r\n\r\n      var tdNode = domConstruct.create('td', {\r\n        'class': '',\r\n        'colspan': '3'\r\n      }, trNode);\r\n\r\n      var tableNode = domConstruct.create('table', {\r\n        'class': 'layer-sub-node'\r\n      }, tdNode);\r\n\r\n      this.initDisplayStateStorage(layerInfo, ckSelect, divLabel);\r\n\r\n      //bind event\r\n      /*\r\n      this.own(on(layerTitleTdNode,\r\n        'click',\r\n        lang.hitch(this,\r\n          this._onRowTrClick,\r\n          layerInfo,\r\n          imageShowLegendDiv,\r\n          layerTrNode,\r\n          tableNode)));\r\n      */\r\n\r\n      this.own(on(imageShowLegendDiv,\r\n        'click',\r\n        lang.hitch(this,\r\n          this._onRowTrClick,\r\n          layerInfo,\r\n          imageShowLegendDiv,\r\n          layerTrNode,\r\n          tableNode)));\r\n\r\n      this.own(on(layerTrNode,\r\n        'mouseover',\r\n        lang.hitch(this, this._onLayerNodeMouseover, layerTrNode, popupMenu)));\r\n      this.own(on(layerTrNode,\r\n        'mouseout',\r\n        lang.hitch(this, this._onLayerNodeMouseout, layerTrNode, popupMenu)));\r\n      this.own(on(ckSelect.domNode, 'click', lang.hitch(this,\r\n        this._onCkSelectNodeClick,\r\n        layerInfo,\r\n        ckSelect)));\r\n\r\n      /*\r\n      this.own(on(popupMenuNode, 'click', lang.hitch(this,\r\n        this._onPopupMenuClick,\r\n        layerInfo,\r\n        popupMenu,\r\n        layerTrNode)));\r\n      */\r\n\r\n      return {\r\n        currentNode: layerTrNode,\r\n        subNode: tableNode\r\n      };\r\n    },\r\n\r\n\r\n    // return current state:\r\n    //   true:  fold,\r\n    //   false: unfold\r\n    _fold: function(layerInfo, imageShowLegendDiv, subNode) {\r\n      /*jshint unused: false*/\r\n      var state;\r\n      if (domStyle.get(subNode, 'display') === 'none') {\r\n        //unfold\r\n        domStyle.set(subNode, 'display', 'table');\r\n        domClass.add(imageShowLegendDiv, 'unfold');\r\n        state = false; //unfold\r\n      } else {\r\n        //fold\r\n        domStyle.set(subNode, 'display', 'none');\r\n        var src;\r\n        domClass.remove(imageShowLegendDiv, 'unfold');\r\n        state = true; // fold\r\n      }\r\n      return state;\r\n    },\r\n\r\n    _onCkSelectNodeClick: function(layerInfo, ckSelect, evt) {\r\n      /*jshint unused: false*/\r\n      layerInfo.traversal(lang.hitch(this, function(subLayerInfo) {\r\n        this._grayedLayerLabel(subLayerInfo);\r\n      }));\r\n      evt.stopPropagation();\r\n    },\r\n\r\n    _onLayerNodeMouseover: function(layerTrNode, popupMenu) {\r\n      domClass.add(layerTrNode, \"layer-row-mouseover\");\r\n      if (popupMenu) {\r\n        //domClass.add(popupMenuNode, \"layers-list-popupMenu-div-selected\");\r\n        domClass.add(popupMenu.btnNode, \"jimu-icon-btn-selected\");\r\n      }\r\n    },\r\n\r\n    _onLayerNodeMouseout: function(layerTrNode, popupMenu) {\r\n      domClass.remove(layerTrNode, \"layer-row-mouseover\");\r\n      if (popupMenu) {\r\n        //domClass.remove(popupMenuNode, \"layers-list-popupMenu-div-selected\");\r\n        domClass.remove(popupMenu.btnNode, \"jimu-icon-btn-selected\");\r\n      }\r\n    },\r\n\r\n    _onRowTrClick: function(layerInfo, imageShowLegendDiv, layerTrNode, subNode) {\r\n      this._changeSelectedLayerRow(layerTrNode);\r\n      this._fold(layerInfo, imageShowLegendDiv, subNode);\r\n    },\r\n\r\n    _changeSelectedLayerRow: function(layerTrNode) {\r\n      if (this._currentSelectedLayerRowNode && this._currentSelectedLayerRowNode === layerTrNode) {\r\n        return;\r\n      }\r\n      if (this._currentSelectedLayerRowNode) {\r\n        domClass.remove(this._currentSelectedLayerRowNode, 'jimu-widget-row-selected');\r\n      }\r\n      domClass.add(layerTrNode, 'jimu-widget-row-selected');\r\n      this._currentSelectedLayerRowNode = layerTrNode;\r\n    },\r\n\r\n    initDisplayStateStorage: function(layerInfo, displayCK, labelDiv) {\r\n      this._displayStateStorage[layerInfo.id] = {\r\n        displayCK: displayCK,\r\n        labelDiv: labelDiv\r\n      };\r\n      this._grayedLayerLabel(layerInfo);\r\n    },\r\n\r\n    _grayedLayerLabel: function(layerInfo) {\r\n      var display = true;\r\n      var currentLayerInfo = layerInfo;\r\n      var labelDiv = this._displayStateStorage[layerInfo.id].labelDiv;\r\n      if(labelDiv) {\r\n        while(currentLayerInfo) {\r\n          display = display && this._displayStateStorage[currentLayerInfo.id].displayCK.checked;\r\n          if(!display) {\r\n            break;\r\n          }\r\n          currentLayerInfo = currentLayerInfo.parentLayerInfo;\r\n        }\r\n        if(!display) {\r\n          domClass.add(labelDiv, 'grayed-title');\r\n        } else {\r\n          domClass.remove(labelDiv, 'grayed-title');\r\n        }\r\n      }\r\n    },\r\n\r\n    getLayerOptions: function() {\r\n      var layerOptions = {};\r\n      for(var child in this._displayStateStorage) {\r\n        if(this._displayStateStorage.hasOwnProperty(child) &&\r\n            (typeof this._displayStateStorage[child] !== 'function')) {\r\n          layerOptions[child] = {display: this._displayStateStorage[child].displayCK.checked};\r\n        }\r\n      }\r\n      return layerOptions;\r\n    }\r\n\r\n  });\r\n});\r\n"]}