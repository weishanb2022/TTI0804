{"version":3,"sources":["../../../widgets/LayerList/PopupMenuInfo.js"],"names":["define","declare","array","lang","Deferred","all","WidgetManager","portalUrlUtils","esriLang","NlsStrings","clazz","_candidateMenuItems","_displayItems","_layerInfo","_layerType","_appConfig","constructor","layerInfo","displayItemInfos","layerType","layerListWidget","nls","value","_initCandidateMenuItems","_initDisplayItems","_getATagLabel","url","label","layerUrl","getUrl","basicItemInfo","isItemLayer","_getItemDetailsPageUrl","itemShowItemDetails","itemDownload","indexOf","itemDesc","_ATagLabelUrl","itemUrl","getItemDetailsPageUrl","portalUrl","itemId","key","empty","itemZoomTo","itemTransparency","itemSetVisibilityRange","itemMoveUp","itemMoveDown","itemToAttributeTable","removePopup","showLabels","forEach","itemInfo","item","push","clone","onClick","_displayItem","_getSupportTableInfoForAllSublayers","defs","traversal","subLayerInfo","def","getSupportTableInfo","then","supportedInfo","resolve","_isSupportedByAT","attributeTableWidget","allSupportedInfo","isSupported","some","supportTableInfo","isSupportedLayer","isSupportQuery","otherReasonCanNotSupport","getDeniedItems","defRet","dynamicDeniedItems","layerListView","isFirstDisplayedLayerInfo","isLastDisplayedLayerInfo","canShowLabel","originOperLayer","featureCollection","isRootLayer","getRootLayerInfo","layerObject","declaredClass","supportsDynamicLayers","isPopupSupportedDef","isSupportPopupNested","getSupportTableInfoDef","isPopupSupported","hitch","result","appConfig","getConfigElementsByName","visible","isMapNotesLayerInfo","parentLayerInfo","getDisplayItems","onPopupMenuClick","evt","closeMenu","itemKey","_onItemZoomToClick","_onMoveUpItemClick","_onMoveDownItemClick","_onTableItemClick","_onTransparencyChanged","_onControlPopup","_onControlLabels","zoomTo","_isValidExtent","extent","isValid","isDefined","xmin","isFinite","ymin","xmax","ymax","isFirst","moveUpLayer","isLast","moveDownLayer","allSupportTableInfo","widgetManager","attributeTableWidgetEle","getInstance","triggerWidgetOpen","id","atWidget","activateWidget","publishData","_denyLayerInfosOpacityResponseOneTime","setOpacity","extraData","newTransValue","isPopupNestedEnabled","disablePopupNested","enablePopupNested","map","infoWindow","hide","isShowLabels","hideLabels","create","retDef","defaultItemInfos","itemInfoCategoreList","getLayerType","itemInfoCategory","isBasemap","isLeaf"],"mappings":"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","file":"PopupMenuInfo.js","sourcesContent":["///////////////////////////////////////////////////////////////////////////\r\n// Copyright © Esri. All Rights Reserved.\r\n//\r\n// Licensed under the Apache License Version 2.0 (the \"License\");\r\n// you may not use this file except in compliance with the License.\r\n// You may obtain a copy of the License at\r\n//\r\n//    http://www.apache.org/licenses/LICENSE-2.0\r\n//\r\n// Unless required by applicable law or agreed to in writing, software\r\n// distributed under the License is distributed on an \"AS IS\" BASIS,\r\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n// See the License for the specific language governing permissions and\r\n// limitations under the License.\r\n///////////////////////////////////////////////////////////////////////////\r\n\r\ndefine([\r\n  'dojo/_base/declare',\r\n  'dojo/_base/array',\r\n  'dojo/_base/lang',\r\n  'dojo/Deferred',\r\n  'dojo/promise/all',\r\n  'jimu/WidgetManager',\r\n  'jimu/portalUrlUtils',\r\n  'esri/lang',\r\n  './NlsStrings'\r\n], function(declare, array, lang, Deferred, all, WidgetManager, portalUrlUtils, esriLang,\r\n  NlsStrings) {\r\n  var clazz = declare([], {\r\n\r\n    _candidateMenuItems: null,\r\n    //_deniedItems: null,\r\n    _displayItems: null,\r\n    _layerInfo: null,\r\n    _layerType: null,\r\n    _appConfig: null,\r\n\r\n    constructor: function(layerInfo, displayItemInfos, layerType, layerListWidget) {\r\n      this.nls = NlsStrings.value;\r\n      this._layerInfo = layerInfo;\r\n      this._layerType = layerType;\r\n      this.layerListWidget = layerListWidget;\r\n      this._initCandidateMenuItems();\r\n      this._initDisplayItems(displayItemInfos);\r\n    },\r\n\r\n    _getATagLabel: function() {\r\n      var url;\r\n      var label;\r\n      var layerUrl = this._layerInfo.getUrl();\r\n      var basicItemInfo = this._layerInfo.isItemLayer();\r\n      if (basicItemInfo) {\r\n        url = this._getItemDetailsPageUrl(basicItemInfo) || layerUrl;\r\n        label = this.nls.itemShowItemDetails;\r\n      } else if (layerUrl &&\r\n        (this._layerType === \"CSVLayer\" || this._layerType === \"KMLLayer\")) {\r\n        url = layerUrl;\r\n        label = this.nls.itemDownload;\r\n      } else if (layerUrl && this._layerType === \"WMSLayer\") {\r\n        url = layerUrl + (layerUrl.indexOf(\"?\") > -1 ? \"&\" : \"?\") + \"SERVICE=WMS&REQUEST=GetCapabilities\";\r\n        label = this.nls.itemDesc;\r\n      } else if (layerUrl && this._layerType === \"WFSLayer\") {\r\n        url = layerUrl + (layerUrl.indexOf(\"?\") > -1 ? \"&\" : \"?\") + \"SERVICE=WFS&REQUEST=GetCapabilities\";\r\n        label = this.nls.itemDesc;\r\n      } else if (layerUrl) {\r\n        url = layerUrl;\r\n        label = this.nls.itemDesc;\r\n      } else {\r\n        url = '';\r\n        label = this.nls.itemDesc;\r\n      }\r\n      this._ATagLabelUrl = url;\r\n      return '<a class=\"menu-item-description\" target=\"_blank\" href=\"' +\r\n        url + '\">' + label + '</a>';\r\n    },\r\n\r\n    _getItemDetailsPageUrl: function(basicItemInfo) {\r\n      var itemUrl = \"\";\r\n      itemUrl = portalUrlUtils.getItemDetailsPageUrl(basicItemInfo.portalUrl, basicItemInfo.itemId);\r\n      return itemUrl;\r\n    },\r\n\r\n    _initCandidateMenuItems: function() {\r\n      //descriptionTitle: NlsStrings.value.itemDesc,\r\n      // var layerObjectUrl = (this._layerInfo.layerObject && this._layerInfo.layerObject.url) ?\r\n      //                       this._layerInfo.layerObject.url :\r\n      //                       '';\r\n      this._candidateMenuItems = [{\r\n        key: 'separator',\r\n        label: ''\r\n      }, {\r\n        key: 'empty',\r\n        label: this.nls.empty\r\n      }, {\r\n        key: 'zoomto',\r\n        label: this.nls.itemZoomTo\r\n      }, {\r\n        key: 'transparency',\r\n        label: this.nls.itemTransparency\r\n      },  {\r\n        key: 'setVisibilityRange',\r\n        label: this.nls.itemSetVisibilityRange\r\n      }, {\r\n        key: 'moveup',\r\n        label: this.nls.itemMoveUp\r\n      }, {\r\n        key: 'movedown',\r\n        label: this.nls.itemMoveDown\r\n      }, {\r\n        key: 'table',\r\n        label: this.nls.itemToAttributeTable\r\n      }, {\r\n        key: 'controlPopup',\r\n        label: this.nls.removePopup\r\n      }, {\r\n        key: 'controlLabels',\r\n        label: this.nls.showLabels\r\n      }, {\r\n        key: 'url',\r\n        label: this._getATagLabel()\r\n      }];\r\n    },\r\n\r\n    _initDisplayItems: function(displayItemInfos) {\r\n      this._displayItems = [];\r\n      // according to candidate itmes to init displayItems\r\n      array.forEach(displayItemInfos, function(itemInfo) {\r\n        array.forEach(this._candidateMenuItems, function(item) {\r\n          if (itemInfo.key === item.key) {\r\n            this._displayItems.push(lang.clone(item));\r\n            if (itemInfo.onClick) {\r\n              this._displayItem.onClick = itemInfo.onClick;\r\n            }\r\n          }\r\n        }, this);\r\n      }, this);\r\n    },\r\n\r\n    _getSupportTableInfoForAllSublayers: function(layerInfo) {\r\n      var defs = [];\r\n      layerInfo.traversal(function(subLayerInfo) {\r\n        var def = new Deferred();\r\n        subLayerInfo.getSupportTableInfo().then(function(supportedInfo) {\r\n          supportedInfo.layerInfo = subLayerInfo;\r\n          def.resolve(supportedInfo);\r\n        });\r\n        defs.push(def);\r\n      });\r\n      return all(defs);\r\n    },\r\n\r\n    _isSupportedByAT: function(attributeTableWidget, allSupportedInfo) {\r\n      /*jshint unused: false*/\r\n      var isSupported = array.some(allSupportedInfo, function(supportTableInfo) {\r\n        if (!supportTableInfo.isSupportedLayer ||\r\n            !supportTableInfo.isSupportQuery ||\r\n            supportTableInfo.otherReasonCanNotSupport) {\r\n          return false;\r\n        } else {\r\n          return true;\r\n        }\r\n      });\r\n      return isSupported;\r\n    },\r\n\r\n    /*\r\n    _isPopupSupported: function() {\r\n      var def = new Deferred();\r\n      var defs = [];\r\n      this._layerInfo.traversal(function(layerInfo) {\r\n        if(layerInfo.isLeaf()) {\r\n          defs.push(layerInfo.loadInfoTemplate());\r\n        }\r\n      });\r\n\r\n      all(defs).then(function(infoTemplates) {\r\n        array.some(infoTemplates, function(infoTemplates) {\r\n          if(infoTemplates) {\r\n            def.resolve(true);\r\n            return true;\r\n          } else {\r\n            def.resolve(false);\r\n            return false;\r\n          }\r\n        });\r\n      });\r\n      return def;\r\n    },\r\n    */\r\n\r\n    getDeniedItems: function() {\r\n      // summary:\r\n      //    the items that will be denied.\r\n      // description:\r\n      //    return Object = [{\r\n      //   key: String, popupMenuInfo key,\r\n      //   denyType: String, \"disable\" or \"hidden\"\r\n      // }]\r\n      var defRet = new Deferred();\r\n      var dynamicDeniedItems = [];\r\n\r\n      if (this.layerListWidget.layerListView.isFirstDisplayedLayerInfo(this._layerInfo)) {\r\n        dynamicDeniedItems.push({\r\n          'key': 'moveup',\r\n          'denyType': 'disable'\r\n        });\r\n      }\r\n      if (this.layerListWidget.layerListView.isLastDisplayedLayerInfo(this._layerInfo)) {\r\n        dynamicDeniedItems.push({\r\n          'key': 'movedown',\r\n          'denyType': 'disable'\r\n        });\r\n      }\r\n\r\n      if (!this._ATagLabelUrl) {\r\n        dynamicDeniedItems.push({\r\n          'key': 'url',\r\n          'denyType': 'disable'\r\n        });\r\n      }\r\n\r\n      // deny controlLabels\r\n      if (!this._layerInfo.canShowLabel()) {\r\n        dynamicDeniedItems.push({\r\n          'key': 'controlLabels',\r\n          'denyType': 'hidden'\r\n        });\r\n      }\r\n\r\n      // deny setVisibilityRange\r\n      if(this._layerInfo.originOperLayer.featureCollection) {\r\n        dynamicDeniedItems.push({\r\n          'key': 'setVisibilityRange',\r\n          'denyType': 'hidden'\r\n        });\r\n      } else if(!this._layerInfo.isRootLayer() &&\r\n          this._layerInfo.getRootLayerInfo().layerObject.declaredClass === \"esri.layers.ArcGISTiledMapServiceLayer\") {\r\n        dynamicDeniedItems.push({\r\n          'key': 'setVisibilityRange',\r\n          'denyType': 'hidden'\r\n        });\r\n      } else if(!this._layerInfo.isRootLayer() &&\r\n          this._layerInfo.getRootLayerInfo().layerObject.declaredClass === \"esri.layers.ArcGISDynamicMapServiceLayer\" &&\r\n          !this._layerInfo.getRootLayerInfo().layerObject.supportsDynamicLayers) {\r\n        dynamicDeniedItems.push({\r\n          'key': 'setVisibilityRange',\r\n          'denyType': 'disable'\r\n        });\r\n      }\r\n\r\n      //var loadInfoTemplateDef = this._layerInfo.loadInfoTemplate();\r\n      var isPopupSupportedDef = this._layerInfo.isSupportPopupNested();\r\n      var getSupportTableInfoDef = this._getSupportTableInfoForAllSublayers(this._layerInfo);\r\n\r\n      all({\r\n        //infoTemplate: loadInfoTemplateDef,\r\n        isPopupSupported: isPopupSupportedDef,\r\n        supportTableInfo: getSupportTableInfoDef\r\n      }).then(lang.hitch(this, function(result) {\r\n\r\n        // deny controlPopup\r\n        if (!result.isPopupSupported) {\r\n          dynamicDeniedItems.push({\r\n            'key': 'controlPopup',\r\n            'denyType': 'hidden'\r\n          });\r\n        }\r\n\r\n        // deny table.\r\n        var supportTableInfo = result.supportTableInfo;\r\n        var attributeTableWidget =\r\n              this.layerListWidget.appConfig.getConfigElementsByName(\"AttributeTable\")[0];\r\n\r\n        if (!attributeTableWidget || !attributeTableWidget.visible) {\r\n          dynamicDeniedItems.push({\r\n            'key': 'table',\r\n            'denyType': 'hidden'\r\n          });\r\n        } else if (!this._isSupportedByAT(attributeTableWidget, supportTableInfo)) {\r\n          dynamicDeniedItems.push({\r\n            'key': 'table',\r\n            'denyType': 'disable'\r\n          });\r\n          if(this._layerInfo.isMapNotesLayerInfo() || (this._layerInfo.parentLayerInfo &&\r\n             this._layerInfo.parentLayerInfo.isMapNotesLayerInfo())) {\r\n            dynamicDeniedItems.push({\r\n              'key': 'table',\r\n              'denyType': 'hidden'\r\n            });\r\n          } else {\r\n            dynamicDeniedItems.push({\r\n              'key': 'table',\r\n              'denyType': 'disable'\r\n            });\r\n          }\r\n        }\r\n        defRet.resolve(dynamicDeniedItems);\r\n      }), function() {\r\n        defRet.resolve(dynamicDeniedItems);\r\n      });\r\n\r\n      return defRet;\r\n\r\n    },\r\n\r\n    getDisplayItems: function() {\r\n      return this._displayItems;\r\n    },\r\n\r\n    onPopupMenuClick: function(evt) {\r\n      var result = {\r\n        closeMenu: true\r\n      };\r\n      switch (evt.itemKey) {\r\n        case 'zoomto' /*this.nls.itemZoomTo'Zoom to'*/ :\r\n          this._onItemZoomToClick(evt);\r\n          break;\r\n        case 'moveup' /*this.nls.itemMoveUp'Move up'*/ :\r\n          this._onMoveUpItemClick(evt);\r\n          break;\r\n        case 'movedown' /*this.nls.itemMoveDown'Move down'*/ :\r\n          this._onMoveDownItemClick(evt);\r\n          break;\r\n        case 'table' /*this.nls.itemToAttributeTable'Open attribute table'*/ :\r\n          this._onTableItemClick(evt);\r\n          break;\r\n        case 'transparencyChanged':\r\n          this._onTransparencyChanged(evt);\r\n          result.closeMenu = false;\r\n          break;\r\n        case 'controlPopup':\r\n          this._onControlPopup();\r\n          break;\r\n        case 'controlLabels':\r\n          this._onControlLabels();\r\n          break;\r\n\r\n      }\r\n      return result;\r\n    },\r\n\r\n    /**********************************\r\n     * Respond events respectively.\r\n     *\r\n     * event format:\r\n      // evt = {\r\n      //   itemKey: item key\r\n      //   extraData: estra data,\r\n      //   layerListWidget: layerListWidget,\r\n      //   layerListView: layerListView\r\n      // }, result;\r\n     **********************************/\r\n    _onItemZoomToClick: function(evt) {\r\n      /*jshint unused: false*/\r\n      this._layerInfo.zoomTo();\r\n    },\r\n\r\n    _isValidExtent: function(extent){\r\n      var isValid = false;\r\n      if(esriLang.isDefined(extent)){\r\n        if(esriLang.isDefined(extent.xmin) && isFinite(extent.xmin) &&\r\n           esriLang.isDefined(extent.ymin) && isFinite(extent.ymin) &&\r\n           esriLang.isDefined(extent.xmax) && isFinite(extent.xmax) &&\r\n           esriLang.isDefined(extent.ymax) && isFinite(extent.ymax)){\r\n          isValid = true;\r\n        }\r\n      }\r\n      return isValid;\r\n    },\r\n\r\n    _onMoveUpItemClick: function(evt) {\r\n      if (!this._layerInfo.isFirst) {\r\n        evt.layerListView.moveUpLayer(this._layerInfo);\r\n      }\r\n    },\r\n\r\n    _onMoveDownItemClick: function(evt) {\r\n      if (!this._layerInfo.isLast) {\r\n        evt.layerListView.moveDownLayer(this._layerInfo);\r\n      }\r\n    },\r\n\r\n    _onTableItemClick: function(evt) {\r\n      this._getSupportTableInfoForAllSublayers(this._layerInfo).then(lang.hitch(this, function(allSupportTableInfo) {\r\n        var widgetManager;\r\n        var attributeTableWidgetEle =\r\n                    this.layerListWidget.appConfig.getConfigElementsByName(\"AttributeTable\")[0];\r\n        if(this._isSupportedByAT(attributeTableWidgetEle, allSupportTableInfo)) {\r\n          widgetManager = WidgetManager.getInstance();\r\n\r\n          array.forEach(allSupportTableInfo, function(supportTableInfo) {\r\n            if(supportTableInfo.isSupportedLayer) {\r\n              widgetManager.triggerWidgetOpen(attributeTableWidgetEle.id)\r\n              .then(lang.hitch(this, function(atWidget) {\r\n                if (atWidget) {\r\n                  widgetManager.activateWidget(atWidget);\r\n                }\r\n                evt.layerListWidget.publishData({\r\n                  'target': 'AttributeTable',\r\n                  'layer': supportTableInfo.layerInfo\r\n                });\r\n              }));\r\n            }\r\n          }, this);\r\n\r\n        }\r\n      }));\r\n    },\r\n\r\n    _onTransparencyChanged: function(evt) {\r\n      this.layerListWidget._denyLayerInfosOpacityResponseOneTime = true;\r\n      this._layerInfo.setOpacity(1 - evt.extraData.newTransValue);\r\n    },\r\n\r\n    _onControlPopup: function(evt) {\r\n      /*jshint unused: false*/\r\n      //if (this._layerInfo.controlPopupInfo.enablePopup) {\r\n      if(this._layerInfo.isPopupNestedEnabled()) {\r\n        this._layerInfo.disablePopupNested();\r\n      } else {\r\n        this._layerInfo.enablePopupNested();\r\n      }\r\n      this._layerInfo.map.infoWindow.hide();\r\n    },\r\n\r\n    _onControlLabels: function(evt) {\r\n      /*jshint unused: false*/\r\n      if(this._layerInfo.canShowLabel()) {\r\n        if(this._layerInfo.isShowLabels()) {\r\n          this._layerInfo.hideLabels();\r\n        } else {\r\n          this._layerInfo.showLabels();\r\n        }\r\n      }\r\n    }\r\n  });\r\n\r\n  clazz.create = function(layerInfo, layerListWidget) {\r\n    var retDef = new Deferred();\r\n    var isRootLayer = layerInfo.isRootLayer();\r\n    var defaultItemInfos = [{\r\n        key: 'controlPopup'\r\n      }, {\r\n        key: 'separator'\r\n      }, {\r\n        key: 'url',\r\n        onClick: null\r\n      }];\r\n\r\n    var itemInfoCategoreList = {\r\n      'RootLayer': [{\r\n        key: 'zoomto'\r\n      }, {\r\n        key: 'transparency'\r\n      }, {\r\n        key: 'setVisibilityRange'\r\n      }, {\r\n        key: 'separator'\r\n      }, {\r\n        key: 'controlPopup'\r\n      }, {\r\n        key: 'separator'\r\n      }, {\r\n        key: 'moveup'\r\n      }, {\r\n        key: 'movedown'\r\n      }, {\r\n        key: 'separator'\r\n      }, {\r\n        key: 'table'\r\n      }, {\r\n        key: 'separator'\r\n      }, {\r\n        key: 'url'\r\n      }],\r\n      'RootLayerAndFeatureLayer': [{\r\n        key: 'zoomto'\r\n      }, {\r\n        key: 'transparency'\r\n      }, {\r\n        key: 'setVisibilityRange'\r\n      }, {\r\n        key: 'separator'\r\n      }, {\r\n        key: 'controlPopup'\r\n      }, {\r\n        key: 'separator'\r\n      }, {\r\n        key: 'controlLabels'\r\n      }, {\r\n        key: 'separator'\r\n      }, {\r\n        key: 'moveup'\r\n      }, {\r\n        key: 'movedown'\r\n      }, {\r\n        key: 'separator'\r\n      }, {\r\n        key: 'table'\r\n      }, {\r\n        key: 'separator'\r\n      }, {\r\n        key: 'url'\r\n      }],\r\n      'FeatureLayer': [{\r\n        key: 'setVisibilityRange'\r\n      }, {\r\n        key: 'separator'\r\n      },{\r\n        key: 'controlPopup'\r\n      }, {\r\n        key: 'separator'\r\n      }, {\r\n        key: 'table'\r\n      }, {\r\n        key: 'separator'\r\n      }, {\r\n        key: 'url'\r\n      }],\r\n      'SublayerOfDynamicMapserviceLayer': [{\r\n        key: 'setVisibilityRange'\r\n      }, {\r\n        key: 'separator'\r\n      }, {\r\n        key: 'url'\r\n      }],\r\n      'GroupLayer': [{\r\n        key: 'setVisibilityRange'\r\n      }, {\r\n        key: 'separator'\r\n      }, {\r\n        key: 'controlPopup'\r\n      }, {\r\n        key: 'separator'\r\n      }, {\r\n        key: 'table'\r\n      }, {\r\n        key: 'separator'\r\n      }, {\r\n        key: 'url'\r\n      }],\r\n      'Table': [{\r\n        key: 'table'\r\n      }, {\r\n        key: 'separator'\r\n      }, {\r\n        key: 'url'\r\n      }],\r\n      'BasemapLayer': [{\r\n        key: 'zoomto'\r\n      }, {\r\n        key: 'transparency'\r\n      }, {\r\n        key: 'separator'\r\n      }, {\r\n        key: 'url'\r\n      }],\r\n      'default': defaultItemInfos\r\n    };\r\n\r\n    layerInfo.getLayerType().then(lang.hitch(this, function(layerType) {\r\n      var itemInfoCategory = \"\";\r\n      if (layerInfo.isBasemap() && layerInfo.isRootLayer()) {\r\n        itemInfoCategory = \"BasemapLayer\";\r\n      } else if(layerInfo.isBasemap()) {\r\n        itemInfoCategory = \"default\";\r\n      } else if (isRootLayer &&\r\n          (layerType === \"FeatureLayer\" ||\r\n            layerType === \"CSVLayer\" ||\r\n            layerType === \"ArcGISImageServiceLayer\" ||\r\n            layerType === \"StreamLayer\" ||\r\n            layerType === \"ArcGISImageServiceVectorLayer\")) {\r\n        itemInfoCategory = \"RootLayerAndFeatureLayer\";\r\n      } else if (isRootLayer) {\r\n        itemInfoCategory = \"RootLayer\";\r\n      } else if (layerType === \"FeatureLayer\" || layerType === \"CSVLayer\") {\r\n        itemInfoCategory = \"FeatureLayer\";\r\n      } else if (layerInfo.isLeaf() &&\r\n                layerInfo.getRootLayerInfo() &&\r\n                layerInfo.getRootLayerInfo().layerObject &&\r\n                layerInfo.getRootLayerInfo().layerObject.declaredClass === \"esri.layers.ArcGISDynamicMapServiceLayer\") {\r\n        itemInfoCategory = \"SublayerOfDynamicMapserviceLayer\";\r\n      } else if (layerType === \"GroupLayer\") {\r\n        itemInfoCategory = \"GroupLayer\";\r\n      } else if (layerType === \"Table\") {\r\n        itemInfoCategory = \"Table\";\r\n      } else {\r\n        //default condition\r\n        itemInfoCategory = \"default\";\r\n      }\r\n      retDef.resolve(new clazz(layerInfo,\r\n        itemInfoCategoreList[itemInfoCategory],\r\n        layerType,\r\n        layerListWidget));\r\n    }), lang.hitch(this, function() {\r\n      //return default popupmenu info.\r\n      retDef.resolve(new clazz(layerInfo, [{\r\n        key: 'empty'\r\n      }]));\r\n    }));\r\n    return retDef;\r\n  };\r\n\r\n\r\n  return clazz;\r\n});\r\n"]}