{"version":3,"sources":["../../../widgets/LayerList/LayerListView.js"],"names":["define","_WidgetBase","declare","lang","array","html","domConstruct","on","keys","focusUtil","query","CheckBox","DropMenu","LoadingShelter","jimuUtils","PopupMenu","_TemplatedMixin","template","domClass","domStyle","NlsStrings","templateString","_currentSelectedLayerRowNode","operationsDropMenu","_layerNodeHandles","_layerDomNodeStorage","_firstLayerNode","_lastLayerNode","_eventHandlers","_layerIndexs","postMixInProperties","inherited","arguments","nls","value","_initLayerIndexs","postCreate","refresh","_initOperations","count","operLayerInfos","traversalAll","hitch","layerInfo","id","_removeLayerNodes","forEach","getLayerInfoArray","drawListNode","layerListTable","config","showBasemap","getBasemapLayerInfoArray","getTableInfoArray","tableListTable","eventHander","remove","_supports508Accessibility","level","toTableNode","position","nodeAndSubNode","showLegendDiv","isLayerHiddenInWidget","layerFilter","isValidLayerInfo","getObjectId","isRootLayer","isTable","place","layerTrNode","layerContentTrNode","newSubLayers","length","addLayerNode","showLegend","addLegendNode","subNode","add","subLayerInfo","layerIndex","layerTdNode","ckSelectDiv","ckSelect","imageNoLegendDiv","handle","imageGroupDiv","imageNoLegendNode","popupMenuNode","i","imageShowLegendDiv","divLabel","rootLayerInfo","getRootLayerInfo","layerNodeEventHandles","layerNodeReferredDijits","layerTrNodeClass","layerOrTableString","window","jimuNls","common","table","layer","create","title","_lastLayerInfo","expandLayer","checked","isVisible","domNode","setAttr","imageName","isBasemap","layerListWidget","folderUrl","isTiled","set","layerTitleTdNode","grayedTitleClass","isInScale","err","console","warn","message","layerTitleDivIdClass","sanitizeHTML","popupMenuDisplayStyle","hasContentMenu","tipLayerOperation","tdNode","tableNode","own","_onRowTrClick","_storeLayerNodeEventHandle","_onCkSelectNodeClick","_onPopupMenuClick","_onLayerNodeKey","_onImageShowLegendKey","_onCkSelectDivKey","_onPopupMenuNodeKey","isExpanded","_foldOrUnfoldLayer","item","contextMenu","hasOwnProperty","legendTrNode","legendTdNode","statisticsChart","legend","legendsNode","createLegendsNode","error","redrawLegends","_legendDijit","destroy","drawLegends","appConfig","portalUrl","rootLayerStorage","push","_storeLayerNodeDijit","dijit","_clearLayerDomNodeStorage","findElem","allLayerAndTableInfos","elem","some","toString","parentNode","removeChild","_foldSwitch","state","get","isFold","imageShowLegendDivParam","subNodeParam","collapseLayer","isLeaf","loadingImg","_foldOrUnfoldLayers","layerInfos","evt","ctrlKey","metaKey","turnAllRootLayers","turnAllSameLevelLayers","_denyLayerInfosIsVisibleChangedResponseOneTime","setTopLayerVisible","stopPropagation","popupMenu","_layerInfo","box","_config","placeAt","_onPopupMenuItemClick","_onPopupMenuOpen","_changeSelectedLayerRow","closeDropMenu","_hideCurrentPopupMenu","currentPopupMenu","openDropMenu","_onLayerListWidgetPaneClick","fold","_expanded","foldOrUnfoldAllRootLayers","foldOrUnfoldSameLevelLayers","data","itemKey","key","extraData","layerListView","result","transparencyDiv","showTransNode","getOpacity","hideTransNode","setVisibilityRangeNode","showSetVisibilityRangeNode","hideSetVisibilityRangeNode","popupMenuInfo","onPopupMenuClick","closeMenu","_exchangeLayerTrNode","layerInfo1","layerInfo2","layer1TrNode","layer2TrNode","layer2ContentTrNode","insertBefore","_getMovedSteps","upOrDown","steps","layerInfoIndex","layerInfoArray","currentLayerInfo","index","isFirst","isLast","moveUpLayer","moveDownLayer","isHidden","layerOptions","undefined","display","parentLayerInfo","isFirstDisplayedLayerInfo","_getTopLayerInfoIndexById","isLastDisplayedLayerInfo","items","label","turnAllLayersOn","turnAllLayersOff","expandAllLayers","collapseAlllayers","layerListOperations","operationIconBtnNode","btnNode","_onLayerListOperationsClick","_onOperationsMenuItemClick","operationsDropMenuLoading","hidden","_onLayerListOperationsKey","_onOperationsDropMenuOpen","foldOrUnfoldAllLayers","isOnOrOff","traversal","visible","resetLayerObjectVisibility","filter","getSubLayers","rootLayerInfoArray","show","concat","layerInfoArrayLength","setTimeout","candidateLayerInfoArray","slice","callee","hide","eventHandler","searchButton","supports508Node","initLastFocusNode","_onSearchButtonKey","e","keyCode","TAB","shiftKey","preventDefault","_backToLastNodeFlag","_getLastExpandedLayerNode","lastExpandedLayerNode","parentLayerTrNode","_onLastNodeFocus","focus","_onLastLayerNodeKey","ENTER","getStyle","ESCAPE","SPACE","uncheck","check","DOWN_ARROW","UP_ARROW","menuItems","dropMenuNode","menuItem","hasClass","firstItem","lastItem","isFirstItem","isLastItem","previousItem","nextItem","hasBeenOpened","_onPopupMenuItemKey","HOME","END","_enableNavMode","isInNavMode","addClass","document","body","_onBtnClick","_onLayerListOperationsMenuItemKey"],"mappings":"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","file":"LayerListView.js","sourcesContent":["///////////////////////////////////////////////////////////////////////////\r\n// Copyright © Esri. All Rights Reserved.\r\n//\r\n// Licensed under the Apache License Version 2.0 (the \"License\");\r\n// you may not use this file except in compliance with the License.\r\n// You may obtain a copy of the License at\r\n//\r\n//    http://www.apache.org/licenses/LICENSE-2.0\r\n//\r\n// Unless required by applicable law or agreed to in writing, software\r\n// distributed under the License is distributed on an \"AS IS\" BASIS,\r\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n// See the License for the specific language governing permissions and\r\n// limitations under the License.\r\n///////////////////////////////////////////////////////////////////////////\r\n\r\ndefine([\r\n  'dijit/_WidgetBase',\r\n  'dojo/_base/declare',\r\n  'dojo/_base/lang',\r\n  'dojo/_base/array',\r\n  'dojo/_base/html',\r\n  'dojo/dom-construct',\r\n  'dojo/on',\r\n  'dojo/keys',\r\n  'dijit/focus',\r\n  'dojo/query',\r\n  'jimu/dijit/CheckBox',\r\n  'jimu/dijit/DropMenu',\r\n  'jimu/dijit/LoadingShelter',\r\n  'jimu/utils',\r\n  './PopupMenu',\r\n  'dijit/_TemplatedMixin',\r\n  'dojo/text!./LayerListView.html',\r\n  'dojo/dom-class',\r\n  'dojo/dom-style',\r\n  './NlsStrings'\r\n], function(_WidgetBase, declare, lang, array, html, domConstruct, on, keys, focusUtil, query,\r\n  CheckBox, DropMenu, LoadingShelter, jimuUtils, PopupMenu, _TemplatedMixin, template,\r\n  domClass, domStyle, NlsStrings) {\r\n\r\n  return declare([_WidgetBase, _TemplatedMixin], {\r\n    templateString: template,\r\n    _currentSelectedLayerRowNode: null,\r\n    operationsDropMenu: null,\r\n    _layerNodeHandles: null,\r\n    // _layerDomNodeStorage = {\r\n    //   layerInfoObjectId: {// layerDomNode\r\n    //     layerTrNode: domNode,\r\n    //     layerContentTrNode: domeNode,\r\n    //     layerNodeEventHandles: [],\r\n    //     layerNodeReferredDijits: [],\r\n    //     layerInfo\r\n    //   }\r\n    // }\r\n    _layerDomNodeStorage: null,\r\n    _firstLayerNode: false,\r\n    _lastLayerNode: null,\r\n    _eventHandlers: null,\r\n    _layerIndexs: null,\r\n\r\n    postMixInProperties: function() {\r\n      this.inherited(arguments);\r\n      this.nls = NlsStrings.value;\r\n      this._layerDomNodeStorage = {};\r\n      this._eventHandlers = [];\r\n      this._initLayerIndexs();\r\n    },\r\n\r\n    postCreate: function() {\r\n      this.refresh();\r\n      this._initOperations();\r\n    },\r\n\r\n    _initLayerIndexs: function() {\r\n      var count = 2;\r\n      this._layerIndexs = {};\r\n      this.operLayerInfos.traversalAll(lang.hitch(this, function(layerInfo) {\r\n        this._layerIndexs[layerInfo.id] = count++;\r\n      }));\r\n    },\r\n\r\n    refresh: function() {\r\n      this._removeLayerNodes();\r\n      array.forEach(this.operLayerInfos.getLayerInfoArray(), function(layerInfo) {\r\n        this.drawListNode(layerInfo, 0, this.layerListTable);\r\n      }, this);\r\n\r\n      if(this.config.showBasemap) {\r\n        array.forEach(this.operLayerInfos.getBasemapLayerInfoArray(), function(layerInfo) {\r\n          this.drawListNode(layerInfo, 0, this.layerListTable);\r\n        }, this);\r\n      }\r\n\r\n      array.forEach(this.operLayerInfos.getTableInfoArray(), function(layerInfo) {\r\n        this.drawListNode(layerInfo, 0, this.tableListTable);\r\n      }, this);\r\n\r\n      array.forEach(this._eventHandlers, function(eventHander) {\r\n        if(eventHander.remove) {\r\n          eventHander.remove();\r\n        }\r\n      });\r\n\r\n      this._supports508Accessibility();\r\n    },\r\n\r\n    drawListNode: function(layerInfo, level, toTableNode, position) {\r\n      var nodeAndSubNode, showLegendDiv;\r\n      if(this.isLayerHiddenInWidget(layerInfo) || !this.layerFilter.isValidLayerInfo(layerInfo)) {\r\n        return;\r\n      }\r\n\r\n      nodeAndSubNode = this._layerDomNodeStorage[layerInfo.getObjectId()];\r\n      if((layerInfo.isRootLayer() || layerInfo.isTable)  && nodeAndSubNode) {\r\n        domConstruct.place(nodeAndSubNode.layerTrNode, toTableNode, position);\r\n        domConstruct.place(nodeAndSubNode.layerContentTrNode, toTableNode, position);\r\n      } else if (layerInfo.newSubLayers.length === 0) {\r\n        //addLayerNode\r\n        nodeAndSubNode = this.addLayerNode(layerInfo, level, toTableNode, position);\r\n        //add legend node\r\n        if (this.config.showLegend) {\r\n          this.addLegendNode(layerInfo, level, nodeAndSubNode.subNode);\r\n        } else {\r\n          showLegendDiv = query(\".showLegend-div\", nodeAndSubNode.layerTrNode)[0];\r\n          if(showLegendDiv) {\r\n            domClass.add(showLegendDiv, 'hidden-showLegend-div');\r\n          }\r\n        }\r\n      } else {\r\n        //addLayerNode\r\n        nodeAndSubNode = this.addLayerNode(layerInfo, level, toTableNode, position);\r\n        array.forEach(layerInfo.newSubLayers, lang.hitch(this, function(level, subLayerInfo) {\r\n          this.drawListNode(subLayerInfo, level + 1, nodeAndSubNode.subNode);\r\n        }, level));\r\n      }\r\n    },\r\n\r\n    addLayerNode: function(layerInfo, level, toTableNode, position) {\r\n      //jshint unused:false\r\n\r\n      var layerIndex = this._layerIndexs[layerInfo.id];\r\n      var layerTrNode, layerTdNode, ckSelectDiv, ckSelect, imageNoLegendDiv, handle,\r\n        imageGroupDiv, imageNoLegendNode, popupMenuNode, i, imageShowLegendDiv, divLabel;\r\n\r\n      var rootLayerInfo = layerInfo.getRootLayerInfo();\r\n      // if(!this._layerNodeHandles[rootLayerInfo.id]) {\r\n      //   this._layerNodeHandles[rootLayerInfo.id] = [];\r\n      // }\r\n\r\n      // init _layerDomNodeStorage for rootLayerInfo.\r\n      //if(layerInfo.isRootLayer() || layerInfo.isTable) {\r\n      this._layerDomNodeStorage[layerInfo.getObjectId()] = {\r\n        layerTrNode: null,\r\n        layerContentTrNode: null,\r\n        layerNodeEventHandles: [],\r\n        layerNodeReferredDijits: [],\r\n        layerInfo: layerInfo\r\n      };\r\n      //}\r\n\r\n      var layerTrNodeClass = \"layer-tr-node-\" + layerInfo.id;\r\n      var layerOrTableString = layerInfo.isTable ? window.jimuNls.common.table : window.jimuNls.common.layer;\r\n      layerTrNode = domConstruct.create('tr', {\r\n        'class': 'jimu-widget-row layer-row' +\r\n          ( /*visible*/ false ? 'jimu-widget-row-selected ' : ' ') + layerTrNodeClass + '',\r\n        //(!this._firstLayerNode ? ' firstFocusNode' : ' '),\r\n        'tabindex': 0,\r\n        'aria-label':  layerOrTableString + ' ' + layerInfo.title,\r\n        //'aria-label': (!this._firstLayerNode ? 'Layers' + layerInfo.title : ''),\r\n        'layerTrNodeId': layerInfo.id\r\n      });\r\n      domConstruct.place(layerTrNode, toTableNode, position);\r\n      if(!this._firstLayerNode) {\r\n        this._firstLayerNode = layerTrNode;\r\n      }\r\n      this._lastLayerNode = layerTrNode;\r\n      this._lastLayerInfo = layerInfo;\r\n\r\n      layerTdNode = domConstruct.create('td', {\r\n        'class': 'col col1'\r\n      }, layerTrNode);\r\n\r\n      for (i = 0; i < level; i++) {\r\n        domConstruct.create('div', {\r\n          'class': 'begin-blank-div jimu-float-leading',\r\n          'innerHTML': ''\r\n        }, layerTdNode);\r\n      }\r\n\r\n      imageShowLegendDiv = domConstruct.create('div', {\r\n        'class': 'showLegend-div jimu-float-leading ',\r\n        'tabindex': layerIndex,\r\n        'role': 'button',\r\n        'aria-label': this.nls.expandLayer,\r\n        'aria-expanded': 'false',\r\n        'imageShowLegendDivId': layerInfo.id\r\n      }, layerTdNode);\r\n\r\n      ckSelectDiv = domConstruct.create('div', {\r\n        'class': 'div-select jimu-float-leading'\r\n      }, layerTdNode);\r\n\r\n      ckSelect = new CheckBox({\r\n        checked: layerInfo.isVisible(), //layerInfo.visible\r\n        'class': \"visible-checkbox-\" + layerInfo.id\r\n      });\r\n\r\n      domConstruct.place(ckSelect.domNode, ckSelectDiv);\r\n      html.setAttr(ckSelect.domNode, 'tabindex', layerIndex);\r\n\r\n      imageNoLegendDiv = domConstruct.create('div', {\r\n        'class': 'noLegend-div jimu-float-leading'\r\n      }, layerTdNode);\r\n\r\n      var imageName;\r\n      if (layerInfo.isTable) {\r\n        imageName = 'images/table.png';\r\n      } else if(layerInfo.isBasemap()) {\r\n        imageName = 'images/basemap.png';\r\n      } else {\r\n        imageName = 'images/noLegend.png';\r\n      }\r\n\r\n      imageNoLegendNode = domConstruct.create('img', {\r\n        'class': 'noLegend-image',\r\n        'src': this.layerListWidget.folderUrl + imageName,\r\n        'alt': ''\r\n      }, imageNoLegendDiv);\r\n\r\n      if (layerInfo.isTiled || layerInfo.isTable) {\r\n        domStyle.set(imageShowLegendDiv, 'display', 'none');\r\n        domStyle.set(ckSelectDiv, 'display', 'none');\r\n        domStyle.set(imageNoLegendDiv, 'display', 'block');\r\n      }\r\n      if(layerInfo.isBasemap()) {\r\n        domStyle.set(imageShowLegendDiv, 'display', 'block');\r\n        domStyle.set(ckSelectDiv, 'display', 'none');\r\n        domStyle.set(imageNoLegendDiv, 'display', 'block');\r\n        domStyle.set(imageNoLegendDiv, 'width', 'auto');\r\n        domStyle.set(imageNoLegendDiv, 'margin-left', '2px');\r\n      }\r\n\r\n      // set tdNode width\r\n      domStyle.set(layerTdNode, 'width', level * 12 + 40 + 'px');\r\n\r\n      /*\r\n      var groupLayerClass = layerInfo.getSubLayers().length > 0 ? \"\" : \"disable\";\r\n      imageGroupDiv = domConstruct.create('div', {\r\n        'class': 'image-group-div jimu-float-leading ' + groupLayerClass\r\n      }, layerTdNode);\r\n      */\r\n\r\n      var layerTitleTdNode = domConstruct.create('td', {\r\n        'class': 'col col2'\r\n      }, layerTrNode);\r\n\r\n      var grayedTitleClass = '';\r\n      try {\r\n        if (!layerInfo.isInScale()) {\r\n          grayedTitleClass = 'grayed-title';\r\n        }\r\n      } catch (err) {\r\n        console.warn(err.message);\r\n      }\r\n      var layerTitleDivIdClass = 'layer-title-div-' + layerInfo.id;\r\n      divLabel = domConstruct.create('div', {\r\n        'innerHTML': jimuUtils.sanitizeHTML(layerInfo.title),\r\n        'class':layerTitleDivIdClass + ' div-content jimu-float-leading ' + grayedTitleClass\r\n      }, layerTitleTdNode);\r\n\r\n      //domStyle.set(divLabel, 'width', 263 - level*13 + 'px');\r\n\r\n      layerTdNode = domConstruct.create('td', {\r\n        'class': 'col col3'\r\n      }, layerTrNode);\r\n\r\n      var popupMenuDisplayStyle = this.hasContentMenu() ? \"display: block\" : \"display: none\";\r\n      // add popupMenu\r\n      popupMenuNode = domConstruct.create('div', {\r\n        'class': 'layers-list-popupMenu-div ',\r\n        'tabindex': layerIndex,\r\n        'role': 'button',\r\n        'aria-haspopup': 'true',\r\n        'aria-expanded': 'false',\r\n        'aria-label': this.nls.tipLayerOperation,\r\n        'style': popupMenuDisplayStyle\r\n      }, layerTdNode);\r\n\r\n      /*\r\n      var handle = on(popupMenuNode,\r\n                  'click',\r\n                  lang.hitch(this, function() {\r\n                    var popupMenu = new PopupMenu({\r\n                      //items: layerInfo.popupMenuInfo.menuItems,\r\n                      _layerInfo: layerInfo,\r\n                    box: this.layerListWidget.domNode.parentNode,\r\n                    popupMenuNode: popupMenuNode,\r\n                    layerListWidget: this.layerListWidget,\r\n                    _config: this.config\r\n                    }).placeAt(popupMenuNode);\r\n                    this.own(on(popupMenu,\r\n                        'onMenuClick',\r\n                        lang.hitch(this, this._onPopupMenuItemClick, layerInfo, popupMenu)));\r\n\r\n                    handle.remove();\r\n                  }));\r\n      */\r\n      /*\r\n      popupMenu = new PopupMenu({\r\n        //items: layerInfo.popupMenuInfo.menuItems,\r\n        _layerInfo: layerInfo,\r\n        box: this.layerListWidget.domNode.parentNode,\r\n        popupMenuNode: popupMenuNode,\r\n        layerListWidget: this.layerListWidget,\r\n        _config: this.config\r\n      }).placeAt(popupMenuNode);\r\n      this.own(on(popupMenu,\r\n        'onMenuClick',\r\n        lang.hitch(this, this._onPopupMenuItemClick, layerInfo, popupMenu)));\r\n      */\r\n\r\n      //add a tr node to toTableNode.\r\n      var layerContentTrNode = domConstruct.create('tr', {\r\n        'class': '',\r\n        'layerContentTrNodeId': layerInfo.id\r\n      });\r\n      domConstruct.place(layerContentTrNode, toTableNode, position);\r\n\r\n      var tdNode = domConstruct.create('td', {\r\n        'class': '',\r\n        'colspan': '3'\r\n      }, layerContentTrNode);\r\n\r\n      var tableNode = domConstruct.create('table', {\r\n        'class': 'layer-sub-node',\r\n        'subNodeId': layerInfo.id\r\n      }, tdNode);\r\n\r\n      //bind event\r\n      handle = this.own(on(layerTitleTdNode,\r\n        'click',\r\n        lang.hitch(this,\r\n          this._onRowTrClick,\r\n          layerInfo,\r\n          imageShowLegendDiv,\r\n          layerTrNode,\r\n          tableNode)));\r\n      //this._layerNodeHandles[rootLayerInfo.id].push(handle[0]);\r\n      this._storeLayerNodeEventHandle(rootLayerInfo, handle[0]);\r\n\r\n      handle = this.own(on(imageShowLegendDiv,\r\n        'click',\r\n        lang.hitch(this,\r\n          this._onRowTrClick,\r\n          layerInfo,\r\n          imageShowLegendDiv,\r\n          layerTrNode,\r\n          tableNode)));\r\n      //this._layerNodeHandles[rootLayerInfo.id].push(handle[0]);\r\n      this._storeLayerNodeEventHandle(rootLayerInfo, handle[0]);\r\n\r\n      handle = this.own(on(ckSelect.domNode, 'click', lang.hitch(this,\r\n        this._onCkSelectNodeClick,\r\n        layerInfo,\r\n        ckSelect)));\r\n      //this._layerNodeHandles[rootLayerInfo.id].push(handle[0]);\r\n      this._storeLayerNodeEventHandle(rootLayerInfo, handle[0]);\r\n\r\n      handle = this.own(on(popupMenuNode, 'click', lang.hitch(this,\r\n        this._onPopupMenuClick,\r\n        layerInfo,\r\n        popupMenuNode,\r\n        layerTrNode)));\r\n      //this._layerNodeHandles[rootLayerInfo.id].push(handle[0]);\r\n      this._storeLayerNodeEventHandle(rootLayerInfo, handle[0]);\r\n\r\n      handle = this.own(on(layerTrNode,\r\n        'keydown',\r\n        lang.hitch(this,\r\n          this._onLayerNodeKey,\r\n          imageShowLegendDiv,\r\n          popupMenuNode)));\r\n      this._storeLayerNodeEventHandle(rootLayerInfo, handle[0]);\r\n\r\n      handle = this.own(on(imageShowLegendDiv,\r\n        'keydown',\r\n        lang.hitch(this,\r\n          this._onImageShowLegendKey,\r\n          layerInfo,\r\n          imageShowLegendDiv,\r\n          layerTrNode,\r\n          tableNode,\r\n          popupMenuNode)));\r\n      this._storeLayerNodeEventHandle(rootLayerInfo, handle[0]);\r\n\r\n      handle = this.own(on(ckSelectDiv,\r\n        'keydown',\r\n        lang.hitch(this,\r\n          this._onCkSelectDivKey,\r\n          layerInfo,\r\n          ckSelect,\r\n          layerTrNode)));\r\n      this._storeLayerNodeEventHandle(rootLayerInfo, handle[0]);\r\n\r\n      handle = this.own(on(popupMenuNode,\r\n        'keydown',\r\n        lang.hitch(this,\r\n          this._onPopupMenuNodeKey,\r\n          layerInfo,\r\n          popupMenuNode,\r\n          layerTrNode,\r\n          imageShowLegendDiv)));\r\n      this._storeLayerNodeEventHandle(rootLayerInfo, handle[0]);\r\n\r\n\r\n\r\n      //if(layerInfo.isRootLayer() || layerInfo.isTable) {\r\n      this._layerDomNodeStorage[layerInfo.getObjectId()].layerTrNode = layerTrNode;\r\n      this._layerDomNodeStorage[layerInfo.getObjectId()].layerContentTrNode = layerContentTrNode;\r\n      //}\r\n\r\n      if(this.layerFilter.isExpanded(layerInfo)) {\r\n        this._foldOrUnfoldLayer(layerInfo, false, imageShowLegendDiv, tableNode);\r\n      }\r\n\r\n      return {\r\n        layerTrNode: layerTrNode,\r\n        subNode: tableNode\r\n      };\r\n    },\r\n\r\n    hasContentMenu: function() {\r\n      var hasContentMenu = false;\r\n      var item;\r\n      if(this.config.contextMenu) {\r\n        for (item in this.config.contextMenu) {\r\n          if(this.config.contextMenu.hasOwnProperty(item) &&\r\n             (typeof this.config.contextMenu[item] !== 'function')) {\r\n            hasContentMenu = hasContentMenu || this.config.contextMenu[item];\r\n          }\r\n        }\r\n      } else {\r\n        hasContentMenu = true;\r\n      }\r\n      return hasContentMenu;\r\n    },\r\n\r\n    addLegendNode: function(layerInfo, level, toTableNode) {\r\n      //var legendsDiv;\r\n      var legendTrNode = domConstruct.create('tr', {\r\n          'class': 'legend-node-tr',\r\n          'tabindex': 0\r\n        }, toTableNode),\r\n        legendTdNode;\r\n\r\n      domConstruct.create('td', {\r\n        'aria-label': window.jimuNls.common.layer + \" \" + window.jimuNls.statisticsChart.legend\r\n      }, legendTrNode);\r\n\r\n      legendTdNode = domConstruct.create('td', {\r\n        'class': 'legend-node-td'\r\n      }, legendTrNode);\r\n\r\n      try {\r\n        var legendsNode = layerInfo.createLegendsNode();\r\n        //layerInfo.legendsNode = legendsNode;\r\n        //domStyle.set(legendsNode, 'marginLeft', (level+1)*12 + 'px');\r\n        domStyle.set(legendsNode, 'font-size', (level + 1) * 12 + 'px');\r\n        domConstruct.place(legendsNode, legendTdNode);\r\n      } catch (err) {\r\n        console.error(err);\r\n      }\r\n    },\r\n\r\n    redrawLegends: function(layerInfo) {\r\n      var legendsNode = query(\"div[legendsDivId='\" + layerInfo.id + \"']\", this.layerListTable)[0];\r\n      if(legendsNode) {\r\n        if(legendsNode._legendDijit && legendsNode._legendDijit.destroy) {\r\n          legendsNode._legendDijit.destroy();\r\n        }\r\n        layerInfo.drawLegends(legendsNode, this.layerListWidget.appConfig.portalUrl);\r\n      }\r\n    },\r\n\r\n    // destroyLayerTrNode: function(layerInfo) {\r\n    //   var removedLayerNode = query(\"[class~='layer-tr-node-\" + layerInfo.id + \"']\", this.domNode)[0];\r\n    //   var removedLayerContentNode = query(\"[layercontenttrnodeid='\" + layerInfo.id + \"']\", this.domNode)[0];\r\n    //   if(removedLayerNode) {\r\n    //     var rootLayerInfo = layerInfo.getRootLayerInfo();\r\n    //     array.forEach(this._layerNodeHandles[rootLayerInfo.id], function(handle) {\r\n    //       handle.remove();\r\n    //     }, this);\r\n    //     delete this._layerNodeHandles[rootLayerInfo.id];\r\n    //     domConstruct.destroy(removedLayerNode);\r\n    //     if(removedLayerContentNode) {\r\n    //       domConstruct.destroy(removedLayerContentNode);\r\n    //     }\r\n    //   }\r\n    // },\r\n\r\n    /***************************************************\r\n     * methods for refresh layerListView\r\n     ***************************************************/\r\n    _storeLayerNodeEventHandle: function(rootLayerInfo, handle) {\r\n      var rootLayerStorage = this._layerDomNodeStorage[rootLayerInfo.getObjectId()];\r\n      if(rootLayerStorage) {\r\n        rootLayerStorage.layerNodeEventHandles.push(handle);\r\n      }\r\n    },\r\n\r\n    _storeLayerNodeDijit: function(rootLayerInfo, dijit) {\r\n      var rootLayerStorage = this._layerDomNodeStorage[rootLayerInfo.getObjectId()];\r\n      if(rootLayerStorage) {\r\n        rootLayerStorage.layerNodeReferredDijits.push(dijit);\r\n      }\r\n    },\r\n\r\n    _clearLayerDomNodeStorage:function() {\r\n      //jshint unused:false\r\n      /*\r\n      var layerInfoArray = this.operLayerInfos.getLayerInfoArray();\r\n      var tableInfoArray = this.operLayerInfos.getTableInfoArray();\r\n      var layerAndTableInfoArray = layerInfoArray.concat(tableInfoArray);\r\n      */\r\n      var findElem;\r\n      var allLayerAndTableInfos = [];\r\n      this.operLayerInfos.traversalAll(function(layerInfo) {\r\n        allLayerAndTableInfos.push(layerInfo);\r\n      });\r\n      for(var elem in this._layerDomNodeStorage) {\r\n        if(this._layerDomNodeStorage.hasOwnProperty(elem) &&\r\n           (typeof this._layerDomNodeStorage[elem] !== 'function')) {\r\n          /* jshint loopfunc: true */\r\n          findElem = array.some(allLayerAndTableInfos, function(layerInfo) {\r\n            if(layerInfo.getObjectId().toString() === elem) {\r\n              return true;\r\n            }\r\n          }, this);\r\n\r\n          if(!findElem) {\r\n            //release layer node.\r\n            array.forEach(this._layerDomNodeStorage[elem].layerNodeEventHandles, function(handle) {\r\n              handle.remove();\r\n            }, this);\r\n            array.forEach(this._layerDomNodeStorage[elem].layerNodeReferredDijits, function(dijit) {\r\n              dijit.destroy();\r\n            }, this);\r\n            domConstruct.destroy(this._layerDomNodeStorage[elem].layerTrNode);\r\n            domConstruct.destroy(this._layerDomNodeStorage[elem].layerContentTrNode);\r\n            delete this._layerDomNodeStorage[elem];\r\n          }\r\n        }\r\n      }\r\n    },\r\n\r\n    _removeLayerNodes: function() {\r\n      var nodeAndSubNode, parentNode;\r\n      this._clearLayerDomNodeStorage();\r\n      for(var elem in this._layerDomNodeStorage) {\r\n        if(this._layerDomNodeStorage.hasOwnProperty(elem) &&\r\n           (typeof this._layerDomNodeStorage[elem] !== 'function')) {\r\n          nodeAndSubNode = this._layerDomNodeStorage[elem];\r\n          if(nodeAndSubNode &&\r\n             nodeAndSubNode.layerInfo &&\r\n             nodeAndSubNode.layerInfo.isRootLayer() &&\r\n             nodeAndSubNode.layerContentTrNode &&\r\n             nodeAndSubNode.layerTrNode) {\r\n            parentNode = nodeAndSubNode.layerTrNode.parentNode;\r\n            if(parentNode) {\r\n              parentNode.removeChild(nodeAndSubNode.layerTrNode);\r\n            }\r\n            parentNode = nodeAndSubNode.layerContentTrNode.parentNode;\r\n            if(parentNode) {\r\n              parentNode.removeChild(nodeAndSubNode.layerContentTrNode);\r\n            }\r\n          }\r\n        }\r\n      }\r\n      // this.inherited(arguments);\r\n    },\r\n\r\n    /***************************************************\r\n     * methods for control layerListView\r\n     ***************************************************/\r\n    // return current state:\r\n    //   true:  fold,\r\n    //   false: unfold\r\n    _foldSwitch: function(layerInfo, imageShowLegendDiv, subNode) {\r\n      /*jshint unused: false*/\r\n      var state;\r\n      if (domStyle.get(subNode, 'display') === 'none') {\r\n        state = this._foldOrUnfoldLayer(layerInfo, false, imageShowLegendDiv, subNode);\r\n      } else {\r\n        state = this._foldOrUnfoldLayer(layerInfo, true, imageShowLegendDiv, subNode);\r\n      }\r\n      return state;\r\n    },\r\n\r\n    _foldOrUnfoldLayer: function(layerInfo, isFold, imageShowLegendDivParam, subNodeParam) {\r\n      var imageShowLegendDiv =\r\n        imageShowLegendDiv ?\r\n        imageShowLegendDivParam :\r\n        query(\"div[imageShowLegendDivId='\" + layerInfo.id + \"']\", this.layerListTable)[0];\r\n      var subNode =\r\n        subNode ?\r\n        subNodeParam :\r\n        query(\"table[subNodeId='\" + layerInfo.id + \"']\", this.layerListTable)[0];\r\n\r\n      var state = null;\r\n      if(imageShowLegendDiv && subNode) {\r\n        if (isFold) {\r\n          //fold\r\n          domStyle.set(subNode, 'display', 'none');\r\n          domClass.remove(imageShowLegendDiv, 'unfold');\r\n          state = true;\r\n          html.setAttr(imageShowLegendDiv, 'aria-label', this.nls.expandLayer);\r\n          html.setAttr(imageShowLegendDiv, 'aria-expanded', 'false');\r\n        } else {\r\n          //unfold\r\n          domStyle.set(subNode, 'display', 'table');\r\n          domClass.add(imageShowLegendDiv, 'unfold');\r\n          state = false;\r\n          html.setAttr(imageShowLegendDiv, 'aria-label', this.nls.collapseLayer);\r\n          html.setAttr(imageShowLegendDiv, 'aria-expanded', 'true');\r\n          if (layerInfo.isLeaf()) {\r\n            var legendsNode = query(\".legends-div\", subNode)[0];\r\n            var loadingImg = query(\".legends-loading-img\", legendsNode)[0];\r\n            if (legendsNode && loadingImg) {\r\n              layerInfo.drawLegends(legendsNode, this.layerListWidget.appConfig.portalUrl);\r\n            }\r\n          }\r\n        }\r\n      }\r\n      return state;\r\n    },\r\n\r\n    _foldOrUnfoldLayers: function(layerInfos, isFold) {\r\n      array.forEach(layerInfos, function(layerInfo) {\r\n        this._foldOrUnfoldLayer(layerInfo, isFold);\r\n      }, this);\r\n    },\r\n\r\n    _onCkSelectNodeClick: function(layerInfo, ckSelect, evt) {\r\n      if(evt.ctrlKey || evt.metaKey) {\r\n        if(layerInfo.isRootLayer()) {\r\n          this.turnAllRootLayers(ckSelect.checked);\r\n        } else {\r\n          this.turnAllSameLevelLayers(layerInfo, ckSelect.checked);\r\n        }\r\n      } else {\r\n        this.layerListWidget._denyLayerInfosIsVisibleChangedResponseOneTime = true;\r\n        layerInfo.setTopLayerVisible(ckSelect.checked);\r\n      }\r\n      evt.stopPropagation();\r\n    },\r\n\r\n    _onPopupMenuClick: function(layerInfo, popupMenuNode, layerTrNode, evt) {\r\n      var rootLayerInfo = layerInfo.getRootLayerInfo();\r\n      var popupMenu = popupMenuNode.popupMenu;\r\n      if(!popupMenu) {\r\n        popupMenu = new PopupMenu({\r\n          //items: layerInfo.popupMenuInfo.menuItems,\r\n          _layerInfo: layerInfo,\r\n          box: this.layerListWidget.domNode.parentNode,\r\n          popupMenuNode: popupMenuNode,\r\n          layerListWidget: this.layerListWidget,\r\n          _config: this.config\r\n        }).placeAt(popupMenuNode);\r\n        popupMenuNode.popupMenu = popupMenu;\r\n        this._storeLayerNodeDijit(rootLayerInfo, popupMenu);\r\n        var handle = this.own(on(popupMenu,\r\n              'onMenuClick',\r\n              lang.hitch(this, this._onPopupMenuItemClick, layerInfo, popupMenu)));\r\n        //this._layerNodeHandles[rootLayerInfo.id].push(handle[0]);\r\n        this._storeLayerNodeEventHandle(rootLayerInfo, handle[0]);\r\n\r\n        handle = this.own(popupMenuNode.popupMenu.on('onOpenMenu',\r\n          lang.hitch(this, this._onPopupMenuOpen, layerInfo, popupMenuNode, rootLayerInfo)));\r\n        this._storeLayerNodeEventHandle(rootLayerInfo, handle[0]);\r\n      }\r\n\r\n      /*jshint unused: false*/\r\n      this._changeSelectedLayerRow(layerTrNode);\r\n      if (popupMenu && popupMenu.state === 'opened') {\r\n        popupMenu.closeDropMenu();\r\n      } else {\r\n        this._hideCurrentPopupMenu();\r\n        if (popupMenu) {\r\n          this.currentPopupMenu = popupMenu;\r\n          popupMenu.openDropMenu();\r\n        }\r\n      }\r\n\r\n      //hidden operation mene if that is opened.\r\n      if (this.operationsDropMenu && this.operationsDropMenu.state === 'opened') {\r\n        this.operationsDropMenu.closeDropMenu();\r\n      }\r\n      evt.stopPropagation();\r\n    },\r\n\r\n    _hideCurrentPopupMenu: function() {\r\n      if (this.currentPopupMenu && this.currentPopupMenu.state === 'opened') {\r\n        this.currentPopupMenu.closeDropMenu();\r\n      }\r\n    },\r\n\r\n    _onLayerListWidgetPaneClick: function() {\r\n      if (this.operationsDropMenu) {\r\n        this.operationsDropMenu.closeDropMenu();\r\n      }\r\n    },\r\n\r\n    _onRowTrClick: function(layerInfo, imageShowLegendDiv, layerTrNode, subNode, evt) {\r\n      this._changeSelectedLayerRow(layerTrNode);\r\n      var fold = this._foldSwitch(layerInfo, imageShowLegendDiv, subNode);\r\n      layerTrNode._expanded = !fold;\r\n      if(evt.ctrlKey || evt.metaKey) {\r\n        if(layerInfo.isRootLayer()) {\r\n          this.foldOrUnfoldAllRootLayers(fold);\r\n        } else {\r\n          this.foldOrUnfoldSameLevelLayers(layerInfo, fold);\r\n        }\r\n      }\r\n    },\r\n\r\n    _changeSelectedLayerRow: function(layerTrNode) {\r\n      if (this._currentSelectedLayerRowNode && this._currentSelectedLayerRowNode === layerTrNode) {\r\n        return;\r\n      }\r\n      if (this._currentSelectedLayerRowNode) {\r\n        domClass.remove(this._currentSelectedLayerRowNode, 'jimu-widget-row-selected');\r\n      }\r\n      domClass.add(layerTrNode, 'jimu-widget-row-selected');\r\n      this._currentSelectedLayerRowNode = layerTrNode;\r\n    },\r\n\r\n    _onPopupMenuItemClick: function(layerInfo, popupMenu, item, data) {\r\n      var evt = {\r\n          itemKey: item.key,\r\n          extraData: data,\r\n          layerListWidget: this.layerListWidget,\r\n          layerListView: this\r\n        },\r\n        result;\r\n\r\n      // window.jimuNls.layerInfosMenu.itemTransparency NlsStrings.value.itemTransparency\r\n      if (item.key === 'transparency') {\r\n        if (domStyle.get(popupMenu.transparencyDiv, 'display') === 'none') {\r\n          popupMenu.showTransNode(layerInfo.getOpacity(), item);\r\n        } else {\r\n          popupMenu.hideTransNode();\r\n        }\r\n      } else if(item.key === 'setVisibilityRange') {\r\n        if (domStyle.get(popupMenu.setVisibilityRangeNode, 'display') === 'none') {\r\n          popupMenu.showSetVisibilityRangeNode(layerInfo, item);\r\n        } else {\r\n          popupMenu.hideSetVisibilityRangeNode();\r\n        }\r\n      } else {\r\n        result = popupMenu.popupMenuInfo.onPopupMenuClick(evt);\r\n        if (result.closeMenu) {\r\n          popupMenu.closeDropMenu();\r\n        }\r\n      }\r\n    },\r\n\r\n    /***************************************************\r\n     * methods for control moveUp/moveDown.\r\n     ***************************************************/\r\n    // befor exchange:  id1 -> id2\r\n    // after exchanged: id2 -> id1\r\n    _exchangeLayerTrNode: function(layerInfo1, layerInfo2) {\r\n      var layer1TrNode = query(\"tr[layerTrNodeId='\" + layerInfo1.id + \"']\", this.layerListTable)[0];\r\n      //var layer1ContentTrNode = query(\"tr[layerContentTrNodeId='\" + layerInfo1.id + \"']\",\r\n      //                                this.layerListTable)[0];\r\n      var layer2TrNode = query(\"tr[layerTrNodeId='\" + layerInfo2.id + \"']\", this.layerListTable)[0];\r\n      var layer2ContentTrNode = query(\"tr[layerContentTrNodeId='\" + layerInfo2.id + \"']\",\r\n        this.layerListTable)[0];\r\n      if(layer1TrNode && layer2TrNode && layer2ContentTrNode) {\r\n        // change layerTr\r\n        this.layerListTable.removeChild(layer2TrNode);\r\n        this.layerListTable.insertBefore(layer2TrNode, layer1TrNode);\r\n        // change LayerContentTr\r\n        this.layerListTable.removeChild(layer2ContentTrNode);\r\n        this.layerListTable.insertBefore(layer2ContentTrNode, layer1TrNode);\r\n      }\r\n    },\r\n\r\n    _getMovedSteps: function(layerInfo, upOrDown) {\r\n      // summary:\r\n      //   according to hidden layers to get moved steps.\r\n      var steps = 1;\r\n      var layerInfoIndex;\r\n      var layerInfoArray = this.operLayerInfos.getLayerInfoArray();\r\n      array.forEach(layerInfoArray, function(currentLayerInfo, index) {\r\n        if(layerInfo.id === currentLayerInfo.id) {\r\n          layerInfoIndex = index;\r\n        }\r\n      }, this);\r\n      if(upOrDown === \"moveup\") {\r\n        while(!layerInfoArray[layerInfoIndex].isFirst) {\r\n          layerInfoIndex--;\r\n          if((this.isLayerHiddenInWidget(layerInfoArray[layerInfoIndex]) ||\r\n                !this.layerFilter.isValidLayerInfo(layerInfoArray[layerInfoIndex])) &&\r\n              !layerInfoArray[layerInfoIndex].isFirst) {\r\n            steps++;\r\n          } else {\r\n            break;\r\n          }\r\n        }\r\n      } else {\r\n        while(!layerInfoArray[layerInfoIndex].isLast) {\r\n          layerInfoIndex++;\r\n          if((this.isLayerHiddenInWidget(layerInfoArray[layerInfoIndex])  ||\r\n                !this.layerFilter.isValidLayerInfo(layerInfoArray[layerInfoIndex])) &&\r\n              !layerInfoArray[layerInfoIndex].isLast) {\r\n            steps++;\r\n          } else {\r\n            break;\r\n          }\r\n        }\r\n      }\r\n      return steps;\r\n    },\r\n\r\n    moveUpLayer: function(layerInfo) {\r\n      // summary:\r\n      //    move up layer in layer list.\r\n      // description:\r\n      //    call the moveUpLayer method of LayerInfos to change the layer order in map,\r\n      //    and update the data in LayerInfos\r\n      //    then, change layerNodeTr and layerContentTr domNode\r\n      /*\r\n      var steps = this._getMovedSteps(layerInfo, 'moveup');\r\n      this.layerListWidget._denyLayerInfosReorderResponseOneTime = true;\r\n      var beChangedLayerInfo = this.operLayerInfos.moveUpLayer(layerInfo, steps);\r\n      if (beChangedLayerInfo) {\r\n        this._exchangeLayerTrNode(beChangedLayerInfo, layerInfo);\r\n      }\r\n      */\r\n      var steps = this._getMovedSteps(layerInfo, 'moveup');\r\n      this.operLayerInfos.moveUpLayer(layerInfo, steps);\r\n    },\r\n\r\n    moveDownLayer: function(layerInfo) {\r\n      // summary:\r\n      //    move down layer in layer list.\r\n      // description:\r\n      //    call the moveDownLayer method of LayerInfos to change the layer order in map,\r\n      //    and update the data in LayerInfos\r\n      //    then, change layerNodeTr and layerContentTr domNode\r\n      /*\r\n      var steps = this._getMovedSteps(layerInfo, 'movedown');\r\n      this.layerListWidget._denyLayerInfosReorderResponseOneTime = true;\r\n      var beChangedLayerInfo = this.operLayerInfos.moveDownLayer(layerInfo, steps);\r\n      if (beChangedLayerInfo) {\r\n        this._exchangeLayerTrNode(layerInfo, beChangedLayerInfo);\r\n      }\r\n      */\r\n      var steps = this._getMovedSteps(layerInfo, 'movedown');\r\n      this.operLayerInfos.moveDownLayer(layerInfo, steps);\r\n    },\r\n\r\n    isLayerHiddenInWidget: function(layerInfo) {\r\n      var isHidden = false;\r\n      var currentLayerInfo = layerInfo;\r\n      if(layerInfo &&\r\n         this.config.layerOptions &&\r\n         this.config.layerOptions[layerInfo.id] !== undefined) {\r\n        while(currentLayerInfo) {\r\n          isHidden = isHidden ||  !this.config.layerOptions[currentLayerInfo.id].display;\r\n          if(isHidden) {\r\n            break;\r\n          }\r\n          currentLayerInfo = currentLayerInfo.parentLayerInfo;\r\n        }\r\n      } else {\r\n        // if config has not been configured, default value is 'true'.\r\n        // if config has been configured, but new layer of webmap is ont in config file,\r\n        //   default value is 'true'.\r\n        isHidden = false;\r\n      }\r\n      return isHidden;\r\n    },\r\n\r\n    isFirstDisplayedLayerInfo: function(layerInfo) {\r\n      var isFirst;\r\n      var steps;\r\n      var layerInfoIndex;\r\n      var layerInfoArray;\r\n      if(layerInfo.isFirst || !layerInfo.isRootLayer() || layerInfo.isBasemap()) {\r\n        isFirst = true;\r\n      } else {\r\n        steps = this._getMovedSteps(layerInfo, \"moveup\");\r\n        layerInfoArray = this.operLayerInfos.getLayerInfoArray();\r\n        layerInfoIndex = this.operLayerInfos._getTopLayerInfoIndexById(layerInfo.id);\r\n        if(this.isLayerHiddenInWidget(layerInfoArray[layerInfoIndex - steps]) ||\r\n            !this.layerFilter.isValidLayerInfo(layerInfoArray[layerInfoIndex - steps])) {\r\n          isFirst = true;\r\n        } else {\r\n          isFirst = false;\r\n        }\r\n      }\r\n      return isFirst;\r\n    },\r\n\r\n    isLastDisplayedLayerInfo: function(layerInfo) {\r\n      var isLast;\r\n      var steps;\r\n      var layerInfoIndex;\r\n      var layerInfoArray;\r\n      if(layerInfo.isLast || !layerInfo.isRootLayer() || layerInfo.isBasemap()) {\r\n        isLast = true;\r\n      } else {\r\n        steps = this._getMovedSteps(layerInfo, \"movedown\");\r\n        layerInfoArray = this.operLayerInfos.getLayerInfoArray();\r\n        layerInfoIndex = this.operLayerInfos._getTopLayerInfoIndexById(layerInfo.id);\r\n        if(this.isLayerHiddenInWidget(layerInfoArray[layerInfoIndex + steps])  ||\r\n            !this.layerFilter.isValidLayerInfo(layerInfoArray[layerInfoIndex + steps])) {\r\n          isLast = true;\r\n        } else {\r\n          isLast = false;\r\n        }\r\n      }\r\n      return isLast;\r\n    },\r\n\r\n    /***************************************************\r\n     * methods for control operation.\r\n     ***************************************************/\r\n    _initOperations: function() {\r\n      this.operationsDropMenu = new DropMenu({\r\n        items:[{\r\n          key: \"turnAllLayersOn\",\r\n          label: this.nls.turnAllLayersOn\r\n        }, {\r\n          key: \"turnAllLayersOff\",\r\n          label: this.nls.turnAllLayersOff\r\n        }, {\r\n          key: \"separator\"\r\n        }, {\r\n          key: \"expandAllLayers\",\r\n          label: this.nls.expandAllLayers\r\n        }, {\r\n          key: \"collapseAlllayers\",\r\n          label: this.nls.collapseAlllayers\r\n        }],\r\n        box: this.layerListWidget.domNode.parentNode\r\n      }).placeAt(this.layerListOperations);\r\n\r\n      var operationIconBtnNode = query('div.jimu-dropmenu > div:first-child',\r\n          this.layerListOperations)[0];\r\n\r\n      if(operationIconBtnNode) {\r\n        domClass.remove(operationIconBtnNode, ['jimu-icon-btn', 'popup-menu-button']);\r\n        domClass.add(operationIconBtnNode, ['feature-action', 'icon-operation']);\r\n      }\r\n\r\n      if(this.operationsDropMenu.btnNode) {\r\n        this.own(on(this.operationsDropMenu.btnNode,\r\n          'click',\r\n          lang.hitch(this, this._onLayerListOperationsClick)));\r\n      }\r\n\r\n      this.own(on(this.operationsDropMenu ,\r\n        'onMenuClick',\r\n        lang.hitch(this, this._onOperationsMenuItemClick)));\r\n\r\n      this.operationsDropMenuLoading = new LoadingShelter({\r\n        hidden: true\r\n      }).placeAt(this.operationsDropMenu.domNode);\r\n\r\n      this.own(on(this.layerListOperations,\r\n        'keydown',\r\n        lang.hitch(this, this._onLayerListOperationsKey)));\r\n\r\n      this.own(on(this.operationsDropMenu,\r\n        'onOpenMenu',\r\n        lang.hitch(this, this._onOperationsDropMenuOpen)));\r\n    },\r\n\r\n    _onLayerListOperationsClick: function() {\r\n      this._hideCurrentPopupMenu();\r\n    },\r\n\r\n    _onOperationsMenuItemClick: function(item) {\r\n      switch (item.key) {\r\n        case 'turnAllLayersOn':\r\n          this.turnAllRootLayers(true);\r\n          return;\r\n        case 'turnAllLayersOff':\r\n          this.turnAllRootLayers(false);\r\n          return;\r\n        case 'expandAllLayers':\r\n          this.foldOrUnfoldAllLayers(false);\r\n          return;\r\n        case 'collapseAlllayers':\r\n          this.foldOrUnfoldAllLayers(true);\r\n          return;\r\n        default:\r\n          return;\r\n      }\r\n    },\r\n\r\n    turnAllRootLayers: function(isOnOrOff) {\r\n      var layerInfoArray = this.operLayerInfos.getLayerInfoArray();\r\n      array.forEach(layerInfoArray, function(layerInfo) {\r\n        if (!this.isLayerHiddenInWidget(layerInfo)) {\r\n          layerInfo.setTopLayerVisible(isOnOrOff);\r\n        }\r\n      }, this);\r\n    },\r\n\r\n    turnAllSameLevelLayers: function(layerInfo, isOnOrOff) {\r\n      var layerOptions = {};\r\n      var rootLayerInfo = layerInfo.getRootLayerInfo();\r\n      rootLayerInfo.traversal(lang.hitch(this, function(subLayerInfo) {\r\n        if(subLayerInfo.parentLayerInfo &&\r\n           subLayerInfo.parentLayerInfo.id === layerInfo.parentLayerInfo.id &&\r\n           !this.isLayerHiddenInWidget(subLayerInfo)) {\r\n          layerOptions[subLayerInfo.id] = {visible: isOnOrOff};\r\n        } else {\r\n          layerOptions[subLayerInfo.id] = {visible: subLayerInfo.isVisible()};\r\n        }\r\n      }));\r\n      rootLayerInfo.resetLayerObjectVisibility(layerOptions);\r\n    },\r\n\r\n    foldOrUnfoldAllRootLayers: function(isFold) {\r\n      var layerInfoArray = array.filter(this.operLayerInfos.getLayerInfoArray(),\r\n                                        function(layerInfo) {\r\n        return !this.isLayerHiddenInWidget(layerInfo);\r\n      }, this);\r\n      this._foldOrUnfoldLayers(layerInfoArray, isFold);\r\n    },\r\n\r\n    foldOrUnfoldSameLevelLayers: function(layerInfo, isFold) {\r\n      var layerInfoArray;\r\n      if(layerInfo.parentLayerInfo) {\r\n        layerInfoArray = array.filter(layerInfo.parentLayerInfo.getSubLayers(),\r\n                                          function(layerInfo) {\r\n          return !this.isLayerHiddenInWidget(layerInfo);\r\n        }, this);\r\n        this._foldOrUnfoldLayers(layerInfoArray, isFold);\r\n      }\r\n    },\r\n\r\n    foldOrUnfoldAllLayers: function(isFold) {\r\n      var layerInfoArray = [];\r\n      var rootLayerInfoArray = [];\r\n\r\n      this.operationsDropMenuLoading.show();\r\n      this.operLayerInfos.traversal(lang.hitch(this, function(layerInfo) {\r\n        if(!this.isLayerHiddenInWidget(layerInfo)) {\r\n          if(layerInfo.isRootLayer()) {\r\n            rootLayerInfoArray.push(layerInfo);\r\n          } else {\r\n            layerInfoArray.push(layerInfo);\r\n          }\r\n        }\r\n      }));\r\n\r\n      layerInfoArray = rootLayerInfoArray.concat(layerInfoArray);\r\n\r\n      var i = 0;\r\n      var layerInfoArrayLength = layerInfoArray.length;\r\n      var steps = 50;\r\n      setTimeout(lang.hitch(this, function() {\r\n        if(i < layerInfoArrayLength) {\r\n          var candidateLayerInfoArray = layerInfoArray.slice(i, i + steps);\r\n          this._foldOrUnfoldLayers(candidateLayerInfoArray, isFold);\r\n          i = i + steps;\r\n          setTimeout(lang.hitch(this, arguments.callee), 60); // jshint ignore:line\r\n        } else {\r\n          this.operationsDropMenuLoading.hide();\r\n        }\r\n      }), 60);\r\n    },\r\n    /***************************************************\r\n     * methods for 508 accessibility.\r\n     ***************************************************/\r\n    _supports508Accessibility: function() {\r\n      var eventHandler;\r\n      if(this._lastLayerNode) {\r\n        /*\r\n        eventHandler = on(this._lastLayerNode, 'keydown', lang.hitch(this, '_onLastLayerNodeKey'));\r\n        this._eventHandlers.push(eventHandler);\r\n        eventHandler = on(this.supports508Node, 'keydown', lang.hitch(this, '_onLastLayerNodeKey'));\r\n        this._eventHandlers.push(eventHandler);\r\n        */\r\n        eventHandler = on(this.layerListWidget.layerFilter.searchButton,\r\n                          'keydown',\r\n                          lang.hitch(this, '_onSearchButtonKey'));\r\n        this._eventHandlers.push(eventHandler);\r\n        eventHandler = on(this.supports508Node, 'focus', lang.hitch(this, '_onLastNodeFocus'));\r\n        this._eventHandlers.push(eventHandler);\r\n        jimuUtils.initLastFocusNode(this.layerListWidget.domNode, this.supports508Node);\r\n      } else {\r\n        jimuUtils.initLastFocusNode(this.layerListWidget.domNode, this.layerListOperations);\r\n        eventHandler = on(this.supports508Node, 'focus', lang.hitch(this, '_onLastNodeFocus'));\r\n        this._eventHandlers.push(eventHandler);\r\n        //this.domNode.removeChild(this.supports508Node);\r\n      }\r\n    },\r\n\r\n\r\n    _onSearchButtonKey: function(e) {\r\n      if(e.keyCode === keys.TAB && e.shiftKey) {\r\n        e.stopPropagation();\r\n        e.preventDefault();\r\n        //focusUtil.focus(this._lastLayerNode);\r\n        this._backToLastNodeFlag = true;\r\n      }\r\n    },\r\n\r\n    _getLastExpandedLayerNode: function() {\r\n      var lastExpandedLayerNode = this._lastLayerNode;\r\n      //var layerTrNode = this._lastLayerNode;\r\n      var parentLayerTrNode = null;\r\n      var layerInfo = this._lastLayerInfo;\r\n      while(layerInfo) {\r\n        var parentLayerInfo = layerInfo.parentLayerInfo;\r\n        if(!parentLayerInfo) {\r\n          lastExpandedLayerNode = this._layerDomNodeStorage[layerInfo.getObjectId()].layerTrNode;\r\n          break;\r\n        } else {\r\n          parentLayerTrNode = this._layerDomNodeStorage[parentLayerInfo.getObjectId()].layerTrNode;\r\n          if(parentLayerTrNode && parentLayerTrNode._expanded) {\r\n            lastExpandedLayerNode = this._layerDomNodeStorage[layerInfo.getObjectId()].layerTrNode;\r\n            break;\r\n          }\r\n        }\r\n        layerInfo = parentLayerInfo;\r\n      }\r\n      return lastExpandedLayerNode;\r\n    },\r\n\r\n    _onLastNodeFocus: function() {\r\n      //e.stopPropagation();\r\n      //e.preventDefault();\r\n      if(this._backToLastNodeFlag) {\r\n        var lastExpandedLayerNode = this._getLastExpandedLayerNode();\r\n        if(lastExpandedLayerNode) {\r\n          focusUtil.focus(lastExpandedLayerNode);\r\n        }\r\n        this._backToLastNodeFlag = false;\r\n      } else {\r\n        focusUtil.focus(this.layerListWidget.layerFilter.searchButton);\r\n      }\r\n    },\r\n\r\n    _onLastLayerNodeKey: function(e) {\r\n      if(e.keyCode === keys.TAB && !e.shiftKey) {\r\n        e.stopPropagation();\r\n        e.preventDefault();\r\n        focusUtil.focus(this.layerListWidget.layerFilter.searchButton);\r\n      }\r\n    },\r\n\r\n    _onLayerNodeKey: function(imageShowLegendDiv, popupMenuNode, e) {\r\n      if(e.keyCode === keys.ENTER) {\r\n        e.stopPropagation();\r\n        e.preventDefault();\r\n        if(html.getStyle(imageShowLegendDiv, 'display') === 'none') {\r\n          focusUtil.focus(popupMenuNode);\r\n        } else {\r\n          focusUtil.focus(imageShowLegendDiv);\r\n        }\r\n      }\r\n    },\r\n\r\n    _onImageShowLegendKey: function(layerInfo, imageShowLegendDiv, layerTrNode, subNode, popupMenuNode, e) {\r\n      // avoid be impacted if the current layer is lastFocueNode.\r\n      if(e.keyCode === keys.TAB) {\r\n        e.stopPropagation();\r\n      }\r\n      if(e.keyCode === keys.TAB && e.shiftKey) {\r\n        e.stopPropagation();\r\n        e.preventDefault();\r\n        focusUtil.focus(popupMenuNode);\r\n      } else if(e.keyCode === keys.ESCAPE) {\r\n        e.stopPropagation();\r\n        e.preventDefault();\r\n        focusUtil.focus(layerTrNode);\r\n      } else if(e.keyCode === keys.ENTER) {\r\n        e.stopPropagation();\r\n        e.preventDefault();\r\n        this._onRowTrClick(layerInfo, imageShowLegendDiv, layerTrNode, subNode, e);\r\n      }\r\n    },\r\n\r\n    _onCkSelectDivKey: function(layerInfo, ckSelect, layerTrNode, e) {\r\n      // avoid be impacted if the current layer is lastFocueNode.\r\n      if(e.keyCode === keys.TAB) {\r\n        e.stopPropagation();\r\n      }\r\n      if(e.keyCode === keys.ESCAPE) {\r\n        e.stopPropagation();\r\n        e.preventDefault();\r\n        focusUtil.focus(layerTrNode);\r\n      } else if(e.keyCode === keys.SPACE || e.keyCode === keys.ENTER) {\r\n        e.stopPropagation();\r\n        e.preventDefault();\r\n        if(ckSelect.checked) {\r\n          ckSelect.uncheck(true);\r\n        } else {\r\n          ckSelect.check(true);\r\n        }\r\n        this._onCkSelectNodeClick(layerInfo, ckSelect, e);\r\n      }\r\n    },\r\n\r\n    _onPopupMenuNodeKey: function(layerInfo, popupMenuNode, layerTrNode, imageShowLegendDiv, e) {\r\n      // avoid be impacted if the current layer is lastFocueNode.\r\n      if(e.keyCode === keys.TAB) {\r\n        e.stopPropagation();\r\n      }\r\n      if(e.keyCode === keys.TAB && !e.shiftKey) {\r\n        e.stopPropagation();\r\n        e.preventDefault();\r\n        focusUtil.focus(imageShowLegendDiv);\r\n      } else if(e.keyCode === keys.ESCAPE) {\r\n        e.stopPropagation();\r\n        e.preventDefault();\r\n        focusUtil.focus(layerTrNode);\r\n      } else if(e.keyCode === keys.ENTER || e.keyCode === keys.DOWN_ARROW || e.keyCode === keys.UP_ARROW) {\r\n        e.stopPropagation();\r\n        e.preventDefault();\r\n        this._onPopupMenuClick(layerInfo, popupMenuNode, layerTrNode, e);\r\n      }\r\n    },\r\n\r\n    _onPopupMenuOpen: function(layerInfo, popupMenuNode, rootLayerInfo) {\r\n      //jshint unused:false\r\n      var menuItems = query('.menu-item', popupMenuNode.popupMenu.dropMenuNode);\r\n      menuItems = menuItems.filter(function(menuItem) {\r\n        if(html.hasClass(menuItem, 'menu-item-hidden')) {\r\n          return false;\r\n        } else {\r\n          return true;\r\n        }\r\n      });\r\n      var firstItem = menuItems[0], lastItem = menuItems[menuItems.length - 1];\r\n      menuItems.forEach(function(menuItem, index) {\r\n        var isFirstItem = false, isLastItem = false;\r\n        var previousItem = menuItems[index - 1], nextItem = menuItems[index + 1];\r\n        if(index === 0) {\r\n          focusUtil.focus(menuItem);\r\n          isFirstItem = true;\r\n        } else if(index === menuItems.length - 1) {\r\n          isLastItem = true;\r\n        }\r\n\r\n        if(!menuItem.hasBeenOpened) {\r\n          var handle = this.own(on(menuItem, 'keydown', lang.hitch(this, this._onPopupMenuItemKey,\r\n            popupMenuNode, previousItem, nextItem, firstItem, lastItem, isFirstItem, isLastItem)));\r\n          this._storeLayerNodeEventHandle(rootLayerInfo, handle[0]);\r\n          menuItem.hasBeenOpened = true;\r\n        }\r\n      }, this);\r\n    },\r\n\r\n    _onPopupMenuItemKey: function(popupMenuNode,\r\n      previousItem, nextItem, firstItem, lastItem, isFirstItem, isLastItem, e) {\r\n      //jshint unused:false\r\n      /*if(e.keyCode === keys.TAB && !e.shiftKey) {\r\n        e.stopPropagation();\r\n        if(isLastItem) {\r\n          e.preventDefault();\r\n        }\r\n        this._enableNavMode(e);\r\n      } else if(e.keyCode === keys.TAB && e.shiftKey) {\r\n        e.stopPropagation();\r\n        if(isFirstItem) {\r\n          e.preventDefault();\r\n        }\r\n        this._enableNavMode(e);\r\n      } else */\r\n      if(e.keyCode === keys.DOWN_ARROW) {\r\n        e.stopPropagation();\r\n        e.preventDefault();\r\n        if(nextItem) {\r\n          focusUtil.focus(nextItem);\r\n        }\r\n      } else if(e.keyCode === keys.UP_ARROW) {\r\n        e.stopPropagation();\r\n        e.preventDefault();\r\n        if(previousItem) {\r\n          focusUtil.focus(previousItem);\r\n        }\r\n      } else if(e.keyCode === keys.HOME) {\r\n        e.stopPropagation();\r\n        e.preventDefault();\r\n        if(firstItem) {\r\n          focusUtil.focus(firstItem);\r\n        }\r\n      } else if(e.keyCode === keys.END) {\r\n        e.stopPropagation();\r\n        e.preventDefault();\r\n        if(lastItem) {\r\n          focusUtil.focus(lastItem);\r\n        }\r\n      } else if(e.keyCode === keys.ESCAPE || e.keyCode === keys.TAB) {\r\n        e.stopPropagation();\r\n        e.preventDefault();\r\n        focusUtil.focus(popupMenuNode);\r\n        popupMenuNode.popupMenu.closeDropMenu();\r\n      }\r\n    },\r\n\r\n    _enableNavMode:function(evt) {\r\n      if(evt.keyCode === keys.TAB && !jimuUtils.isInNavMode()){\r\n        html.addClass(document.body, 'jimu-nav-mode');\r\n      }\r\n    },\r\n\r\n    _onLayerListOperationsKey: function(e) {\r\n      if(e.keyCode === keys.ENTER) {\r\n        /*\r\n        if(this.operationsDropMenu.state === \"opened\") {\r\n          html.setAttr(this.layerListOperations, 'aria-expanded', 'true');\r\n        } else {\r\n          html.setAttr(this.layerListOperations, 'aria-expanded', 'false');\r\n        }\r\n        */\r\n        this.operationsDropMenu._onBtnClick(e);\r\n      }\r\n    },\r\n\r\n    _onOperationsDropMenuOpen: function() {\r\n      var menuItems = query('.menu-item', this.operationsDropMenu.domNode);\r\n      menuItems = menuItems.filter(function(menuItem) {\r\n        if(html.hasClass(menuItem, 'menu-item-hidden')) {\r\n          return false;\r\n        } else {\r\n          return true;\r\n        }\r\n      });\r\n      var firstItem = menuItems[0], lastItem = menuItems[menuItems.length - 1];\r\n      menuItems.forEach(function(menuItem, index) {\r\n        var isFirstItem = false, isLastItem = false;\r\n        var previousItem = menuItems[index - 1], nextItem = menuItems[index + 1];\r\n        if(index === 0) {\r\n          focusUtil.focus(menuItem);\r\n          isFirstItem = true;\r\n        } else if(index === menuItems.length - 1) {\r\n          isLastItem = true;\r\n        }\r\n\r\n        if(!menuItem.hasBeenOpened) {\r\n          this.own(on(menuItem, 'keydown',\r\n            lang.hitch(this, this._onLayerListOperationsMenuItemKey,\r\n              previousItem, nextItem, firstItem, lastItem, isFirstItem, isLastItem)));\r\n          menuItem.hasBeenOpened = true;\r\n        }\r\n      }, this);\r\n    },\r\n\r\n    _onLayerListOperationsMenuItemKey: function(previousItem,\r\n      nextItem, firstItem, lastItem, isFirstItem, isLastItem, e) {\r\n      //jshint unused:false\r\n      /*\r\n      if(e.keyCode === keys.TAB && !e.shiftKey) {\r\n        e.stopPropagation();\r\n        if(isLastItem) {\r\n          e.preventDefault();\r\n        }\r\n        this._enableNavMode(e);\r\n      } else if(e.keyCode === keys.TAB && e.shiftKey) {\r\n        e.stopPropagation();\r\n        if(isFirstItem) {\r\n          e.preventDefault();\r\n        }\r\n        this._enableNavMode(e);\r\n      } else */\r\n      if(e.keyCode === keys.DOWN_ARROW) {\r\n        e.stopPropagation();\r\n        e.preventDefault();\r\n        if(nextItem) {\r\n          focusUtil.focus(nextItem);\r\n        }/*else {\r\n          focusUtil.focus(firstItem);\r\n        }*/\r\n      } else if(e.keyCode === keys.UP_ARROW) {\r\n        e.stopPropagation();\r\n        e.preventDefault();\r\n        if(previousItem) {\r\n          focusUtil.focus(previousItem);\r\n        }/*else {\r\n          focusUtil.focus(lastItem);\r\n        }*/\r\n      } else if(e.keyCode === keys.HOME) {\r\n        e.stopPropagation();\r\n        e.preventDefault();\r\n        if(firstItem) {\r\n          focusUtil.focus(firstItem);\r\n        }\r\n      } else if(e.keyCode === keys.END) {\r\n        e.stopPropagation();\r\n        e.preventDefault();\r\n        if(lastItem) {\r\n          focusUtil.focus(lastItem);\r\n        }\r\n      } else if(e.keyCode === keys.ESCAPE || e.keyCode === keys.TAB) {\r\n        e.stopPropagation();\r\n        e.preventDefault();\r\n        focusUtil.focus(this.layerListOperations);\r\n        this.operationsDropMenu.closeDropMenu();\r\n      }\r\n    }\r\n  });\r\n});\r\n"]}