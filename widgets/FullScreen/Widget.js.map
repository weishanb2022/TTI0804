{"version":3,"sources":["../../../widgets/FullScreen/Widget.js"],"names":["define","declare","lang","html","on","query","BaseWidget","win","jimuUtils","a11y","clazz","name","baseClass","domsCache","appDoc","ACTION","HIDE","SHOW","MODE","RESTORE","MAXIMIZE","state","_changeColorThemes","startup","a11y_updateLabel","nls","_widgetLabel","doc","addClass","fullScreenBtn","themeName","appConfig","theme","indexOf","domNode","own","hitch","_onFullScreenChangeEvent","a11y_initEvents","setPosition","inherited","arguments","window","getAppConfig","appInfo","isRunInMobile","setStyle","placeAt","_getDBThemeContainer","isMobileUa","removeClass","onAppConfigChanged","_onFullScreenClick","evt","stopPropagation","_toggleFullScreen","_isFullScreen","_toggleBtnIcon","mode","_cancelFullScreen","_launchFullScreen","body","isFullScreen","_isElementFullScreen","isInConfigOrPreviewWindow","_isFullScreenCountByJS","_getBuilderWindow","parent","layoutContainer","Math","floor","innerWidth","screen","width","innerHeight","height","element","fullscreenElement","mozFullScreenElement","webkitFullscreenElement","msFullscreenElement","requestFullScreen","mozRequestFullScreen","webkitRequestFullScreen","msRequestFullscreen","fullscreen","exitFullscreen","mozCancelFullScreen","webkitCancelFullScreen","msExitFullscreen","extend"],"mappings":"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","file":"Widget.js","sourcesContent":["///////////////////////////////////////////////////////////////////////////\r\n// Copyright Â© Esri. All Rights Reserved.\r\n//\r\n// Licensed under the Apache License Version 2.0 (the \"License\");\r\n// you may not use this file except in compliance with the License.\r\n// You may obtain a copy of the License at\r\n//\r\n//    http://www.apache.org/licenses/LICENSE-2.0\r\n//\r\n// Unless required by applicable law or agreed to in writing, software\r\n// distributed under the License is distributed on an \"AS IS\" BASIS,\r\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n// See the License for the specific language governing permissions and\r\n// limitations under the License.\r\n///////////////////////////////////////////////////////////////////////////\r\n\r\ndefine([\r\n  'dojo/_base/declare',\r\n  'dojo/_base/lang',\r\n  'dojo/_base/html',\r\n  'dojo/on',\r\n  \"dojo/query\",\r\n  'jimu/BaseWidget',\r\n  \"dojo/_base/window\",\r\n  'jimu/utils',\r\n  \"./a11y/Widget\"\r\n], function (declare, lang, html, on, query, BaseWidget, win, jimuUtils, a11y) {\r\n  var clazz = declare([BaseWidget], {\r\n    name: 'FullScreen',\r\n    baseClass: 'jimu-widget-fullScreen',\r\n    domsCache: {\r\n      appDoc: null\r\n    },\r\n    ACTION: {\r\n      HIDE: \"hide\",\r\n      SHOW: \"show\"\r\n    },\r\n    MODE: {\r\n      RESTORE: \"restore\",\r\n      MAXIMIZE: \"maximize\"\r\n    },\r\n    state: null,\r\n    _changeColorThemes: [\"BillboardTheme\", \"BoxTheme\", \"DartTheme\", \"PlateauTheme\"],\r\n\r\n    startup: function () {\r\n      this.a11y_updateLabel(this.nls._widgetLabel);\r\n\r\n      this.domsCache.appDoc = win.doc;\r\n\r\n      this.state = this.MODE.RESTORE;\r\n      //init btn style\r\n      html.addClass(this.fullScreenBtn, this.state);\r\n      //need change color in those Themes\r\n      var themeName = this.appConfig.theme.name;\r\n      if (this._changeColorThemes.indexOf(themeName) > -1) {\r\n        html.addClass(this.domNode, \"jimu-main-background\");\r\n      }\r\n\r\n      //click btn fullscreened, and then press F11 restore. At that time must handle event manually.\r\n      this.own(on(this.domsCache.appDoc,\r\n        'webkitfullscreenchange,mozfullscreenchange,MSFullscreenChange,fullscreenchange',\r\n        lang.hitch(this, function () {\r\n          this._onFullScreenChangeEvent();\r\n        })));\r\n      //js test when press F11 btn\r\n      // this.own(on(this.map, 'resize', lang.hitch(this, function () {\r\n      //   setTimeout(lang.hitch(this, function () {\r\n      //     if (jimuUtils.isInConfigOrPreviewWindow()) {\r\n      //       //F11 do nothing in builder here\r\n      //     } else {\r\n      //       this._onFullScreenChangeEvent();\r\n      //     }\r\n      //   }), 400);\r\n      // })));\r\n      this.a11y_initEvents();\r\n    },\r\n\r\n    setPosition: function (/*position*/) {\r\n      this.inherited(arguments);\r\n      var appConfig = window.getAppConfig();\r\n      if (appConfig.theme.name === \"DashboardTheme\" && !window.appInfo.isRunInMobile) {\r\n        html.setStyle(this.domNode, 'z-index', 110);\r\n        this.placeAt(this._getDBThemeContainer());\r\n      }\r\n\r\n      //hide button in mobile\r\n      if (window.appInfo.isRunInMobile || jimuUtils.isMobileUa()) {\r\n        html.addClass(this.domNode, 'mobile');\r\n      } else {\r\n        html.removeClass(this.domNode, 'mobile');\r\n      }\r\n    },\r\n\r\n    onAppConfigChanged: function (appConfig) {\r\n      //need change color in those Themes\r\n      var themeName = appConfig.theme.name;\r\n      if (this._changeColorThemes.indexOf(themeName) > -1) {\r\n        html.addClass(this.domNode, \"jimu-main-background\");\r\n      } else {\r\n        html.removeClass(this.domNode, \"jimu-main-background\");\r\n      }\r\n    },\r\n\r\n    _onFullScreenClick: function (evt) {\r\n      if(evt && evt.stopPropagation){\r\n        evt.stopPropagation();\r\n      }\r\n\r\n      this._toggleFullScreen();\r\n    },\r\n    _onFullScreenChangeEvent: function () {\r\n      if (!this._isFullScreen()) {\r\n        this.state = this.MODE.RESTORE;\r\n        this._toggleFullScreen(this.state);\r\n      } else {\r\n        this.state = this.MODE.MAXIMIZE;\r\n      }\r\n      this._toggleBtnIcon();\r\n    },\r\n\r\n    _toggleFullScreen: function (mode) {\r\n      if (this._isFullScreen() || mode === this.MODE.RESTORE) {\r\n        this._cancelFullScreen(this.domsCache.appDoc);\r\n      } else {\r\n        this._launchFullScreen(this.domsCache.appDoc.body);\r\n      }\r\n    },\r\n\r\n    _toggleBtnIcon: function () {\r\n      if (this.state === this.MODE.RESTORE) {\r\n        html.addClass(this.fullScreenBtn, \"restore\");\r\n        html.removeClass(this.fullScreenBtn, \"maximize\");\r\n        html.removeClass(this.domsCache.appDoc.body, \"body-fullscreened\");\r\n        //html.removeClass(this.fullScreenBtn, \"f11\");\r\n      } else {\r\n        html.addClass(this.fullScreenBtn, \"maximize\");\r\n        html.removeClass(this.fullScreenBtn, \"restore\");\r\n        html.addClass(this.domsCache.appDoc.body, \"body-fullscreened\");\r\n      }\r\n    },\r\n\r\n    _isFullScreen: function () {\r\n      var isFullScreen = this._isElementFullScreen(this.domsCache.appDoc);\r\n      /*test F11: isFullScreen = isFullScreen || this._isFullScreenCountByJS(window);*/\r\n      if (jimuUtils.isInConfigOrPreviewWindow()) {\r\n        //under builder mode\r\n        if (false === this._isFullScreenCountByJS(window) &&\r\n          true === this._isFullScreenCountByJS(this._getBuilderWindow())) {\r\n          isFullScreen = false;//after press F11 in builder, NOT really fullscreen the map\r\n        }\r\n      }/* else {\r\n        //launch mode\r\n        // if (this.MODE.RESTORE === this.state && true === this._isFullScreenCountByJS(window)) {\r\n        //   html.addClass(this.fullScreenBtn, \"f11\");//fullscreened by press f11, can't \"restore\" window by JS, so mark it\r\n        // }\r\n      }*/\r\n      return isFullScreen;\r\n    },\r\n    _getBuilderWindow: function () {\r\n      //window obj for builder\r\n      return window.parent;\r\n    },\r\n    //for dashboard theme\r\n    _getDBThemeContainer: function () {\r\n      var layoutContainer = null;\r\n      if (window.appInfo.isRunInMobile) {\r\n        layoutContainer = query(\"#main-page .DashboardTheme\")[0];\r\n      } else {\r\n        layoutContainer = query(\".jimu-dnd-layout\")[0];\r\n      }\r\n\r\n      return layoutContainer;\r\n    },\r\n    _isFullScreenCountByJS: function (win) {\r\n      //whether window full of screen\r\n      return (Math.floor(win.innerWidth) === Math.floor(screen.width) &&\r\n        Math.floor(win.innerHeight) === Math.floor(screen.height));\r\n    },\r\n    //fullscreen element is in the window.top.doc\r\n    _isElementFullScreen: function (element) {\r\n      return !(!element.fullscreenElement &&\r\n        !element.mozFullScreenElement &&\r\n        !element.webkitFullscreenElement &&\r\n        !element.msFullscreenElement);\r\n    },\r\n    //in iframe , allowfullscreen=\"true\" is necessary\r\n    _launchFullScreen: function (element) {\r\n      if (element.requestFullScreen) {\r\n        element.requestFullScreen();\r\n      } else if (element.mozRequestFullScreen) {\r\n        element.mozRequestFullScreen();\r\n      } else if (element.webkitRequestFullScreen) {\r\n        element.webkitRequestFullScreen();\r\n      } else if (element.msRequestFullscreen) {\r\n        element.msRequestFullscreen();\r\n      } else {\r\n        return false;\r\n      }\r\n    },\r\n    _cancelFullScreen: function (element) {\r\n      if (!(element.fullscreen ||\r\n        element.fullscreenElement || element.webkitFullscreenElement ||\r\n        element.mozFullScreenElement || element.msFullscreenElement)) {\r\n        return;//for chrome 71+, document.fullscreen is deprecated\r\n      }\r\n\r\n      if (element.exitFullscreen) {\r\n        element.exitFullscreen();\r\n      } else if (element.mozCancelFullScreen) {\r\n        element.mozCancelFullScreen();\r\n      } else if (element.webkitCancelFullScreen) {\r\n        element.webkitCancelFullScreen();\r\n      } else if (element.msExitFullscreen) {\r\n        element.msExitFullscreen();\r\n      } else {\r\n        return false;\r\n      }\r\n    }\r\n  });\r\n\r\n  clazz.extend(a11y);//for a11y\r\n  return clazz;\r\n});"]}