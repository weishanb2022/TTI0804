{"version":3,"sources":["../../../../widgets/Chart/setting/DataFields.js"],"names":["define","declare","lang","array","html","query","on","_WidgetBase","_TemplatedMixin","Evented","template","jimuUtils","baseClass","templateString","postCreate","inherited","arguments","own","domNode","hitch","_onDomClicked","clear","empty","fieldsContent","emit","setFields","fields","forEach","item","str","fieldItemDom","toDom","cbx","span","checked","innerHTML","sanitizeHTML","alias","name","title","fieldName","place","selectFields","fieldNames","isArrayLike","names","clone","reverse","_getFieldItemDivByName","parentNode","getSelectedFieldNames","fieldItemDivs","push","divs","fieldItemDoms","filter","div","event","target","srcElement","isDescendant","tagName","toLowerCase","hasClass","_selectFieldItemDom","removeClass","_updateHighLightIcons","_getSelectedFieldItemDiv","highLightClass","previousSibling","addClass","btnUp","nextSibling","btnDown","length","_moveUp","_moveDown"],"mappings":"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","file":"DataFields.js","sourcesContent":["///////////////////////////////////////////////////////////////////////////\r\n// Copyright Â© Esri. All Rights Reserved.\r\n//\r\n// Licensed under the Apache License Version 2.0 (the \"License\");\r\n// you may not use this file except in compliance with the License.\r\n// You may obtain a copy of the License at\r\n//\r\n//    http://www.apache.org/licenses/LICENSE-2.0\r\n//\r\n// Unless required by applicable law or agreed to in writing, software\r\n// distributed under the License is distributed on an \"AS IS\" BASIS,\r\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n// See the License for the specific language governing permissions and\r\n// limitations under the License.\r\n///////////////////////////////////////////////////////////////////////////\r\n\r\ndefine([\r\n  'dojo/_base/declare',\r\n  'dojo/_base/lang',\r\n  'dojo/_base/array',\r\n  'dojo/_base/html',\r\n  'dojo/_base/query',\r\n  'dojo/on',\r\n  'dijit/_WidgetBase',\r\n  'dijit/_TemplatedMixin',\r\n  'dojo/Evented',\r\n  'dojo/text!./DataFields.html',\r\n  'jimu/utils'\r\n],\r\nfunction(declare, lang, array, html, query, on, _WidgetBase, _TemplatedMixin, Evented, template, jimuUtils) {\r\n  return declare([_WidgetBase, Evented, _TemplatedMixin], {\r\n    baseClass: 'jimu-widget-chart-setting-data-fields',\r\n    templateString: template,\r\n\r\n    //public methods:\r\n    //clear\r\n    //setFields\r\n    //selectFields\r\n    //getSelectedFieldNames\r\n\r\n    postCreate: function(){\r\n      this.inherited(arguments);\r\n      this.own(on(this.domNode, 'click', lang.hitch(this, this._onDomClicked)));\r\n    },\r\n\r\n    clear: function(){\r\n      html.empty(this.fieldsContent);\r\n      this.emit('change');\r\n    },\r\n\r\n    setFields: function(fields){\r\n      //[{name,alias,checked}]\r\n      this.clear();\r\n      array.forEach(fields, lang.hitch(this, function(item){\r\n        var str = '<div class=\"field-item\"><input type=\"checkbox\" /><span class=\"jimu-ellipsis\" /></div>';\r\n        var fieldItemDom = html.toDom(str);\r\n        var cbx = query('input', fieldItemDom)[0];\r\n        var span = query('span', fieldItemDom)[0];\r\n        cbx.checked = !!item.checked;\r\n        span.innerHTML = jimuUtils.sanitizeHTML(item.alias || item.name);\r\n        span.title = item.alias || item.name;\r\n        fieldItemDom.fieldName = item.name;\r\n        html.place(fieldItemDom, this.fieldsContent);\r\n        this.own(on(cbx, 'change', lang.hitch(this, function(){\r\n          this.emit('change');\r\n        })));\r\n      }));\r\n      this.emit('change');\r\n    },\r\n\r\n    selectFields: function(fieldNames) {\r\n      if (lang.isArrayLike(fieldNames)) {\r\n        var names = lang.clone(fieldNames);\r\n        names.reverse();\r\n        array.forEach(names, lang.hitch(this, function(name) {\r\n          var fieldItemDom = this._getFieldItemDivByName(name);\r\n          if (fieldItemDom) {\r\n            html.place(fieldItemDom, fieldItemDom.parentNode, 'first');\r\n            var cbx = query('input', fieldItemDom)[0];\r\n            cbx.checked = true;\r\n          }\r\n        }));\r\n      }\r\n      this.emit('change');\r\n    },\r\n\r\n    getSelectedFieldNames: function(){\r\n      var fieldItemDivs = query('.field-item', this.fieldsContent);\r\n      var fieldNames = [];\r\n      array.forEach(fieldItemDivs, lang.hitch(this, function(fieldItemDom){\r\n        var cbx = query('input', fieldItemDom)[0];\r\n        if(cbx.checked){\r\n          fieldNames.push(fieldItemDom.fieldName);\r\n        }\r\n      }));\r\n      return fieldNames;\r\n    },\r\n\r\n    _getFieldItemDivByName: function(name){\r\n      var divs = query('.field-item', this.fieldsContent);\r\n      var fieldItemDoms = array.filter(divs, lang.hitch(this, function(div){\r\n        return div.fieldName === name;\r\n      }));\r\n      return fieldItemDoms[0];\r\n    },\r\n\r\n    _onDomClicked: function(event){\r\n      var target = event.target || event.srcElement;\r\n      if(html.isDescendant(target, this.fieldsContent) && target !== this.fieldsContent){\r\n        var tagName = target.tagName.toLowerCase();\r\n        var fieldItemDom = null;\r\n        if(html.hasClass(target, 'field-item')){\r\n          fieldItemDom = target;\r\n          this._selectFieldItemDom(fieldItemDom);\r\n        }\r\n        else if(tagName === 'span'){\r\n          fieldItemDom = target.parentNode;\r\n          this._selectFieldItemDom(fieldItemDom);\r\n        }\r\n        else if(tagName === 'input'){\r\n          fieldItemDom = target.parentNode;\r\n          if(target.checked){\r\n            this._selectFieldItemDom(fieldItemDom);\r\n          }\r\n          else{\r\n            html.removeClass(fieldItemDom, 'selected');\r\n          }\r\n        }\r\n\r\n        this._updateHighLightIcons();\r\n      }\r\n    },\r\n\r\n    _updateHighLightIcons: function() {\r\n      var fieldItemDom = this._getSelectedFieldItemDiv();\r\n\r\n      if (fieldItemDom && html.hasClass(fieldItemDom, 'selected')) {\r\n        var highLightClass = 'high-light';\r\n\r\n        if (fieldItemDom.previousSibling) {\r\n          html.addClass(this.btnUp, highLightClass);\r\n        } else {\r\n          html.removeClass(this.btnUp, highLightClass);\r\n        }\r\n\r\n        if (fieldItemDom.nextSibling) {\r\n          html.addClass(this.btnDown, highLightClass);\r\n        } else {\r\n          html.removeClass(this.btnDown, highLightClass);\r\n        }\r\n      }\r\n    },\r\n\r\n    _selectFieldItemDom: function(fieldItemDom){\r\n      query('.field-item', this.fieldsContent).removeClass('selected');\r\n      html.addClass(fieldItemDom, 'selected');\r\n    },\r\n\r\n    _getSelectedFieldItemDiv: function(){\r\n      var fieldItemDom = null;\r\n      var divs = query('.field-item.selected', this.fieldsContent);\r\n      if(divs.length > 0){\r\n        fieldItemDom = divs[0];\r\n      }\r\n      return fieldItemDom;\r\n    },\r\n\r\n    _moveUp: function(){\r\n      var fieldItemDom = this._getSelectedFieldItemDiv();\r\n      if(fieldItemDom && fieldItemDom.previousSibling){\r\n        html.place(fieldItemDom, fieldItemDom.previousSibling, 'before');\r\n      }\r\n      this._updateHighLightIcons();\r\n    },\r\n\r\n    _moveDown: function(){\r\n      var fieldItemDom = this._getSelectedFieldItemDiv();\r\n      if(fieldItemDom && fieldItemDom.nextSibling){\r\n        html.place(fieldItemDom, fieldItemDom.nextSibling, 'after');\r\n      }\r\n      this._updateHighLightIcons();\r\n    }\r\n  });\r\n});"]}