{"version":3,"sources":["../../../../widgets/Chart/setting/SingleChartSetting.js"],"names":["define","declare","lang","array","html","query","Color","on","Evented","Deferred","_WidgetBase","_TemplatedMixin","_WidgetsInTemplateMixin","template","TooltipDialog","dojoPopup","jimuPopup","jimuUtils","TabContainer3","Filter","_FeaturelayerSourcePopup","Message","StatisticsChart","LayerInfos","DataFields","Sort","utils","StatisticsChartSettings","EsriQuery","QueryTask","esriSymbolJsonUtils","baseClass","templateString","mediaSelector","config","map","nls","tr","folderUrl","appConfig","_webMapLayerId","_filterParts","maxPreviewFeaturesCount","_layerDefinition","_highLightColor","_oidFieldType","_stringFieldType","_numberFieldTypes","_dateFieldType","postCreate","inherited","arguments","layerInfosObj","getInstanceSync","_initSelf","destroy","_hideAllTooltipDialogs","_destroyTooltipDialog","filter","onClose","hitch","close","name","ttd","_hideTooltipDialog","filterTooltipDialog","sortOrderTooltipDialog","_hideAllParamsTooltipDialogs","columnTTD","barTTD","lineTTD","pieTTD","tooltipDialog","isOpendNow","_showTooltipDialog","around","orient","args","popup","open","startup","_started","_updateUrlTextBoxLength","boxBtn","getMarginBox","btnSetSource","boxDescription","getContentBox","descriptionTA","width","Math","max","w","setStyle","urlTextBox","domNode","e","console","error","setConfig","_isObject","url","validUrl","layerId","webMapLayerId","_resetByConfig","showBigShelter","getLayerDefinitionByLayerIdOrUrl","then","definition","hideBigShelter","bind","err","getConfig","showError","description","symbol","mode","highLightColor","types","get","toJson","expr","tab","viewStack","getSelectedLabel","preview","_showMessage","setFilterTip","chartName","chartNameTextBox","stripHTML","setChartTitleTip","value","chartModeSelect","columnCbx","checked","push","type","display","columnParameters","pieCbx","pieParameters","barCbx","barParameters","lineCbx","lineParameters","length","setChartTypeTip","featureConfig","labelField","valueFields","sortOrder","featureAxisLabelSelect","featureDataFields","getSelectedFieldNames","setDataFieldTip","_getSortOrder","mixin","categoryConfig","categoryField","operation","categoryFieldSelect","categoryOperationSelect","categoryDataFields","countConfig","fieldConfig","fieldOperationSelect","fieldDataFields","clone","symbolPicker","getSymbol","color","colorPicker","getColor","toHex","emit","sortDijit","msg","message","o","_initCheckBox","_initTabs","_initChartTypes","_initFilter","_initSortOrder","_initDataFields","_initPreview","_updateUIByMode","setLabel","column","pie","bar","line","tabSettings","title","settings","content","settingsTabNode","tabPreview","previewTabNode","tabs","placeAt","tabDiv","own","_updatePreview","str","ttdContent","toDom","filterDiv","btnOk","btnCancel","innerHTML","ok","window","isRTL","style","marginLeft","marginRight","hasTitle","enableMoveable","autoHeight","hiddenAfterInit","resetFilter","_hideJimuPopup","buttons","autoSwitchMode","runtime","allExpsBox","maxHeight","overflowY","filterIcon","show","resize","hide","SortDiv","dataFieldsDiv","_updateChartTypes","_updateSortFields","_updateParametersDijit","fields","showSingleColor","showMultiColor","_updateChartModeOfChartParamters","setStatus","chartMode","setValue","imagesUrl","isInWidget","singleColor","_createParametersDialog","columnEdit","pieEdit","barEdit","lineEdit","document","body","event","target","srcElement","_unselectEditDivs","checkNode","checkbox","editDiv","hasClass","preNode","previousElementSibling","isCheckBox","isEditDiv","_showEditDiv","addClass","_hideEditDiv","a","b","isDescendant","isClickInternal","cbx","parametersDijit","create","removeClass","isBigPreview","showSettingIcon","showZoomIcon","zoomToFeaturesWhenClick","previewDiv","className","trs","detailsTable","forEach","reset","_onChartModeChanged","ignoreChangeEvents","setFieldOptions","sortFieldOptions","_generateSortFieldOption","field","alias","getAliasByFieldName","label","_updateLegendDisplayByMode","_onChartNameBlurred","set","_onChartNameChanged","_onDescriptionBlurred","_clear","removeOption","getOptions","clear","setColor","_onBtnSetClicked","titleLabel","setDataSource","dijitArgs","multiple","createMapResponse","webMapResponse","portalUrl","height","featurePopup","item","layerSourceType","getSelectedRadioType","layerInfo","id","setNewLayerDefinition","_hasNumberFields","layerDefinition","result","fieldInfos","some","fieldInfo","indexOf","layerSourceItem","sourceType","oldUrl","_resetByNewLayerDefinition","sourceItem","_addAliasForLayerInfo","options","featureLayerId","partsObj","build","_resetFieldsDijitsByLayerInfo","geoType","getTypeByGeometryType","geometryType","symType","showByType","addOption","featureOption","categoryOption","countOption","fieldOption","displayField","categoryFieldTypes","concat","availableCategoryFieldInfos","selectedCategoryFieldValue","option","c","featureLabelFieldTypes","availableLabelFieldInfos","selectedAxisLabelValue","numberFieldInfos","setFields","_ignoreEvent","_careEvent","setTimeout","cfg","setPieConfig","pieDisplayConfig","_getChartTypeDisplayConfig","selectFields","columnDisplayConfig","barDisplayConfig","lineDisplayConfig","fromJson","showBySymbol","widgetConfig","chartType","i","queryParams","returnGeometry","where","outFields","showShelter","_queryFeatures","features","box","parentNode","h","slice","createClientCharts","hideShelter","def","queryTask","execute","featureSet","resolve","code","queryTask2","featureSet2","err2","reject"],"mappings":"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","file":"SingleChartSetting.js","sourcesContent":["///////////////////////////////////////////////////////////////////////////\r\n// Copyright Â© Esri. All Rights Reserved.\r\n//\r\n// Licensed under the Apache License Version 2.0 (the \"License\");\r\n// you may not use this file except in compliance with the License.\r\n// You may obtain a copy of the License at\r\n//\r\n//    http://www.apache.org/licenses/LICENSE-2.0\r\n//\r\n// Unless required by applicable law or agreed to in writing, software\r\n// distributed under the License is distributed on an \"AS IS\" BASIS,\r\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n// See the License for the specific language governing permissions and\r\n// limitations under the License.\r\n///////////////////////////////////////////////////////////////////////////\r\n\r\ndefine([\r\n  'dojo/_base/declare',\r\n  'dojo/_base/lang',\r\n  'dojo/_base/array',\r\n  'dojo/_base/html',\r\n  'dojo/_base/query',\r\n  'dojo/_base/Color',\r\n  'dojo/on',\r\n  'dojo/Evented',\r\n  'dojo/Deferred',\r\n  'dijit/_WidgetBase',\r\n  'dijit/_TemplatedMixin',\r\n  'dijit/_WidgetsInTemplateMixin',\r\n  'dojo/text!./SingleChartSetting.html',\r\n  'dijit/TooltipDialog',\r\n  'dijit/popup',\r\n  'jimu/dijit/Popup',\r\n  'jimu/utils',\r\n  'jimu/dijit/TabContainer3',\r\n  'jimu/dijit/Filter',\r\n  'jimu/dijit/_FeaturelayerSourcePopup',\r\n  'jimu/dijit/Message',\r\n  'jimu/dijit/StatisticsChart',\r\n  'jimu/LayerInfos/LayerInfos',\r\n  './DataFields',\r\n  './Sort',\r\n  './utils',\r\n  'jimu/dijit/_StatisticsChartSettings',\r\n  'esri/tasks/query',\r\n  'esri/tasks/QueryTask',\r\n  'esri/symbols/jsonUtils',\r\n  'dijit/Tooltip',\r\n  'dijit/form/Select',\r\n  'dijit/form/ValidationTextBox',\r\n  'jimu/dijit/SymbolPicker',\r\n  'jimu/dijit/SimpleTable',\r\n  'jimu/dijit/LoadingIndicator',\r\n  'jimu/dijit/CheckBox'\r\n],\r\nfunction(declare, lang, array, html, query, Color, on, Evented, Deferred, _WidgetBase, _TemplatedMixin,\r\n  _WidgetsInTemplateMixin, template, TooltipDialog, dojoPopup, jimuPopup, jimuUtils, TabContainer3, Filter,\r\n  _FeaturelayerSourcePopup, Message, StatisticsChart, LayerInfos, DataFields, Sort, utils, StatisticsChartSettings,\r\n  EsriQuery, QueryTask, esriSymbolJsonUtils) {\r\n\r\n  return declare([_WidgetBase, Evented, _TemplatedMixin, _WidgetsInTemplateMixin], {\r\n    baseClass: 'jimu-widget-singlechart-setting',\r\n    templateString: template,\r\n    mediaSelector: null,\r\n\r\n    //options\r\n    config: null,\r\n    map: null,\r\n    nls: null,\r\n    tr: null,\r\n    folderUrl: '',\r\n    appConfig: null,\r\n    _webMapLayerId: null,//the layerId in web map, maybe null\r\n    _filterParts: null,//generated by Filter.toJson()\r\n\r\n    //public methods:\r\n    //setConfig\r\n    //getConfig\r\n    //setNewLayerDefinition\r\n\r\n    maxPreviewFeaturesCount: 50,\r\n\r\n    _layerDefinition: null,\r\n\r\n    _highLightColor: '#ff0000',\r\n\r\n    _oidFieldType: 'esriFieldTypeOID',\r\n\r\n    _stringFieldType: 'esriFieldTypeString',\r\n\r\n    _numberFieldTypes: ['esriFieldTypeSmallInteger',\r\n                        'esriFieldTypeInteger',\r\n                        'esriFieldTypeSingle',\r\n                        'esriFieldTypeDouble'],\r\n\r\n    _dateFieldType: 'esriFieldTypeDate',\r\n\r\n    postCreate: function(){\r\n      this.inherited(arguments);\r\n      utils.layerInfosObj = LayerInfos.getInstanceSync();\r\n      this._initSelf();\r\n    },\r\n\r\n    destroy: function(){\r\n      this.tr = null;\r\n      delete this.tr;\r\n      //destroy TooltipDialog\r\n      this._hideAllTooltipDialogs();\r\n      this._destroyTooltipDialog('filterTooltipDialog');\r\n      this._destroyTooltipDialog('sortOrderTooltipDialog');\r\n      this._destroyTooltipDialog('columnTTD');\r\n      this._destroyTooltipDialog('barTTD');\r\n      this._destroyTooltipDialog('lineTTD');\r\n      this._destroyTooltipDialog('pieTTD');\r\n\r\n      if(this.filter){\r\n        this.filter.destroy();\r\n      }\r\n      if (this.jimuPopup) {\r\n        this.jimuPopup.onClose = lang.hitch(this, function() {\r\n          return true;\r\n        });\r\n        this.jimuPopup.close();\r\n      }\r\n      this.inherited(arguments);\r\n    },\r\n\r\n    _destroyTooltipDialog: function(name){\r\n      var ttd = this[name];\r\n      if(ttd){\r\n        this._hideTooltipDialog(ttd);\r\n        ttd.destroy();\r\n      }\r\n      ttd = null;\r\n      this[name] = null;\r\n    },\r\n\r\n    _hideAllTooltipDialogs: function(){\r\n      this._hideTooltipDialog(this.filterTooltipDialog);\r\n      this._hideTooltipDialog(this.sortOrderTooltipDialog);\r\n      this._hideAllParamsTooltipDialogs();\r\n    },\r\n\r\n    _hideAllParamsTooltipDialogs: function(){\r\n      if(this.columnTTD){\r\n        this._hideTooltipDialog(this.columnTTD);\r\n      }\r\n      if(this.barTTD){\r\n        this._hideTooltipDialog(this.barTTD);\r\n      }\r\n      if(this.lineTTD){\r\n        this._hideTooltipDialog(this.lineTTD);\r\n      }\r\n      if(this.pieTTD){\r\n        this._hideTooltipDialog(this.pieTTD);\r\n      }\r\n    },\r\n\r\n    _hideTooltipDialog: function(tooltipDialog){\r\n      if(tooltipDialog){\r\n        dojoPopup.close(tooltipDialog);\r\n        tooltipDialog.isOpendNow = false;\r\n      }\r\n    },\r\n\r\n    _showTooltipDialog: function(tooltipDialog, around, /* optional */ orient){\r\n      if(tooltipDialog){\r\n        var args = {\r\n          popup: tooltipDialog,\r\n          around: around\r\n        };\r\n        if(orient){\r\n          args.orient = orient;\r\n        }\r\n        dojoPopup.open(args);\r\n        tooltipDialog.isOpendNow = true;\r\n      }\r\n    },\r\n\r\n    startup: function(){\r\n      if(!this._started){\r\n        this.inherited(arguments);\r\n        // setTimeout(lang.hitch(this, function(){\r\n        //   this._updateUrlTextBoxLength();\r\n        // }), 200);\r\n      }\r\n      this._started = true;\r\n    },\r\n\r\n    _updateUrlTextBoxLength: function(){\r\n      try{\r\n        var boxBtn = html.getMarginBox(this.btnSetSource);\r\n        var boxDescription = html.getContentBox(this.descriptionTA);\r\n        var width = Math.max(boxDescription.w - boxBtn.w - 10, 380);\r\n        html.setStyle(this.urlTextBox.domNode, 'width', width + 'px');\r\n      }\r\n      catch(e){\r\n        console.error(e);\r\n      }\r\n    },\r\n\r\n    setConfig: function(config){\r\n      if(!this._isObject(config)){\r\n        return;\r\n      }\r\n\r\n      this.config = config;\r\n      this._filterParts = config.filter;\r\n\r\n      var url = config.url || '';\r\n      var validUrl = url && typeof url === 'string';\r\n      if(!validUrl){\r\n        return;\r\n      }\r\n      var layerId = config.webMapLayerId;\r\n\r\n      if (this._layerDefinition && this._layerDefinition.url === url) {\r\n        this._resetByConfig(this.config, this._layerDefinition);\r\n      } else {\r\n        this._layerDefinition = null;\r\n        this.showBigShelter();\r\n        utils.getLayerDefinitionByLayerIdOrUrl(layerId, url).then(function(definition) {\r\n          if (!this.domNode) {\r\n            return;\r\n          }\r\n          this.hideBigShelter();\r\n          this._layerDefinition = definition;\r\n          this._layerDefinition.url = url;\r\n          this._resetByConfig(this.config, this._layerDefinition);\r\n        }.bind(this), function(err) {\r\n          console.error(err);\r\n          if (!this.domNode) {\r\n            return;\r\n          }\r\n          this.hideBigShelter();\r\n        }.bind(this));\r\n      }\r\n    },\r\n\r\n    getConfig: function(showError){\r\n      var config = {\r\n        url: '',\r\n        filter: '',\r\n        description: '',\r\n        symbol: '',\r\n        webMapLayerId: this._webMapLayerId,\r\n\r\n        mode:'',\r\n        name: '',\r\n        highLightColor: '',\r\n        types: []//{type,display}\r\n      };\r\n\r\n      config.url = this.urlTextBox.get('value');\r\n\r\n      var filter = this.filter.toJson();\r\n      var expr = filter && filter.expr;\r\n      if(!expr){\r\n        if(showError){\r\n          if(this.tab.viewStack.getSelectedLabel() !== this.nls.preview){\r\n            this._showTooltipDialog(this.filterTooltipDialog, this.urlTextBox.domNode);\r\n          }\r\n          this._showMessage(this.nls.setFilterTip);\r\n        }\r\n        return false;\r\n      }\r\n      config.filter = filter;\r\n\r\n      var chartName = this.chartNameTextBox.get('value');\r\n      chartName = jimuUtils.stripHTML(chartName);\r\n      if(!chartName){\r\n        if(showError){\r\n          this._showMessage(this.nls.setChartTitleTip);\r\n        }\r\n        return false;\r\n      }\r\n      config.name = chartName;\r\n\r\n      config.description = jimuUtils.stripHTML(this.descriptionTA.value);\r\n\r\n      config.mode = this.chartModeSelect.get('value');\r\n\r\n      if(this.columnCbx.checked){\r\n        config.types.push({\r\n          type: 'column',\r\n          display: this.columnParameters.getConfig()\r\n        });\r\n      }\r\n\r\n      if(this.pieCbx.checked){\r\n        config.types.push({\r\n          type: 'pie',\r\n          display: this.pieParameters.getConfig()\r\n        });\r\n      }\r\n\r\n      if(this.barCbx.checked){\r\n        config.types.push({\r\n          type: 'bar',\r\n          display: this.barParameters.getConfig()\r\n        });\r\n      }\r\n\r\n      if(this.lineCbx.checked){\r\n        config.types.push({\r\n          type: 'line',\r\n          display: this.lineParameters.getConfig()\r\n        });\r\n      }\r\n\r\n      if(config.types.length === 0 && showError){\r\n        this._showMessage(this.nls.setChartTypeTip);\r\n        return false;\r\n      }\r\n\r\n      if(config.mode === 'feature'){\r\n        var featureConfig = {\r\n          labelField: '',\r\n          valueFields: [],\r\n          sortOrder: {}\r\n        };\r\n\r\n        featureConfig.labelField = this.featureAxisLabelSelect.get('value');\r\n\r\n        var featureDataFields = this.valueFields.getSelectedFieldNames();\r\n        if(featureDataFields.length === 0){\r\n          if(showError){\r\n            this._showMessage(this.nls.setDataFieldTip);\r\n          }\r\n          return false;\r\n        }\r\n        featureConfig.valueFields = featureDataFields;\r\n        //sort order\r\n        featureConfig.sortOrder = this._getSortOrder();\r\n\r\n        config = lang.mixin(config, featureConfig);\r\n      }else if(config.mode === 'category'){\r\n        var categoryConfig = {\r\n          categoryField: '',\r\n          operation: '',\r\n          valueFields: [],\r\n          sortOrder: {}\r\n        };\r\n\r\n        categoryConfig.categoryField = this.categoryFieldSelect.get('value');//check if none\r\n\r\n        categoryConfig.operation = this.categoryOperationSelect.get('value');\r\n\r\n        var categoryDataFields = this.valueFields.getSelectedFieldNames();\r\n        if(categoryDataFields.length === 0){\r\n          if(showError){\r\n            this._showMessage(this.nls.setDataFieldTip);\r\n          }\r\n          return false;\r\n        }\r\n        categoryConfig.valueFields = categoryDataFields;\r\n\r\n        categoryConfig.sortOrder = this._getSortOrder();\r\n\r\n        config = lang.mixin(config, categoryConfig);\r\n      }else if(config.mode === 'count'){\r\n        var countConfig = {\r\n          categoryField: '',\r\n          sortOrder: {}\r\n        };\r\n\r\n        countConfig.categoryField = this.categoryFieldSelect.get('value');\r\n\r\n        countConfig.sortOrder = this._getSortOrder();\r\n\r\n        config = lang.mixin(config, countConfig);\r\n      }else if(config.mode === 'field'){\r\n        var fieldConfig = {\r\n          operation: '',\r\n          valueFields: [],\r\n          sortOrder: {}\r\n        };\r\n\r\n        fieldConfig.operation = this.fieldOperationSelect.get('value');\r\n\r\n        var fieldDataFields = this.valueFields.getSelectedFieldNames();\r\n        if(fieldDataFields.length === 0){\r\n          if(showError){\r\n            this._showMessage(this.nls.setDataFieldTip);\r\n          }\r\n          return false;\r\n        }\r\n        fieldConfig.valueFields = fieldDataFields;\r\n        fieldConfig.sortOrder = this._getSortOrder();\r\n        config = lang.mixin(config, fieldConfig);\r\n      }\r\n\r\n      this.config = lang.clone(config);\r\n\r\n      var symbol = this.symbolPicker.getSymbol();\r\n      if(symbol){\r\n        config.symbol = symbol.toJson();\r\n      }else{\r\n        return false;\r\n      }\r\n\r\n      var color = this.colorPicker.getColor();\r\n      config.highLightColor = color.toHex();\r\n\r\n      this.tr._layerDefinition = this._layerDefinition;\r\n\r\n      return lang.clone(config);\r\n    },\r\n\r\n    showBigShelter: function(){\r\n      this.emit(\"show-shelter\");\r\n    },\r\n\r\n    _getSortOrder:function(){\r\n      return this.sortDijit.getConfig();\r\n    },\r\n\r\n    hideBigShelter: function(){\r\n      this.emit(\"hide-shelter\");\r\n    },\r\n\r\n    _showMessage: function(msg){\r\n      new Message({\r\n        message: msg\r\n      });\r\n    },\r\n\r\n    _isObject:function(o){\r\n      return o && typeof o === 'object';\r\n    },\r\n\r\n    _initSelf: function(){\r\n      this._initCheckBox();\r\n      this._initTabs();\r\n      this._initChartTypes();\r\n      this._initFilter();\r\n      this._initSortOrder();\r\n      this._initDataFields();\r\n      this._initPreview();\r\n      var mode = this.config && this.config.mode;\r\n      this._updateUIByMode(mode);\r\n    },\r\n\r\n    _initCheckBox:function(){\r\n      this.columnCbx.setLabel(this.nls.column);\r\n      this.pieCbx.setLabel(this.nls.pie);\r\n      this.barCbx.setLabel(this.nls.bar);\r\n      this.lineCbx.setLabel(this.nls.line);\r\n    },\r\n\r\n    _initTabs: function(){\r\n      var tabSettings = {\r\n        title: this.nls.settings,\r\n        content: this.settingsTabNode\r\n      };\r\n\r\n      var tabPreview = {\r\n        title: this.nls.preview,\r\n        content: this.previewTabNode\r\n      };\r\n\r\n      var tabs = [tabSettings, tabPreview];\r\n      this.tab = new TabContainer3({tabs: tabs});\r\n      this.tab.placeAt(this.tabDiv);\r\n      this.own(on(this.tab, 'tabChanged', lang.hitch(this, function(title){\r\n        this._hideAllTooltipDialogs();\r\n        if(title === tabPreview.title){\r\n          this._updatePreview();\r\n        }\r\n      })));\r\n    },\r\n\r\n    _initFilter: function(){\r\n      var str = '<div>' +\r\n        '<div class=\"filter-div\"></div>' +\r\n        '<div class=\"operations\" style=\"overflow:hidden;\">' +\r\n          '<div class=\"jimu-btn  jimu-float-trailing btn-cancel\"></div>' +\r\n          '<div class=\"jimu-btn  jimu-float-trailing btn-ok\"></div>' +\r\n        '</div>' +\r\n      '</div>';\r\n      var ttdContent = html.toDom(str);\r\n      var filterDiv = query('.filter-div', ttdContent)[0];\r\n      var btnOk = query('.btn-ok', ttdContent)[0];\r\n      var btnCancel = query('.btn-cancel', ttdContent)[0];\r\n      btnOk.innerHTML = this.nls.ok;\r\n      btnCancel.innerHTML = this.nls.close;\r\n\r\n      if(window.isRTL){\r\n        btnOk.style.marginLeft = \"20px\";\r\n      }\r\n      else{\r\n        btnOk.style.marginRight = \"20px\";\r\n      }\r\n\r\n      this.jimuPopup = new jimuPopup({\r\n        width: 700,\r\n        content: ttdContent,\r\n        hasTitle: false,\r\n        enableMoveable: false,\r\n        autoHeight: true,\r\n        hiddenAfterInit: true,\r\n        onClose: lang.hitch(this, function() {\r\n          //restore filter to previous config\r\n          this.resetFilter(this._filterParts);\r\n          this._hideJimuPopup();\r\n          return false;\r\n        }),\r\n        buttons: []\r\n      });\r\n\r\n\r\n      this.filter = new Filter({\r\n        autoSwitchMode: false,\r\n        runtime: true //no predefined options\r\n      });\r\n      this.filter.allExpsBox.style.maxHeight = \"300px\";\r\n      this.filter.allExpsBox.style.overflowY = \"auto\";\r\n      this.filter.placeAt(filterDiv);\r\n      this.filter.startup();\r\n\r\n      this.own(on(btnOk, 'click', lang.hitch(this, function(){\r\n        this._filterParts = this.filter.toJson();\r\n        if(this._filterParts){\r\n          this._hideJimuPopup();\r\n        }else{\r\n          this._showMessage(this.nls.setFilterTip);\r\n        }\r\n      })));\r\n\r\n      this.own(on(btnCancel, 'click', lang.hitch(this, function(){\r\n        //restore filter to previous config\r\n        this.resetFilter(this._filterParts);\r\n        this._hideJimuPopup();\r\n      })));\r\n\r\n      this.own(on(this.filterIcon, 'click', lang.hitch(this, function(){\r\n        if(this.jimuPopup){\r\n          this.jimuPopup.show();\r\n          this.jimuPopup.resize();\r\n        }\r\n      })));\r\n    },\r\n\r\n    _hideJimuPopup: function() { //not destroy it\r\n      if (this.jimuPopup) {\r\n        this.jimuPopup.hide();\r\n      }\r\n    },\r\n\r\n    _initSortOrder: function() {\r\n      this.sortDijit = new Sort({\r\n        nls: this.nls\r\n      });\r\n      this.sortDijit.placeAt(this.SortDiv);\r\n    },\r\n\r\n    _initDataFields: function(){\r\n      this.valueFields = new DataFields({\r\n        nls: this.nls\r\n      });\r\n      this.valueFields.placeAt(this.dataFieldsDiv);\r\n      this.valueFields.startup();\r\n      this.own(on(this.valueFields, 'change', lang.hitch(this, function(){\r\n        this._updateChartTypes();\r\n        this._updateSortFields();\r\n        this._updateParametersDijit();\r\n      })));\r\n    },\r\n\r\n    _updateParametersDijit: function(){\r\n      var mode = this.chartModeSelect.get('value');\r\n\r\n      if(mode === 'feature' || mode === 'category'){\r\n        var fields = this.valueFields.getSelectedFieldNames();\r\n        if(fields.length === 1){\r\n          //if one field selected, should show single color section\r\n          this.columnParameters.showSingleColor();\r\n          this.barParameters.showSingleColor();\r\n          this.lineParameters.showSingleColor();\r\n        }\r\n        else{\r\n          //if none or more than two fields selected, should show multiple color section\r\n          this.columnParameters.showMultiColor();\r\n          this.barParameters.showMultiColor();\r\n          this.lineParameters.showMultiColor();\r\n        }\r\n      }\r\n      else{\r\n        //chart only supports single color for count and field mode\r\n        this.columnParameters.showSingleColor();\r\n        this.barParameters.showSingleColor();\r\n        this.lineParameters.showSingleColor();\r\n      }\r\n      //legend\r\n      this._updateChartModeOfChartParamters(mode);\r\n    },\r\n\r\n    _updateChartTypes: function(){\r\n      this.pieCbx.setStatus(true);\r\n\r\n      var chartMode = this.chartModeSelect.get('value');\r\n\r\n      if(chartMode === 'feature' || chartMode === 'category'){\r\n        var fields = this.valueFields.getSelectedFieldNames();\r\n        if(fields.length > 1){\r\n          this.pieCbx.setValue(false);\r\n          this.pieCbx.setStatus(false);\r\n        }\r\n      }\r\n    },\r\n\r\n    _initChartTypes: function(){\r\n      var imagesUrl = this.folderUrl + 'common/images';\r\n      //column\r\n      this.columnParameters = new StatisticsChartSettings({\r\n        type: 'column',\r\n        imagesUrl: imagesUrl,\r\n        isInWidget: false,\r\n        singleColor: false,\r\n        nls: this.nls,\r\n        config: null\r\n      });\r\n      this.columnTTD = this._createParametersDialog(this.columnCbx,\r\n                                                    this.columnEdit,\r\n                                                    this.columnParameters);\r\n\r\n      //pie\r\n      this.pieParameters = new StatisticsChartSettings({\r\n        type: 'pie',\r\n        imagesUrl: imagesUrl,\r\n        isInWidget: false,\r\n        singleColor: false,\r\n        nls: this.nls,\r\n        config: null\r\n      });\r\n      this.pieTTD = this._createParametersDialog(this.pieCbx, this.pieEdit, this.pieParameters);\r\n\r\n      //bar\r\n      this.barParameters = new StatisticsChartSettings({\r\n        type: 'bar',\r\n        imagesUrl: imagesUrl,\r\n        isInWidget: false,\r\n        singleColor: false,\r\n        nls: this.nls,\r\n        config: null\r\n      });\r\n      this.barTTD = this._createParametersDialog(this.barCbx, this.barEdit, this.barParameters);\r\n\r\n      //line\r\n      this.lineParameters = new StatisticsChartSettings({\r\n        type: 'line',\r\n        imagesUrl: imagesUrl,\r\n        isInWidget: false,\r\n        singleColor: false,\r\n        nls: this.nls,\r\n        config: null\r\n      });\r\n      this.lineTTD = this._createParametersDialog(this.lineCbx, this.lineEdit, this.lineParameters);\r\n\r\n      this.own(on(document.body, 'click', lang.hitch(this, function(event){\r\n        var target = event.target || event.srcElement;\r\n        this._unselectEditDivs();\r\n        var isOpendNow = null;\r\n        var checkNode = null, checkbox = null;\r\n        var editDiv = null;\r\n        var tooltipDialog = null;\r\n        if(html.hasClass(target, 'checkbox')){\r\n          checkNode = target;\r\n        }else if(html.hasClass(target, 'label')){\r\n          var preNode = target.previousElementSibling;\r\n          if(html.hasClass(preNode, 'checkbox')){\r\n            checkNode = preNode;\r\n          }\r\n        }\r\n        var isCheckBox = (checkNode === this.columnCbx.checkNode) ||\r\n                         (checkNode === this.pieCbx.checkNode) ||\r\n                         (checkNode === this.barCbx.checkNode) ||\r\n                         (checkNode === this.lineCbx.checkNode);\r\n        var isEditDiv = (target === this.columnEdit) ||\r\n                        (target === this.pieEdit) ||\r\n                        (target === this.barEdit) ||\r\n                        (target === this.lineEdit);\r\n        if(isCheckBox){\r\n          if(checkNode === this.columnCbx.checkNode){\r\n            checkbox = this.columnCbx;\r\n            editDiv = this.columnEdit;\r\n            tooltipDialog = this.columnTTD;\r\n          }\r\n          else if(checkNode === this.pieCbx.checkNode){\r\n            checkbox = this.pieCbx;\r\n            editDiv = this.pieEdit;\r\n            tooltipDialog = this.pieTTD;\r\n          }\r\n          else if(checkNode === this.barCbx.checkNode){\r\n            checkbox = this.barCbx;\r\n            editDiv = this.barEdit;\r\n            tooltipDialog = this.barTTD;\r\n          }\r\n          else if(checkNode === this.lineCbx.checkNode){\r\n            checkbox = this.lineCbx;\r\n            editDiv = this.lineEdit;\r\n            tooltipDialog = this.lineTTD;\r\n          }\r\n          isOpendNow = !!tooltipDialog.isOpendNow;\r\n          this._hideAllParamsTooltipDialogs();\r\n\r\n          if(checkbox.checked){\r\n            this._showEditDiv(editDiv);\r\n            html.addClass(editDiv, 'selected');\r\n            this._showTooltipDialog(tooltipDialog, editDiv);\r\n          }\r\n          else{\r\n            this._hideTooltipDialog(tooltipDialog);\r\n            this._hideEditDiv(editDiv);\r\n          }\r\n        }\r\n        else if(isEditDiv){\r\n          editDiv = target;\r\n          if(editDiv === this.columnEdit){\r\n            tooltipDialog = this.columnTTD;\r\n          }\r\n          else if(editDiv === this.pieEdit){\r\n            tooltipDialog = this.pieTTD;\r\n          }\r\n          else if(editDiv === this.barEdit){\r\n            tooltipDialog = this.barTTD;\r\n          }\r\n          else if(editDiv === this.lineEdit){\r\n            tooltipDialog = this.lineTTD;\r\n          }\r\n          isOpendNow = !!tooltipDialog.isOpendNow;\r\n          this._hideAllParamsTooltipDialogs();\r\n          if(isOpendNow){\r\n            this._hideTooltipDialog(tooltipDialog);\r\n          }\r\n          else{\r\n            this._showTooltipDialog(tooltipDialog, editDiv);\r\n            html.addClass(editDiv, 'selected');\r\n          }\r\n        }\r\n        else{\r\n          if(this.columnTTD.isOpendNow){\r\n            editDiv = this.columnEdit;\r\n            tooltipDialog = this.columnTTD;\r\n          }\r\n          else if(this.pieTTD.isOpendNow){\r\n            editDiv = this.pieEdit;\r\n            tooltipDialog = this.pieTTD;\r\n          }\r\n          else if(this.barTTD.isOpendNow){\r\n            editDiv = this.barEdit;\r\n            tooltipDialog = this.barTTD;\r\n          }\r\n          else if(this.lineTTD.isOpendNow){\r\n            editDiv = this.lineEdit;\r\n            tooltipDialog = this.lineTTD;\r\n          }\r\n          if(tooltipDialog){\r\n            var a = target === tooltipDialog.domNode;\r\n            var b = html.isDescendant(target, tooltipDialog.domNode);\r\n            var isClickInternal = a || b;\r\n            if(isClickInternal){\r\n              this._hideAllParamsTooltipDialogs();\r\n              this._showTooltipDialog(tooltipDialog, editDiv);\r\n              html.addClass(editDiv, 'selected');\r\n            }\r\n            else{\r\n              this._hideAllParamsTooltipDialogs();\r\n            }\r\n          }\r\n          else{\r\n            this._hideAllParamsTooltipDialogs();\r\n          }\r\n        }\r\n      })));\r\n    },\r\n\r\n    _createParametersDialog: function(cbx, editDiv, parametersDijit){\r\n      /*jshint unused: false*/\r\n      var ttdContent = html.create('div');\r\n      parametersDijit.placeAt(ttdContent);\r\n      var tooltipDialog = new TooltipDialog({\r\n        content: ttdContent\r\n      });\r\n\r\n      return tooltipDialog;\r\n    },\r\n\r\n    _unselectEditDivs: function(){\r\n      html.removeClass(this.columnEdit, 'selected');\r\n      html.removeClass(this.pieEdit, 'selected');\r\n      html.removeClass(this.barEdit, 'selected');\r\n      html.removeClass(this.lineEdit, 'selected');\r\n    },\r\n\r\n    _showEditDiv: function(editDiv){\r\n      html.setStyle(editDiv, 'display', 'inline-block');\r\n    },\r\n\r\n    _hideEditDiv: function(editDiv){\r\n      html.setStyle(editDiv, 'display', 'none');\r\n    },\r\n\r\n    _initPreview: function(){\r\n      this.preview = new StatisticsChart({\r\n        map: null,\r\n        isBigPreview: false,\r\n        showSettingIcon: false,\r\n        showZoomIcon: false,\r\n        zoomToFeaturesWhenClick: false\r\n      });\r\n\r\n      this.preview.placeAt(this.previewDiv);\r\n      this.preview.startup();\r\n    },\r\n\r\n    _updateUIByMode: function(mode){\r\n      //feature,category,count,field\r\n      var chartMode = mode || this.chartModeSelect.get('value') || '';\r\n\r\n      var className = chartMode + '-tr';\r\n      var trs = query('.detail-tr', this.detailsTable);\r\n\r\n      array.forEach(trs, lang.hitch(this, function(tr){\r\n        if(html.hasClass(tr, className)){\r\n          html.addClass(tr, 'show-tr');\r\n        }\r\n        else{\r\n          html.removeClass(tr, 'show-tr');\r\n        }\r\n      }));\r\n\r\n      this._updateChartTypes();\r\n      this._updateParametersDijit();\r\n      if(this.sortDijit){\r\n        this.sortDijit.reset();\r\n        this._updateSortFields();\r\n      }\r\n    },\r\n\r\n    _onChartModeChanged: function(){\r\n      if(this.ignoreChangeEvents){\r\n        return;\r\n      }\r\n      var chartMode = this.chartModeSelect.get('value') || '';\r\n      this._updateUIByMode(chartMode);\r\n    },\r\n\r\n    _updateSortFields:function(){\r\n      var mode = this.chartModeSelect.get('value');\r\n      if(!this.sortDijit){\r\n        return;\r\n      }\r\n      if(mode === 'count' || mode === 'field'){\r\n        this.sortDijit.setFieldOptions();\r\n        return;\r\n      }\r\n      var sortFieldOptions = this._generateSortFieldOption(mode);\r\n      this.sortDijit.setFieldOptions(sortFieldOptions);\r\n    },\r\n\r\n    _generateSortFieldOption: function() {\r\n      var fields = this.valueFields.getSelectedFieldNames();\r\n      if (!fields || fields.length <= 1) {\r\n        return;\r\n      }\r\n      return fields.map(function(field) {\r\n        var alias = utils.getAliasByFieldName(field, this._layerDefinition);\r\n        return {\r\n          label: alias,\r\n          value: field\r\n        };\r\n      }.bind(this));\r\n    },\r\n\r\n    _updateChartModeOfChartParamters: function(mode) {\r\n      if (!mode) {\r\n        return;\r\n      }\r\n      if (this.columnParameters) {\r\n        this.columnParameters._updateLegendDisplayByMode(mode);\r\n      }\r\n      if (this.pieParameters) {\r\n        this.pieParameters._updateLegendDisplayByMode(mode);\r\n      }\r\n      if (this.barParameters) {\r\n        this.barParameters._updateLegendDisplayByMode(mode);\r\n      }\r\n      if (this.lineParameters) {\r\n        this.lineParameters._updateLegendDisplayByMode(mode);\r\n      }\r\n    },\r\n\r\n    _onChartNameBlurred: function(){\r\n      var value = jimuUtils.stripHTML(this.chartNameTextBox.get('value'));\r\n      this.chartNameTextBox.set('value', value);\r\n    },\r\n\r\n    _onChartNameChanged: function(){\r\n      this.emit('name-change', this.chartNameTextBox.get('value'));\r\n    },\r\n\r\n    _onDescriptionBlurred: function(){\r\n      this.descriptionTA.value = jimuUtils.stripHTML(this.descriptionTA.value);\r\n    },\r\n\r\n    _clear: function(){\r\n      //reset general\r\n      this._layerDefinition = null;\r\n      this.urlTextBox.set('value', '');\r\n      this.filter.reset();\r\n\r\n      this.chartNameTextBox.set('value', '');\r\n\r\n      this.descriptionTA.value = '';\r\n\r\n      this.chartModeSelect.removeOption(this.chartModeSelect.getOptions());\r\n\r\n      //reset details\r\n      this.categoryFieldSelect.removeOption(this.categoryFieldSelect.getOptions());\r\n\r\n      this.categoryOperationSelect.set('value', 'sum');\r\n\r\n      this.fieldOperationSelect.set('value', 'sum');\r\n\r\n      this.valueFields.clear();\r\n\r\n      this.featureAxisLabelSelect.removeOption(this.featureAxisLabelSelect.getOptions());\r\n\r\n\r\n      this.columnCbx.setValue(false);\r\n      this.pieCbx.setValue(false);\r\n      this.barCbx.setValue(false);\r\n      this.lineCbx.setValue(false);\r\n\r\n      this.columnParameters.reset();\r\n      this.pieParameters.reset();\r\n      this.barParameters.reset();\r\n      this.lineParameters.reset();\r\n\r\n      //reset symbol picker\r\n      this.symbolPicker.reset();\r\n      this.colorPicker.setColor(new Color(this._highLightColor));\r\n      //reset sort\r\n      this.sortDijit.reset(true);\r\n      //reset preview\r\n      this.preview.clear();\r\n    },\r\n\r\n    _onBtnSetClicked: function(){\r\n      var args = {\r\n        titleLabel: this.nls.setDataSource,\r\n\r\n        dijitArgs: {\r\n          multiple: false,\r\n          createMapResponse: this.map.webMapResponse,\r\n          portalUrl: this.appConfig.portalUrl,\r\n          style: {\r\n            height: '100%'\r\n          }\r\n        }\r\n      };\r\n\r\n      var featurePopup = new _FeaturelayerSourcePopup(args);\r\n      this.own(on(featurePopup, 'ok', lang.hitch(this, function(item){\r\n        //{name, url, definition}\r\n        var layerSourceType = featurePopup.getSelectedRadioType();\r\n        featurePopup.close();\r\n        featurePopup = null;\r\n        var chartName = null;\r\n        // var expr = null;\r\n        // if(layerSourceType === 'map'){\r\n        //   var layerObject = item.layerInfo && item.layerInfo.layerObject;\r\n        //   if(layerObject && typeof layerObject.getDefinitionExpression === 'function'){\r\n        //     expr = layerObject.getDefinitionExpression();\r\n        //   }\r\n        // }\r\n        var layerId = item.layerInfo && item.layerInfo.id;\r\n        var url = item.url;\r\n        this.showBigShelter();\r\n        utils.getLayerDefinitionByLayerIdOrUrl(layerId, url).then(function(definition){\r\n          this.hideBigShelter();\r\n          item.definition = null;\r\n          item.definition = definition;\r\n          this.setNewLayerDefinition(item, layerSourceType, chartName);\r\n        }.bind(this),function(err){\r\n          console.error(err);\r\n          this.hideBigShelter();\r\n        }.bind(this));\r\n      })));\r\n      this.own(on(featurePopup, 'cancel', lang.hitch(this, function(){\r\n        featurePopup.close();\r\n        featurePopup = null;\r\n      })));\r\n\r\n      featurePopup.startup();\r\n    },\r\n\r\n    _hasNumberFields: function(layerDefinition){\r\n      var result = false;\r\n      var fieldInfos = layerDefinition.fields;\r\n      if(fieldInfos && fieldInfos.length > 0){\r\n        result = array.some(fieldInfos, lang.hitch(this, function(fieldInfo){\r\n          return this._numberFieldTypes.indexOf(fieldInfo.type) >= 0;\r\n        }));\r\n      }\r\n      return result;\r\n    },\r\n\r\n    //update UI by updating data source\r\n    setNewLayerDefinition: function(layerSourceItem, sourceType, /*optional*/ chartName){\r\n      //layerSourceItem: {name,url,definition,...}\r\n      layerSourceItem.definition.name = layerSourceItem.name;\r\n      layerSourceItem.definition.url = layerSourceItem.url;\r\n      var oldUrl = this._layerDefinition && this._layerDefinition.url;\r\n      if (layerSourceItem.url !== oldUrl) {\r\n        this._resetByNewLayerDefinition(layerSourceItem, sourceType, chartName);\r\n      }\r\n    },\r\n\r\n    //update UI by updating data source\r\n    _resetByNewLayerDefinition: function(sourceItem, sourceType, /*optional*/ chartName){\r\n      var definition = sourceItem.definition;\r\n      this._addAliasForLayerInfo(definition);\r\n      this._clear();\r\n      if(!definition){\r\n        return;\r\n      }\r\n\r\n      var webMapLayerId = null;\r\n      if(sourceType === 'map'){\r\n        if(sourceItem.layerInfo){\r\n          webMapLayerId = sourceItem.layerInfo.id;\r\n        }\r\n      }\r\n\r\n      //general\r\n      this._layerDefinition = definition;\r\n      this._webMapLayerId = webMapLayerId;\r\n      var url = definition.url;\r\n      this.urlTextBox.set('value', url);\r\n\r\n      //reset filter\r\n      this.filter.reset();\r\n      if(this._layerDefinition){\r\n        var options = {\r\n          featureLayerId: this._webMapLayerId,\r\n          url: url,\r\n          partsObj: null,\r\n          layerDefinition: this._layerDefinition\r\n        };\r\n        this.filter.build(options);\r\n      }\r\n\r\n      this.chartNameTextBox.set('value', chartName || definition.name);\r\n\r\n      //details\r\n      //reset categoryFieldSelect, featureAxisLabelSelect, valueFields\r\n      this._resetFieldsDijitsByLayerInfo(this._layerDefinition);\r\n\r\n      //reset symbol\r\n      var geoType = jimuUtils.getTypeByGeometryType(definition.geometryType);\r\n      var symType = '';\r\n      if(geoType === 'point'){\r\n        symType = 'marker';\r\n      }\r\n      else if(geoType === 'polyline'){\r\n        symType = 'line';\r\n      }\r\n      else if(geoType === 'polygon'){\r\n        symType = 'fill';\r\n      }\r\n      if(symType){\r\n        this.symbolPicker.showByType(symType);\r\n      }\r\n    },\r\n\r\n    _resetFieldsDijitsByLayerInfo: function(layerDefinition){\r\n      //reset chartModeSelect\r\n      this.chartModeSelect.removeOption(this.chartModeSelect.getOptions());\r\n      if(this._hasNumberFields(layerDefinition)){\r\n        this.chartModeSelect.addOption({\r\n          value: 'feature',\r\n          label: this.nls.featureOption\r\n        });\r\n        this.chartModeSelect.addOption({\r\n          value: 'category',\r\n          label: this.nls.categoryOption\r\n        });\r\n        this.chartModeSelect.addOption({\r\n          value: 'count',\r\n          label: this.nls.countOption\r\n        });\r\n        this.chartModeSelect.addOption({\r\n          value: 'field',\r\n          label: this.nls.fieldOption\r\n        });\r\n        this.chartModeSelect.set('value', 'feature');\r\n      }\r\n      else{\r\n        this.chartModeSelect.addOption({\r\n          value: 'count',\r\n          label: this.nls.countOption\r\n        });\r\n        this.chartModeSelect.set('value', 'count');\r\n      }\r\n\r\n      var displayField = layerDefinition.displayField;\r\n      var fieldInfos = lang.clone(layerDefinition.fields);\r\n\r\n      //categoryFieldSelect\r\n      var categoryFieldTypes = [this._stringFieldType, this._dateFieldType];\r\n      categoryFieldTypes = categoryFieldTypes.concat(lang.clone(this._numberFieldTypes));\r\n\r\n      var availableCategoryFieldInfos = array.filter(fieldInfos,\r\n        lang.hitch(this, function(fieldInfo){\r\n        return categoryFieldTypes.indexOf(fieldInfo.type) >= 0;\r\n      }));\r\n\r\n      this.categoryFieldSelect.removeOption(this.categoryFieldSelect.getOptions());\r\n\r\n      var selectedCategoryFieldValue = '';\r\n\r\n      array.forEach(availableCategoryFieldInfos, lang.hitch(this, function(fieldInfo){\r\n        var option = {\r\n          value: fieldInfo.name,\r\n          label: fieldInfo.alias || fieldInfo.name\r\n        };\r\n\r\n        this.categoryFieldSelect.addOption(option);\r\n\r\n        if(fieldInfo.name === displayField){\r\n          selectedCategoryFieldValue = displayField;\r\n        }\r\n      }));\r\n\r\n      this.categoryFieldSelect.set('value', selectedCategoryFieldValue);\r\n\r\n      //featureAxisLabelSelect\r\n      var a = this._stringFieldType;\r\n      var b = this._oidFieldType;\r\n      var c = this._dateFieldType;\r\n      var featureLabelFieldTypes = [a, b, c].concat(lang.clone(this._numberFieldTypes));\r\n\r\n      var availableLabelFieldInfos = array.filter(fieldInfos, lang.hitch(this, function(fieldInfo){\r\n        return featureLabelFieldTypes.indexOf(fieldInfo.type) >= 0;\r\n      }));\r\n\r\n      this.featureAxisLabelSelect.removeOption(this.featureAxisLabelSelect.getOptions());\r\n\r\n      var selectedAxisLabelValue = '';\r\n\r\n      array.forEach(availableLabelFieldInfos, lang.hitch(this, function(fieldInfo){\r\n        var option = {\r\n          value: fieldInfo.name,\r\n          label: fieldInfo.alias || fieldInfo.name\r\n        };\r\n\r\n        if(displayField){\r\n          if(fieldInfo.name === displayField){\r\n            selectedAxisLabelValue = fieldInfo.name;\r\n          }\r\n        }\r\n        else{\r\n          if(fieldInfo.type === this._oidFieldType){\r\n            selectedAxisLabelValue = fieldInfo.name;\r\n          }\r\n        }\r\n\r\n        this.featureAxisLabelSelect.addOption(option);\r\n      }));\r\n\r\n      this.featureAxisLabelSelect.set('value', selectedAxisLabelValue);\r\n\r\n      //valueFields\r\n      var numberFieldInfos = array.filter(fieldInfos, lang.hitch(this, function(fieldInfo){\r\n        return this._numberFieldTypes.indexOf(fieldInfo.type) >= 0;\r\n      }));\r\n      this.valueFields.setFields(numberFieldInfos);\r\n    },\r\n\r\n    _addAliasForLayerInfo: function(layerInfo){\r\n      if(layerInfo && layerInfo.fields && layerInfo.fields.length > 0){\r\n        array.forEach(layerInfo.fields, lang.hitch(this, function(fieldInfo){\r\n          if(fieldInfo.name && !fieldInfo.alias){\r\n            fieldInfo.alias = fieldInfo.name;\r\n          }\r\n        }));\r\n      }\r\n    },\r\n\r\n    _ignoreEvent: function() {\r\n      this.ignoreChangeEvents = true;\r\n    },\r\n\r\n    _careEvent: function() {\r\n      setTimeout(function() {\r\n        this.ignoreChangeEvents = false;\r\n      }.bind(this), 200);\r\n    },\r\n\r\n    resetFilter: function(_filterParts){\r\n      if(!this.filter || !this._layerDefinition){\r\n        return;\r\n      }\r\n\r\n      var options = {\r\n        featureLayerId: this._webMapLayerId,\r\n        url: this._layerDefinition.url,\r\n        partsObj: _filterParts,\r\n        layerDefinition: this._layerDefinition\r\n      };\r\n      this.filter.build(options);\r\n    },\r\n\r\n    //restore UI when reopen setting page\r\n    _resetByConfig: function(cfg, layerInfo){\r\n      this._ignoreEvent();\r\n      this._addAliasForLayerInfo(layerInfo);\r\n      this._clear();\r\n      var config = lang.clone(cfg);\r\n\r\n      //general\r\n      this._layerDefinition = layerInfo;\r\n      this._webMapLayerId = config.webMapLayerId;\r\n      this.urlTextBox.set('value', config.url);\r\n      var filter = config.filter;\r\n      // this.whereClause.innerHTML = filter.expr;\r\n      var options = {\r\n        featureLayerId: this._webMapLayerId,\r\n        url: config.url,\r\n        partsObj: filter,\r\n        layerDefinition: this._layerDefinition\r\n      };\r\n      this.filter.build(options);\r\n      this.chartNameTextBox.set('value', config.name || layerInfo.name || '');\r\n      this.descriptionTA.value = config.description || '';\r\n\r\n      //details\r\n      //reset categoryFieldSelect, featureAxisLabelSelect, valueFields\r\n      this._resetFieldsDijitsByLayerInfo(layerInfo);\r\n\r\n      this.chartModeSelect.set('value', config.mode);\r\n\r\n      var setPieConfig = lang.hitch(this, function(){\r\n        var pieDisplayConfig = this._getChartTypeDisplayConfig(config, 'pie');\r\n        if(pieDisplayConfig){\r\n          this.pieParameters.setConfig(pieDisplayConfig);\r\n          this.pieCbx.setValue(true);\r\n          this._showEditDiv(this.pieEdit);\r\n        }\r\n      });\r\n\r\n      if(config.mode === 'feature'){\r\n        this.featureAxisLabelSelect.set('value', config.labelField);\r\n        this.valueFields.selectFields(config.valueFields);\r\n\r\n        if(config.valueFields.length <= 1){\r\n          setPieConfig();\r\n        }\r\n      }else if(config.mode === 'category'){\r\n        this.categoryFieldSelect.set('value', config.categoryField);\r\n        this.categoryOperationSelect.set('value', config.operation);\r\n        this.valueFields.selectFields(config.valueFields);\r\n\r\n        if(config.valueFields.length <= 1){\r\n          setPieConfig();\r\n        }\r\n      }else if(config.mode === 'count'){\r\n        this.categoryFieldSelect.set('value', config.categoryField);\r\n\r\n        setPieConfig();\r\n      }else if(config.mode === 'field'){\r\n        this.fieldOperationSelect.set('value', config.operation);\r\n        this.valueFields.selectFields(config.valueFields);\r\n        setPieConfig();\r\n      }\r\n\r\n      //should execute setConfig method of Parameters after execute setConfig method of valueFields\r\n      var columnDisplayConfig = this._getChartTypeDisplayConfig(config, 'column');\r\n      if(columnDisplayConfig){\r\n        this.columnParameters.setConfig(columnDisplayConfig);\r\n        this.columnCbx.setValue(true);\r\n        this._showEditDiv(this.columnEdit);\r\n      }\r\n\r\n      var barDisplayConfig = this._getChartTypeDisplayConfig(config, 'bar');\r\n      if(barDisplayConfig){\r\n        this.barParameters.setConfig(barDisplayConfig);\r\n        this.barCbx.setValue(true);\r\n        this._showEditDiv(this.barEdit);\r\n      }\r\n\r\n      var lineDisplayConfig = this._getChartTypeDisplayConfig(config, 'line');\r\n      if(lineDisplayConfig){\r\n        this.lineParameters.setConfig(lineDisplayConfig);\r\n        this.lineCbx.setValue(true);\r\n        this._showEditDiv(this.lineEdit);\r\n      }\r\n      //sort order\r\n      if(config.sortOrder){\r\n        this.sortDijit.setConfig(config.sortOrder);\r\n      }\r\n      //set symbol\r\n      var symbol = esriSymbolJsonUtils.fromJson(config.symbol);\r\n      this.symbolPicker.showBySymbol(symbol);\r\n\r\n      //highlight color\r\n      this.colorPicker.setColor(new Color(config.highLightColor));\r\n      this._careEvent();\r\n    },\r\n\r\n    _getChartTypeDisplayConfig: function(widgetConfig, chartType){\r\n      if(widgetConfig && widgetConfig.types && widgetConfig.types.length > 0){\r\n        for(var i = 0; i < widgetConfig.types.length; i++){\r\n          if(widgetConfig.types[i].type === chartType){\r\n            return widgetConfig.types[i].display;\r\n          }\r\n        }\r\n      }\r\n      return null;\r\n    },\r\n\r\n    _updatePreview: function(){\r\n      this.preview.clear();\r\n      var config = this.getConfig(true);\r\n      if(!config){\r\n        return;\r\n      }\r\n\r\n      var queryParams = new EsriQuery();\r\n      queryParams.returnGeometry = false;\r\n      queryParams.where = config.filter.expr || '1=1';\r\n      queryParams.outFields = [];\r\n\r\n      if(config.mode === 'feature'){\r\n        queryParams.outFields = lang.clone(config.valueFields);\r\n        if(queryParams.outFields.indexOf(config.labelField) < 0){\r\n          queryParams.outFields = [config.labelField].concat(queryParams.outFields);\r\n        }\r\n      }\r\n      else if(config.mode === 'category'){\r\n        queryParams.outFields = lang.clone(config.valueFields);\r\n        if(queryParams.outFields.indexOf(config.categoryField) < 0) {\r\n          queryParams.outFields =  [config.categoryField].concat(queryParams.outFields);\r\n        }\r\n      }\r\n      else if(config.mode === 'count'){\r\n        queryParams.outFields = [config.categoryField];\r\n      }\r\n      else if(config.mode === 'field'){\r\n        queryParams.outFields = lang.clone(config.valueFields);\r\n      }\r\n\r\n      this.tab.showShelter();\r\n      this.showBigShelter();\r\n\r\n      this._queryFeatures(queryParams, config.url).then(lang.hitch(this, function(features) {\r\n        if(!this.domNode){\r\n          return;\r\n        }\r\n\r\n        var box = html.getContentBox(this.domNode.parentNode);\r\n        var h = Math.max(box.h - 60, 150);\r\n        html.setStyle(this.preview.domNode, 'height', h + 'px');\r\n\r\n        // var args = {\r\n        //   config: config,\r\n        //   features: features,\r\n        //   layerDefinition: this._layerDefinition,\r\n        //   resultLayer: null\r\n        // };\r\n        // this.preview.createClientCharts(args);\r\n        features = features.slice(0, this.maxPreviewFeaturesCount);\r\n        var url = this._layerDefinition.url;\r\n        this.preview.createClientCharts(url, features, config);\r\n        this.tab.hideShelter();\r\n        this.hideBigShelter();\r\n      }), lang.hitch(this, function(err) {\r\n        if(!this.domNode){\r\n          return;\r\n        }\r\n\r\n        console.error(err);\r\n        this.tab.hideShelter();\r\n        this.hideBigShelter();\r\n      }));\r\n    },\r\n\r\n    _queryFeatures: function(queryParams, url){\r\n      var def = new Deferred();\r\n      var queryTask = new QueryTask(url);\r\n      queryTask.execute(queryParams).then(lang.hitch(this, function(featureSet){\r\n        var features = featureSet.features || [];\r\n        def.resolve(features);\r\n      }), lang.hitch(this, function(err){\r\n        //maybe a joined layer\r\n        if(err && err.code === 400){\r\n          queryParams.outFields = [\"*\"];\r\n          var queryTask2 = new QueryTask(url);\r\n          queryTask2.execute(queryParams).then(lang.hitch(this, function(featureSet2){\r\n            def.resolve(featureSet2);\r\n          }), lang.hitch(this, function(err2){\r\n            def.reject(err2);\r\n          }));\r\n        }else{\r\n          def.reject(err);\r\n        }\r\n      }));\r\n      return def;\r\n    }\r\n\r\n  });\r\n});"]}