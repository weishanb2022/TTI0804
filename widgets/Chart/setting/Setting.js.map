{"version":3,"sources":["../../../../widgets/Chart/setting/Setting.js"],"names":["define","declare","lang","array","html","on","_WidgetsInTemplateMixin","BaseWidgetSetting","_FeaturelayerSourcePopup","jimuUtils","FilterUtils","LayerInfos","SingleChartSetting","utils","SimpleTable","baseClass","currentSCS","_numberFieldTypes","postMixInProperties","inherited","arguments","layerInfosObj","getInstanceSync","nls","horizontalAxis","verticalAxis","dataLabels","color","colorful","monochromatic","config","_setUrlForConfig","_updateConfig","postCreate","_initSelf","setConfig","fields","name","title","width","type","editable","actions","chartList","autoHeight","selectable","style","addClass","domNode","own","hitch","_onChartItemRemoved","_onChartItemSelected","placeAt","chartListContent","charts","length","forEach","singleConfig","_rebuildFilter","url","filter","webMapLayerId","info","getLayerOrTableInfoById","getUrl","expr","filterUtils","isHosted","isHostedService","getExprByFilterObj","e","console","log","destroy","clear","isArrayLike","index","addResult","addRow","tr","clone","selectRow","getConfig","currentSingleConfig","trs","getRows","i","push","_onAddNewClicked","args","titleLabel","setDataSource","dijitArgs","multiple","createMapResponse","map","webMapResponse","portalUrl","appConfig","height","featurePopup","item","layerSourceType","getSelectedRadioType","close","chartName","success","layerId","layerInfo","id","shelter","show","getLayerDefinitionByLayerIdOrUrl","then","definition","hide","setNewLayerDefinition","bind","err","error","startup","_hasNumberFields","layerDefinition","result","fieldInfos","some","fieldInfo","indexOf","_createSingleChartSetting","_layerDefinition","folderUrl","singleChartContainer","editRow"],"mappings":"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","file":"Setting.js","sourcesContent":["///////////////////////////////////////////////////////////////////////////\r\n// Copyright © Esri. All Rights Reserved.\r\n//\r\n// Licensed under the Apache License Version 2.0 (the \"License\");\r\n// you may not use this file except in compliance with the License.\r\n// You may obtain a copy of the License at\r\n//\r\n//    http://www.apache.org/licenses/LICENSE-2.0\r\n//\r\n// Unless required by applicable law or agreed to in writing, software\r\n// distributed under the License is distributed on an \"AS IS\" BASIS,\r\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n// See the License for the specific language governing permissions and\r\n// limitations under the License.\r\n///////////////////////////////////////////////////////////////////////////\r\n\r\ndefine([\r\n  'dojo/_base/declare',\r\n  'dojo/_base/lang',\r\n  'dojo/_base/array',\r\n  'dojo/_base/html',\r\n  'dojo/on',\r\n  'dijit/_WidgetsInTemplateMixin',\r\n  'jimu/BaseWidgetSetting',\r\n  'jimu/dijit/_FeaturelayerSourcePopup',\r\n  'jimu/utils',\r\n  'jimu/filterUtils',\r\n  'jimu/LayerInfos/LayerInfos',\r\n  './SingleChartSetting',\r\n  './utils',\r\n  'jimu/dijit/SimpleTable',\r\n  'jimu/dijit/TabContainer',\r\n  'jimu/dijit/ColorPicker',\r\n  'dijit/form/Select',\r\n  'dijit/form/TextBox'\r\n],\r\nfunction(declare, lang, array, html, on, _WidgetsInTemplateMixin, BaseWidgetSetting,\r\n  _FeaturelayerSourcePopup, jimuUtils,  FilterUtils, LayerInfos, SingleChartSetting, utils, SimpleTable) {\r\n  return declare([BaseWidgetSetting, _WidgetsInTemplateMixin], {\r\n    baseClass: 'jimu-widget-chart-setting',\r\n    currentSCS: null,\r\n\r\n    _numberFieldTypes: ['esriFieldTypeSmallInteger',\r\n                        'esriFieldTypeInteger',\r\n                        'esriFieldTypeSingle',\r\n                        'esriFieldTypeDouble'],\r\n\r\n    postMixInProperties: function(){\r\n      this.inherited(arguments);\r\n      this.layerInfosObj = LayerInfos.getInstanceSync();\r\n      utils.layerInfosObj = this.layerInfosObj;\r\n      this.nls.horizontalAxis = this.nls.horizontalAxis || \"Horizontal Axis\";\r\n      this.nls.verticalAxis = this.nls.verticalAxis || \"Vertical Axis\";\r\n      this.nls.dataLabels = this.nls.dataLabels || \"Data Labels\";\r\n      this.nls.color = this.nls.color || \"Color\";\r\n      this.nls.colorful = this.nls.colorful || \"Colorful\";\r\n      this.nls.monochromatic = this.nls.monochromatic || \"Monochromatic\";\r\n      if(this.config){\r\n        this._setUrlForConfig(this.config);\r\n        this._updateConfig();\r\n      }\r\n    },\r\n\r\n    postCreate: function(){\r\n      this.inherited(arguments);\r\n      this._initSelf();\r\n      if(this.config){\r\n        this.setConfig(this.config);\r\n      }\r\n    },\r\n\r\n    _initSelf: function(){\r\n      var fields = [{\r\n        name: \"name\",\r\n        title: this.nls.name,\r\n        width: \"auto\",\r\n        type: \"text\",\r\n        editable: false\r\n      }, {\r\n        name: \"actions\",\r\n        title: \"\",\r\n        width: \"70px\",\r\n        type: \"actions\",\r\n        actions: [\"up\", \"down\", \"delete\"]\r\n      }];\r\n      this.chartList = new SimpleTable({\r\n        fields: fields,\r\n        autoHeight: false,\r\n        selectable: true,\r\n        style: \"position:absolute; top:0; bottom:10px;\"\r\n      });\r\n      html.addClass(this.chartList.domNode, 'chart-list-table');\r\n      this.own(on(this.chartList, 'row-delete', lang.hitch(this, this._onChartItemRemoved)));\r\n      this.own(on(this.chartList, 'row-select', lang.hitch(this, this._onChartItemSelected)));\r\n      this.chartList.placeAt(this.chartListContent, 'first');\r\n    },\r\n\r\n    _updateConfig: function() {\r\n      if (this.config && this.config.charts && this.config.charts.length > 0) {\r\n        array.forEach(this.config.charts, lang.hitch(this, function(singleConfig) {\r\n          this._rebuildFilter(singleConfig.url, singleConfig.filter);\r\n        }));\r\n      }\r\n    },\r\n\r\n    _setUrlForConfig: function(config){\r\n      if(config.charts && config.charts.length > 0){\r\n        array.forEach(config.charts, lang.hitch(this, function(singleConfig){\r\n          if(singleConfig.webMapLayerId){\r\n            var info = this.layerInfosObj.getLayerOrTableInfoById(singleConfig.webMapLayerId);\r\n            if(info){\r\n              singleConfig.url = info.getUrl();\r\n            }\r\n          }\r\n        }));\r\n      }\r\n    },\r\n\r\n    _rebuildFilter: function(url, filter) {\r\n      try {\r\n        if (filter) {\r\n          delete filter.expr;\r\n          var filterUtils = new FilterUtils();\r\n          filterUtils.isHosted = jimuUtils.isHostedService(url);\r\n          filterUtils.getExprByFilterObj(filter);\r\n        }\r\n      } catch (e) {\r\n        console.log(e);\r\n      }\r\n    },\r\n\r\n    setConfig: function(config){\r\n      this._setUrlForConfig(config);\r\n\r\n      if(this.currentSCS){\r\n        this.currentSCS.destroy();\r\n      }\r\n      this.currentSCS = null;\r\n      this.chartList.clear();\r\n\r\n      this.config = config;\r\n      var charts = this.config && this.config.charts;\r\n      if(lang.isArrayLike(charts)){\r\n        array.forEach(charts, lang.hitch(this, function(singleConfig, index){\r\n          var addResult = this.chartList.addRow({name: singleConfig.name || ''});\r\n          var tr = addResult.tr;\r\n          tr.singleConfig = lang.clone(singleConfig);\r\n          if(index === 0){\r\n            this.chartList.selectRow(tr);\r\n          }\r\n        }));\r\n      }\r\n    },\r\n\r\n    getConfig: function(){\r\n      if(this.currentSCS){\r\n        var currentSingleConfig = this.currentSCS.getConfig(true);\r\n        if(currentSingleConfig){\r\n          this.currentSCS.tr.singleConfig = lang.clone(currentSingleConfig);\r\n        }\r\n        else{\r\n          return false;\r\n        }\r\n      }\r\n      var config = {\r\n        charts: []\r\n      };\r\n      var trs = this.chartList.getRows();\r\n      for(var i = 0; i < trs.length; i++){\r\n        var tr = trs[i];\r\n        config.charts.push(lang.clone(tr.singleConfig));\r\n        if(config.charts[i].webMapLayerId){\r\n          config.charts[i].url = '';\r\n        }\r\n      }\r\n      this.config = lang.clone(config);\r\n      return config;\r\n    },\r\n\r\n    _onAddNewClicked: function(){\r\n      if(this.currentSCS){\r\n        var singleConfig = this.currentSCS.getConfig(true);\r\n        if(singleConfig){\r\n          this.currentSCS.tr.singleConfig = singleConfig;\r\n        }\r\n        else{\r\n          return;\r\n        }\r\n      }\r\n\r\n      var args = {\r\n        titleLabel: this.nls.setDataSource,\r\n\r\n        dijitArgs: {\r\n          multiple: false,\r\n          createMapResponse: this.map.webMapResponse,\r\n          portalUrl: this.appConfig.portalUrl,\r\n          style: {\r\n            height: '100%'\r\n          }\r\n        }\r\n      };\r\n\r\n      var featurePopup = new _FeaturelayerSourcePopup(args);\r\n      this.own(on(featurePopup, 'ok', lang.hitch(this, function(item){\r\n        //{name, url, definition}\r\n        var layerSourceType = featurePopup.getSelectedRadioType();\r\n        featurePopup.close();\r\n\r\n        if(this.currentSCS){\r\n          this.currentSCS.destroy();\r\n          this.currentSCS = null;\r\n        }\r\n\r\n        //var chartName = this._getSuitableQueryName(item.name);\r\n        var chartName = item.name || \"\";\r\n        var addResult = this.chartList.addRow({name: chartName});\r\n        if (addResult.success) {\r\n          var tr = addResult.tr;\r\n          this.chartList.selectRow(tr);\r\n          if (this.currentSCS) {\r\n            var expr = null;\r\n            // if(layerSourceType === 'map'){\r\n            //   var layerObject = item.layerInfo && item.layerInfo.layerObject;\r\n            //   if(layerObject && typeof layerObject.getDefinitionExpression === 'function'){\r\n            //     expr = layerObject.getDefinitionExpression();\r\n            //   }\r\n            // }\r\n            var layerId = item.layerInfo && item.layerInfo.id;\r\n            var url = item.url;\r\n            this.shelter.show();\r\n            utils.getLayerDefinitionByLayerIdOrUrl(layerId, url).then(function(definition) {\r\n              this.shelter.hide();\r\n              item.definition = null;\r\n              item.definition = definition;\r\n              this.currentSCS.setNewLayerDefinition(item, layerSourceType, chartName, expr);\r\n            }.bind(this), function(err) {\r\n              console.error(err);\r\n              this.shelter.hide();\r\n            }.bind(this));\r\n          }\r\n        }\r\n      })));\r\n\r\n      this.own(on(featurePopup, 'cancel', lang.hitch(this, function(){\r\n        featurePopup.close();\r\n      })));\r\n\r\n      featurePopup.startup();\r\n    },\r\n\r\n    _hasNumberFields: function(layerDefinition){\r\n      var result = false;\r\n      var fieldInfos = layerDefinition.fields;\r\n      if(fieldInfos && fieldInfos.length > 0){\r\n        result = array.some(fieldInfos, lang.hitch(this, function(fieldInfo){\r\n          return this._numberFieldTypes.indexOf(fieldInfo.type) >= 0;\r\n        }));\r\n      }\r\n      return result;\r\n    },\r\n\r\n    _onChartItemRemoved: function(tr){\r\n      if(this.currentSCS){\r\n        if(this.currentSCS.tr === tr){\r\n          this.currentSCS.destroy();\r\n          this.currentSCS = null;\r\n        }\r\n      }\r\n    },\r\n\r\n    _onChartItemSelected: function(tr){\r\n      if(this.currentSCS){\r\n        if(this.currentSCS.tr !== tr){\r\n          var singleConfig = this.currentSCS.getConfig(true);\r\n          if(singleConfig){\r\n            this.currentSCS.tr.singleConfig = singleConfig;\r\n            this.currentSCS.destroy();\r\n            this.currentSCS = null;\r\n            this._createSingleChartSetting(tr);\r\n          }\r\n          else{\r\n            this.chartList.selectRow(this.currentSCS.tr);\r\n          }\r\n        }\r\n      }\r\n      else{\r\n        this._createSingleChartSetting(tr);\r\n      }\r\n    },\r\n\r\n    _createSingleChartSetting: function(tr){\r\n      var args = {\r\n        map: this.map,\r\n        nls: this.nls,\r\n        config: tr.singleConfig,\r\n        tr: tr,\r\n        _layerDefinition: tr._layerDefinition,\r\n        folderUrl: this.folderUrl,\r\n        appConfig: this.appConfig\r\n      };\r\n      this.currentSCS = new SingleChartSetting(args);\r\n      this.currentSCS.placeAt(this.singleChartContainer);\r\n\r\n      this.own(on(this.currentSCS, 'name-change', lang.hitch(this, function(chartName){\r\n        this.chartList.editRow(tr, {name: chartName});\r\n      })));\r\n\r\n      this.own(on(this.currentSCS, 'show-shelter', lang.hitch(this, function(){\r\n        this.shelter.show();\r\n      })));\r\n\r\n      this.own(on(this.currentSCS, 'hide-shelter', lang.hitch(this, function(){\r\n        this.shelter.hide();\r\n      })));\r\n\r\n      this.currentSCS.startup();\r\n\r\n      //first bind event, then setConfig\r\n      this.currentSCS.setConfig(tr.singleConfig);\r\n\r\n      return this.currentSCS;\r\n    }\r\n  });\r\n});"]}