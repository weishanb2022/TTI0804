{"version":3,"sources":["../../../widgets/Chart/VersionManager.js"],"names":["define","BaseVersionManager","VersionManager","versions","version","upgrader","oldConfig","newConfig","chart","types","colors","mode","fixedMultiColors","i","charts","length","valueFields","indexOf","column","horizontalAxis","verticalAxis","bar","line","pie","label","webMapLayerId","singleChartConfig","push","type","display","showLegend","showHorizontalAxis","showVerticalAxis","showDataLabel","sortOrder","isLabelAxis","isAsc","field","labelField","prototype","constructor"],"mappings":"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","file":"VersionManager.js","sourcesContent":["///////////////////////////////////////////////////////////////////////////\r\n// Copyright Â© Esri. All Rights Reserved.\r\n//\r\n// Licensed under the Apache License Version 2.0 (the \"License\");\r\n// you may not use this file except in compliance with the License.\r\n// You may obtain a copy of the License at\r\n//\r\n//    http://www.apache.org/licenses/LICENSE-2.0\r\n//\r\n// Unless required by applicable law or agreed to in writing, software\r\n// distributed under the License is distributed on an \"AS IS\" BASIS,\r\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n// See the License for the specific language governing permissions and\r\n// limitations under the License.\r\n///////////////////////////////////////////////////////////////////////////\r\ndefine(['jimu/shared/BaseVersionManager'],\r\nfunction(BaseVersionManager) {\r\n\r\n  function VersionManager(){\r\n    this.versions = [{\r\n      version: '1.0',\r\n      upgrader: function(oldConfig){\r\n        return oldConfig;\r\n      }\r\n    }, {\r\n      version: '1.1',\r\n      upgrader: function(oldConfig){\r\n        var newConfig = oldConfig;\r\n\r\n        var chart = null, types = null, colors = null, mode = null;\r\n        var fixedMultiColors = ['#5d9cd3', '#eb7b3a', '#a5a5a5', '#febf29', '#4673c2', '#72ad4c'];\r\n\r\n        for(var i = 0; i < newConfig.charts.length; i++){\r\n          chart = newConfig.charts[i];\r\n          mode = chart.mode;\r\n          types = chart.types;\r\n          colors = chart.colors;\r\n          delete chart.types;\r\n          delete chart.colors;\r\n\r\n          if(mode === 'feature' || mode === 'category'){\r\n            if(chart.valueFields.length === 1){\r\n              //if one field selected, should show single color section\r\n              colors = [colors[0]];\r\n            }\r\n            else{\r\n              //if none or more than two fields selected, should show multiple color section\r\n              colors = fixedMultiColors;\r\n            }\r\n          }\r\n          else{\r\n            //chart only supports single color for count and field mode\r\n            colors = [colors[0]];\r\n          }\r\n\r\n          if(types.indexOf('column') >= 0){\r\n            chart.column = {\r\n              horizontalAxis: true,\r\n              verticalAxis: true,\r\n              colors: colors\r\n            };\r\n          }\r\n          if(types.indexOf('bar') >= 0){\r\n            chart.bar = {\r\n              horizontalAxis: true,\r\n              verticalAxis: true,\r\n              colors: colors\r\n            };\r\n          }\r\n          if(types.indexOf('line') >= 0){\r\n            chart.line = {\r\n              horizontalAxis: true,\r\n              verticalAxis: true,\r\n              colors: colors\r\n            };\r\n          }\r\n          if(types.indexOf('pie') >= 0){\r\n            chart.pie = {\r\n              label: true,\r\n              colors: fixedMultiColors\r\n            };\r\n          }\r\n        }\r\n\r\n        return newConfig;\r\n      }\r\n    }, {\r\n      version: '1.2',\r\n      upgrader: function(oldConfig){\r\n        return oldConfig;\r\n      }\r\n    }, {\r\n      version: '1.3',\r\n      upgrader: function(oldConfig){\r\n        return oldConfig;\r\n      }\r\n    }, {\r\n      version: '1.4',\r\n      upgrader: function(oldConfig){\r\n        return oldConfig;\r\n      }\r\n    }, {\r\n      version: '2.0Beta',\r\n      upgrader: function(oldConfig){\r\n        return oldConfig;\r\n      }\r\n    }, {\r\n      version: '2.0',\r\n      upgrader: function(oldConfig){\r\n        return oldConfig;\r\n      }\r\n    }, {\r\n      version: '2.0.1',\r\n      upgrader: function(oldConfig){\r\n        return oldConfig;\r\n      }\r\n    }, {\r\n      version: '2.1',\r\n      upgrader: function(oldConfig){\r\n        var newConfig = oldConfig;\r\n        var chart = null;\r\n        for(var i = 0; i < newConfig.charts.length; i++){\r\n          chart = newConfig.charts[i];\r\n          chart.webMapLayerId = \"\";\r\n        }\r\n        return newConfig;\r\n      }\r\n    }, {\r\n      version: '2.2',\r\n      upgrader: function(oldConfig){\r\n        return oldConfig;\r\n      }\r\n    }, {\r\n      version: '2.3',\r\n      upgrader: function(oldConfig){\r\n        return oldConfig;\r\n      }\r\n    }, {\r\n      version: '2.4',\r\n      upgrader: function(oldConfig){\r\n        return oldConfig;\r\n      }\r\n    }, {\r\n      version: '2.5',\r\n      upgrader: function(oldConfig){\r\n        var newConfig = oldConfig;\r\n        var singleChartConfig = null;\r\n        for(var i = 0; i < newConfig.charts.length; i++){\r\n          singleChartConfig = newConfig.charts[i];\r\n          singleChartConfig.types = [];\r\n\r\n          if(singleChartConfig.column){\r\n            singleChartConfig.types.push({\r\n              type: 'column',\r\n              display: {\r\n                colors: singleChartConfig.column.colors,\r\n                showLegend: false,\r\n                showHorizontalAxis: singleChartConfig.column.horizontalAxis,\r\n                showVerticalAxis: singleChartConfig.column.verticalAxis\r\n              }\r\n            });\r\n          }\r\n\r\n          if(singleChartConfig.pie){\r\n            singleChartConfig.types.push({\r\n              type: 'pie',\r\n              display: {\r\n                colors: singleChartConfig.pie.colors,\r\n                showLegend: false,\r\n                showDataLabel: singleChartConfig.pie.label\r\n              }\r\n            });\r\n          }\r\n\r\n          if(singleChartConfig.bar){\r\n            singleChartConfig.types.push({\r\n              type: 'bar',\r\n              display: {\r\n                colors: singleChartConfig.bar.colors,\r\n                showLegend: false,\r\n                showHorizontalAxis: singleChartConfig.bar.horizontalAxis,\r\n                showVerticalAxis: singleChartConfig.bar.verticalAxis\r\n              }\r\n            });\r\n          }\r\n\r\n          if(singleChartConfig.line){\r\n            singleChartConfig.types.push({\r\n              type: 'line',\r\n              display: {\r\n                colors: singleChartConfig.line.colors,\r\n                showLegend: false,\r\n                showHorizontalAxis: singleChartConfig.line.horizontalAxis,\r\n                showVerticalAxis: singleChartConfig.line.verticalAxis\r\n              }\r\n            });\r\n          }\r\n        }\r\n\r\n        return newConfig;\r\n      }\r\n    },{\r\n      version: '2.6',\r\n      upgrader: function(oldConfig) {\r\n        var newConfig = oldConfig;\r\n        var chart = null;\r\n        for (var i = 0; i < newConfig.charts.length; i++) {\r\n          chart = newConfig.charts[i];\r\n          chart.sortOrder = {\r\n            isLabelAxis: true,\r\n            isAsc: chart.sortOrder === 'asc'\r\n          };\r\n          if (chart.mode === 'feature') {\r\n            chart.sortOrder.field = chart.labelField;\r\n          }\r\n        }\r\n        return newConfig;\r\n      }\r\n    }];\r\n  }\r\n\r\n  VersionManager.prototype = new BaseVersionManager();\r\n  VersionManager.prototype.constructor = VersionManager;\r\n  return VersionManager;\r\n});"]}