{"version":3,"sources":["../../../../widgets/Scalebar/setting/Setting.js"],"names":["define","declare","html","_WidgetsInTemplateMixin","BaseWidgetSetting","PortalUtils","lang","on","Deferred","CheckBox","baseClass","selectUnit","selectStyle","startup","inherited","arguments","config","scalebar","set","own","englishNode","hitch","_selectItem","metricNode","dualNode","lineNode","rulerNode","numberNode","numberLabel","innerHTML","window","isRTL","separator","label","nls","checked","watch","_updateUnit","_updateStyle","setConfig","_selectedUnitNode","_unit","get","setChecked","_selectedStyleNode","_style","addClass","roundNumber","removeClass","unitConfig","_processConfig","configJson","def","scalebarUnit","scalebarStyle","resolve","getUnits","appConfig","portalUrl","then","units","promise","isValid","spinner","lineStyle","isFinite","parseInt","decimalPlaces","addSeparator","setValue","getConfig","getValue","name"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEAA,OAAO,CACH,oBADG,EAEH,iBAFG,EAGH,+BAHG,EAIH,wBAJG,EAKH,kBALG,EAMH,iBANG,EAOH,SAPG,EAQH,eARG,EASH,qBATG,EAUH,qBAVG,CAAP,EAYE,UACEC,OADF,EAEEC,IAFF,EAGEC,uBAHF,EAIEC,iBAJF,EAKEC,WALF,EAMEC,IANF,EAOEC,EAPF,EAQEC,QARF,EAQYC,QARZ,EAQsB;AACpB,SAAOR,QAAQ,CAACG,iBAAD,EAAoBD,uBAApB,CAAR,EAAsD;AAC3D;AACAO,eAAW,8BAFgD;AAG3DC,gBAAY,EAH+C;AAI3DC,iBAAa,EAJ8C;;AAM3DC,aAAS,mBAAW;AAClB,WAAKC,SAAL,CAAeC,SAAf;AACA,UAAI,CAAC,KAAKC,MAAL,CAAYC,QAAjB,EAA2B;AACzB,aAAKD,MAAL,CAAYC,QAAZ,GAAuB,EAAvB;AACD;AACD,WAAKC,GAAL,CAAS,YAAT,EAAuB,EAAvB;AACA,WAAKA,GAAL,CAAS,aAAT,EAAwB,EAAxB;;AAEA,WAAKC,GAAL,CAASZ,GAAG,KAAKa,WAAR,EAAqB,OAArB,EAA8Bd,KAAKe,KAAL,CAAW,IAAX,EAAiB,YAAW;AACjE,aAAKH,GAAL,CAAS,YAAT,EAAuB,SAAvB;AACA,aAAKI,WAAL,CAAiB,SAAjB;AACD,OAHsC,CAA9B,CAAT;AAIA,WAAKH,GAAL,CAASZ,GAAG,KAAKgB,UAAR,EAAoB,OAApB,EAA6BjB,KAAKe,KAAL,CAAW,IAAX,EAAiB,YAAW;AAChE,aAAKH,GAAL,CAAS,YAAT,EAAuB,QAAvB;AACA,aAAKI,WAAL,CAAiB,QAAjB;AACD,OAHqC,CAA7B,CAAT;AAIA,WAAKH,GAAL,CAASZ,GAAG,KAAKiB,QAAR,EAAkB,OAAlB,EAA2BlB,KAAKe,KAAL,CAAW,IAAX,EAAiB,YAAW;AAC9D,aAAKH,GAAL,CAAS,YAAT,EAAuB,MAAvB;AACA,aAAKI,WAAL,CAAiB,MAAjB;AACA;AACA;AACD,OALmC,CAA3B,CAAT;;AAOA,WAAKH,GAAL,CAASZ,GAAG,KAAKkB,QAAR,EAAkB,OAAlB,EAA2BnB,KAAKe,KAAL,CAAW,IAAX,EAAiB,YAAW;AAC9D,aAAKH,GAAL,CAAS,aAAT,EAAwB,MAAxB;AACA,aAAKI,WAAL,CAAiB,MAAjB;AACD,OAHmC,CAA3B,CAAT;AAIA,WAAKH,GAAL,CAASZ,GAAG,KAAKmB,SAAR,EAAmB,OAAnB,EAA4BpB,KAAKe,KAAL,CAAW,IAAX,EAAiB,YAAW;AAC/D,aAAKH,GAAL,CAAS,aAAT,EAAwB,OAAxB;AACA,aAAKI,WAAL,CAAiB,OAAjB;AACD,OAHoC,CAA5B,CAAT;AAIA,WAAKH,GAAL,CAASZ,GAAG,KAAKoB,UAAR,EAAoB,OAApB,EAA6BrB,KAAKe,KAAL,CAAW,IAAX,EAAiB,YAAW;AAChE,aAAKH,GAAL,CAAS,aAAT,EAAwB,QAAxB;AACA,aAAKI,WAAL,CAAiB,QAAjB;AACD,OAHqC,CAA7B,CAAT;;AAKA,WAAKM,WAAL,CAAiBC,SAAjB,GAA8BC,OAAOC,KAAP,GAAe,sBAAf,GAAwC,sBAAtE;;AAEA,WAAKC,SAAL,GAAiB,IAAIvB,QAAJ,CAAa;AAC5BwB,eAAO,KAAKC,GAAL,CAASF,SADY;AAE5BG,iBAAS;AAFmB,OAAb,EAGd,KAAKH,SAHS,CAAjB;;AAKA,WAAKI,KAAL,CAAW,YAAX,EAAyB,KAAKC,WAA9B;AACA,WAAKD,KAAL,CAAW,aAAX,EAA0B,KAAKE,YAA/B;AACA,WAAKC,SAAL,CAAe,KAAKvB,MAApB;AACD,KApD0D;;AAsD3DqB,iBAAa,uBAAW;AACtB,UAAIG,oBAAoB,IAAxB;AACA,UAAIC,QAAQ,KAAKC,GAAL,CAAS,YAAT,CAAZ;AACA,UAAID,UAAU,QAAd,EAAwB;AACtBD,4BAAoB,KAAKjB,UAAzB;AACA;AACA;AACD,OAJD,MAIO,IAAIkB,UAAU,MAAd,EAAsB;AAC3BD,4BAAoB,KAAKhB,QAAzB;AACA;AACA;AACD,OAJM,MAIA;AACLgB,4BAAoB,KAAKpB,WAAzB;AACA;AACA;AACD;;AAED,UAAGoB,qBAAqBA,kBAAkBG,UAA1C,EAAqD;AACnDH,0BAAkBG,UAAlB,CAA6B,IAA7B;AACD;AACF,KA1E0D;;AA4E3DL,kBAAc,wBAAW;AACvB,UAAIM,qBAAqB,IAAzB;AACA,UAAIC,SAAS,KAAKH,GAAL,CAAS,aAAT,CAAb;;AAEAxC,WAAK4C,QAAL,CAAc,KAAKC,WAAnB,EAAgC,MAAhC;AACA7C,WAAK8C,WAAL,CAAiB,KAAKC,UAAtB,EAAkC,MAAlC;AACA/C,WAAK8C,WAAL,CAAiB,KAAK5B,WAAtB,EAAmC,MAAnC;AACAlB,WAAK8C,WAAL,CAAiB,KAAKzB,UAAtB,EAAkC,MAAlC;AACArB,WAAK8C,WAAL,CAAiB,KAAKxB,QAAtB,EAAgC,MAAhC;;AAEA,UAAIqB,WAAW,MAAf,EAAuB;AACrBD,6BAAqB,KAAKnB,QAA1B;AACD,OAFD,MAEO,IAAGoB,WAAW,OAAd,EAAsB;AAC3BD,6BAAqB,KAAKlB,SAA1B;AACAxB,aAAK4C,QAAL,CAAc,KAAKtB,QAAnB,EAA6B,MAA7B;;AAEA,YAAI,WAAW,KAAKkB,GAAL,CAAS,YAAT,CAAf,EAAuC;AACrC,eAAKxB,GAAL,CAAS,YAAT,EAAuB,SAAvB;AACA,eAAKI,WAAL,CAAiB,SAAjB;AACD;AACF,OARM,MAQA,IAAGuB,WAAW,QAAd,EAAuB;AAC5BD,6BAAqB,KAAKjB,UAA1B;AACAzB,aAAK8C,WAAL,CAAiB,KAAKD,WAAtB,EAAmC,MAAnC;AACA7C,aAAK4C,QAAL,CAAc,KAAKG,UAAnB,EAA+B,MAA/B;AACD;;AAED,UAAGL,sBAAsBA,mBAAmBD,UAA5C,EAAuD;AACrDC,2BAAmBD,UAAnB,CAA8B,IAA9B;AACD;AACF,KAzG0D;;AA2G3DO,oBAAgB,wBAASC,UAAT,EAAqB;AACnC,UAAIC,MAAM,IAAI5C,QAAJ,EAAV;AACA,UAAI2C,WAAWE,YAAX,IAA2BF,WAAWG,aAA1C,EAAyD;AACvDF,YAAIG,OAAJ,CAAYJ,UAAZ;AACD,OAFD,MAEO;AACL9C,oBAAYmD,QAAZ,CAAqB,KAAKC,SAAL,CAAeC,SAApC,EAA+CC,IAA/C,CAAoDrD,KAAKe,KAAL,CAAW,IAAX,EAAiB,UAASuC,KAAT,EAAgB;AACnFT,qBAAWE,YAAX,GAA0BO,UAAU,SAAV,GAAsB,SAAtB,GAAkC,QAA5D;AACAR,cAAIG,OAAJ,CAAYJ,UAAZ;AACD,SAHmD,CAApD;AAID;;AAED,aAAOC,IAAIS,OAAX;AACD,KAvH0D;;AAyH3DC,aAAS,mBAAY;AACnB,UAAI,aAAa,KAAKlD,WAAtB,EAAmC;AACjC,eAAO,KAAKmD,OAAL,CAAaD,OAAb,EAAP;AACD,OAFD,MAEO;AACL,eAAO,IAAP;AACD;AACF,KA/H0D;;AAiI3DvB,eAAW,mBAASvB,MAAT,EAAiB;AAC1B,WAAKA,MAAL,GAAcA,MAAd;;AAEA,WAAKkC,cAAL,CAAoBlC,OAAOC,QAA3B,EAAqC0C,IAArC,CAA0CrD,KAAKe,KAAL,CAAW,IAAX,EAAiB,UAASJ,QAAT,EAAmB;AAC5E,aAAKC,GAAL,CAAS,YAAT,EAAuBD,SAASoC,YAAhC;AACA,aAAK/B,WAAL,CAAiBL,SAASoC,YAA1B;;AAEA,YAAIW,YAAY/C,SAASqC,aAAT,IAA0B,MAA1C;AACA,aAAKpC,GAAL,CAAS,aAAT,EAAwB8C,SAAxB;AACA,aAAK1C,WAAL,CAAiB0C,SAAjB;;AAEA,YAAIC,SAASC,SAASlD,OAAOC,QAAP,CAAgBkD,aAAzB,EAAwC,EAAxC,CAAT,CAAJ,EAA2D;AACzD,eAAKJ,OAAL,CAAa7C,GAAb,CAAiB,OAAjB,EAA0BgD,SAASlD,OAAOC,QAAP,CAAgBkD,aAAzB,EAAwC,EAAxC,CAA1B;AACD;AACD,YAAInD,OAAOC,QAAP,CAAgBmD,YAApB,EAAkC;AAChC,eAAKpC,SAAL,CAAeqC,QAAf,CAAwBrD,OAAOC,QAAP,CAAgBmD,YAAxC;AACD;AACF,OAdyC,CAA1C;AAeD,KAnJ0D;;AAqJ3DE,eAAW,qBAAW;AACpB,UAAI,UAAU,KAAKR,OAAL,EAAd,EAA8B;AAC5B,eAAO,KAAP;AACD;;AAED,WAAK9C,MAAL,CAAYC,QAAZ,CAAqBoC,YAArB,GAAoC,KAAKX,GAAL,CAAS,YAAT,CAApC;AACA,WAAK1B,MAAL,CAAYC,QAAZ,CAAqBqC,aAArB,GAAqC,KAAKZ,GAAL,CAAS,aAAT,CAArC;;AAEA,WAAK1B,MAAL,CAAYC,QAAZ,CAAqBkD,aAArB,GAAqC,KAAKJ,OAAL,CAAarB,GAAb,CAAiB,OAAjB,CAArC;AACA,WAAK1B,MAAL,CAAYC,QAAZ,CAAqBmD,YAArB,GAAoC,KAAKpC,SAAL,CAAeuC,QAAf,EAApC;AACA,aAAO,KAAKvD,MAAZ;AACD,KAhK0D;;AAkK3DM,iBAAa,qBAASkD,IAAT,EAAe;AAC1B,UAAG,KAAKA,IAAL,KAAc,KAAKA,IAAL,EAAW7B,UAA5B,EAAuC;AACrC,aAAK6B,IAAL,EAAW7B,UAAX,CAAsB,IAAtB;AACD;AACF;AAtK0D,GAAtD,CAAP;AAwKD,CA7LH","file":"Setting.js","sourcesContent":["///////////////////////////////////////////////////////////////////////////\r\n// Copyright Â© Esri. All Rights Reserved.\r\n//\r\n// Licensed under the Apache License Version 2.0 (the \"License\");\r\n// you may not use this file except in compliance with the License.\r\n// You may obtain a copy of the License at\r\n//\r\n//    http://www.apache.org/licenses/LICENSE-2.0\r\n//\r\n// Unless required by applicable law or agreed to in writing, software\r\n// distributed under the License is distributed on an \"AS IS\" BASIS,\r\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n// See the License for the specific language governing permissions and\r\n// limitations under the License.\r\n///////////////////////////////////////////////////////////////////////////\r\n\r\ndefine([\r\n    'dojo/_base/declare',\r\n    'dojo/_base/html',\r\n    'dijit/_WidgetsInTemplateMixin',\r\n    'jimu/BaseWidgetSetting',\r\n    'jimu/portalUtils',\r\n    'dojo/_base/lang',\r\n    'dojo/on',\r\n    \"dojo/Deferred\",\r\n    'jimu/dijit/CheckBox',\r\n    \"jimu/dijit/RadioBtn\"\r\n  ],\r\n  function(\r\n    declare,\r\n    html,\r\n    _WidgetsInTemplateMixin,\r\n    BaseWidgetSetting,\r\n    PortalUtils,\r\n    lang,\r\n    on,\r\n    Deferred, CheckBox) {\r\n    return declare([BaseWidgetSetting, _WidgetsInTemplateMixin], {\r\n      //these two properties is defined in the BaseWidget\r\n      baseClass: 'jimu-widget-scalebar-setting',\r\n      selectUnit: '',\r\n      selectStyle: '',\r\n\r\n      startup: function() {\r\n        this.inherited(arguments);\r\n        if (!this.config.scalebar) {\r\n          this.config.scalebar = {};\r\n        }\r\n        this.set('selectUnit', '');\r\n        this.set('selectStyle', '');\r\n\r\n        this.own(on(this.englishNode, 'click', lang.hitch(this, function() {\r\n          this.set('selectUnit', 'english');\r\n          this._selectItem('english');\r\n        })));\r\n        this.own(on(this.metricNode, 'click', lang.hitch(this, function() {\r\n          this.set('selectUnit', 'metric');\r\n          this._selectItem('metric');\r\n        })));\r\n        this.own(on(this.dualNode, 'click', lang.hitch(this, function() {\r\n          this.set('selectUnit', 'dual');\r\n          this._selectItem('dual');\r\n          //this.set('selectStyle', 'line');\r\n          //this._selectItem('line');\r\n        })));\r\n\r\n        this.own(on(this.lineNode, 'click', lang.hitch(this, function() {\r\n          this.set('selectStyle', 'line');\r\n          this._selectItem('line');\r\n        })));\r\n        this.own(on(this.rulerNode, 'click', lang.hitch(this, function() {\r\n          this.set('selectStyle', 'ruler');\r\n          this._selectItem('ruler');\r\n        })));\r\n        this.own(on(this.numberNode, 'click', lang.hitch(this, function() {\r\n          this.set('selectStyle', 'number');\r\n          this._selectItem('number');\r\n        })));\r\n\r\n        this.numberLabel.innerHTML = (window.isRTL ? \"1000 &nbsp;:&nbsp; 1\" : \"1 &nbsp;:&nbsp; 1000\");\r\n\r\n        this.separator = new CheckBox({\r\n          label: this.nls.separator,\r\n          checked: false\r\n        }, this.separator);\r\n\r\n        this.watch('selectUnit', this._updateUnit);\r\n        this.watch('selectStyle', this._updateStyle);\r\n        this.setConfig(this.config);\r\n      },\r\n\r\n      _updateUnit: function() {\r\n        var _selectedUnitNode = null;\r\n        var _unit = this.get('selectUnit');\r\n        if (_unit === 'metric') {\r\n          _selectedUnitNode = this.metricNode;\r\n          //html.setStyle(this.rulerNode, 'display', 'inline-block');\r\n          //html.removeClass(this.rulerNode, \"hide\");\r\n        } else if (_unit === 'dual') {\r\n          _selectedUnitNode = this.dualNode;\r\n          //html.setStyle(this.rulerNode, 'display', 'none');\r\n          //html.addClass(this.rulerNode, \"hide\");\r\n        } else {\r\n          _selectedUnitNode = this.englishNode;\r\n          //html.setStyle(this.rulerNode, 'display', 'inline-block');\r\n          //html.removeClass(this.rulerNode, \"hide\");\r\n        }\r\n\r\n        if(_selectedUnitNode && _selectedUnitNode.setChecked){\r\n          _selectedUnitNode.setChecked(true);\r\n        }\r\n      },\r\n\r\n      _updateStyle: function() {\r\n        var _selectedStyleNode = null;\r\n        var _style = this.get('selectStyle');\r\n\r\n        html.addClass(this.roundNumber, \"hide\");\r\n        html.removeClass(this.unitConfig, \"hide\");\r\n        html.removeClass(this.englishNode, \"hide\");\r\n        html.removeClass(this.metricNode, \"hide\");\r\n        html.removeClass(this.dualNode, \"hide\");\r\n\r\n        if (_style === 'line') {\r\n          _selectedStyleNode = this.lineNode;\r\n        } else if(_style === 'ruler'){\r\n          _selectedStyleNode = this.rulerNode;\r\n          html.addClass(this.dualNode, \"hide\");\r\n\r\n          if (\"dual\" === this.get('selectUnit')) {\r\n            this.set('selectUnit', 'english');\r\n            this._selectItem('english');\r\n          }\r\n        } else if(_style === 'number'){\r\n          _selectedStyleNode = this.numberNode;\r\n          html.removeClass(this.roundNumber, \"hide\");\r\n          html.addClass(this.unitConfig, \"hide\");\r\n        }\r\n\r\n        if(_selectedStyleNode && _selectedStyleNode.setChecked){\r\n          _selectedStyleNode.setChecked(true);\r\n        }\r\n      },\r\n\r\n      _processConfig: function(configJson) {\r\n        var def = new Deferred();\r\n        if (configJson.scalebarUnit && configJson.scalebarStyle) {\r\n          def.resolve(configJson);\r\n        } else {\r\n          PortalUtils.getUnits(this.appConfig.portalUrl).then(lang.hitch(this, function(units) {\r\n            configJson.scalebarUnit = units === 'english' ? 'english' : 'metric';\r\n            def.resolve(configJson);\r\n          }));\r\n        }\r\n\r\n        return def.promise;\r\n      },\r\n\r\n      isValid: function () {\r\n        if ('number' === this.selectStyle) {\r\n          return this.spinner.isValid();\r\n        } else {\r\n          return true;\r\n        }\r\n      },\r\n\r\n      setConfig: function(config) {\r\n        this.config = config;\r\n\r\n        this._processConfig(config.scalebar).then(lang.hitch(this, function(scalebar) {\r\n          this.set('selectUnit', scalebar.scalebarUnit);\r\n          this._selectItem(scalebar.scalebarUnit);\r\n\r\n          var lineStyle = scalebar.scalebarStyle || 'line';\r\n          this.set('selectStyle', lineStyle);\r\n          this._selectItem(lineStyle);\r\n\r\n          if (isFinite(parseInt(config.scalebar.decimalPlaces, 10))) {\r\n            this.spinner.set('value', parseInt(config.scalebar.decimalPlaces, 10));\r\n          }\r\n          if (config.scalebar.addSeparator) {\r\n            this.separator.setValue(config.scalebar.addSeparator);\r\n          }\r\n        }));\r\n      },\r\n\r\n      getConfig: function() {\r\n        if (false === this.isValid()) {\r\n          return false;\r\n        }\r\n\r\n        this.config.scalebar.scalebarUnit = this.get('selectUnit');\r\n        this.config.scalebar.scalebarStyle = this.get('selectStyle');\r\n\r\n        this.config.scalebar.decimalPlaces = this.spinner.get('value');\r\n        this.config.scalebar.addSeparator = this.separator.getValue();\r\n        return this.config;\r\n      },\r\n\r\n      _selectItem: function(name) {\r\n        if(this[name] && this[name].setChecked){\r\n          this[name].setChecked(true);\r\n        }\r\n      }\r\n    });\r\n  });"]}