{"version":3,"sources":["../../../widgets/Coordinate/Widget.js"],"names":["define","declare","html","_WidgetsInTemplateMixin","Point","SpatialReference","BaseWidget","utils","Message","lang","on","domClass","DropDownMenu","MenuItem","aspect","Deferred","esriRequest","Graphic","GraphicsLayer","ProjectParameters","webMercatorUtils","PictureMarkerSymbol","portalUtils","esriConfig","usng","unitUtils","a11y","jimuUnitToNlsLabel","esriUnitsToJimuUnit","clazz","baseClass","name","popMenu","selectedWkid","selectedItem","selectedTfWkid","_defaultItem","forward","enableRealtime","geoServiceUrl","_mapWkid","_configured","_markerGraphic","moveTopOnActive","_ENABLE_MAP_POPUP","postMixInProperties","nls","enableClick","disableClick","postCreate","inherited","arguments","add","coordinateBackground","own","map","hitch","onExtentChange","onMouseMove","onMapClick","a11y_initEvents","graphicsLayer","addLayer","startup","spatialReference","isWebMercator","wkid","config","spatialReferences","length","setStyle","foldableNode","onOpen","_processData","then","domNode","initPopMenu","isHidePopmenu","getChildren","foldContainer","a11y_init","err","console","error","_processMapUnits","mapData","def","units","resolve","sr","exists","tileInfo","ext","extent","initialExtent","fullExtent","latestWkid","that","require","srUtils","loadResource","unit","getCSUnit","basemap","itemInfo","itemData","baseMap","baseMapLayers","getUnits","appConfig","portalUrl","isBingMap","type","isWebTiled","isVectorTile","_getWMSBaseMapInfo","options","url","handleAs","callbackParamName","content","f","unitOptions","_getUnconfiguredUnitOptions","json","outputUnit","_options","sameSRWithMap","defaultUnit","isGeographicUnit","isGeographicCS","isProjectUnit","isProjectedCS","unitRate","reject","label","esriMeters","Error","mapUnits","localeUnits","_mapUnit","_outputUnit","_unitRate","_isGeographicCS","_isGeographicUnit","_isProjectedCS","_isProjectUnit","esriFeet","toUpperCase","getUnitRate","esriDecimalDegrees","coordinateMenu","after","onClickMenu","Object","prototype","toString","call","parseInt","addMenuItem","isDefault","alias","_addAllMenuItems","_setDefaultItme","params","transformationWkid","set","getStatusString","addClass","_adjustCoordinateInfoUI","a11y_initPopMenuEvents","len","i","transformForward","_isWebMercator","apply","canShowInClient","specialCase","option","get","event","removeClass","tfWkid","toggleMenuContainer","coordinateInfoMenu","remove","_getDefaultPlaceHolder","setAttr","locateButton","a11y_setCoordinateInfo","locateContainer","enableWebMapPopup","disableWebMapPopup","setInfoWindowOnClick","onLocateButtonClick","isMenuContainerOpen","onFoldContainerClick","toggleClass","hintMessage","hasClass","onActive","onDeActive","selected","_rtlTheBrackets","defaultLabel","str","rlmFlag","window","isRTL","item","ownerDocument","menuItem","a11y_bindMenuItemEvent","addChild","_toFormat","num","isNaN","localizeNumberByFieldInfo","format","places","decimalPlaces","digitSeparator","addSeparator","onProjectComplete","geometries","point","x","y","_displayUsngOrMgrs","_displayDegOrDms","_displayProject","_unitToNls","outUnit","nlsLabel","onProjectError","msg","message","evt","cPos","position","mPos","root","w","appInfo","isRunInMobile","coordinateMenuContainer","_displayOnClient","getCenter","_projectMapPoint","_getMarkerGraphic","mapPoint","symbol","folderUrl","setOffset","needMarker","setGeometry","outWkid","spheroidCS","transformation","JSON","parse","outSR","computing","defaults","geometryService","project","normalizedPoint","convertInClient","normalize","getLongitude","getLatitude","mCoord","lngLatToXY","_displayCoordinatesByOrder","coordinateInfo","innerHTML","destroy","removeLayer","LLtoMGRS","LLtoUSNG","lat_string","lon_string","degToDMS","degToDDM","displayOrderLonLat","a11y_focusMenuItem","isOpen","decDeg","decDir","d","Math","abs","deg","floor","min","sec","min_string","sec_string","dir","dm","mapWkid","isValidWkid","standardizeWkid","getSRLabel","isSameSR","getGeoCSByProj","_setDefaultItemStyle","isMobileUa","realtimeLabel","extend"],"mappings":"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","file":"Widget.js","sourcesContent":["///////////////////////////////////////////////////////////////////////////\r\n// Copyright © Esri. All Rights Reserved.\r\n//\r\n// Licensed under the Apache License Version 2.0 (the \"License\");\r\n// you may not use this file except in compliance with the License.\r\n// You may obtain a copy of the License at\r\n//\r\n//    http://www.apache.org/licenses/LICENSE-2.0\r\n//\r\n// Unless required by applicable law or agreed to in writing, software\r\n// distributed under the License is distributed on an \"AS IS\" BASIS,\r\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n// See the License for the specific language governing permissions and\r\n// limitations under the License.\r\n///////////////////////////////////////////////////////////////////////////\r\n\r\ndefine([\r\n    'dojo/_base/declare',\r\n    'dojo/_base/html',\r\n    'dijit/_WidgetsInTemplateMixin',\r\n    \"esri/geometry/Point\",\r\n    'esri/SpatialReference',\r\n    'jimu/BaseWidget',\r\n    'jimu/utils',\r\n    'jimu/dijit/Message',\r\n    'dojo/_base/lang',\r\n    'dojo/on',\r\n    \"dojo/dom-class\",\r\n    \"dijit/DropDownMenu\",\r\n    \"dijit/MenuItem\",\r\n    \"dojo/aspect\",\r\n    \"dojo/Deferred\",\r\n    \"esri/request\",\r\n    \"esri/graphic\",\r\n    \"esri/layers/GraphicsLayer\",\r\n    \"esri/tasks/ProjectParameters\",\r\n    \"esri/geometry/webMercatorUtils\",\r\n    \"esri/symbols/PictureMarkerSymbol\",\r\n    \"jimu/portalUtils\",\r\n    \"esri/config\",\r\n    \"libs/usng/usng\",\r\n    \"jimu/SpatialReference/unitUtils\",\r\n    \"./a11y/Widget\"\r\n  ],\r\n  function(\r\n    declare,\r\n    html,\r\n    _WidgetsInTemplateMixin,\r\n    Point,\r\n    SpatialReference,\r\n    BaseWidget,\r\n    utils,\r\n    Message,\r\n    lang,\r\n    on,\r\n    domClass,\r\n    DropDownMenu,\r\n    MenuItem,\r\n    aspect,\r\n    Deferred,\r\n    esriRequest,\r\n    Graphic,\r\n    GraphicsLayer,\r\n    ProjectParameters,\r\n    webMercatorUtils,\r\n    PictureMarkerSymbol,\r\n    portalUtils,\r\n    esriConfig,\r\n    usng,\r\n    unitUtils,\r\n    a11y\r\n  ) {\r\n    var jimuUnitToNlsLabel = {\r\n      \"INCHES\": \"Inches\",\r\n      \"FOOT\": \"Foot\",\r\n      \"FEET\": \"Foot\",\r\n      \"FOOT_US\": \"Foot_US\",\r\n      \"YARDS\": \"Yards\",\r\n      \"MILES\": \"Miles\",\r\n      \"NAUTICAL_MILES\": \"Nautical_Miles\",\r\n      \"MILLIMETERS\": \"Millimeters\",\r\n      \"CENTIMETERS\": \"Centimeters\",\r\n      \"METER\": \"Meter\",\r\n      \"METERS\": \"Meter\",\r\n      \"KILOMETERS\": \"Kilometers\",\r\n      \"DECIMETERS\": \"Decimeters\",\r\n      \"DEGREE\": \"Decimal_Degrees\",\r\n      \"DECIMAL_DEGREES\": \"Decimal_Degrees\",\r\n      \"DEGREES_DECIMAL_MINUTES\":\"Degrees_Decimal_Minutes\",\r\n      \"DEGREE_MINUTE_SECONDS\": \"Degree_Minutes_Seconds\",\r\n      \"MGRS\": \"MGRS\",\r\n      \"USNG\": \"USNG\"\r\n    };\r\n    var esriUnitsToJimuUnit = {\r\n      \"esriCentimeters\": \"CENTIMETERS\",\r\n      \"esriDecimalDegrees\": \"DECIMAL_DEGREES\",\r\n      \"esriDegreeMinuteSeconds\": \"DEGREE_MINUTE_SECONDS\",\r\n      \"esriDecimeters\": \"DECIMETERS\",\r\n      \"esriFeet\": \"FOOT\",\r\n      \"esriInches\": \"INCHES\",\r\n      \"esriKilometers\": \"KILOMETERS\",\r\n      \"esriMeters\": \"METER\",\r\n      \"esriMiles\": \"MILES\",\r\n      \"esriMillimeters\": \"MILLIMETERS\",\r\n      \"esriNauticalMiles\": \"NAUTICAL_MILES\",\r\n      \"esriPoints\": \"POINTS\",\r\n      \"esriUnknownUnits\": \"UNKNOWN\",\r\n      \"esriYards\": \"YARDS\"\r\n    };\r\n    /**\r\n     * The Coordinate widget displays the current mouse coordinates.\r\n     * If the map's spatial reference is geographic or web mercator,\r\n     * the coordinates can be displayed as\r\n     * decimal degrees or as degree-minute-seconds.\r\n     * Otherwise, the coordinates will show in map units.\r\n     *\r\n     * @module widgets/Coordinate\r\n     */\r\n    var clazz = declare([BaseWidget, _WidgetsInTemplateMixin], {\r\n      /**\r\n      * realtime: {\r\n      *   102100: all unit,\r\n      *   4326: geoUnit,usng,mgrs,\r\n      *   projCS: projUnit,\r\n      *   geoCS: geoUnit,usng,mgrs,\r\n      * }\r\n      * click: {\r\n      *   projectCS: {\r\n      *     geoUnit:  convert to ellipsoidal coordinates,\r\n      *     projUnit: convert on client,\r\n      *     usng、mgrs: get longtitude and latitude, then convert to usng/mgrs on client,\r\n      *   },\r\n      *   geoCS: {\r\n      *     geoUnit: convert to ellipsoidal coordinates,\r\n      *     usng、mgrs: get longtitude and latitude, then convert to usng/mgrs on client\r\n      *   }\r\n      * }\r\n      */\r\n\r\n      baseClass: 'jimu-widget-coordinate',\r\n      name: 'Coordinate',\r\n      popMenu: null,\r\n      selectedWkid: null,\r\n      selectedItem: null,\r\n      selectedTfWkid: null,\r\n      _defaultItem: null,//for config upgrade from 6.3\r\n      forward: true,\r\n      enableRealtime: false,\r\n      geoServiceUrl: null,\r\n\r\n      _mapWkid: null,\r\n      _configured: false,\r\n      _markerGraphic: null,\r\n\r\n      moveTopOnActive: false,\r\n\r\n      _ENABLE_MAP_POPUP: false,\r\n\r\n      postMixInProperties: function() {\r\n        this.nls.enableClick = this.nls.enableClick ||\r\n          \"Click to enable clicking map to get coordinates\";\r\n        this.nls.disableClick = this.nls.disableClick ||\r\n          \"Click to disable clicking map to get coordinates\";\r\n      },\r\n\r\n      postCreate: function() {\r\n        this.inherited(arguments);\r\n        domClass.add(this.coordinateBackground, \"coordinate-background\");\r\n        this.own(on(this.map, \"extent-change\", lang.hitch(this, this.onExtentChange)));\r\n        this.own(on(this.map, \"mouse-move\", lang.hitch(this, this.onMouseMove)));\r\n        this.own(on(this.map, \"click\", lang.hitch(this, this.onMapClick)));\r\n\r\n        this.a11y_initEvents();\r\n\r\n        this.graphicsLayer = new GraphicsLayer();\r\n        this.map.addLayer(this.graphicsLayer);\r\n      },\r\n\r\n      startup: function() {\r\n        this.inherited(arguments);\r\n        this._mapWkid = this.map.spatialReference.isWebMercator() ?\r\n          3857 : this.map.spatialReference.wkid;\r\n        this.selectedWkid = this._mapWkid;\r\n\r\n        if (!(this.config.spatialReferences && this.config.spatialReferences.length > 1)) {\r\n          html.setStyle(this.foldableNode, 'display', 'none');\r\n        } else {\r\n          html.setStyle(this.foldableNode, 'display', 'inline-block');\r\n        }\r\n      },\r\n\r\n      onOpen: function() {\r\n        this._processData().then(lang.hitch(this, function(spatialReferences) {\r\n          if (!this.domNode) {\r\n            return;\r\n          }\r\n          this.initPopMenu(spatialReferences);\r\n\r\n          var isHidePopmenu = (this.popMenu.getChildren().length <= 1);\r\n          if (isHidePopmenu) {\r\n            html.setStyle(this.foldContainer, 'display', 'none');\r\n          }\r\n\r\n          this.a11y_init({ isHidePopmenu: isHidePopmenu });\r\n        }), lang.hitch(this, function(err) {\r\n          console.error(err);\r\n        }));\r\n      },\r\n\r\n      _processMapUnits: function(mapData) {\r\n        var def = new Deferred();\r\n        if (mapData.units) {\r\n          def.resolve(mapData);\r\n        } else {\r\n          // MapServer or VectorTileServer\r\n          var sr = mapData.spatialReference ||\r\n            (lang.exists('tileInfo.spatialReference', mapData) &&\r\n              mapData.tileInfo.spatialReference);\r\n          var ext = mapData.extent || mapData.initialExtent || mapData.fullExtent;\r\n          var wkid = (sr && (sr.latestWkid || sr.wkid)) ||\r\n            (ext && ext.spatialReference && ext.spatialReference.wkid);\r\n          var that = this;\r\n          require(['jimu/SpatialReference/srUtils'], function(srUtils) {\r\n            srUtils.loadResource().then(lang.hitch(that, function() {\r\n              var unit = srUtils.getCSUnit(wkid);\r\n              mapData.units = unit;\r\n\r\n              def.resolve(mapData);\r\n            }));\r\n          });\r\n        }\r\n        return def;\r\n      },\r\n\r\n      _processData: function() {\r\n        var def = new Deferred();\r\n\r\n        // types of basemap: mapServer, imageServer, bingMap, openStreetMap, webTiledMap\r\n        var basemap = this.map.itemInfo.itemData.baseMap.baseMapLayers[0];\r\n        if (!(this.config.spatialReferences && this.config.spatialReferences.length)) {\r\n          portalUtils.getUnits(this.appConfig.portalUrl).then(lang.hitch(this, function(units) {\r\n            var isBingMap = basemap && (basemap.type === \"BingMapsRoad\" ||\r\n              basemap.type === \"BingMapsHybrid\" || basemap.type === \"BingMapsAerial\");\r\n            var isWebTiled = basemap && basemap.type === 'WebTiledLayer';\r\n            var isVectorTile = basemap && basemap.type === 'VectorTileLayer';\r\n            if(\"WMS\" === basemap.type){\r\n              //support WMS basemap\r\n              this._getWMSBaseMapInfo().then(lang.hitch(this, function (options) {\r\n                this._configured = false;\r\n                def.resolve(options);\r\n              }));\r\n            } else if (basemap && basemap.url) {\r\n              esriRequest({\r\n                url: basemap.url,\r\n                handleAs: \"json\",\r\n                callbackParamName: \"callback\",\r\n                content: {\r\n                  f: \"json\"\r\n                }\r\n              }).then(lang.hitch(this, function(mapData) {\r\n                this._processMapUnits(mapData).then(lang.hitch(this, function(mapData) {\r\n                  var unitOptions = this._getUnconfiguredUnitOptions(mapData.units, units);\r\n                  var sr = mapData.spatialReference;\r\n                  var ext = mapData.extent;\r\n                  var wkid = (sr && (sr.latestWkid || sr.wkid)) ||\r\n                    (ext && ext.spatialReference && ext.spatialReference.wkid);\r\n                  var json = {\r\n                    'wkid': wkid,\r\n                    'label': \"\",\r\n                    'outputUnit': unitOptions.outputUnit\r\n                  };\r\n                  var _options = {\r\n                    sameSRWithMap: true,\r\n                    defaultUnit: esriUnitsToJimuUnit[mapData.units] || mapData.units,\r\n                    isGeographicUnit: unitOptions.isGeographicUnit,\r\n                    isGeographicCS: unitOptions.isGeographicCS,\r\n                    isProjectUnit: unitOptions.isProjectUnit,\r\n                    isProjectedCS: unitOptions.isProjectedCS,\r\n                    unitRate: unitOptions.unitRate\r\n                  };\r\n                  json.options = _options;\r\n\r\n                  this._configured = false;\r\n                  def.resolve(json);\r\n                }));\r\n              }), lang.hitch(this, function(err) {\r\n                console.error(err);\r\n                def.reject(err);\r\n              }));\r\n            } else if (basemap &&\r\n              (basemap.type === \"OpenStreetMap\" || isBingMap || isWebTiled || isVectorTile)) {\r\n              var unitOptions = this._getUnconfiguredUnitOptions(\"esriMeters\", units);\r\n              var json = {\r\n                wkid: 3857,\r\n                label: \"\",\r\n                outputUnit: unitOptions.outputUnit\r\n              };\r\n              var _options = {\r\n                sameSRWithMap: true,\r\n                defaultUnit: esriUnitsToJimuUnit.esriMeters,\r\n                isGeographicUnit: unitOptions.isGeographicUnit,\r\n                isGeographicCS: unitOptions.isGeographicCS,\r\n                isProjectUnit: unitOptions.isProjectUnit,\r\n                isProjectedCS: unitOptions.isProjectedCS,\r\n                unitRate: unitOptions.unitRate\r\n              };\r\n              json.options = _options;\r\n\r\n              this._configured = false;\r\n              def.resolve(json);\r\n            } else {\r\n              def.reject(new Error(\"no baseMap\"));\r\n            }\r\n          }));\r\n        } else {\r\n          this._configured = true;\r\n          def.resolve(this.config.spatialReferences);\r\n        }\r\n\r\n        return def;\r\n      },\r\n\r\n      _getUnconfiguredUnitOptions: function(mapUnits, localeUnits) {\r\n        var _mapUnit = esriUnitsToJimuUnit[mapUnits] || mapUnits,\r\n          _outputUnit = \"\",\r\n          _unitRate = 1,\r\n          _isGeographicCS = \"\",\r\n          _isGeographicUnit = \"\",\r\n          _isProjectedCS = \"\",\r\n          _isProjectUnit = \"\";\r\n\r\n        if (unitUtils.isProjectUnit(_mapUnit)) {\r\n          _isProjectUnit = true;\r\n          _isProjectedCS = true;\r\n          _isGeographicUnit = false;\r\n          _isGeographicCS = false;\r\n          _outputUnit = localeUnits === \"english\" ?\r\n            esriUnitsToJimuUnit.esriFeet.toUpperCase() :\r\n            esriUnitsToJimuUnit.esriMeters.toUpperCase();\r\n          _unitRate = unitUtils.getUnitRate(\r\n            _mapUnit.toUpperCase(),\r\n            _outputUnit\r\n          );\r\n        } else if (unitUtils.isGeographicUnit(_mapUnit)) {\r\n          _isProjectUnit = false;\r\n          _isProjectedCS = false;\r\n          _isGeographicUnit = true;\r\n          _isGeographicCS = true;\r\n          _outputUnit = _mapUnit.toUpperCase();\r\n        }\r\n\r\n        //default show mercator is degrees.\r\n        if (this.map.spatialReference.isWebMercator()) {\r\n          _outputUnit = esriUnitsToJimuUnit.esriDecimalDegrees;\r\n          _isGeographicUnit = true;\r\n          _isProjectUnit = false;\r\n          _unitRate = 1;\r\n        }\r\n\r\n        return {\r\n          outputUnit: _outputUnit,\r\n          unitRate: _unitRate,\r\n          isGeographicUnit: _isGeographicUnit,\r\n          isGeographicCS: _isGeographicCS,\r\n          isProjectUnit: _isProjectUnit,\r\n          isProjectedCS: _isProjectedCS\r\n        };\r\n      },\r\n\r\n      initPopMenu: function(spatialReferences) {\r\n        this.popMenu = new DropDownMenu({}, this.coordinateMenu);\r\n        aspect.after(this.popMenu, \"onItemClick\", lang.hitch(this, this.onClickMenu), true);\r\n        //if configured spatialReferences use\r\n        //the first sr as defalut else add the map sr as default.\r\n        if (Object.prototype.toString.call(spatialReferences) !== \"[object Array]\") {\r\n          //1.without spatialReferences[]\r\n          this.selectedWkid = parseInt(spatialReferences.wkid, 10);\r\n          this.addMenuItem(\r\n            '',\r\n            this.selectedWkid,\r\n            spatialReferences.outputUnit,\r\n            null,\r\n            null,\r\n            spatialReferences.options,\r\n            spatialReferences.isDefault,\r\n            spatialReferences.alias\r\n          );\r\n          this.selectedItem = this.popMenu.getChildren()[0];\r\n        } else {\r\n          //2.with spatialReferences[]\r\n          this._addAllMenuItems();\r\n          this._setDefaultItme();\r\n\r\n          if (null === this.selectedItem) {\r\n            this.selectedItem = this.popMenu.getChildren()[0]; //for default\r\n          }\r\n        }\r\n\r\n        this.selectedWkid = parseInt(this.selectedItem.params.wkid, 10);\r\n        this.selectedTfWkid = this.selectedItem.params.transformationWkid &&\r\n          parseInt(this.selectedItem.params.transformationWkid, 10);\r\n        this.selectedItem.set({\r\n          label: this.getStatusString(\r\n            true,//set it selected\r\n            (this.selectedItem.params.alias || this.selectedItem.params.name),\r\n            this.selectedItem.params.wkid,\r\n            this.selectedItem.params.isDefault\r\n          )\r\n        });\r\n        html.addClass(this.selectedItem.domNode, 'selected-item');\r\n\r\n        this._adjustCoordinateInfoUI(this.selectedWkid);\r\n        this.popMenu.startup();\r\n\r\n        this.a11y_initPopMenuEvents();\r\n      },\r\n\r\n      _addAllMenuItems: function() {\r\n        var len = this.config.spatialReferences.length;\r\n        for (var i = 0; i < len; i++) {\r\n          this.addMenuItem(\r\n            this.config.spatialReferences[i].label,\r\n            this.config.spatialReferences[i].wkid,\r\n            this.config.spatialReferences[i].outputUnit,\r\n            this.config.spatialReferences[i].transformationWkid,\r\n            this.config.spatialReferences[i].transformForward,\r\n            this.config.spatialReferences[i].options,\r\n            this.config.spatialReferences[i].isDefault,\r\n            this.config.spatialReferences[i].alias\r\n          );\r\n        }\r\n      },\r\n\r\n      _isWebMercator: function(wkid) {\r\n        // true if this spatial reference is web mercator\r\n        if (SpatialReference.prototype._isWebMercator) {\r\n          return SpatialReference.prototype._isWebMercator.apply({\r\n            wkid: parseInt(wkid, 10)\r\n          }, []);\r\n        } else {\r\n          var sr = new SpatialReference(parseInt(wkid, 10));\r\n          return sr.isWebMercator();\r\n        }\r\n      },\r\n\r\n      canShowInClient: function(wkid) {\r\n        var specialCase = (this._mapWkid === 4326 && this._isWebMercator(wkid)) ||\r\n          (this._isWebMercator(this._mapWkid) && parseInt(wkid, 10) === 4326);\r\n        var option = this.selectedItem.get('options');\r\n        if ((option && option.sameSRWithMap) || specialCase) {\r\n          return true;\r\n        } else {\r\n          return false;\r\n        }\r\n      },\r\n\r\n      onClickMenu: function(event) {\r\n        html.removeClass(this.selectedItem.domNode, 'selected-item');\r\n        this.selectedItem.set({\r\n          label: this.getStatusString(\r\n            false,\r\n            (this.selectedItem.params.alias || this.selectedItem.params.name),\r\n            this.selectedItem.params.wkid,\r\n            this.selectedItem.params.isDefault\r\n          )\r\n        });\r\n        this.selectedWkid = parseInt(event.params.wkid, 10);\r\n        this.selectedTfWkid = event.params.tfWkid;\r\n        this.forward = event.params.forward;\r\n        event.set({\r\n          label: this.getStatusString(true, (event.params.alias || event.params.name),\r\n            event.params.wkid, event.params.isDefault)\r\n        });\r\n        html.addClass(event.domNode, 'selected-item');\r\n        this.selectedItem = event;\r\n\r\n        this._adjustCoordinateInfoUI(this.selectedWkid);\r\n\r\n        this.toggleMenuContainer(false);\r\n      },\r\n\r\n      _adjustCoordinateInfoUI: function(selectedWkid) {\r\n        html.removeClass(this.coordinateInfoMenu, 'coordinate-info-menu-empty');\r\n        this.graphicsLayer.remove(this._markerGraphic);\r\n        this._markerGraphic = null;\r\n        if (this.canShowInClient(selectedWkid)) {\r\n          this.enableRealtime = true;\r\n          this._getDefaultPlaceHolder();\r\n          html.setAttr(this.locateButton, 'title', this.nls.enableClick);\r\n        } else {\r\n          this.enableRealtime = false;\r\n          //this.coordinateInfo.innerHTML = \"\";\r\n          this.a11y_setCoordinateInfo(\"\");\r\n          html.addClass(this.coordinateInfoMenu, 'coordinate-info-menu-empty');\r\n          html.setAttr(this.locateButton, 'title', this.nls.enableClick);\r\n        }\r\n        html.removeClass(this.locateContainer, 'coordinate-locate-container-active');\r\n        this.enableWebMapPopup();\r\n\r\n        this.onExtentChange({\r\n          extent: this.map.extent\r\n        });\r\n      },\r\n\r\n      disableWebMapPopup: function() {\r\n        this._ENABLE_MAP_POPUP = false;\r\n        this.map.setInfoWindowOnClick(false);\r\n      },\r\n\r\n      enableWebMapPopup: function() {\r\n        this._ENABLE_MAP_POPUP = true;\r\n        this.map.setInfoWindowOnClick(true);\r\n      },\r\n\r\n      onLocateButtonClick: function() {\r\n        if (this.isMenuContainerOpen()) {\r\n          this.onFoldContainerClick();\r\n        }\r\n        html.removeClass(this.coordinateInfoMenu, 'coordinate-info-menu-empty');\r\n        html.toggleClass(this.locateContainer, 'coordinate-locate-container-active');\r\n        this.graphicsLayer.remove(this._markerGraphic);\r\n        this._markerGraphic = null;\r\n        if (this.canShowInClient(this.selectedWkid)) {\r\n          if (this.enableRealtime) {\r\n            this.enableRealtime = false;\r\n            //this.coordinateInfo.innerHTML = this.nls.hintMessage;\r\n            this.a11y_setCoordinateInfo(this.nls.hintMessage);\r\n            html.setAttr(this.locateButton, 'title', this.nls.disableClick);\r\n            this.disableWebMapPopup();\r\n          } else {\r\n            this.enableRealtime = true;\r\n            this._getDefaultPlaceHolder();\r\n            html.setAttr(this.locateButton, 'title', this.nls.enableClick);\r\n            this.enableWebMapPopup();\r\n          }\r\n        } else {\r\n          if (html.hasClass(this.locateContainer, 'coordinate-locate-container-active')) {\r\n            //this.coordinateInfo.innerHTML = this.nls.hintMessage;\r\n            this.a11y_setCoordinateInfo(this.nls.hintMessage);\r\n            this.disableWebMapPopup();\r\n            html.setAttr(this.locateButton, 'title', this.nls.disableClick);\r\n          } else {\r\n            //this.coordinateInfo.innerHTML = \"\";\r\n            this.a11y_setCoordinateInfo(\"\");\r\n            html.addClass(this.coordinateInfoMenu, 'coordinate-info-menu-empty');\r\n            this.enableWebMapPopup();\r\n            html.setAttr(this.locateButton, 'title', this.nls.enableClick);\r\n          }\r\n        }\r\n      },\r\n\r\n      onActive: function () {\r\n        if (!this.locateContainer || !html.hasClass(this.locateContainer, 'coordinate-locate-container-active')) {\r\n          return;\r\n        }\r\n\r\n        if (this._ENABLE_MAP_POPUP === true) {\r\n          this.enableWebMapPopup();//trigger after other widgets onDeActive\r\n        } else {\r\n          this.disableWebMapPopup();\r\n        }\r\n      },\r\n\r\n      onDeActive: function() {\r\n        if (html.hasClass(this.locateContainer, 'coordinate-locate-container-active')) {\r\n          this.onLocateButtonClick();\r\n        }\r\n        if (this.isMenuContainerOpen()) {\r\n          this.onFoldContainerClick();\r\n        }\r\n      },\r\n\r\n      getStatusString: function(selected, name, wkid, isDefault) {\r\n        var label = \"\";\r\n        wkid = parseInt(wkid, 10);\r\n\r\n        if (selected) {\r\n          label = \"<b>\" + label + name + \"</b>&nbsp;\" + this._rtlTheBrackets(wkid) + \"&nbsp;\";\r\n        } else {\r\n          label = label + name + \"&nbsp;&nbsp;\" + this._rtlTheBrackets(wkid) + \"&nbsp;\";\r\n        }\r\n\r\n        if (isDefault) {\r\n          label += this.nls.defaultLabel;//show nls\r\n        }\r\n        return label;\r\n      },\r\n\r\n      _rtlTheBrackets: function(str) {\r\n        var rlmFlag = \"&rlm;\";\r\n        if (window.isRTL) {\r\n          return rlmFlag + \"(\" + str + \")\";\r\n        } else {\r\n          return \"(\" + str + \")\";\r\n        }\r\n      },\r\n\r\n      addMenuItem: function(name, wkid, outputUnit, tfWkid, forward, _options, isDefault, alias) {\r\n        var label = this.getStatusString(false, (alias || name), wkid, isDefault);\r\n        var item = {\r\n          label: label || \"\",\r\n          name: name || \"\",\r\n          wkid: wkid || \"\",\r\n          outputUnit: outputUnit || \"\",\r\n          tfWkid: tfWkid || \"\",\r\n          options: _options,\r\n          isDefault: isDefault,\r\n          alias: alias,\r\n          ownerDocument: this.ownerDocument\r\n        };\r\n        if (item.tfWkid) {\r\n          item.forward = forward;\r\n        }\r\n\r\n        var menuItem = new MenuItem(item);\r\n        this.a11y_bindMenuItemEvent(menuItem);\r\n\r\n        this.popMenu.addChild(menuItem);\r\n      },\r\n\r\n      _toFormat: function(num) {\r\n        /*var decimalPlaces = isFinite(parseInt(this.config.decimalPlaces, 10)) ?\r\n          parseInt(this.config.decimalPlaces, 10) : 3;\r\n        var decimalStr = num.toString().split('.')[1] || \"\",\r\n          decimalLen = decimalStr.length,\r\n          patchStr = \"\",\r\n          fix = decimalLen < decimalPlaces ? decimalLen : decimalPlaces;\r\n\r\n        if (decimalLen < decimalPlaces) {\r\n          patchStr = Array.prototype.join.call({\r\n            length: decimalPlaces - decimalLen + 1\r\n          }, '0');\r\n        }\r\n\r\n        num = num.toFixed(fix) + patchStr;\r\n        return this.separator(num, decimalPlaces);*/\r\n        if(isNaN(num)){\r\n          return \"\";\r\n        }\r\n\r\n        return utils.localizeNumberByFieldInfo(num, {\r\n          format: {\r\n            places: this.config.decimalPlaces,\r\n            digitSeparator: this.config.addSeparator\r\n          }\r\n        });\r\n      },\r\n\r\n      onProjectComplete: function(wkid, geometries) {\r\n        if (!this.selectedWkid || wkid !== this.selectedWkid || !this.domNode) {\r\n          return;\r\n        }\r\n        var point = geometries[0],\r\n\r\n          x = point.x,\r\n          y = point.y;\r\n        var outputUnit = this.selectedItem.get('outputUnit');\r\n        var options = this.selectedItem.get('options');\r\n\r\n        if (\"MGRS\" === outputUnit || \"USNG\" === outputUnit) {\r\n          this._displayUsngOrMgrs(outputUnit, y, x);\r\n        } else if (options.isGeographicUnit) {\r\n          this._displayDegOrDms(outputUnit, y, x);\r\n        } else {\r\n          this._displayProject(outputUnit, y, x);\r\n        }\r\n      },\r\n\r\n      _unitToNls: function(outUnit) {\r\n        var nlsLabel = jimuUnitToNlsLabel[outUnit.toUpperCase()];\r\n        return this.nls[nlsLabel] || this.nls[outUnit] || outUnit;\r\n      },\r\n\r\n      onProjectError: function(msg) {\r\n        new Message({message: msg.message || msg.toString()});\r\n        //this.coordinateInfo.innerHTML = this.nls.hintMessage;\r\n        this.a11y_setCoordinateInfo(this.nls.hintMessage);\r\n      },\r\n\r\n      onExtentChange: function(evt) {\r\n        if (!this.selectedItem) {\r\n          return;\r\n        }\r\n\r\n        var cPos = html.position(this.domNode);\r\n        var mPos = html.position(this.map.root);\r\n\r\n        if (!window.isRTL) {\r\n          if ((cPos.x - mPos.x + cPos.w) + 5 >= mPos.w) {\r\n            if ('left' in this.position) {\r\n              html.setStyle(this.domNode, 'right', '5px');\r\n            } else {\r\n              html.setStyle(this.domNode, 'left', '5px');\r\n            }\r\n          }\r\n        } else {\r\n          if (cPos.x - mPos.x <= 0 || (cPos.x - mPos.x + cPos.w) + 5 >= mPos.w) {\r\n            if ('left' in this.position) {\r\n              html.setStyle(this.domNode, 'left', '5px');\r\n            } else {\r\n              html.setStyle(this.domNode, 'right', '5px');\r\n            }\r\n          }\r\n        }\r\n\r\n        if (window.appInfo.isRunInMobile) {\r\n          this.graphicsLayer.remove(this._markerGraphic);\r\n          this._markerGraphic = null;\r\n          html.setStyle(this.locateContainer, 'display', 'none');\r\n          // this.toggleMenuContainer(false);\r\n          html.removeClass(this.coordinateMenuContainer, 'display-coordinate-menu');\r\n          html.setStyle(this.domNode, 'zIndex', 'auto');//change popup z-index=auto\r\n\r\n          if (this.canShowInClient(this.selectedWkid)) {\r\n            this._displayOnClient(evt.extent.getCenter());\r\n          } else {\r\n            this._projectMapPoint(evt.extent.getCenter());\r\n          }\r\n        } else {\r\n          html.setStyle(this.locateContainer, 'display', 'block');\r\n          if (this.popMenu.getChildren().length > 1) {\r\n            html.setStyle(this.foldContainer, 'display', 'block');\r\n          } else {\r\n            html.setStyle(this.foldContainer, 'display', 'none');\r\n          }\r\n        }\r\n      },\r\n\r\n      _getMarkerGraphic: function(mapPoint) {\r\n        var symbol = new PictureMarkerSymbol(\r\n          this.folderUrl + \"css/images/esriGreenPin16x26.png\",\r\n          16, 26\r\n          );\r\n        symbol.setOffset(0, 12);\r\n        return new Graphic(mapPoint, symbol);\r\n      },\r\n\r\n      onMapClick: function(evt) {\r\n        if (window.appInfo.isRunInMobile) {\r\n          return;\r\n        }\r\n        if (this.enableRealtime || !this.selectedItem) {\r\n          return;\r\n        }\r\n        var needMarker = this.canShowInClient(this.selectedWkid) ||\r\n          html.hasClass(this.locateContainer, 'coordinate-locate-container-active');\r\n        if (needMarker && !this._markerGraphic) {\r\n          this._markerGraphic = this._getMarkerGraphic(evt.mapPoint);\r\n          this.graphicsLayer.add(this._markerGraphic);\r\n        }\r\n\r\n        if (this.canShowInClient(this.selectedWkid)) {\r\n          this._markerGraphic.setGeometry(evt.mapPoint);\r\n          this._displayOnClient(evt.mapPoint);\r\n          return;\r\n        }\r\n\r\n        if (html.hasClass(this.locateContainer, 'coordinate-locate-container-active')) {\r\n          this._markerGraphic.setGeometry(evt.mapPoint);\r\n          var point = new Point(evt.mapPoint.x, evt.mapPoint.y, this.map.spatialReference);\r\n          this._projectMapPoint(point);\r\n        }\r\n      },\r\n\r\n      _projectMapPoint: function(point) {\r\n        var params = new ProjectParameters();\r\n        var outWkid = null;\r\n        var options = this.selectedItem.get('options');\r\n        params.geometries = [point];\r\n\r\n        if (options.isProjectedCS) {\r\n          if (options.isProjectUnit) {\r\n            outWkid = this.selectedWkid;\r\n          } else { // geoUnit or USNG, MGRS\r\n            outWkid = options.spheroidCS;\r\n          }\r\n        } else if (options.isGeographicCS) {\r\n          outWkid = this.selectedWkid;\r\n        }\r\n\r\n        if (this.selectedTfWkid) {\r\n          params.transformation = new SpatialReference(parseInt(this.selectedTfWkid, 10));\r\n          params.transformForward = JSON.parse(this.forward);\r\n        }\r\n\r\n        params.outSR = new SpatialReference(parseInt(outWkid, 10));\r\n\r\n        //this.coordinateInfo.innerHTML = this.nls.computing;\r\n        this.a11y_setCoordinateInfo(this.nls.computing);\r\n        esriConfig.defaults.geometryService.project(params,\r\n          lang.hitch(this, this.onProjectComplete, this.selectedWkid),\r\n          lang.hitch(this, this.onProjectError)\r\n        );\r\n      },\r\n\r\n      _displayOnClient: function(mapPoint) {\r\n        var outUnit = this.selectedItem.get('outputUnit');\r\n\r\n        var x = mapPoint.x,\r\n          y = mapPoint.y;\r\n\r\n        var normalizedPoint = null;\r\n        var convertInClient = (this._mapWkid === 4326 && this._isWebMercator(this.selectedWkid)) ||\r\n          (this._isWebMercator(this._mapWkid) && this.selectedWkid === 4326);\r\n        var options = this.selectedItem.get('options');\r\n\r\n        // make sure longitude values stays within -180/180\r\n        normalizedPoint = mapPoint.normalize();\r\n        if (options.isGeographicUnit) {\r\n          x = normalizedPoint.getLongitude() || x;\r\n        }\r\n        if (options.isGeographicUnit) {\r\n          y = normalizedPoint.getLatitude() || y;\r\n        }\r\n\r\n        if (convertInClient) {\r\n          // process special case\r\n          if (mapPoint.spatialReference.wkid === 4326 && this._isWebMercator(this.selectedWkid)) {\r\n            if (\"MGRS\" === outUnit || \"USNG\" === outUnit) {\r\n              this._displayUsngOrMgrs(\r\n                outUnit,\r\n                normalizedPoint.getLatitude(),\r\n                normalizedPoint.getLongitude()\r\n              );\r\n            } else if (options.isGeographicUnit) {\r\n              this._displayDegOrDms(outUnit, y, x);\r\n            } else if (options.isProjectUnit) {\r\n              var mCoord = webMercatorUtils.lngLatToXY(x, y);\r\n              this._displayProject(outUnit, mCoord[1], mCoord[0]);\r\n            }\r\n          } else if (mapPoint.spatialReference.isWebMercator() &&\r\n            this.selectedWkid === 4326) {\r\n            if (\"MGRS\" === outUnit || \"USNG\" === outUnit) {\r\n              this._displayUsngOrMgrs(\r\n                outUnit,\r\n                normalizedPoint.getLatitude(),\r\n                normalizedPoint.getLongitude()\r\n              );\r\n            } else if (options.isGeographicUnit) {\r\n              this._displayDegOrDms(outUnit, y, x);\r\n            }\r\n          }\r\n        } else {\r\n          // use default units\r\n          if (options.defaultUnit === outUnit) {\r\n            this._displayCoordinatesByOrder(this._toFormat(x), this._toFormat(y));\r\n            //this.coordinateInfo.innerHTML += \" \" + this._unitToNls(outUnit);\r\n            this.a11y_setCoordinateInfo((this.coordinateInfo.innerHTML += \" \" + this._unitToNls(outUnit)));\r\n            return;\r\n          }\r\n          // setting display units\r\n          if (mapPoint.spatialReference.wkid === 4326 ||\r\n            mapPoint.spatialReference.isWebMercator()) {\r\n            if (\"MGRS\" === outUnit || \"USNG\" === outUnit) {\r\n              this._displayUsngOrMgrs(\r\n                outUnit,\r\n                normalizedPoint.getLatitude(),\r\n                normalizedPoint.getLongitude()\r\n              );\r\n            } else if (options.isGeographicUnit) {\r\n              this._displayDegOrDms(outUnit, y, x);\r\n            } else if (options.isProjectedCS) {\r\n              this._displayProject(outUnit, y, x);\r\n            }\r\n          } else { // proj or geo\r\n            if (options.isProjectedCS) {\r\n              this._displayProject(outUnit, y, x);\r\n            } else if (options.isGeographicCS) {\r\n              if (\"MGRS\" === outUnit || \"USNG\" === outUnit) {\r\n                this._displayUsngOrMgrs(outUnit, y, x);\r\n              } else if (options.isGeographicUnit) {\r\n                this._displayDegOrDms(outUnit, y, x);\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n\r\n      onMouseMove: function(evt) {\r\n        if (window.appInfo.isRunInMobile) {\r\n          return;\r\n        }\r\n        if (!this.enableRealtime || !this.selectedItem) {\r\n          return;\r\n        }\r\n\r\n        this._displayOnClient(evt.mapPoint);\r\n      },\r\n\r\n      destroy: function() {\r\n        if (this._markerGraphic) {\r\n          this.graphicsLayer.remove(this._markerGraphic);\r\n        }\r\n        if (this.graphicsLayer) {\r\n          this.map.removeLayer(this.graphicsLayer);\r\n        }\r\n\r\n        this.inherited(arguments);\r\n      },\r\n\r\n      _displayUsngOrMgrs: function(outUnit, y, x) {\r\n        if (\"MGRS\" === outUnit) {\r\n          //this.coordinateInfo.innerHTML = usng.LLtoMGRS(y, x, 5);\r\n          this.a11y_setCoordinateInfo(usng.LLtoMGRS(y, x, 5));\r\n        } else if (\"USNG\" === outUnit) {\r\n          //this.coordinateInfo.innerHTML = usng.LLtoUSNG(y, x, 5);\r\n          this.a11y_setCoordinateInfo(usng.LLtoUSNG(y, x, 5));\r\n        }\r\n\r\n        if (isNaN(y) && isNaN(x)) {\r\n          //this.coordinateInfo.innerHTML = \"\";\r\n          this.a11y_setCoordinateInfo(\"\");\r\n        } else {\r\n          //this.coordinateInfo.innerHTML += \" \" + this._unitToNls(outUnit);\r\n          this.a11y_setCoordinateInfo((this.coordinateInfo.innerHTML += \" \" + this._unitToNls(outUnit)));\r\n        }\r\n      },\r\n\r\n      _displayDegOrDms: function(outUnit, y, x) {\r\n        var lat_string = \"\";\r\n        var lon_string = \"\";\r\n        var options = this.selectedItem.get('options');\r\n\r\n        x = x * options.unitRate;\r\n        y = y * options.unitRate;\r\n\r\n        if (\"DEGREE_MINUTE_SECONDS\" === outUnit) {\r\n          lon_string = this.degToDMS(x, 'LON');\r\n          lat_string = this.degToDMS(y, 'LAT');\r\n          this._displayCoordinatesByOrder(lon_string, lat_string);\r\n        } else if (\"DEGREES_DECIMAL_MINUTES\" === outUnit){\r\n          //for hack DEGREES_DECIMAL_MINUTES\r\n          lon_string = this.degToDDM(x);\r\n          lat_string = this.degToDDM(y);\r\n          this._displayCoordinatesByOrder(lon_string, lat_string);\r\n        } else {\r\n          this._displayCoordinatesByOrder(this._toFormat(x), this._toFormat(y));\r\n\r\n          if (isNaN(y) && isNaN(x)) {\r\n            //this.coordinateInfo.innerHTML = \"\";\r\n            this.a11y_setCoordinateInfo(\"\");\r\n          } else {\r\n            //this.coordinateInfo.innerHTML += \" \" + this._unitToNls(outUnit);\r\n            this.a11y_setCoordinateInfo((this.coordinateInfo.innerHTML += \" \" + this._unitToNls(outUnit)));\r\n          }\r\n        }\r\n      },\r\n\r\n      _displayProject: function(outUnit, y, x) {\r\n        var options = this.selectedItem.get('options');\r\n        x = x * options.unitRate;\r\n        y = y * options.unitRate;\r\n\r\n        this._displayCoordinatesByOrder(this._toFormat(x), this._toFormat(y));\r\n\r\n        if (isNaN(y) && isNaN(x)) {\r\n          //this.coordinateInfo.innerHTML = \"\";\r\n          this.a11y_setCoordinateInfo(\"\");\r\n        } else {\r\n          //this.coordinateInfo.innerHTML += \" \" + this._unitToNls(outUnit);\r\n          this.a11y_setCoordinateInfo((this.coordinateInfo.innerHTML += \" \" + this._unitToNls(outUnit)));\r\n        }\r\n      },\r\n\r\n      _displayCoordinatesByOrder: function(x, y) {\r\n        var displayOrderLonLat = this.config.displayOrderLonLat;//X,Y\r\n        if (displayOrderLonLat) {\r\n          //this.coordinateInfo.innerHTML = x + \"  \" + y;\r\n          this.a11y_setCoordinateInfo((x + \"  \" + y));\r\n        } else {\r\n          //this.coordinateInfo.innerHTML = y + \"  \" + x;\r\n          this.a11y_setCoordinateInfo((y + \"  \" + x));\r\n        }\r\n      },\r\n\r\n      onFoldContainerClick: function() {\r\n        if (this._configured) {\r\n          this.toggleMenuContainer();\r\n        }\r\n\r\n        this.a11y_focusMenuItem();\r\n      },\r\n\r\n      isMenuContainerOpen: function () {\r\n        return html.hasClass(this.coordinateMenuContainer, 'display-coordinate-menu');\r\n      },\r\n      //for ,#17005\r\n      toggleMenuContainer: function (isOpen) {\r\n        if (!isOpen) {\r\n          isOpen = this.isMenuContainerOpen();\r\n          isOpen = !isOpen;//toggleClass\r\n        }\r\n\r\n        if (true === isOpen) {\r\n          html.addClass(this.coordinateMenuContainer, 'display-coordinate-menu');\r\n          html.setStyle(this.domNode, 'zIndex', '1');//change popup z-index=1\r\n        } else if (false === isOpen) {\r\n          html.removeClass(this.coordinateMenuContainer, 'display-coordinate-menu');\r\n          html.setStyle(this.domNode, 'zIndex', 'auto');//change popup z-index=auto\r\n        }\r\n      },\r\n\r\n      /**\r\n       * Helper function to prettify decimal degrees into DMS (degrees-minutes-seconds).\r\n       *\r\n       * @param {number} decDeg The decimal degree number\r\n       * @param {string} decDir LAT or LON\r\n       *\r\n       * @return {string} Human-readable representation of decDeg.\r\n       */\r\n      degToDMS: function(decDeg, decDir) {\r\n        /** @type {number} */\r\n        var d = Math.abs(decDeg);\r\n        /** @type {number} */\r\n        var deg = Math.floor(d);\r\n        d = d - deg;\r\n        /** @type {number} */\r\n        var min = Math.floor(d * 60);\r\n        /** @type {number} */\r\n        var sec = Math.floor((d - min / 60) * 60 * 60);\r\n        if (sec === 60) { // can happen due to rounding above\r\n          min++;\r\n          sec = 0;\r\n        }\r\n        if (min === 60) { // can happen due to rounding above\r\n          deg++;\r\n          min = 0;\r\n        }\r\n        /** @type {string} */\r\n        var min_string = min < 10 ? \"0\" + min : min;\r\n        /** @type {string} */\r\n        var sec_string = sec < 10 ? \"0\" + sec : sec;\r\n        /** @type {string} */\r\n        var dir = (decDir === 'LAT') ? (decDeg < 0 ? \"S\" : \"N\") : (decDeg < 0 ? \"W\" : \"E\");\r\n\r\n        return (decDir === 'LAT') ?\r\n          deg + \"&deg;\" + min_string + \"&prime;\" + sec_string + \"&Prime;\" + dir :\r\n          deg + \"&deg;\" + min_string + \"&prime;\" + sec_string + \"&Prime;\" + dir;\r\n      },\r\n      //for hack Degrees Decimal Minutes\r\n      degToDDM: function (decDeg) {\r\n        /** @type {number} */\r\n        var d = Math.abs(decDeg);\r\n        /** @type {number} */\r\n        var deg = Math.floor(d);\r\n        d = d - deg;\r\n        /** @type {number} */\r\n        var min = Math.floor(d * 60);\r\n        /** @type {number} */\r\n        var sec = Math.floor((d - min / 60) * 60 * 60);\r\n        if (sec === 60) { // can happen due to rounding above\r\n          min++;\r\n          sec = 0;\r\n        }\r\n        if (min === 60) { // can happen due to rounding above\r\n          deg++;\r\n          min = 0;\r\n        }\r\n\r\n        var dm = utils.localizeNumberByFieldInfo((min + (sec / 60)), {\r\n          format: {\r\n            places: this.config.decimalPlaces,\r\n            digitSeparator: this.config.addSeparator\r\n          }\r\n        });\r\n\r\n        return deg + \"&deg;\" + dm + \"&prime;\";\r\n      },\r\n      _getWMSBaseMapInfo: function () {\r\n        var def = new Deferred();\r\n        require(['jimu/SpatialReference/srUtils'], lang.hitch(this, function (srUtils) {\r\n          srUtils.loadResource().then(lang.hitch(this, function () {\r\n            var mapWkid = this.map.spatialReference.wkid;\r\n            portalUtils.getUnits(this.appConfig.portalUrl).then(lang.hitch(this, function (units) {\r\n              if (srUtils.isValidWkid(mapWkid)) {\r\n                var item = {\r\n                  wkid: srUtils.standardizeWkid(mapWkid),\r\n                  label: srUtils.getSRLabel(parseInt(mapWkid, 10))\r\n                };\r\n\r\n                if (srUtils.isProjectedCS(item.wkid)) {\r\n                  item.outputUnit = units === \"english\" ? \"FOOT\" : \"METER\";\r\n                } else {\r\n                  item.outputUnit = item.outputUnit || srUtils.getCSUnit(item.wkid);\r\n                }\r\n\r\n                var _options = {\r\n                  sameSRWithMap: srUtils.isSameSR(item.wkid, this.map.spatialReference.wkid),\r\n                  isGeographicCS: srUtils.isGeographicCS(item.wkid),\r\n                  isGeographicUnit: srUtils.isGeographicUnit(item.outputUnit),\r\n                  isProjectedCS: srUtils.isProjectedCS(item.wkid),\r\n                  isProjectUnit: srUtils.isProjectUnit(item.outputUnit),\r\n                  spheroidCS: srUtils.isProjectedCS(item.wkid) ?\r\n                    srUtils.getGeoCSByProj(item.wkid) : item.wkid,\r\n                  defaultUnit: srUtils.getCSUnit(item.wkid),\r\n                  unitRate: srUtils.getUnitRate(srUtils.getCSUnit(item.wkid), item.outputUnit)\r\n                };\r\n\r\n                //default show mercator is degrees.\r\n                if (this.map.spatialReference.isWebMercator()) {\r\n                  _options.isGeographicUnit = true;\r\n                  _options.isProjectUnit = false;\r\n                  _options.unitRate = 1;\r\n                  item.outputUnit = \"DECIMAL_DEGREES\";\r\n                }\r\n                //for hack DEGREES_DECIMAL_MINUTES\r\n                if (item.outputUnit === \"DEGREES_DECIMAL_MINUTES\") {\r\n                  _options.isGeographicUnit = true;\r\n                  _options.unitRate = 1;\r\n                }\r\n\r\n                item.options = _options;\r\n                def.resolve(item);\r\n              }\r\n            }), lang.hitch(this, function (err) {\r\n              console.error(err);\r\n              def.reject(err);\r\n            }));\r\n          }));\r\n        }));\r\n\r\n        return def;\r\n      },\r\n      /*,\r\n      separator: function(nStr, places) {\r\n        if (this.config.addSeparator && JSON.parse(this.config.addSeparator)) {\r\n          return utils.localizeNumber(nStr, {\r\n            places: places\r\n          });\r\n        }\r\n        return nStr;\r\n      }*/\r\n      _setDefaultItme: function () {\r\n        //default in setting\r\n        var i, len, item;\r\n        for (i = 0, len = this.popMenu.getChildren().length; i < len; i++) {\r\n          item = this.popMenu.getChildren()[i];\r\n\r\n          if (item.params.isDefault === true) {\r\n            this.selectedItem = item;\r\n            this._defaultItem = item;\r\n\r\n            break;\r\n          }\r\n        }\r\n        //no default in setting\r\n        var mapWkid = this._mapWkid;\r\n        if (!this._defaultItem) {\r\n          for (i = 0, len = this.popMenu.getChildren().length; i < len; i++) {\r\n            item = this.popMenu.getChildren()[i];\r\n\r\n            var wkid = item.params.wkid;\r\n            if (parseInt(wkid, 10) === parseInt(mapWkid, 10)) {\r\n              item.set({\r\n                isDefault: true\r\n              });\r\n              item.params.isDefault = true;\r\n\r\n              this._defaultItem = item;\r\n              break; //first item that same wkid\r\n            }\r\n          }\r\n        }\r\n\r\n        //style\r\n        if (this._defaultItem) {\r\n          this._setDefaultItemStyle(this._defaultItem);\r\n        }\r\n      },\r\n      _setDefaultItemStyle: function (item) {\r\n        item.set({\r\n          label: this.getStatusString(\r\n            false, //no selected\r\n            (item.params.alias || item.params.name),\r\n            item.params.wkid,\r\n            item.params.isDefault\r\n          )\r\n        });\r\n      },\r\n      _getDefaultPlaceHolder: function(){\r\n        if(utils.isMobileUa()){\r\n          //this.coordinateInfo.innerHTML = \"\";\r\n          this.a11y_setCoordinateInfo(\"\");\r\n        } else {\r\n          //this.coordinateInfo.innerHTML = this.nls.realtimeLabel;\r\n          this.a11y_setCoordinateInfo(this.nls.realtimeLabel);\r\n        }\r\n      }\r\n    });\r\n\r\n    clazz.extend(a11y);\r\n    return clazz;\r\n  });"]}