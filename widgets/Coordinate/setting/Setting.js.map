{"version":3,"sources":["../../../../widgets/Coordinate/setting/Setting.js"],"names":["define","declare","lang","html","on","aspect","query","keys","dojoJSON","request","BaseWidgetSetting","_WidgetsInTemplateMixin","Table","Message","Popup","CheckBox","LoadingIndicator","portalUtils","Edit","utils","baseClass","edit","popup","popupState","editTr","gsVersion","postCreate","inherited","arguments","separator","label","nls","checked","shelter1","hidden","placeAt","domNode","startup","shelter2","fields","name","title","id","type","unique","editable","wkid","defaultTitle","width","alias","output","transformationWkid","transformationLabel","transformForward","actions","args","autoHeight","selectable","singleClickEdit","outputCoordinateTable","setStyle","tableCoordinate","own","hitch","setConfig","config","_initOrderLonLatRadioBtns","_getGeometryServiceVersion","clear","show","loadResource","then","spatialReferences","length","json","len","i","parseInt","isDefaultValue","isDefault","aliasValue","push","standardizeWkid","outputUnit","options","stringify","addRows","_addMapCoordinate","err","console","error","always","hide","isFinite","decimalPlaces","spinner","set","addSeparator","setValue","esriConfig","defaults","geometryService","url","gsUrl","services","slice","indexOf","handleAs","callbackParamName","content","f","response","log","currentVersion","parseFloat","message","getVersionError","mapWkid","map","spatialReference","getUnits","appConfig","portalUrl","units","isValidWkid","item","getSRLabel","isProjectedCS","getCSUnit","_options","sameSRWithMap","isSameSR","isGeographicCS","isGeographicUnit","isProjectUnit","spheroidCS","getGeoCSByProj","defaultUnit","unitRate","getUnitRate","isWebMercator","addRow","_keepDefaultOnlyEdit","pSelector","row","style","after","tr","onAddClick","_openEdit","add","onEditClick","cs","getRowData","version","titleLabel","container","buttons","ok","key","ENTER","disable","onClick","cancel","classNames","ESCAPE","onClose","addClass","_onEditOk","getConfig","editResult","editRow","success","close","errorCode","_onEditClose","data","getData","parse","get","getValue","lonLat","displayOrderLonLat","latLon"],"mappings":"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","file":"Setting.js","sourcesContent":["///////////////////////////////////////////////////////////////////////////\r\n// Copyright © Esri. All Rights Reserved.\r\n//\r\n// Licensed under the Apache License Version 2.0 (the \"License\");\r\n// you may not use this file except in compliance with the License.\r\n// You may obtain a copy of the License at\r\n//\r\n//    http://www.apache.org/licenses/LICENSE-2.0\r\n//\r\n// Unless required by applicable law or agreed to in writing, software\r\n// distributed under the License is distributed on an \"AS IS\" BASIS,\r\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n// See the License for the specific language governing permissions and\r\n// limitations under the License.\r\n///////////////////////////////////////////////////////////////////////////\r\n\r\ndefine([\r\n    'dojo/_base/declare',\r\n    'dojo/_base/lang',\r\n    'dojo/_base/html',\r\n    'dojo/on',\r\n    'dojo/aspect',\r\n    'dojo/query',\r\n    'dojo/keys',\r\n    'dojo/json',\r\n    'esri/request',\r\n    'jimu/BaseWidgetSetting',\r\n    'dijit/_WidgetsInTemplateMixin',\r\n    'jimu/dijit/SimpleTable',\r\n    'jimu/dijit/Message',\r\n    'jimu/dijit/Popup',\r\n    'jimu/dijit/CheckBox',\r\n    'jimu/dijit/LoadingIndicator',\r\n    'jimu/portalUtils',\r\n    './Edit',\r\n    \"jimu/SpatialReference/srUtils\",\r\n    'jimu/dijit/RadioBtn',\r\n    'dojo/NodeList-dom',\r\n    'dijit/form/NumberSpinner',\r\n    'dijit/form/NumberTextBox'\r\n  ],\r\n  function(\r\n    declare,\r\n    lang,\r\n    html,\r\n    on,\r\n    aspect,\r\n    query,\r\n    keys,\r\n    dojoJSON,\r\n    request,\r\n    BaseWidgetSetting,\r\n    _WidgetsInTemplateMixin,\r\n    Table,\r\n    Message,\r\n    Popup,\r\n    CheckBox,\r\n    LoadingIndicator,\r\n    portalUtils,\r\n    Edit,\r\n    utils) {\r\n    return declare([BaseWidgetSetting, _WidgetsInTemplateMixin], {\r\n      /*global esriConfig*/\r\n      baseClass: 'jimu-widget-coordinate-setting',\r\n      edit: null,\r\n      popup: null,\r\n      popupState: \"\", // ADD or EDIT\r\n      editTr: null,\r\n      gsVersion: 0,\r\n\r\n      postCreate: function() {\r\n        this.inherited(arguments);\r\n\r\n        this.separator = new CheckBox({\r\n          label: this.nls.separator,\r\n          checked: false\r\n        }, this.separator);\r\n\r\n        this.shelter1 = new LoadingIndicator({\r\n          hidden: true\r\n        });\r\n        this.shelter1.placeAt(this.domNode);\r\n        this.shelter1.startup();\r\n\r\n        this.shelter2 = new LoadingIndicator({\r\n          hidden: true\r\n        });\r\n        this.shelter2.placeAt(this.domNode);\r\n        this.shelter2.startup();\r\n      },\r\n\r\n      startup: function() {\r\n        this.inherited(arguments);\r\n\r\n        var fields = [{\r\n          name: 'id',\r\n          title: this.nls.id,\r\n          type: 'text',\r\n          unique: true,\r\n          hidden: true,\r\n          editable: false\r\n        }, {\r\n          name: 'wkid',\r\n          title: this.nls.wkid,\r\n          type: 'text',\r\n          'class': \"wkid\",\r\n          hidden: true,\r\n          editable: false\r\n        }, {\r\n          name: 'isDefault',\r\n          title: this.nls.defaultTitle,\r\n          type: 'radio',\r\n          editable: true,\r\n          width: '100px'\r\n        }, {\r\n          name: 'label',\r\n          title: this.nls.label,\r\n          type: 'text',\r\n          editable: false\r\n        }, {\r\n          name: 'alias',\r\n          title: this.nls.alias,\r\n          type: 'text',\r\n          editable: true\r\n        }, {\r\n          name: 'outputUnit',\r\n          title: this.nls.output,\r\n          type: 'text',\r\n          hidden: true,\r\n          editable: false\r\n        }, {\r\n          name: 'transformationWkid',\r\n          title: this.nls.transformationWkid,\r\n          type: 'text',\r\n          'class': 'transformationWkid',\r\n          editable: false,\r\n          hidden: true\r\n        }, {\r\n          name: 'transformationLabel',\r\n          title: this.nls.transformationLabel,\r\n          type: 'text',\r\n          editable: false,\r\n          hidden: true\r\n        }, {\r\n          name: 'transformForward',\r\n          title: this.nls.transformForward,\r\n          type: 'checkbox',\r\n          editable: false,\r\n          hidden: true\r\n        }, {\r\n          name: 'options',\r\n          title: 'options',\r\n          type: 'text',\r\n          editable: false,\r\n          hidden: true\r\n        }, {\r\n          name: 'actions',\r\n          title: this.nls.actions,\r\n          type: 'actions',\r\n          'class': \"actions\",\r\n          actions: ['edit', 'up', 'down', 'delete']\r\n        }];\r\n        var args = {\r\n          autoHeight: false,\r\n          fields: fields,\r\n          selectable: false,\r\n          singleClickEdit: true\r\n        };\r\n        this.outputCoordinateTable = new Table(args);\r\n        html.setStyle(this.outputCoordinateTable.domNode, 'height', '100%');\r\n        this.outputCoordinateTable.placeAt(this.tableCoordinate);\r\n        this.outputCoordinateTable.startup();\r\n\r\n        this.own(on(this.outputCoordinateTable, 'actions-edit', lang.hitch(this, 'onEditClick')));\r\n        this.setConfig(this.config);\r\n\r\n        this._initOrderLonLatRadioBtns();\r\n\r\n        this._getGeometryServiceVersion();\r\n      },\r\n\r\n      setConfig: function(config) {\r\n        this.config = config;\r\n        this.outputCoordinateTable.clear();\r\n\r\n        this.shelter1.show();\r\n        utils.loadResource().then(lang.hitch(this, function() {\r\n          if (config.spatialReferences && config.spatialReferences.length) {\r\n            var json = [];\r\n            var len = config.spatialReferences.length;\r\n\r\n            for (var i = 0; i < len; i++) {\r\n              var wkid = parseInt(config.spatialReferences[i].wkid, 10);\r\n              var isDefaultValue = config.spatialReferences[i].isDefault;\r\n              var aliasValue = config.spatialReferences[i].alias;\r\n              json.push({\r\n                id: i,\r\n                wkid: utils.standardizeWkid(wkid),\r\n                isDefault: isDefaultValue || false,\r\n                label: config.spatialReferences[i].label,\r\n                alias: aliasValue || config.spatialReferences[i].label,\r\n                outputUnit: config.spatialReferences[i].outputUnit,\r\n                transformationWkid: config.spatialReferences[i].transformationWkid,\r\n                transformationLabel: config.spatialReferences[i].transformationLabel,\r\n                transformForward: config.spatialReferences[i].transformForward,\r\n                options: dojoJSON.stringify(config.spatialReferences[i].options)\r\n              });\r\n            }\r\n            this.outputCoordinateTable.addRows(json);\r\n          } else {\r\n            this._addMapCoordinate();\r\n          }\r\n        }), lang.hitch(this, function(err) {\r\n          console.error(err);\r\n        })).always(lang.hitch(this, function() {\r\n          this.shelter1.hide();\r\n        }));\r\n\r\n        if (isFinite(parseInt(config.decimalPlaces, 10))) {\r\n          this.spinner.set('value', parseInt(config.decimalPlaces, 10));\r\n        }\r\n        if (config.addSeparator) {\r\n          this.separator.setValue(config.addSeparator);\r\n        }\r\n      },\r\n\r\n      _getGeometryServiceVersion: function() {\r\n        this.shelter2.show();\r\n        if (esriConfig.defaults.geometryService && esriConfig.defaults.geometryService.url) {\r\n          var gsUrl = esriConfig.defaults.geometryService.url;\r\n          var services = gsUrl.slice(0, gsUrl.indexOf('/Geometry/'));\r\n          request({\r\n            url: services,\r\n            handleAs: 'json',\r\n            callbackParamName: \"callback\",\r\n            content: {\r\n              f: 'json'\r\n            }\r\n          }).then(lang.hitch(this, function(response) {\r\n            console.log(response);\r\n            if (response && response.currentVersion) {\r\n              this.gsVersion = parseFloat(response.currentVersion);\r\n            }\r\n          }), lang.hitch(this, function(err) {\r\n            console.error(err);\r\n          })).always(lang.hitch(this, function() {\r\n            this.shelter2.hide();\r\n          }));\r\n        } else {\r\n          this.shelter2.hide();\r\n          new Message({\r\n            message: this.nls.getVersionError\r\n          });\r\n        }\r\n      },\r\n\r\n      _addMapCoordinate: function() {\r\n        var mapWkid = this.map.spatialReference.wkid;\r\n        portalUtils.getUnits(this.appConfig.portalUrl).then(lang.hitch(this, function(units) {\r\n          if (utils.isValidWkid(mapWkid)) {\r\n            var item = {\r\n              wkid: utils.standardizeWkid(mapWkid),\r\n              label: utils.getSRLabel(parseInt(mapWkid, 10))\r\n            };\r\n            item.alias = item.label;\r\n\r\n            if (utils.isProjectedCS(item.wkid)) {\r\n              item.outputUnit = units === \"english\" ? \"FOOT\" : \"METER\";\r\n            } else {\r\n              item.outputUnit = item.outputUnit || utils.getCSUnit(item.wkid);\r\n            }\r\n\r\n            var _options = {\r\n              sameSRWithMap: utils.isSameSR(item.wkid, this.map.spatialReference.wkid),\r\n              isGeographicCS: utils.isGeographicCS(item.wkid),\r\n              isGeographicUnit: utils.isGeographicUnit(item.outputUnit),\r\n              isProjectedCS: utils.isProjectedCS(item.wkid),\r\n              isProjectUnit: utils.isProjectUnit(item.outputUnit),\r\n              spheroidCS: utils.isProjectedCS(item.wkid) ?\r\n                utils.getGeoCSByProj(item.wkid) : item.wkid,\r\n              defaultUnit: utils.getCSUnit(item.wkid),\r\n              unitRate: utils.getUnitRate(utils.getCSUnit(item.wkid), item.outputUnit)\r\n            };\r\n\r\n            //default show mercator is degrees.\r\n            if (this.map.spatialReference.isWebMercator()){\r\n              _options.isGeographicUnit = true;\r\n              _options.isProjectUnit = false;\r\n              _options.unitRate = 1;\r\n              item.outputUnit = \"DECIMAL_DEGREES\";\r\n            }\r\n\r\n            //for hack DEGREES_DECIMAL_MINUTES\r\n            if(item.outputUnit === \"DEGREES_DECIMAL_MINUTES\"){\r\n              _options.isGeographicUnit = true;\r\n              _options.unitRate = 1;\r\n            }\r\n\r\n            item.options = dojoJSON.stringify(_options);\r\n            this.outputCoordinateTable.addRow(item);\r\n          }\r\n        }));\r\n      },\r\n\r\n      _keepDefaultOnlyEdit: function() {\r\n        var pSelector = \".\" + this.baseClass + \" .body-section tr[rowid=row1]\",\r\n          row = query(pSelector)[0];\r\n\r\n        query('.action-item', row).style('display', 'none');\r\n        query('.row-edit-div', row).style('display', 'block');\r\n\r\n        aspect.after(this.outputCoordinateTable, 'onBeforeRowUp', lang.hitch(this, function(tr) {\r\n          if (query(\".body-section .simple-table-row\")[1] === tr) {\r\n            return false;\r\n          }\r\n        }), true);\r\n      },\r\n\r\n      onAddClick: function() {\r\n        this.popupState = \"ADD\";\r\n        this._openEdit(this.nls.add, {});\r\n      },\r\n\r\n      onEditClick: function(tr) {\r\n        var cs = this.outputCoordinateTable.getRowData(tr);\r\n        this.popupState = \"EDIT\";\r\n        this.editTr = tr;\r\n        this._openEdit(this.nls.edit, cs);\r\n      },\r\n\r\n      _openEdit: function(title, config) {\r\n        this.edit = new Edit({\r\n          version: this.gsVersion,\r\n          map: this.map,\r\n          nls: this.nls\r\n        });\r\n        // this.edit.setConfig(config || {});\r\n        this.popup = new Popup({\r\n          titleLabel: title,\r\n          autoHeight: true,\r\n          content: this.edit,\r\n          container: 'main-page',\r\n          width: 640,\r\n          buttons: [{\r\n            label: this.nls.ok,\r\n            key: keys.ENTER,\r\n            disable: true,\r\n            onClick: lang.hitch(this, '_onEditOk')\r\n          }, {\r\n            label: this.nls.cancel,\r\n            classNames: ['jimu-btn-vacation'],\r\n            key: keys.ESCAPE\r\n          }],\r\n          onClose: lang.hitch(this, '_onEditClose')\r\n        });\r\n        this.edit.setConfig(config || {});\r\n        html.addClass(this.popup.domNode, 'widget-setting-popup');\r\n        this.edit.startup();\r\n      },\r\n\r\n      _onEditOk: function() {\r\n        var json = this.edit.getConfig(),\r\n          editResult = null;\r\n\r\n        json.wkid = utils.standardizeWkid(json.wkid);\r\n        json.options = dojoJSON.stringify(json.options);\r\n        if (json.label) {\r\n          json.alias = json.label;\r\n        }\r\n\r\n        if (this.popupState === \"ADD\") {\r\n          editResult = this.outputCoordinateTable.addRow(json);\r\n        } else if (this.popupState === \"EDIT\") {\r\n          editResult = this.outputCoordinateTable.editRow(this.editTr, json);\r\n        }\r\n\r\n        if (editResult.success) {\r\n          this.popup.close();\r\n          this.popupState = \"\";\r\n          this.editTr = null;\r\n        } else {\r\n          // var repeatTitles = array.map(\r\n          //   editResult.repeatFields,\r\n          //   lang.hitch(this, function(field) {\r\n          //     return field && field.title;\r\n          //   }));\r\n          new Message({\r\n            message: json.wkid + this.nls[editResult.errorCode]\r\n          });\r\n        }\r\n      },\r\n\r\n      _onEditClose: function() {\r\n        this.edit = null;\r\n        this.popup = null;\r\n      },\r\n\r\n      getConfig: function() {\r\n        var data = this.outputCoordinateTable.getData();\r\n        var json = [];\r\n        var len = data.length;\r\n        for (var i = 0; i < len; i++) {\r\n          delete data[i].id;\r\n          data[i].options = dojoJSON.parse(data[i].options);\r\n          json.push(data[i]);\r\n        }\r\n        this.config.spatialReferences = json;\r\n\r\n        this.config.decimalPlaces = this.spinner.get('value');\r\n        this.config.addSeparator = this.separator.getValue();\r\n\r\n        return this.config;\r\n      },\r\n      _initOrderLonLatRadioBtns: function() {\r\n        this.own(on(this.lonLat, 'click', lang.hitch(this, function() {\r\n          this.config.displayOrderLonLat = true;\r\n        })));\r\n        this.own(on(this.latLon, 'click', lang.hitch(this, function() {\r\n          this.config.displayOrderLonLat = false;\r\n        })));\r\n        if (this.config.displayOrderLonLat) {\r\n          this.lonLat.set('checked', true);\r\n          this.config.displayOrderLonLat = true;\r\n        } else {\r\n          this.latLon.set('checked', true);\r\n          this.config.displayOrderLonLat = false;\r\n        }\r\n      }\r\n    });\r\n  });"]}