{"version":3,"sources":["../../../../widgets/AddData/search/ScopeOptions.js"],"names":["define","declare","lang","array","domClass","SearchComponent","template","i18n","util","templateString","curatedFilter","postCreate","inherited","arguments","startup","_started","initOptions","hideDropdown","remove","scopePlaceholder","btnGroup","context","searchPane","searchContext","hasUsername","username","length","options","getConfig","scopeOptions","Curated","filter","activeNode","initOption","name","node","opt","allow","label","trim","setNodeText","search","anonymousContent","defaultScope","style","display","MyContentToggle","MyOrganizationToggle","CuratedToggle","ArcGISOnlineToggle","MyOrganization","ArcGISOnline","MyContent","add","scopePlaceholderText","innerHTML","optionClicked","evt","toggleClassName","scopePlaceholderClicked","preventDefault","contains","showDropdown","forEach","children","target","appendQueryParams","params","task","scope","some","getAttribute","q","orgId","considerOrg","escapeForLucene","allowArcGISOnline","scopeIsArcGISOnline"],"mappings":"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","file":"ScopeOptions.js","sourcesContent":["///////////////////////////////////////////////////////////////////////////\r\n// Copyright Â© Esri. All Rights Reserved.\r\n//\r\n// Licensed under the Apache License Version 2.0 (the \"License\");\r\n// you may not use this file except in compliance with the License.\r\n// You may obtain a copy of the License at\r\n//\r\n//    http://www.apache.org/licenses/LICENSE-2.0\r\n//\r\n// Unless required by applicable law or agreed to in writing, software\r\n// distributed under the License is distributed on an \"AS IS\" BASIS,\r\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n// See the License for the specific language governing permissions and\r\n// limitations under the License.\r\n///////////////////////////////////////////////////////////////////////////\r\ndefine([\"dojo/_base/declare\",\r\n    \"dojo/_base/lang\",\r\n    \"dojo/_base/array\",\r\n    \"dojo/dom-class\",\r\n    \"./SearchComponent\",\r\n    \"dojo/text!./templates/ScopeOptions.html\",\r\n    \"dojo/i18n!../nls/strings\",\r\n    \"./util\"\r\n  ],\r\n  function(declare, lang, array, domClass, SearchComponent, template, i18n, util) {\r\n\r\n    return declare([SearchComponent], {\r\n\r\n      i18n: i18n,\r\n      templateString: template,\r\n      curatedFilter: null,\r\n\r\n      postCreate: function() {\r\n        this.inherited(arguments);\r\n      },\r\n\r\n      startup: function() {\r\n        if (this._started) {\r\n          return;\r\n        }\r\n        this.inherited(arguments);\r\n        this.initOptions();\r\n        //console.warn(\"ScopeOptions.startup\",this.searchPane.portal);\r\n      },\r\n\r\n      hideDropdown: function() {\r\n        domClass.remove(this.scopePlaceholder, \"opened\");\r\n        domClass.remove(this.btnGroup, \"show\");\r\n      },\r\n\r\n      initOptions: function() {\r\n        var context = this.searchPane.searchContext;\r\n        var hasUsername = (typeof context.username === \"string\" && context.username.length > 0);\r\n        //var hasOrgId = (typeof context.orgId === \"string\" && context.orgId.length > 0);\r\n        var options = this.getConfig().scopeOptions;\r\n        this.curatedFilter = options.Curated.filter;\r\n        var activeNode = null;\r\n\r\n        var initOption = function(name, node) {\r\n          var opt = options[name];\r\n          if (opt && opt.allow) {\r\n            if (typeof opt.label === \"string\" && lang.trim(opt.label). length > 0) {\r\n              util.setNodeText(node,lang.trim(opt.label));\r\n            } else {\r\n              if (!hasUsername && name === \"MyOrganization\") {\r\n                // \"My Organization as a label doesn't make sense\r\n                util.setNodeText(node,i18n.search.scopeOptions.anonymousContent);\r\n              }\r\n            }\r\n            if (options.defaultScope === name) {\r\n              activeNode = node;\r\n            }\r\n          } else {\r\n            node.style.display = \"none\";\r\n          }\r\n        };\r\n        initOption(\"MyContent\", this.MyContentToggle);\r\n        initOption(\"MyOrganization\", this.MyOrganizationToggle);\r\n        initOption(\"Curated\", this.CuratedToggle);\r\n        initOption(\"ArcGISOnline\", this.ArcGISOnlineToggle);\r\n\r\n        if (!activeNode) {\r\n          if (options.MyOrganization.allow) {\r\n            activeNode = this.MyOrganizationToggle;\r\n          } else if (options.ArcGISOnline.allow) {\r\n            activeNode = this.ArcGISOnlineToggle;\r\n          } else if (options.Curated.allow) {\r\n            activeNode = this.CuratedToggle;\r\n          } else if (options.MyContent.allow) {\r\n            activeNode = this.MyContentToggle;\r\n          }\r\n        }\r\n        if (activeNode) {\r\n          domClass.add(activeNode, \"active\");\r\n          this.scopePlaceholderText.innerHTML = activeNode.innerHTML;\r\n        }\r\n      },\r\n\r\n      optionClicked: function(evt) {\r\n        this.toggleClassName(evt);\r\n        this.hideDropdown();\r\n        this.search();\r\n      },\r\n\r\n      scopePlaceholderClicked: function(evt) {\r\n        evt.preventDefault();\r\n        if (domClass.contains(this.scopePlaceholder, \"opened\")) {\r\n          this.hideDropdown();\r\n        } else {\r\n          this.showDropdown();\r\n        }\r\n      },\r\n\r\n      showDropdown: function() {\r\n        // this.btnGroup.style.top = this.domNode.clientHeight + \"px\";\r\n        domClass.add(this.scopePlaceholder, \"opened\");\r\n        domClass.add(this.btnGroup, \"show\");\r\n      },\r\n\r\n      toggleClassName: function(evt) {\r\n        array.forEach(this.btnGroup.children, function(node) {\r\n          domClass.remove(node, \"active\");\r\n        });\r\n        domClass.add(evt.target, \"active\");\r\n        this.scopePlaceholderText.innerHTML = evt.target.innerHTML;\r\n      },\r\n\r\n      /* SearchComponent API ============================================= */\r\n\r\n      appendQueryParams: function(params, task) {\r\n        var scope = null;\r\n        array.some(this.btnGroup.children, function(node) {\r\n          if (domClass.contains(node, \"active\")) {\r\n            scope = node.getAttribute(\"data-option-name\");\r\n            return true;\r\n          }\r\n        });\r\n        if (typeof scope === \"undefined\") {\r\n          scope = null;\r\n        }\r\n        //console.warn(\"scope\",scope);\r\n\r\n        var q = null;\r\n        var curatedFilter = this.curatedFilter;\r\n        var context = this.searchPane.searchContext;\r\n        var username = context.username;\r\n        var orgId = context.orgId;\r\n        var considerOrg = true;\r\n\r\n        // Issue #14908\r\n        // if (context.portal && context.portal.isPortal) {\r\n        //   considerOrg = false;\r\n        // }\r\n\r\n        if (scope === \"MyContent\") {\r\n          if (typeof username === \"string\" && username.length > 0) {\r\n            q = \"(owner:\" + util.escapeForLucene(username) + \")\";\r\n          }\r\n\r\n        } else if (scope === \"MyOrganization\") {\r\n          if (considerOrg && typeof orgId === \"string\" && orgId.length > 0) {\r\n            q = \"(orgid:\" + util.escapeForLucene(orgId) + \")\";\r\n          }\r\n\r\n        } else if (scope === \"Curated\") {\r\n          if (typeof curatedFilter === \"string\" && curatedFilter.length > 0) {\r\n            q = curatedFilter;\r\n          }\r\n\r\n        } else if (scope === \"ArcGISOnline\") {\r\n          if (context.allowArcGISOnline) {\r\n            task.scopeIsArcGISOnline = true;\r\n          }\r\n        }\r\n\r\n        if (q !== null && q.length > 0) {\r\n          q = \"(\" + q + \")\";\r\n          if (params.q !== null && params.q.length > 0) {\r\n            params.q += \" AND \" + q;\r\n          } else {\r\n            params.q = q;\r\n          }\r\n        }\r\n      }\r\n\r\n    });\r\n\r\n  });\r\n"]}