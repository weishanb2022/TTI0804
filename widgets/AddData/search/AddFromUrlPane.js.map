{"version":3,"sources":["../../../../widgets/AddData/search/AddFromUrlPane.js"],"names":["define","declare","lang","array","on","keys","Deferred","all","domClass","win","Viewport","_WidgetBase","_TemplatedMixin","_WidgetsInTemplateMixin","template","i18n","LayerLoader","util","ArcGISDynamicMapServiceLayer","ArcGISImageServiceLayer","ArcGISTiledMapServiceLayer","CSVLayer","FeatureLayer","GeoRSSLayer","ImageParameters","KMLLayer","RasterXLayer","StreamLayer","VectorTileLayer","WMSLayer","WMTSLayer","InfoTemplate","Message","templateString","wabWidget","_dfd","postCreate","inherited","arguments","_updateExamples","urlTextBox","set","addFromUrl","invalidURL","self","own","evt","keyCode","ENTER","addClicked","contains","addButton","_setStatus","select","ex","typeSelect","type","dropDown","selectPopup","domNode","parentElement","add","resize","destroy","ok","btn","get","url","trim","value","length","search","item","messages","adding","dfd","map","_handleAdd","then","result","remove","addFailed","otherwise","error","unsupported","console","warn","message","log","examplesExpanderClicked","toggle","examplesNode","preHide","winBox","getBox","ownerDocument","w","checkMixedContent","lc","toLowerCase","loader","id","_generateLayerId","layer","indexOf","_readRestInfo","info","outFields","infoTemplate","_waitThenAdd","dfds","forEach","layers","li","lyr","push","_waitForLayer","tables","tbl","results","lyrs","reverse","_setFeatureLayerInfoTemplate","xtnAddData","addLayer","resolve","reject","tileInfo","mslOptions","supportedImageFormatTypes","imageParameters","format","singleFusedMapCache","cacheType","supported","_checkVectorTileUrl","vturl","purgeOptions","displayCount","loadWFSByUrl","setInfoTemplate","_newInfoTemplate","_persist","xtnAddFromUrlPane","_restore","data","msg","_showLayers","showLayers","children","node","v","getAttribute","style","display","_setWMSVisibleLayers","declaredClass","_setDynamicLayerInfoTemplates","mapSR","spatialReference","outSR","_outSR","projOk","equals","isWebMercator","wkid","titleLabel","_widgetLabel","addFromFile","kmlProjectionMismatch"],"mappings":"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","file":"AddFromUrlPane.js","sourcesContent":["///////////////////////////////////////////////////////////////////////////\r\n// Copyright © Esri. All Rights Reserved.\r\n//\r\n// Licensed under the Apache License Version 2.0 (the \"License\");\r\n// you may not use this file except in compliance with the License.\r\n// You may obtain a copy of the License at\r\n//\r\n//    http://www.apache.org/licenses/LICENSE-2.0\r\n//\r\n// Unless required by applicable law or agreed to in writing, software\r\n// distributed under the License is distributed on an \"AS IS\" BASIS,\r\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n// See the License for the specific language governing permissions and\r\n// limitations under the License.\r\n///////////////////////////////////////////////////////////////////////////\r\ndefine([\"dojo/_base/declare\",\r\n    \"dojo/_base/lang\",\r\n    \"dojo/_base/array\",\r\n    \"dojo/on\",\r\n    \"dojo/keys\",\r\n    \"dojo/Deferred\",\r\n    \"dojo/promise/all\",\r\n    \"dojo/dom-class\",\r\n    \"dojo/window\",\r\n    \"dijit/Viewport\",\r\n    \"dijit/_WidgetBase\",\r\n    \"dijit/_TemplatedMixin\",\r\n    \"dijit/_WidgetsInTemplateMixin\",\r\n    \"dojo/text!./templates/AddFromUrlPane.html\",\r\n    \"dojo/i18n!../nls/strings\",\r\n    \"./LayerLoader\",\r\n    \"./util\",\r\n    \"esri/layers/ArcGISDynamicMapServiceLayer\",\r\n    \"esri/layers/ArcGISImageServiceLayer\",\r\n    \"esri/layers/ArcGISTiledMapServiceLayer\",\r\n    \"esri/layers/CSVLayer\",\r\n    \"esri/layers/FeatureLayer\",\r\n    \"esri/layers/GeoRSSLayer\",\r\n    \"esri/layers/ImageParameters\",\r\n    \"esri/layers/KMLLayer\",\r\n    \"esri/layers/RasterXLayer\",\r\n    \"esri/layers/StreamLayer\",\r\n    \"esri/layers/VectorTileLayer\",\r\n    \"esri/layers/WMSLayer\",\r\n    \"esri/layers/WMTSLayer\",\r\n    \"esri/InfoTemplate\",\r\n    \"jimu/dijit/Message\",\r\n    \"dijit/form/Select\",\r\n    \"dijit/form/ValidationTextBox\"\r\n  ],\r\n  function(declare, lang, array, on, keys, Deferred, all, domClass, win,\r\n    Viewport, _WidgetBase, _TemplatedMixin, _WidgetsInTemplateMixin,\r\n    template, i18n, LayerLoader, util, ArcGISDynamicMapServiceLayer,\r\n    ArcGISImageServiceLayer, ArcGISTiledMapServiceLayer, CSVLayer,\r\n    FeatureLayer, GeoRSSLayer, ImageParameters, KMLLayer, RasterXLayer, StreamLayer,\r\n    VectorTileLayer, WMSLayer, WMTSLayer,\r\n    InfoTemplate, Message) {\r\n\r\n    return declare([_WidgetBase, _TemplatedMixin, _WidgetsInTemplateMixin], {\r\n\r\n      i18n: i18n,\r\n      templateString: template,\r\n\r\n      wabWidget: null,\r\n\r\n      _dfd: null,\r\n\r\n      postCreate: function() {\r\n        this.inherited(arguments);\r\n        this._updateExamples(\"ArcGIS\");\r\n        //this._restore();\r\n        this.urlTextBox.set('invalidMessage', i18n.addFromUrl.invalidURL);\r\n\r\n        var self = this;\r\n        this.own(on(this.urlTextBox, \"keyup\", function(evt) {\r\n          if (evt.keyCode === keys.ENTER) {\r\n            self.addClicked();\r\n          } else {\r\n            if (!domClass.contains(self.addButton, \"disabled\")) {\r\n              self._setStatus(\"\");\r\n            }\r\n          }\r\n        }));\r\n        /*\r\n        this.own(on(this.urlTextBox,\"change\",function(evt) {\r\n          if (!domClass.contains(self.addButton,\"disabled\")) {\r\n            self._setStatus(\"\");\r\n          }\r\n        }));\r\n        */\r\n        this.own(on(this.urlTextBox,\"focus\",function() {\r\n          try {\r\n            self.urlTextBox.select();\r\n          } catch(ex) {}\r\n        }));\r\n\r\n        this.own(on(this.typeSelect, \"change\", function(type) {\r\n          self._updateExamples(type);\r\n        }));\r\n\r\n        this.own(on(this.typeSelect.dropDown, \"open\", function(){\r\n          var selectPopup = this.domNode.parentElement;\r\n          if(selectPopup) {\r\n            domClass.add(selectPopup, \"add-data-widget-popup\");\r\n          }\r\n        }));\r\n\r\n        this.own(Viewport.on(\"resize\", self.resize()));\r\n      },\r\n\r\n      destroy: function() {\r\n        this.inherited(arguments);\r\n      },\r\n\r\n      addClicked: function() {\r\n        var self = this,\r\n          ok = false,\r\n          btn = this.addButton;\r\n        if (domClass.contains(btn, \"disabled\")) {\r\n          return;\r\n        }\r\n        var type = this.typeSelect.get(\"value\");\r\n        var url = lang.trim(this.urlTextBox.value);\r\n        if (url.length > 0) {\r\n          if (url) { //(url.indexOf(\"http://\") === 0 || url.indexOf(\"https://\") === 0) {\r\n            ok = true;\r\n          }\r\n        }\r\n        if (!ok) {\r\n          return;\r\n        }\r\n\r\n        domClass.add(btn, \"disabled\");\r\n        self._setStatus(i18n.search.item.messages.adding);\r\n        var dfd = new Deferred();\r\n        var map = this.wabWidget.map;\r\n        this._handleAdd(dfd, map, type, url);\r\n        dfd.then(function(result) {\r\n          if (result) {\r\n            //self.canRemove = true;\r\n            self._setStatus(\"\");\r\n            //util.setNodeText(self.addButton,i18n.search.item.actions.remove);\r\n            domClass.remove(btn, \"disabled\");\r\n            // if (self.parentDialog) {\r\n            //   self.parentDialog.hide();\r\n            // }\r\n          } else {\r\n            self._setStatus(i18n.search.item.messages.addFailed);\r\n            domClass.remove(btn, \"disabled\");\r\n          }\r\n        }).otherwise(function(error) {\r\n          if (typeof error === \"string\" && error === \"Unsupported\") {\r\n            self._setStatus(i18n.search.item.messages.unsupported);\r\n            domClass.remove(btn, \"disabled\");\r\n          } else {\r\n            console.warn(\"Add layer failed.\");\r\n            console.warn(error);\r\n            self._setStatus(i18n.search.item.messages.addFailed);\r\n            domClass.remove(btn, \"disabled\");\r\n            if (error && typeof error.message === \"string\" && error.message.length > 0) {\r\n              // TODO show this message\r\n              //console.warn(\"msg\",error.message);\r\n              self._setStatus(error.message);\r\n              console.log(\"\");\r\n            }\r\n          }\r\n        });\r\n      },\r\n\r\n      examplesExpanderClicked: function() {\r\n        domClass.toggle(this.examplesNode, \"show\");\r\n      },\r\n\r\n      preHide: function() {\r\n        //this._persist();\r\n      },\r\n\r\n      resize: function() {\r\n        var winBox = win.getBox(this.ownerDocument);\r\n        if (winBox && typeof winBox.w !== \"undefined\") {\r\n          //console.warn(\"winBox.w\",winBox.w);\r\n          if (winBox.w > 600) {\r\n            domClass.add(this.urlTextBox, \"url-textbox-wide\");\r\n          } else {\r\n            domClass.remove(this.urlTextBox, \"url-textbox-wide\");\r\n          }\r\n        }\r\n      },\r\n\r\n      _handleAdd: function(dfd, map, type, url) {\r\n        url = util.checkMixedContent(url);\r\n        var lc = url.toLowerCase();\r\n        var loader = new LayerLoader();\r\n        var id = loader._generateLayerId();\r\n        var self = this,\r\n          layer = null;\r\n\r\n        if (type === \"ArcGIS\") {\r\n          if (lc.indexOf(\"/featureserver\") > 0 ||\r\n              lc.indexOf(\"/mapserver\") > 0 ||\r\n              lc.indexOf(\"/imageserver\") > 0) {\r\n            loader._readRestInfo(url).then(function(info) {\r\n              //console.warn(\"restInfo\",info);\r\n              if (info && typeof info.type === \"string\" &&\r\n                 (info.type === \"Feature Layer\" || info.type === \"Table\")) {\r\n                layer = new FeatureLayer(url, {\r\n                  id: id,\r\n                  outFields: [\"*\"],\r\n                  infoTemplate: new InfoTemplate()\r\n                });\r\n                self._waitThenAdd(dfd, map, type, loader, layer);\r\n              } else {\r\n\r\n                if (lc.indexOf(\"/featureserver\") > 0) {\r\n                  var dfds = [];\r\n                  array.forEach(info.layers, function(li) {\r\n                    var lyr = new FeatureLayer(url + \"/\" + li.id, {\r\n                      id: loader._generateLayerId(),\r\n                      outFields: [\"*\"],\r\n                      infoTemplate: new InfoTemplate()\r\n                    });\r\n                    dfds.push(loader._waitForLayer(lyr));\r\n                  });\r\n                  array.forEach(info.tables, function(li) {\r\n                    var tbl = new FeatureLayer(url + \"/\" + li.id, {\r\n                      id: loader._generateLayerId(),\r\n                      outFields: [\"*\"]\r\n                    });\r\n                    dfds.push(loader._waitForLayer(tbl));\r\n                  });\r\n                  all(dfds).then(function(results) {\r\n                    var lyrs = [];\r\n                    array.forEach(results, function(lyr) {\r\n                      lyrs.push(lyr);\r\n                    });\r\n                    lyrs.reverse();\r\n                    array.forEach(lyrs, function(lyr) {\r\n                      loader._setFeatureLayerInfoTemplate(lyr);\r\n                      lyr.xtnAddData = true;\r\n                      map.addLayer(lyr);\r\n                    });\r\n                    dfd.resolve(lyrs);\r\n                  }).otherwise(function(error) {\r\n                    dfd.reject(error);\r\n                  });\r\n\r\n                } else if (lc.indexOf(\"/mapserver\") > 0) {\r\n                  if (info.tileInfo) {\r\n                    layer = new ArcGISTiledMapServiceLayer(url, {\r\n                      id: id\r\n                    });\r\n                  } else {\r\n                    var mslOptions = {id:id};\r\n                    if (info && info.supportedImageFormatTypes &&\r\n                        info.supportedImageFormatTypes.indexOf(\"PNG32\") !== -1) {\r\n                      mslOptions.imageParameters = new ImageParameters();\r\n                      mslOptions.imageParameters.format = \"png32\";\r\n                    }\r\n                    layer = new ArcGISDynamicMapServiceLayer(url,mslOptions);\r\n                  }\r\n                  self._waitThenAdd(dfd, map, type, loader, layer);\r\n\r\n                } else if (lc.indexOf(\"/imageserver\") > 0) {\r\n                  if (info && info.tileInfo && info.singleFusedMapCache) {\r\n                    if (info.cacheType === \"Raster\") {\r\n                      layer = new RasterXLayer(url, {\r\n                        id: id\r\n                      });\r\n                    } else {\r\n                      layer = new ArcGISTiledMapServiceLayer(url, {\r\n                        id: id\r\n                      });\r\n                    }\r\n                  } else {\r\n                    layer = new ArcGISImageServiceLayer(url, {\r\n                      id: id\r\n                    });\r\n                  }\r\n                  self._waitThenAdd(dfd, map, type, loader, layer);\r\n\r\n                }\r\n              }\r\n            }).otherwise(function(error) {\r\n              dfd.reject(error);\r\n            });\r\n\r\n          } else if (lc.indexOf(\"/vectortileserver\") > 0 ||\r\n            lc.indexOf(\"/resources/styles/root.json\") > 0) {\r\n            if (!VectorTileLayer || !VectorTileLayer.supported()) {\r\n              dfd.reject(\"Unsupported\");\r\n            } else {\r\n              loader._checkVectorTileUrl(url, {}).then(function(vturl) {\r\n                //console.warn(\"vectorTileUrl\",vturl);\r\n                layer = new VectorTileLayer(vturl, {\r\n                  id: id\r\n                });\r\n                self._waitThenAdd(dfd, map, type, loader, layer);\r\n              }).otherwise(function(error) {\r\n                dfd.reject(error);\r\n              });\r\n            }\r\n          } else if (lc.indexOf(\"/streamserver\") > 0) {\r\n            layer = new StreamLayer(url, {\r\n              id: id,\r\n              purgeOptions: {\r\n                displayCount: 10000\r\n              },\r\n              infoTemplate: new InfoTemplate()\r\n            });\r\n            this._waitThenAdd(dfd, map, type, loader, layer);\r\n\r\n          } else {\r\n            dfd.reject(\"Unsupported\");\r\n          }\r\n        } else if (type === \"WMS\") {\r\n          layer = new WMSLayer(url, {\r\n            id: id\r\n          });\r\n          this._waitThenAdd(dfd, map, type, loader, layer);\r\n        } else if (type === \"WMTS\") {\r\n          layer = new WMTSLayer(url, {\r\n            id: id\r\n          });\r\n          this._waitThenAdd(dfd, map, type, loader, layer);\r\n        } else if (type === \"WFS\") {\r\n          util.loadWFSByUrl(dfd,map,loader,url,id,true);\r\n        } else if (type === \"KML\") {\r\n          layer = new KMLLayer(url, {\r\n            id: id\r\n          });\r\n          this._waitThenAdd(dfd, map, type, loader, layer);\r\n        } else if (type === \"GeoRSS\") {\r\n          layer = new GeoRSSLayer(url, {\r\n            id: id\r\n          });\r\n          this._waitThenAdd(dfd, map, type, loader, layer);\r\n        } else if (type === \"CSV\") {\r\n          layer = new CSVLayer(url, {\r\n            id: id\r\n          });\r\n          layer.setInfoTemplate(loader._newInfoTemplate());\r\n          this._waitThenAdd(dfd, map, type, loader, layer);\r\n        }\r\n      },\r\n\r\n      _persist: function() {\r\n        //console.warn(\"AddFromUrlPane._persist\");\r\n        try {\r\n          var type = this.typeSelect.get(\"value\");\r\n          var url = lang.trim(this.urlTextBox.value);\r\n          this.wabWidget.xtnAddFromUrlPane = {\r\n            type: type,\r\n            url: url\r\n          };\r\n        } catch (ex) {}\r\n      },\r\n\r\n      _restore: function() {\r\n        //console.warn(\"AddFromUrlPane._restore\");\r\n        try {\r\n          var data = this.wabWidget.xtnAddFromUrlPane;\r\n          if (data && typeof data.type === \"string\" && data.type.length > 0) {\r\n            this.typeSelect.set(\"value\", data.type);\r\n          }\r\n          if (data && typeof data.url === \"string\" && data.url.length > 0) {\r\n            this.urlTextBox.value = data.url;\r\n          }\r\n        } catch (ex) {}\r\n      },\r\n\r\n      _setStatus: function(msg) {\r\n        if(this.wabWidget) {\r\n          this.wabWidget._setStatus(msg);\r\n        }\r\n      },\r\n\r\n      _showLayers: function(){\r\n        if (this.wabWidget) {\r\n          this.wabWidget.showLayers();\r\n        }\r\n      },\r\n\r\n      _updateExamples: function(type) {\r\n        array.forEach(this.examplesNode.children, function(node) {\r\n          var v = node.getAttribute(\"data-examples-type\");\r\n          if (typeof v === \"string\" && v.length > 0) {\r\n            if (v === type) {\r\n              node.style.display = \"\";\r\n            } else {\r\n              node.style.display = \"none\";\r\n            }\r\n          }\r\n        });\r\n      },\r\n\r\n      _waitThenAdd: function(dfd, map, type, loader, layer) {\r\n        //console.warn(\"_waitThenAdd\",type,layer);\r\n        loader._waitForLayer(layer).then(function(lyr) {\r\n          //console.warn(\"_waitThenAdd.ok\",lyr);\r\n          if (type === \"WMS\") {\r\n            loader._setWMSVisibleLayers(lyr);\r\n          } else if (lyr && lyr.declaredClass === \"esri.layers.ArcGISDynamicMapServiceLayer\") {\r\n            loader._setDynamicLayerInfoTemplates(lyr);\r\n          //} else if (lyr && lyr.declaredClass === \"esri.layers.ArcGISTiledMapServiceLayer\") {\r\n          } else if (lyr && lyr.declaredClass === \"esri.layers.FeatureLayer\") {\r\n            loader._setFeatureLayerInfoTemplate(lyr);\r\n          } else if (lyr && lyr.declaredClass === \"esri.layers.CSVLayer\") {\r\n            loader._setFeatureLayerInfoTemplate(lyr);\r\n          }\r\n          lyr.xtnAddData = true;\r\n          if (type === \"KML\") {\r\n            var mapSR = map.spatialReference, outSR = lyr._outSR;\r\n            var projOk = (mapSR && outSR) && (mapSR.equals(outSR) ||\r\n              mapSR.isWebMercator() && outSR.wkid === 4326 ||\r\n              outSR.isWebMercator() && mapSR.wkid === 4326);\r\n            if (projOk) {\r\n              map.addLayer(lyr);\r\n            } else {\r\n              new Message({\r\n                titleLabel: i18n._widgetLabel,\r\n                message: i18n.addFromFile.kmlProjectionMismatch\r\n              });\r\n            }\r\n          } else {\r\n            map.addLayer(lyr);\r\n          }\r\n          dfd.resolve(lyr);\r\n        }).otherwise(function(error) {\r\n          //console.warn(\"_waitThenAdd.error\",error);\r\n          dfd.reject(error);\r\n        });\r\n      }\r\n\r\n    });\r\n\r\n  });\r\n"]}