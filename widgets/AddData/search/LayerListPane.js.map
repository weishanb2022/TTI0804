{"version":3,"sources":["../../../../widgets/AddData/search/LayerListPane.js"],"names":["define","declare","array","on","domClass","domConstruct","_WidgetBase","_TemplatedMixin","_WidgetsInTemplateMixin","template","i18n","util","templateString","wabWidget","baseClass","postCreate","inherited","arguments","startup","_started","_buildList","_initListeners","_addLayer","parentNode","layer","self","name","_getLayerTitle","layerNode","create","innerHTML","title","layerList","removeLayer","onclick","event","preventDefault","map","destroy","err","console","warn","nameNode","setNodeText","hasLayer","ids","layersNode","forEach","layerIds","id","push","graphicsLayerIds","reverse","lyr","getLayer","xtnAddData","noLayersAdded","label","length","url","svc","index","indexOf","substring","lastIndexOf","own","_backButton","hide","show","content","_title","caption","_layerlist","tagName","appendChild","domNode","add","remove"],"mappings":"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","file":"LayerListPane.js","sourcesContent":["///////////////////////////////////////////////////////////////////////////\r\n// Copyright Â© Esri. All Rights Reserved.\r\n//\r\n// Licensed under the Apache License Version 2.0 (the \"License\");\r\n// you may not use this file except in compliance with the License.\r\n// You may obtain a copy of the License at\r\n//\r\n//    http://www.apache.org/licenses/LICENSE-2.0\r\n//\r\n// Unless required by applicable law or agreed to in writing, software\r\n// distributed under the License is distributed on an \"AS IS\" BASIS,\r\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n// See the License for the specific language governing permissions and\r\n// limitations under the License.\r\n///////////////////////////////////////////////////////////////////////////\r\ndefine([\"dojo/_base/declare\",\r\n    \"dojo/_base/array\",\r\n    \"dojo/on\",\r\n    \"dojo/dom-class\",\r\n    \"dojo/dom-construct\",\r\n    \"dijit/_WidgetBase\",\r\n    \"dijit/_TemplatedMixin\",\r\n    \"dijit/_WidgetsInTemplateMixin\",\r\n    \"dojo/text!./templates/LayerListPane.html\",\r\n    \"dojo/i18n!../nls/strings\",\r\n    \"./util\"\r\n],\r\nfunction(declare, array, on, domClass, domConstruct, _WidgetBase, _TemplatedMixin,\r\n  _WidgetsInTemplateMixin, template, i18n, util) {\r\n\r\n  return declare([_WidgetBase, _TemplatedMixin, _WidgetsInTemplateMixin], {\r\n\r\n    i18n: i18n,\r\n    templateString: template,\r\n    wabWidget: null,\r\n    baseClass: \"add-data-widget-layers\",\r\n\r\n    postCreate: function() {\r\n      this.inherited(arguments);\r\n    },\r\n\r\n    startup: function() {\r\n      if (this._started) {\r\n        return;\r\n      }\r\n      this._buildList();\r\n      this._initListeners();\r\n      this.inherited(arguments);\r\n    },\r\n\r\n    _addLayer: function(parentNode,layer) {\r\n      //console.warn(\"layer\",layer);\r\n      var self = this, name = this._getLayerTitle(layer);\r\n      var layerNode = domConstruct.create(\"div\",{\r\n        \"class\": \"add-data-layerlist--listitem\"\r\n      }, parentNode);\r\n      domConstruct.create(\"A\",{\r\n        \"class\": \"remove-button\",\r\n        \"href\": \"#\",\r\n        innerHTML: \"<span class='esri-icon-trash'></span>\",\r\n        title: i18n.layerList.removeLayer,\r\n        onclick: function(event) {\r\n          event.preventDefault();\r\n          try {\r\n            if (self.wabWidget && self.wabWidget.map) {\r\n              self.wabWidget.map.removeLayer(layer);\r\n              domConstruct.destroy(layerNode);\r\n            }\r\n          } catch(err) {\r\n            console.warn(\"Error removing layer.\");\r\n            console.warn(err);\r\n          }\r\n        }\r\n      },layerNode);\r\n      var nameNode = domConstruct.create(\"label\",{\r\n        \"class\": \"layer-name\"\r\n      },layerNode);\r\n      util.setNodeText(nameNode,name);\r\n    },\r\n\r\n    _buildList: function() {\r\n      var self = this, hasLayer = false, ids = [], map = this.wabWidget.map;\r\n      /*\r\n      var captionNode = domConstruct.create(\"div\",{\r\n        \"class\": \"caption\"\r\n      },contentNode);\r\n      util.setNodeText(captionNode,i18n.layerList.caption);\r\n      */\r\n      var layersNode = domConstruct.create(\"div\",{\r\n        \"class\": \"add-data-layerlist--list\"\r\n      });\r\n      array.forEach(map.layerIds, function(id) {ids.push(id);});\r\n      array.forEach(map.graphicsLayerIds, function(id) {ids.push(id);});\r\n      ids.reverse();\r\n      array.forEach(ids, function(id) {\r\n        var lyr = map.getLayer(id);\r\n        if (lyr && lyr.xtnAddData) {\r\n          hasLayer = true;\r\n          self._addLayer(layersNode,lyr);\r\n        }\r\n      });\r\n      if (!hasLayer) {\r\n\r\n        return domConstruct.create(\"div\",{\r\n          \"class\": \"no-data-message\",\r\n          \"innerHTML\": i18n.layerList.noLayersAdded\r\n        });\r\n      }\r\n      return layersNode;\r\n    },\r\n\r\n    _getLayerTitle: function(layer) {\r\n      var title = \"...\";\r\n      if (typeof layer.label === \"string\" && layer.label.length > 0) {\r\n        title = layer.label;\r\n      } else if (typeof layer.title === \"string\" && layer.title.length > 0) {\r\n        title = layer.title;\r\n      } else if (typeof layer.name === \"string\" && layer.name.length > 0) {\r\n        title = layer.name;\r\n      } else if (layer.url) {\r\n        var svc;\r\n        var index = layer.url.indexOf(\"/FeatureServer\");\r\n        if (index === -1) {\r\n          index = layer.url.indexOf(\"/MapServer\");\r\n        }\r\n        if (index === -1) {\r\n          index = layer.url.indexOf(\"/ImageServer\");\r\n        }\r\n        if (index === -1) {\r\n          index = layer.url.indexOf(\"/service\");\r\n        }\r\n        if (index > -1) {\r\n          svc = layer.url.substring(0,index);\r\n          svc = svc.substring(svc.lastIndexOf(\"/\") + 1,svc.length);\r\n          title = svc;\r\n        }\r\n      }\r\n      return title;\r\n    },\r\n\r\n    _initListeners: function() {\r\n      var self = this;\r\n      this.own(on(this._backButton, \"click\", function(event) {\r\n        event.preventDefault();\r\n        self.hide();\r\n      }));\r\n    },\r\n\r\n    show: function() {\r\n      var content = this._buildList();\r\n      this._title.innerHTML = i18n.layerList.caption;\r\n      this._layerlist.innerHTML = \"\";\r\n      if(content && content.tagName) {\r\n        this._layerlist.appendChild(content);\r\n      }\r\n      if(this.wabWidget && this.wabWidget.domNode) {\r\n        domClass.add(this.wabWidget.domNode, \"layerlist-show\");\r\n      }\r\n      domClass.add(this.domNode, \"show\");\r\n    },\r\n\r\n    hide: function() {\r\n      if(this.wabWidget && this.wabWidget.domNode) {\r\n        domClass.remove(this.wabWidget.domNode, \"layerlist-show\");\r\n      }\r\n      domClass.remove(this.domNode, \"show\");\r\n    }\r\n\r\n  });\r\n\r\n});\r\n"]}