{"version":3,"sources":["../../../../widgets/OverviewMap/setting/BaseLayerConfig.js"],"names":["define","declare","lang","on","html","array","Deferred","template","utils","jimuUtils","LoadingShelter","_WidgetBase","_TemplatedMixin","_WidgetsInTemplateMixin","templateString","nls","TYPE","postCreate","shelter","hidden","placeAt","domNode","inherited","arguments","startup","_toggleVELayerByKey","_setBaseLayerStyle","own","baseLayerType","hitch","value","initVerification","_showErrMsg","checkList","tiledMapServiceUrlInput","dynamicMapServiceUrlInput","imageServiceUrlInput","forEach","input","isValid","show","def","addClass","valid","baseLayerVerification","getValues","map","then","validRes","removeClass","res","hide","resolve","type","_getType","ARCGIS_TILED_MAP","ARCGIS_DYNAMIC_MAP_SERVICE","ARCGIS_IMAGE_SERVICE","_setArcGISLayerInputState","errorNode","errInfo","err","errWkid","errUrl","name","indexOf","message","errReqTimeout","isUrlEmpty","url","_getArcLayerInputsValue","baseLayerObj","veLayerInfo","isKeyInPortal","isHaveBingKey","setValues","config","overviewMap","baseLayer","_setArcLayerInputsValue","set","_getArcGISLayerInput","setValue","stripHTML","state","test","msg","innerHTML","displayMessage","removeOption","BING_AERIAL","BING_HYBRID","BING_ROAD","layerType","baseLayerContainer","BASE_MAP","OSM","_onTileLayerUrlChange","isCleanSubDomain","tileLayerUrl","toLowerCase","subdomainContainer","subdomain","_getSubDomains","tileLayerSubDomains","length","split","sd","trim","_getTileInfo","tileInfoStr","tileInfo"],"mappings":"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","file":"BaseLayerConfig.js","sourcesContent":["///////////////////////////////////////////////////////////////////////////\r\n// Copyright © Esri. All Rights Reserved.\r\n//\r\n// Licensed under the Apache License Version 2.0 (the \"License\");\r\n// you may not use this file except in compliance with the License.\r\n// You may obtain a copy of the License at\r\n//\r\n//    http://www.apache.org/licenses/LICENSE-2.0\r\n//\r\n// Unless required by applicable law or agreed to in writing, software\r\n// distributed under the License is distributed on an \"AS IS\" BASIS,\r\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n// See the License for the specific language governing permissions and\r\n// limitations under the License.\r\n///////////////////////////////////////////////////////////////////////////\r\n\r\ndefine([\r\n  'dojo/_base/declare',\r\n  \"dojo/_base/lang\",\r\n  'dojo/on',\r\n  'dojo/_base/html',\r\n  'dojo/_base/array',\r\n  'dojo/Deferred',\r\n  'dojo/text!./BaseLayerConfig.html',\r\n  \"../utils\",\r\n  'jimu/utils',\r\n  \"jimu/dijit/LoadingShelter\",\r\n  'dijit/_WidgetBase',\r\n  'dijit/_TemplatedMixin',\r\n  'dijit/_WidgetsInTemplateMixin'\r\n],\r\n  function (declare, lang, on, html, array, Deferred, template, utils, jimuUtils, LoadingShelter,\r\n    _WidgetBase, _TemplatedMixin, _WidgetsInTemplateMixin) {\r\n    return declare([_WidgetBase, _TemplatedMixin, _WidgetsInTemplateMixin], {\r\n      templateString: template,\r\n      nls: null,\r\n      TYPE: utils.TYPE,\r\n\r\n      postCreate: function () {\r\n        this.shelter = new LoadingShelter({ hidden: true });\r\n        this.shelter.placeAt(this.domNode);\r\n        this.inherited(arguments);\r\n      },\r\n      startup: function () {\r\n        this._toggleVELayerByKey();\r\n        this._setBaseLayerStyle();\r\n\r\n        this.own(on(this.baseLayerType, 'change', lang.hitch(this, function (value) {\r\n          this._setBaseLayerStyle(value);\r\n        })));\r\n        // this.own(on(this.tileLayerUrl, 'change,blur', lang.hitch(this, function () {\r\n        //   this._onTileLayerUrlChange();\r\n        // })));\r\n        this.initVerification();\r\n\r\n        this.inherited(arguments);\r\n      },\r\n\r\n      initVerification: function () {\r\n        //clean errorMsg\r\n        this.own(on(this.baseLayerType, 'change', lang.hitch(this, function () {\r\n          this._showErrMsg(null);\r\n        })));\r\n        this.own(on(this.baseLayerType, 'blur', lang.hitch(this, function () {\r\n          this._showErrMsg(null);\r\n        })));\r\n\r\n        //verification\r\n        var checkList = [this.tiledMapServiceUrlInput, this.dynamicMapServiceUrlInput, this.imageServiceUrlInput];\r\n        array.forEach(checkList, lang.hitch(this, function (input) {\r\n          this.own(on(input, 'change', lang.hitch(this, function () {\r\n            this.isValid();\r\n          })));\r\n          this.own(on(input, 'blur', lang.hitch(this, function () {\r\n            this.isValid();\r\n          })));\r\n        }));\r\n      },\r\n\r\n      isValid: function () {\r\n        this.shelter.show();\r\n        var def = new Deferred();\r\n        html.addClass(this.domNode, \"validating\");\r\n\r\n        utils.valid.baseLayerVerification(this.getValues(), this.map).then(lang.hitch(this, function (validRes) {\r\n          html.removeClass(this.domNode, \"validating\");\r\n          this._showErrMsg(null);\r\n\r\n          if (validRes && true === validRes.res) {\r\n            html.removeClass(this.domNode, \"error\");\r\n            this.shelter.hide();\r\n            def.resolve(true);//true: no class \"validating\"||\"error\"\r\n          } else {\r\n            html.addClass(this.domNode, \"error\");\r\n            var type = this._getType();\r\n            if (type === this.TYPE.ARCGIS_TILED_MAP ||\r\n              type === this.TYPE.ARCGIS_DYNAMIC_MAP_SERVICE ||\r\n              type === this.TYPE.ARCGIS_IMAGE_SERVICE) {\r\n              this._setArcGISLayerInputState(\"Error\");\r\n\r\n              html.removeClass(this.errorNode, \"hide\");\r\n              var errInfo = validRes.err;//handle errors\r\n              if (errInfo) {\r\n                if (errInfo === \"wkid\") {\r\n                  this._showErrMsg(this.nls.errWkid);\r\n                } else if (errInfo === \"layerType\") {\r\n                  this._showErrMsg(this.nls.errUrl);\r\n                } else if (errInfo.name && -1 !== errInfo.name.indexOf(\"SyntaxError\")) {\r\n                  this._showErrMsg(this.nls.errUrl);\r\n                } else if (errInfo.name && -1 !== errInfo.name.indexOf(\"RequestError\")) {\r\n                  this._showErrMsg(this.nls.errUrl);\r\n                } else if (errInfo.name && (-1 !== errInfo.message.indexOf(\"Invalid URL\") ||\r\n                    -1 !== errInfo.message.indexOf(\"Unexpected token <\"))) {\r\n                  this._showErrMsg(this.nls.errUrl);\r\n                } else if (errInfo.name && -1 !== errInfo.message.indexOf(\"Timeout exceeded\")) {\r\n                  this._showErrMsg(this.nls.errReqTimeout);\r\n                } else {\r\n                  this._showErrMsg(this.nls.errUrl);\r\n                }\r\n              }\r\n            }\r\n\r\n            this.shelter.hide();\r\n            def.resolve(false);\r\n          }\r\n        }), lang.hitch(this, function (/*err*/) {\r\n          //TODO err\r\n          html.removeClass(this.domNode, \"validating\");\r\n          html.removeClass(this.domNode, \"error\");\r\n          this.shelter.hide();\r\n          def.resolve(false);\r\n        }));\r\n\r\n        return def;\r\n      },\r\n      isUrlEmpty: function () {\r\n        html.addClass(this.domNode, \"validating\");\r\n        var type = this._getType();\r\n        var url = this._getArcLayerInputsValue(type);\r\n        if (!url || \"\" === url) {\r\n          this._showErrMsg(this.nls.errUrl);\r\n        } else {\r\n          html.removeClass(this.domNode, \"validating\");\r\n          this._showErrMsg(null);\r\n        }\r\n      },\r\n\r\n      getValues: function () {\r\n        var type = this._getType();\r\n        var baseLayerObj = {\r\n          url: this._getArcLayerInputsValue(type),\r\n          type: type,\r\n          // tileLayerInfo: {\r\n          //   url: jimuUtils.stripHTML(this.tileLayerUrl.value || \"\"),\r\n          //   tile: this.tile.value,\r\n          //   credits: this.credits.value,\r\n          //   subDomains: this._getSubDomains(),\r\n          //   tileInfo: this._getTileInfo(),\r\n          //   extent: this.map.extent.toJson()//TODO initExtent\r\n          // },\r\n          veLayerInfo: {\r\n            //credential: this.VECredential.value,\r\n            isKeyInPortal: utils.valid.isHaveBingKey()\r\n            //style: this.VEStyle.value\r\n          }\r\n        };\r\n\r\n        return baseLayerObj;\r\n      },\r\n\r\n      setValues: function (config) {\r\n        if (config.overviewMap.baseLayer) {\r\n          var type = config.overviewMap.baseLayer.type;\r\n          this._setArcLayerInputsValue(config.overviewMap.baseLayer.url, type);\r\n          this.baseLayerType.set('value', type);\r\n          // if (config.overviewMap.baseLayer.tileLayerInfo) {\r\n          //   this.tileLayerUrl.value = jimuUtils.stripHTML(config.overviewMap.baseLayer.tileLayerInfo.url || \"\");\r\n          //   this.tile.value = jimuUtils.stripHTML(config.overviewMap.baseLayer.tileLayerInfo.tile || \"\");\r\n          //   this.credits.value = jimuUtils.stripHTML(config.overviewMap.baseLayer.tileLayerInfo.credits || \"\");\r\n          //   this.subdomain.value = jimuUtils.stripHTML(config.overviewMap.baseLayer.tileLayerInfo.subDomains || \"\");\r\n          //   //this.extent.value = jimuUtils.stripHTML(config.overviewMap.baseLayer.tileLayerInfo.extent || \"\");//TODO\r\n          //   this.tileInfo.value = jimuUtils.stripHTML(config.overviewMap.baseLayer.tileLayerInfo.tileInfo || \"\");\r\n          // }\r\n          if (config.overviewMap.baseLayer.veLayerInfo) {\r\n            //this.VECredential.value = jimuUtils.stripHTML(config.overviewMap.baseLayer.veLayerInfo.credential || \"\");\r\n            //this.VEStyle.set('value', config.overviewMap.baseLayer.veLayerInfo.style);\r\n          }\r\n          //this._onTileLayerUrlChange();\r\n        }\r\n      },\r\n\r\n      /************************************** */\r\n      _getType: function () {\r\n        return this.baseLayerType.value;\r\n      },\r\n      _setArcLayerInputsValue: function (value, type) {\r\n        var input = this._getArcGISLayerInput(type);\r\n        if (input && input.setValue) {\r\n          input.setValue(jimuUtils.stripHTML(value || \"\"));\r\n        }\r\n      },\r\n      _getArcGISLayerInput: function (type) {\r\n        switch (type) {\r\n          case this.TYPE.ARCGIS_TILED_MAP: {\r\n            return this.tiledMapServiceUrlInput;\r\n          } case this.TYPE.ARCGIS_DYNAMIC_MAP_SERVICE: {\r\n            return this.dynamicMapServiceUrlInput;\r\n          } case this.TYPE.ARCGIS_IMAGE_SERVICE: {\r\n            return this.imageServiceUrlInput;\r\n          }\r\n        }\r\n      },\r\n      _setArcGISLayerInputState: function (state) {\r\n        var type = this._getType();\r\n        var input = this._getArcGISLayerInput(type);\r\n        if (input) {\r\n          input.set(\"state\", state);\r\n        }\r\n      },\r\n      _getArcLayerInputsValue: function (type) {\r\n        var value;\r\n        var input = this._getArcGISLayerInput(type);\r\n        if (input && input.value) {\r\n          value = input.value;\r\n\r\n          if (\"\" !== value && (false === /^\\/\\//.test(value) && false === /(^(.+):\\/\\/)/.test(value))) {\r\n            value = 'http://' + value;\r\n          }\r\n        }\r\n\r\n        return jimuUtils.stripHTML(value || \"\");\r\n      },\r\n      _showErrMsg: function (msg) {\r\n        if (!msg) {\r\n          this._setArcGISLayerInputState(\"\");\r\n          html.addClass(this.errorNode, \"hide\");\r\n          this.errorNode.innerHTML = \"\";\r\n        } else {\r\n          //this._getArcGISLayerInput().focus();\r\n          this._setArcGISLayerInputState(\"Error\");\r\n          html.removeClass(this.errorNode, \"hide\");\r\n        }\r\n\r\n        var type = this._getType();\r\n        var input = this._getArcGISLayerInput(type);\r\n        if (input && input.displayMessage) {\r\n          input.displayMessage(msg);\r\n        }\r\n        this.errorNode.innerHTML = msg;\r\n      },\r\n\r\n      _toggleVELayerByKey: function () {\r\n        //hide VE, when there is NO bing-key\r\n        if (!utils.valid.isHaveBingKey()) {\r\n          this.baseLayerType.removeOption(this.TYPE.BING_AERIAL);\r\n          this.baseLayerType.removeOption(this.TYPE.BING_HYBRID);\r\n          this.baseLayerType.removeOption(this.TYPE.BING_ROAD);\r\n        }\r\n      },\r\n      _setBaseLayerStyle: function (layerType) {\r\n        var type = layerType;\r\n        if (!layerType) {\r\n          if (this.config.overviewMap.baseLayer && this.config.overviewMap.baseLayer.type) {\r\n            type = this.config.overviewMap.baseLayer.type;\r\n          }\r\n        }\r\n\r\n        html.addClass(this.baseLayerContainer, \"hide\");\r\n\r\n        html.addClass(this.tiledMapServiceUrlInput.domNode, \"hide\");\r\n        html.addClass(this.dynamicMapServiceUrlInput.domNode, \"hide\");\r\n        html.addClass(this.imageServiceUrlInput.domNode, \"hide\");\r\n        //html.addClass(this.tileLayerContainer, \"hide\");\r\n        //html.addClass(this.VELayerContainer, \"hide\");\r\n        switch (type) {\r\n          case this.TYPE.BASE_MAP: {\r\n            break;\r\n          } case this.TYPE.ARCGIS_TILED_MAP: {\r\n            html.removeClass(this.baseLayerContainer, \"hide\");\r\n            html.removeClass(this.tiledMapServiceUrlInput.domNode, \"hide\");\r\n            break;\r\n          } case this.TYPE.ARCGIS_DYNAMIC_MAP_SERVICE: {\r\n            html.removeClass(this.baseLayerContainer, \"hide\");\r\n            html.removeClass(this.dynamicMapServiceUrlInput.domNode, \"hide\");\r\n            break;\r\n          } case this.TYPE.ARCGIS_IMAGE_SERVICE: {\r\n            html.removeClass(this.baseLayerContainer, \"hide\");\r\n            html.removeClass(this.imageServiceUrlInput.domNode, \"hide\");\r\n            break;\r\n          } case this.TYPE.OSM: {\r\n            break;\r\n          } case this.TYPE.BING_ROAD: {\r\n            break;\r\n          } case this.TYPE.BING_AERIAL: {\r\n            break;\r\n          } case this.TYPE.BING_HYBRID: {\r\n            break;\r\n          } default: { break; }\r\n        }\r\n      },\r\n\r\n      /***************   TileLayer   ***************** */\r\n      _onTileLayerUrlChange: function (isCleanSubDomain) {\r\n        var url = this.tileLayerUrl.value;\r\n        if (url.toLowerCase().indexOf(\"{subdomain}\") > -1) {\r\n          html.removeClass(this.subdomainContainer, \"hide\");\r\n        } else {\r\n          html.addClass(this.subdomainContainer, \"hide\");\r\n          if (isCleanSubDomain) {\r\n            this.subdomain.value = \"\";\r\n          }\r\n        }\r\n      },\r\n      _getSubDomains: function () {\r\n        this._onTileLayerUrlChange(true);\r\n\r\n        var tileLayerSubDomains = null;\r\n        if (this.subdomain.value && this.subdomain.value.length > 0) {\r\n          tileLayerSubDomains = this.subdomain.value.split(\",\");\r\n          tileLayerSubDomains = array.map(tileLayerSubDomains, function (sd) {\r\n            return lang.trim(sd);\r\n          });\r\n        }\r\n\r\n        return tileLayerSubDomains;\r\n      },\r\n      _getTileInfo: function () {\r\n        var tileInfoStr = this.tileInfo.value;\r\n        if (true !== utils.valid.tileInfoStr(tileInfoStr)) {\r\n          //TODO popup the error\r\n        }\r\n\r\n        return tileInfoStr;\r\n      }\r\n    });\r\n  });"]}