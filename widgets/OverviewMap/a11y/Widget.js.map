{"version":3,"sources":["../../../../widgets/OverviewMap/a11y/Widget.js"],"names":["define","lang","on","html","jimuUtils","aspect","keys","mo","a11y_init","setAttr","overviewMapDijit","_maximizerDiv","appConfig","window","getAppConfig","theme","name","_a11y_isLaunchpadTheme","_a11y_index","getAttr","domNode","removeAttr","_controllerDiv","parseInt","initFirstFocusNode","initLastFocusNode","a11y_initEvents","_a11y_RAW_DOM_NODE_HEIGHT","getStyle","_openedBy508Enter","_closedBy508Controller","_initToShow","config","overviewMap","visible","own","hitch","evt","target","keyCode","ENTER","hasClass","baseClass","TAB","preventDefault","focus","isInNavMode","show","setTimeout","focusNode","document","activeElement","isDescendant","hide","_maximizeHandler","ESCAPE","a11y_forLaunchpadThemeStyle","after","tarNode","container","parentElement","parentNode","parentTar","_maximized","addClass","removeClass"],"mappings":"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","file":"Widget.js","sourcesContent":["///////////////////////////////////////////////////////////////////////////\r\n// Copyright Â© Esri. All Rights Reserved.\r\n//\r\n// Licensed under the Apache License Version 2.0 (the \"License\");\r\n// you may not use this file except in compliance with the License.\r\n// You may obtain a copy of the License at\r\n//\r\n//    http://www.apache.org/licenses/LICENSE-2.0\r\n//\r\n// Unless required by applicable law or agreed to in writing, software\r\n// distributed under the License is distributed on an \"AS IS\" BASIS,\r\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n// See the License for the specific language governing permissions and\r\n// limitations under the License.\r\n///////////////////////////////////////////////////////////////////////////\r\n\r\ndefine([\r\n  'dojo/_base/lang',\r\n  'dojo/on',\r\n  'dojo/_base/html',\r\n  'jimu/utils',\r\n  \"dojo/aspect\",\r\n  'dojo/keys'\r\n  //\"dijit/a11yclick\",\r\n],\r\n  function (lang, on, html, jimuUtils, aspect, keys/*, a11yclick*/) {\r\n    var mo = {};\r\n\r\n    mo.a11y_init = function () {\r\n\r\n      html.setAttr(this.overviewMapDijit._maximizerDiv, \"tabindex\", 0);\r\n\r\n      var appConfig = window.getAppConfig();\r\n      if (appConfig.theme.name === \"LaunchpadTheme\") {\r\n        this._a11y_isLaunchpadTheme = true;\r\n      }\r\n      //_controllerDiv must be the first focusable node, so keyboard will trigger it when enter widgetDom\r\n      if (this._a11y_isLaunchpadTheme) {\r\n        if (!this._a11y_index) {\r\n          this._a11y_index = html.getAttr(this.domNode, \"tabindex\");\r\n          html.removeAttr(this.domNode, \"tabindex\");\r\n        }\r\n        if (this._a11y_index) {\r\n          html.setAttr(this.overviewMapDijit._controllerDiv, \"tabindex\", parseInt(this._a11y_index, 10));\r\n        }\r\n\r\n        jimuUtils.initFirstFocusNode(this.domNode, this.overviewMapDijit._maximizerDiv);\r\n        jimuUtils.initLastFocusNode(this.domNode, this.overviewMapDijit._maximizerDiv);\r\n      } else {\r\n\r\n        html.setAttr(this.overviewMapDijit._controllerDiv, \"tabindex\", 0);\r\n\r\n        jimuUtils.initFirstFocusNode(this.domNode, this.overviewMapDijit._controllerDiv);\r\n        jimuUtils.initLastFocusNode(this.domNode, this.overviewMapDijit._maximizerDiv);\r\n      }\r\n    };\r\n\r\n    mo.a11y_initEvents = function () {\r\n      this._a11y_RAW_DOM_NODE_HEIGHT = html.getStyle(this.domNode, 'height');//getRawDomNodeHeight for LaunchpadTheme\r\n\r\n      this._openedBy508Enter = false;\r\n      this._closedBy508Controller = false;\r\n      this._initToShow = !!(this.config.overviewMap.visible);\r\n\r\n      this.own(on(this.domNode, 'keydown', lang.hitch(this, function (evt) {\r\n        var target = evt.target;\r\n        if (false === this._initToShow && evt.keyCode === keys.ENTER && html.hasClass(target, this.baseClass)) {\r\n          this._openedBy508Enter = true;\r\n        }\r\n\r\n        if (true !== this._a11y_isLaunchpadTheme) {\r\n          //remove these events when esri/overviewMap dijit supports 508\r\n          //dijit's first node and last node are not in normal order by dom-structure\r\n          if (evt.keyCode === keys.TAB && !html.hasClass(target, this.baseClass)) {\r\n            evt.preventDefault();\r\n            if (html.hasClass(target, 'ovwController')) {\r\n              this.overviewMapDijit._maximizerDiv.focus();\r\n            } else if (html.hasClass(target, 'ovwMaximizer')) {\r\n              this.overviewMapDijit._controllerDiv.focus();\r\n            }\r\n          }\r\n        }\r\n      })));\r\n\r\n      this.own(on(this.domNode, 'focus', lang.hitch(this, function () {\r\n        if (true === this._closedBy508Controller || this._a11y_isLaunchpadTheme) {\r\n          //this._closedBy508Controller = false;\r\n          return;\r\n        }\r\n\r\n        if (false === this._initToShow && jimuUtils.isInNavMode() && !this._openedBy508Enter &&\r\n          html.getStyle(this.domNode, 'height') <= 10) {\r\n          this.overviewMapDijit.show(); //show widget temporarily\r\n        }\r\n      })));\r\n\r\n      this.own(on(this.domNode, 'blur', lang.hitch(this, function () {\r\n        if (false === this._initToShow && jimuUtils.isInNavMode() && !this._openedBy508Enter &&\r\n          true !== this._a11y_isLaunchpadTheme) {\r\n\r\n          setTimeout(lang.hitch(this, function () {\r\n            var focusNode = document.activeElement;\r\n            if (!html.isDescendant(focusNode, this.domNode)) {\r\n              this.overviewMapDijit.hide(); //hide widget\r\n            }\r\n          }), 10);//wait for dom update\r\n        }\r\n      })));\r\n\r\n      //remove these events when esri/overviewMap dijit supports 508\r\n      this.own(on(this.overviewMapDijit._controllerDiv, 'keydown', lang.hitch(this, function (evt) {\r\n        if (evt.keyCode === keys.ENTER) {\r\n          if (this.overviewMapDijit.visible) {\r\n            this.overviewMapDijit.hide();\r\n            //back to focus and display widgetDom temperly when set it closed.\r\n            this._openedBy508Enter = false;\r\n            this._closedBy508Controller = true;//skip out the focus\r\n\r\n            if (true !== this._a11y_isLaunchpadTheme) {\r\n              this.domNode.focus();\r\n            } else {\r\n              this.overviewMapDijit._controllerDiv.focus();\r\n            }\r\n          } else {\r\n            this.overviewMapDijit.show();\r\n\r\n            if (false === this._initToShow) {\r\n              this._openedBy508Enter = true;\r\n              this._closedBy508Controller = false;\r\n            }\r\n\r\n            if (true === this._a11y_isLaunchpadTheme) {\r\n              this.overviewMapDijit._maximizerDiv.focus();\r\n            }\r\n          }\r\n        }\r\n      })));\r\n\r\n      this.own(on(this.overviewMapDijit._maximizerDiv, 'keydown', lang.hitch(this, function (evt) {\r\n        if (evt.keyCode === keys.ENTER) {\r\n          this.overviewMapDijit._maximizeHandler();\r\n        }\r\n\r\n        if (true === this._a11y_isLaunchpadTheme && this.overviewMapDijit.visible) {\r\n          if (evt.keyCode === keys.ESCAPE) {\r\n            this.overviewMapDijit.hide();\r\n            this.overviewMapDijit._controllerDiv.focus();\r\n          }\r\n        }\r\n      })));\r\n    };\r\n\r\n    mo.a11y_forLaunchpadThemeStyle = function () {\r\n      this.own(aspect.after(this.overviewMapDijit, \"_maximizeHandler\",\r\n        lang.hitch(this, function () {\r\n          var tarNode = this.overviewMapDijit.overviewMap.container.parentElement ||\r\n            this.overviewMapDijit.overviewMap.container.parentNode;\r\n          var parentTar = tarNode.parentElement || tarNode.parentNode;\r\n\r\n          if (this.overviewMapDijit._maximized) {\r\n            html.addClass(tarNode, \"a11y_maximized\");\r\n            html.addClass(parentTar, \"a11y_maximized\");\r\n          } else {\r\n            html.removeClass(tarNode, \"a11y_maximized\");\r\n            html.removeClass(parentTar, \"a11y_maximized\");\r\n          }\r\n        }), this));\r\n    };\r\n\r\n    return mo;\r\n  });"]}